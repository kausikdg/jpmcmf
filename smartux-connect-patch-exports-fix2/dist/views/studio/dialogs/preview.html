<div class="heading">
    <h1>Preview</h1>
</div>

<div ui-layout="{ flow : 'column', dividerSize: 6}" class="layout">
    <div ui-view="center" ui-layout-container="central" id="central" class="overflow-hidden">
        <div class="pull-left left-pane">
            <div collapsible>
                <input class="marker" type="radio" name="left-block" value="devices" ng-model="model.expanded">
                <label class="section target">Devices</label>
                <div class="content">
                    <ul class="menu no-float">
                        <label class="section">iOS</label>
                        <li ng-repeat="device in devices | filter: {platform: 'ios'}" ng-click="model.activeDevice = device" ng-class="{'active': model.activeDevice.id === device.id}">
                            {{device.name}}
                        </li>
                        <label class="section">Android</label>
                        <li ng-repeat="device in devices | filter: {platform: 'android'}" ng-click="model.activeDevice = device" ng-class="{'active': model.activeDevice.id === device.id}">
                            {{device.name}}
                        </li>
                        <label class="section">Windows</label>
                        <li ng-repeat="device in devices | filter: {platform: 'windows'}" ng-click="model.activeDevice = device" ng-class="{'active': model.activeDevice.id === device.id}">
                            {{device.name}}
                        </li>
                        <label class="section">Other</label>
                        <li ng-repeat="device in devices | filter: {platform: 'core'}" ng-click="model.activeDevice = device" ng-class="{'active': model.activeDevice.id === device.id}">
                            {{device.name}}
                        </li>
                    </ul>
                </div>
            </div>

            <div collapsible>
                <input class="marker" type="radio" name="left-block" value="preview" ng-model="model.expanded">
                <label class="section target">On-Device Preview</label>
                <div class="content qrcode-content">
                    <qrcode data="{{devicePreviewUrl}}" version="7" size="160"></qrcode>
                    <div class="link-container">
                        <a class="clear section-control" href="https://community.powwowmobile.com/hc/en-us/articles/360002251211" target="_blank">Instructions</a>
                    </div>
                </div>
            </div>

            <div collapsible>
                <input class="marker" type="radio" name="left-block" value="advanced" ng-model="model.expanded">
                <label class="section target">Advanced Options</label>
                <div class="content">
                    <div>
                        <span class="section-control">Landscape:</span>
                        <switch ng-model="model.landscapeMode"></switch>
                    </div>
                    <div>
                        <span class="section-control">Mock server data:</span>
                        <switch ng-model="model.mock"></switch>
                    </div>
                    <div class="link-container">
                        <a class="clear section-control" id="fullscreen-preview" onclick="document.querySelector('.preview .preview-content').webkitRequestFullscreen();">
                            Full Screen
                        </a>
                    </div>
                    <div class="link-container">
                        <a class="clear section-control" ng-href="{{appUrl}}" target="_blank">App Link</a>
                    </div>
                </div>
            </div>
        </div>

        <div class="preview-content preview-{{model.activeDevice.id}}" ng-class="{'landscape': model.landscapeMode}">
            <iframe name="preview" src="{{previewUrl}}"></iframe>
        </div>
    </div>
    <div ng-if="!model.mock" ui-view="rightPane" ui-layout-container id="east" size="500px" min-size="400px">
        <div class="run-server form">
            <div class="form-control row">
                <span class="label-container">
                    <span class="label ellipsis">Server URL:</span>
                </span>
                <span class="col-xs">
                    <input type="text" ng-model="model.rpcUrl" ng-model-options="{debounce: 500}">
                </span>
                <span class="button-container">
                    <button class="button" ng-click="startServer()" ng-disabled="serverRunning">Start</button>
                </span>
                <span class="button-container">
                    <button class="button" ng-click="stopServer()" ng-disabled="!serverRunning">Stop</button>
                </span>
            </div>
            <div class="form-control row" ng-if="debugUrl">
                <span class="label-container">
                    <span class="label ellipsis">Debug Link:</span>
                </span>
                <span class="col-xs">
                    <input type="text" id="debugLink" ng-model="debugUrl">
                </span>
                <span class="button-container">
                    <button class="button" data-copytarget="#debugLink" ng-click="copyLink($event)">Copy</button>
                </span>
                <span class="button-container"></span>
            </div>
            <div class="form-control row" ng-if="sourceAppUrl">
                <span class="label-container">
                    <span class="label ellipsis">Source App:</span>
                </span>
                <span class="button-container">
                    <a class="button" ng-href="{{sourceAppUrl}}" target="_blank">Open</a>
                </span>
            </div>
            <div class="form-control row">
                <span class="label-container">
                    <span class="label ellipsis">Server Output:</span>
                </span>
            </div>
            <div class="row fill-height no-margin">
                <textarea id="runServerOutput" ng-disabled="true" ng-model="model.runServer.output"></textarea>
            </div>
        </div>

    </div>
</div>

<div class="buttons">
    <button class="button" ng-click="closeThisDialog()">Close
    </button>

    <form class="form inline">
        <div class="form-control form-control-center">
            <span class="control-sized" ng-if="model.mock">View Screen:</span>
            <select ng-if="model.mock" ng-model="model.startScreenId">
                <option ng-repeat-start="screen in screens" ng-if="!screen.folder" value="{{screen.id}}" ng-selected="model.startScreenId === screen.id">{{screen.name}}
                </option>
                <optgroup ng-repeat-end ng-if="screen.folder" label="{{screen.name}}"></optgroup>
            </select>
        </div>
    </form>
</div>
