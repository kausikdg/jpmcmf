<input class="marker" type="checkbox" ng-show="isCollapsible(node)" ng-model="node.expanded">

<label class="target" ng-show="isCollapsible(node)"></label>

<span class="item" ng-show="!isEditable(node) || edit.node!==node && delete.node!==node" ng-click="isClickable(node) && onClick(node)" ng-dblclick="isClickable(node) && onDblClick(node)" ng-class="[{'selected': isSelected(node), 'warning': isWarned(node), 'clickable': isClickable(node)}, getItemClass(node)]" drag-and-drop="{
          draggable: isDraggable(node),
          data: getDragData(node),
          onStart: getDragStart(node),
          onEnd: getDragEnd(node),
          effect: isSortable(node) ? 'move' : 'copy',

          acceptedTypes: getAcceptedTypes(node),
          onEnter: getDragEnter(node),
          onLeave: getDragLeave(node),
          onDrop: getDragDrop(node)
      }">
    <span class="left-button" ng-if="hasLeftButton()">
        <button class="fa fa-bars"></button>
    </span>
    <input type="checkbox" ng-if="hasCheckbox(node)" ng-checked="isChecked(node)" ng-click="onClickCheckbox(node, $event)">
    <i class="fa {{getIcon(node)}}" ng-if="!hasCheckbox(node) && getIcon(node) || hasIcon(node)"></i>
    <span class="label">{{getLabel(node)}}</span>
    <span class="description">
        <i class="fa" ng-if="getDescriptionIcon(node)" ng-repeat="icon in getDescriptionIcon(node) track by $index" ng-class="icon"></i>
        {{getDescription(node)}}
    </span>
    <b ng-if="hasAsterisk(node)" class="asterisk">*</b>

    <!-- TODO: remove this from a common directive -->
    <div ng-if="hasAssociatedItem(node)" class="associatedItem">{{getAssociatedItem(node)}}</div>

    <span class="controls" ng-if="isEditable(node) || getControls(node)">

        <button class="fa" ng-if="getControls(node)" ng-repeat="button in getControls(node)" ng-class="button.icon" ng-click="button.action(node, $event, $parent)" title="{{button.title}}"></button>

        <button class="fa fa-plus" title="Add child" ng-if="clickAddChild && hasAddChild(node) && isEditable(node)" ng-click="cancel(); clickAddChild(node, $event);"></button>
        <button class="fa fa-pencil" title="Rename" ng-if="clickRename && hasRename(node) && isEditable(node)" ng-click="cancel(); clickRename(node, $event)"></button>
        <button class="fa fa-trash" title="Delete" ng-if="clickDelete && hasDelete(node) && isEditable(node)" ng-click="cancel(); clickDelete(node, $event)"></button>

    </span>

    <ng-include ng-if="hasTemplate(node)" ng-model="getTemplateModel(node)" ng-model-options="{ getterSetter: true }" class="template" src="getTemplateSrc(node)"></ng-include>
</span>

<ng-include ng-if="isEditable(node) && edit.node===node" src="'/views/common/directives/tree/treeEditNode.html'"></ng-include>

<ng-include ng-if="isEditable(node) && delete.node===node" src="'/views/common/directives/tree/treeDeleteNode.html'"></ng-include>

<ul class="content not-displayed" ng-if="isArray(node) && (isCollapsible(node) && node.expanded || !isCollapsible(node) && getChildren(node))">

    <li ng-repeat="child in getChildren(node) track by child.id" tree-node="child" ng-if="!isHidden(child)" collapsible></li>

    <ng-include ng-if="isEditable(node) && edit.parentNode===node" src="'/views/common/directives/tree/treeEditNode.html'"></ng-include>
</ul>

<ul class="content not-displayed" ng-if="!isArray(node) && (isCollapsible(node) && node.expanded || !isCollapsible(node) && getChildren(node))">

    <li ng-repeat="(key, child) in getChildren(node)" tree-node="child" ng-if="!isHidden(child)" collapsible></li>

    <ng-include ng-if="isEditable(node) && edit.parentNode===node" src="'/views/common/directives/tree/treeEditNode.html'"></ng-include>

</ul>
