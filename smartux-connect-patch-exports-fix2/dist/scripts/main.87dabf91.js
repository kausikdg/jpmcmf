"use strict";function WsWrapper(e){var t=this;this.ws=e,e.onmessage=this._onmessage=function(e){var n;try{n=JSON.parse(e.data)}catch(e){console.log("Can not parse ws message response: ",e)}n&&"2.0"===n.jsonrpc&&"function"==typeof t.onmessage&&t.onmessage.call(t,n)},e.onclose=this._onclose=function(){console.log("close"),"function"==typeof t.onclose&&t.onclose.call(t)}}function getAppPermissions(e,t){var n=[];return _.each(t,function(t){n.push({id:t.id,name:t.name,permission:getAppPermission(e,t.id)})}),n}function getAppPermission(e,t){return e.isAdmin&&!e.permissions?"edit":e.permissions[t]?e.permissions[t]:"none"}function setAppPermissions(e){var t={};return _.each(e,function(e){"none"!==e.permission&&(t[e.id]=e.permission)}),t}angular.module("common",["ui.router","uuid","ngSanitize"]),angular.module("common").config(["$locationProvider",function(e){e.hashPrefix("!")}]).factory("commonConfig",["$location",function(e){var t=e.search(),n={};return n.env=t.env||"production",n.serverPort=t.serverPort||e.port(),n.serverUrl=e.protocol()+"://"+e.host()+":"+n.serverPort,n.reconnectTimeout="production"===n.env?5e3:2e3,n.errorTemplatePath="/views/common/dialogs/error.html",n}]),angular.module("common").run(["$rootScope",function(e){e.EVENT_API_SUCCESS="api.success",e.EVENT_DIALOG_REQUESTED="dialog.requested",e.EVENT_FILE_SELECTED="file.selected",e.EVENT_FILE_CLOSED="file.closed",e.EVENT_BUILD_FINISHED="build.finished"}]),angular.module("common").run(["$rootScope","$log","$rootElement","ngDialog","commonHelperService","$document","config","$http","$templateCache",function(e,t,n,r,o,i,s,a,l){e.appName=n.attr("ng-app"),a.get(s.errorTemplatePath).then(function(e){l.put(s.errorTemplatePath,e.data)}),e.$log=t,e._=_,e.isLoading=!1,e.showLoading=function(){e.isLoading=!0},e.hideLoading=function(){e.isLoading=!1},e.showNotification=function(t){e.hasNotification=!0,e.notification=t},e.hideNotification=function(){e.hasNotification=!1,e.notification={}},e.$on(e.EVENT_DIALOG_REQUESTED,_.debounce(function(t,n,s,a){a=a||{};var l=n.replace(/\//g,"-");if(!i[0].querySelector(".ngdialog."+l)||a.allowMultiple){var c="/views/"+(a.isCommon?"common":e.appName)+"/dialogs/";r.open({template:c+n+".html",controller:o.nameToController(n),className:l,data:s||{},disableAnimation:!0,showClose:!1,ariaAuto:!1,preCloseCallback:a.preCloseCallback,closeByEscape:!~_.keys(a).indexOf("closeByEscape")||!!a.closeByEscape,closeByDocument:!~_.keys(a).indexOf("closeByDocument")||!!a.closeByDocument})}},300,!0))}]),angular.module("common").service("allFilesService",["$q","$timeout","$rootScope","batchRequest","apiService","commonDialogs","sessionService",function(e,t,n,r,o,i,s){function a(){let e=[];_.each(u,t=>{e.push({id:t.id,sticky:t.isSticky,selected:p===t.id})}),s.set("files",e)}let l,c=this,d={},u={},p=null;c.TYPE_DIRECTORY="directory",c.TYPE_LINK="link",c.TYPE_FILE="file",c.setRoot=function(e){l=e},c.resetCache=function(){d={},u={}},c.fetch=function(){return o.files.getTree({root:l}).then(function(e){return d.children=e,c.eachNode(c.processNode),d})},c.eachNode=function(e,t,n){t=t||d.children,n=n||d,t.forEach(r=>{e(r,t,n),r.children&&c.eachNode(e,r.children,r)})},c.processNode=function(e,t,n){e.id=`${e.path}/${e.name}`,e.parent=n,e.siblings=t,e.type!==c.TYPE_DIRECTORY||e.children||(e.children=[])},c.eachChildFile=function(e,t,n){e.children.forEach(e=>{t(e),e.children&&!n&&c.eachChildFile(e,t)})},c.updateChildNodes=function(e){c.eachChildFile(e,t=>{t.path=`${e.path}/${e.name}`,c.processNode(t,e.children,e),t.children&&c.updateChildNodes(t)},!0)},c.findById=function(e){let t;return c.eachNode(n=>{n.id===e&&(t=n)}),t||null},c.openFile=function(e){return o.files.getSource({id:e,root:l}).then(t=>{let n=c.findById(e);return n.source=t,u[e]=n,n})},c.createFile=function(e,t,n){let r={path:e.id,name:t,type:n,root:l};return o.files.createFile(r).then(t=>(c.processNode(t.data,e.children,e),e.children.push(t.data),t.data))},c.renameFile=function(e,t){return o.files.renameFile({id:e.id,name:t,root:l}).then(()=>(e.id=`${e.path}/${t}`,e.name=t,e.type===c.TYPE_DIRECTORY&&c.updateChildNodes(e),e))},c.deleteFile=function(e){return o.files.deleteFile({id:e.id,root:l}).then(()=>{switch(e.type){case c.TYPE_DIRECTORY:c.eachChildFile(e,e=>{c.isOpenedFile(e.id)&&c.closeFile(e.id)});break;case c.TYPE_FILE:c.isOpenedFile(e.id)&&c.closeFile(e.id)}let t=e.parent.children;t.splice(t.indexOf(e),1)})},c.isValidName=function(e,t,n){let r=!!e,o=!!n,i=_.pluck(t.children,"name").indexOf(e)<0;return o&&(i=i||e===n.name),r&&i},c.getOpenedFiles=function(){return u},c.hasDirtyFiles=function(){return _.where(u,{isDirty:!0}).length>0},c.selectFile=function(e){if(!u[e])return c.getSelectedFile();p=e;let t=c.getSelectedFile();return n.$broadcast(n.EVENT_FILE_SELECTED,e),a(),t},c.stickFile=function(e){u[e]&&(u[e].isSticky=!0),a()},c.closeFile=function(e,t){if(p===e){let n=Object.keys(u);if(t)p=null;else if(n.length>1){let t=n.indexOf(e),r=t>0?t-1:t+1;c.selectFile(n[r])}else p=null}u[e]&&(u[e].expanded=!1),["isDirty","isSticky"].forEach(t=>delete u[e][t]),delete u[e],t||a(),n.$broadcast(n.EVENT_FILE_CLOSED,e)},c.closeAllFiles=function(e){_.isEmpty(u)||(e&&s.clear("files"),_.each(u,(e,t)=>c.closeFile(t,!0)),p=null)},c.restoreFiles=function(){let t,n=[],r=s.get("files");return r.forEach(e=>{e.selected&&(t=e.id),c.findById(e.id)&&n.push(c.openFile(e.id).then(t=>{t.isSticky=e.sticky}))}),e.all(n).then(()=>{!(t&&c.findById(t))&&r.length>0&&c.findById(r[0].id)&&(t=r[0].id),c.selectFile(t)})},c.fileChanged=function(e){t(()=>{u[e].isSticky=!0,u[e].isDirty=!0},!0)},c.isOpenedFile=function(e){return Object.keys(u).indexOf(e)>-1},c.getSelectedFile=function(){return u[p]},c.setSource=function(e){r.add(o.files.setSource,{id:e,root:l,source:u[e].source}).then(()=>u[e].isDirty=!1)},c.saveAllFiles=function(){let t=[];return _.each(u,(e,n)=>{e.isDirty&&t.push(c.setSource(n))}),e.all(t).then(()=>r.send())},c.refreshAllFilesTab=function(){return c.closeAllFiles(),c.fetch().then(c.restoreFiles)},c.processOpeningFile=function(e){let t=c.getSelectedFile();if(_.isEmpty(u))return c.openFile(e).then(e=>(c.selectFile(e.id),e));if(u[e])return t.id!==e&&c.selectFile(e),Promise.resolve(u[e]);{let t;return _.each(u,e=>{e.isSticky||(t=e)}),c.openFile(e).then(e=>(c.selectFile(e.id),t&&c.closeFile(t.id),e))}},c.processClosingFileTab=function(e){c.findById(e.id).isDirty?i.saveConfirm().then(()=>{n.showLoading(),c.setSource(e.id),r.send().then(()=>{c.closeFile(e.id),n.hideLoading()})}).catch(()=>{c.closeFile(e.id)}):c.closeFile(e.id)},c.processSelectingFileTab=function(e){p!==e.id&&c.selectFile(e.id)},c.processStickingFileTab=function(e){p!==e.id&&c.stickFile(e.id)}}]),angular.module("common").service("commonHelperService",function(){let commonHelperService=this;commonHelperService.startsWith=function(e,t){return null!==e&&void 0!==e&&e.substring(0,t.length)===t},commonHelperService.endsWith=function(e,t){return null!==e&&void 0!==e&&e.substring(e.length-t.length,e.length)===t},commonHelperService.toKebabCase=function(e){return void 0===e?"":e.replace(/([a-z])([A-Z])/g,"$1-$2").replace(/\s+/g,"-").toLowerCase()},commonHelperService.toLowerCase=function(e){if(void 0===e)return"";return commonHelperService.filterName(e).toLowerCase()},this.toPascalCase=(e=>{if(void 0===e)return"";let t=e.replace(/[^\a-zA-Z0-9 ]/g," ").split(" ");return t.length?t.reduce((e,t)=>e+t.charAt(0).toUpperCase()+t.slice(1),""):""}),commonHelperService.filterName=function(e,t){if(void 0===e)return"";let n=t?"_":"",r=new RegExp(`[^a-zA-Z0-9${n}]`,"g");return e.replace(r,"")},commonHelperService.filterStyleName=function(e){if(e.match(/[^\a-zA-Z0-9]/g))return"";let t=e.toLowerCase();return""===t?"":`_${t}.scss`},commonHelperService.nameToController=function(e){return(e=e.replace(/\//g,"-")).split("-").reduce((e,t)=>e+t.charAt(0).toUpperCase()+t.slice(1),"")+"Ctrl"},commonHelperService.isSrcElementInput=function(e){let t=e.srcElement||e.target;return"INPUT"===t.tagName.toUpperCase()||"TEXTAREA"===t.tagName.toUpperCase()},commonHelperService.parseRepeatValue=function(e){let t=/(?:(?:^let\s+(.+))\sof\s)(.+?)(?:;|\s|$)(?:let\s+(.+|\s+)=(.+))?/;const n=t.exec(e)[1],r=t.exec(e)[2].replace("data.",""),o=`data.${r.replace(".options","")}`,i=t.exec(e)[3],s=t.exec(e)[4];let a={variable:n,array:r,selectData:o};return i&&(a[s.replace(/\s/,"")]=i.replace(/\s/,"")),a},commonHelperService.mergeObjects=function(e){let t=Array.prototype.slice.call(arguments,commonHelperService.mergeObjects.length);if(!t.length)return e;const n=t.shift();for(const t in n)_.isObject(n[t])&&!_.isArray(n[t])?(e[t]||Object.assign(e,{[t]:{}}),commonHelperService.mergeObjects(e[t],n[t])):Object.assign(e,{[t]:n[t]});return commonHelperService.mergeObjects.apply(this,[e].concat(t))},commonHelperService.isReservedWord=function(str){try{eval(`let ${str}= 0`)}catch(e){return!0}return!1},commonHelperService.checkUrlScheme=function(e){if(e)return e.match(/^(https?|about|chrome):/)||(e="http://"+e),e}}),angular.module("common").factory("httpInterceptor",["$q","$rootScope","$injector","config","commonDialogs",function(e,t,n,r,o){return{request:function(n){return n.headers=n.headers||{},localStorage.getItem("accessToken")&&!n.headers.Authorization&&(n.headers.Authorization="Bearer "+localStorage.getItem("accessToken")),t.hideNotification(),n||e.when(n)},requestError:function(t){return e.reject(t)},response:function(t){return t||e.when(t)},responseError:function(i){let s=i.statusText,a=i.data;switch(t.hideLoading(),i.config.data.method){case"studio/applications.importRepository":return o.error("Import error",a),e.reject(i)}switch(i.status){case 401:localStorage.removeItem("accessToken"),n.get("$state").go("login");break;case 403:o.error("Permission denied",r.messages.operationNotPermitted);break;case 0:let e=i.config.url;s="Connection Error",a='Server URL <a target="_blank" href="'+e+'">'+e+"</a> is not responding.",o.error(s,a);break;case-1:break;default:o.error(s,a)}return e.reject(i)}}}]),angular.module("common").factory("wsService",["$q","$sce","$rootScope","$state","$location","config","uuid4",function(e,t,n,r,o,i,s){var a,l={},c=!1,d=!0,u=0;return l.$init=function(t){var r=(i.serverUrl.indexOf("https")>-1?"wss":"ws")+i.serverUrl.replace(/^https?/,""),o=e.defer(),p=localStorage.getItem("wsConnectionId");return p||(p=s.generate(),localStorage.setItem("wsConnectionId",p)),n.wsConnectionId=p,a=new WebSocket(r+"?wsConnectionId="+n.wsConnectionId+"&appId="+t+"&token="+localStorage.getItem("accessToken")),a.onopen=function(){console.log("WS has been opened "+r)},a.onmessage=function(e){var t=JSON.parse(e.data);switch(t.method){case"ready":d=!0,c=!0,u>0&&(u=0,n.hideLoading(),n.$apply()),o.resolve();break;case"mergeConflict":n.hideLoading(),n.$emit(n.EVENT_DIALOG_REQUESTED,"merge-conflicts",{commitsList:t.params},{isCommon:!0,allowMultiple:!0,closeByEscape:!1,closeByDocument:!1});break;case"diff":n.showNotification({message:i.messages.repositoryUpdated}),n.$apply();break;case"buildFinished":let e=t.params.error;e?n.showNotification(function(e){return{message:i.messages.compileError,dialogInfo:{title:"Compile error",message:e.message+"\nOutput:\n"+e.output}}}(e)):n.hideNotification(),n.$emit(n.EVENT_BUILD_FINISHED,e),n.$apply()}},a.onclose=function(){console.log("WS Connection closed. Reconnect?",d),c=!1,d&&(n.showLoading(),n.$apply(),u<5?(console.log("Trying to reconnect. Waiting "+i.reconnectTimeout/1e3+" seconds..."),u++,setTimeout(function(){l.$init(t)},i.reconnectTimeout)):(n.$broadcast(n.EVENT_DIALOG_REQUESTED,"error",{title:"WebSocket connection error",text:"WebSocket URL is not responding"},{isCommon:!0,allowMultiple:!0,preCloseCallback:function(){n.showLoading(),u=1,l.$init(t)}}),n.hideLoading(),d=!0,o.resolve()))},a.onerror=function(e){console.log("WS error: "+JSON.stringify(e))},o.promise},l.close=function(e){d=!e,a.close()},l.isConnected=function(){return c},l}]),angular.module("common").service("batchRequest",["$rootScope","$q","jsonrpc","apiService","commonDialogs",function(e,t,n,r,o){let i=()=>(a=!1,s=0,n.batch()),s=0,a=!1,l=i();this.add=function(n,i,c){return c&&(a=c),s++,l.add(n.$method,r.prepareParams(i,n.$namespace)).then(t=>(e.$broadcast(e.EVENT_API_SUCCESS,{name:n.$method,namespace:n.$namespace,isSetter:n.$isSetter}),t)).catch(r=>(console.error(r,n,i),e.hideLoading(),o.error(r.name,r.message),t.reject(r)))},this.send=function(){return s?l.send().then(()=>{let e=a;return l=i(),e}).catch(e=>t.reject(e)):t.resolve()},this.count=function(){return s},this.clear=function(){return l=i()}}]),angular.module("common").service("commonDialogs",["$q","$rootScope",function(e,t){this.alert=function(e,n,r){t.$emit(t.EVENT_DIALOG_REQUESTED,"alert",{title:e,text:n,data:r||{}},{isCommon:!0,allowMultiple:!0})},this.error=function(e,n,r){t.$emit(t.EVENT_DIALOG_REQUESTED,"error",{title:e,text:n,data:r||{}},{isCommon:!0,allowMultiple:!0})},this.info=function(e,n,r){t.$emit(t.EVENT_DIALOG_REQUESTED,"info",{title:e,text:n,data:r||{}},{isCommon:!0,allowMultiple:!0})},this.confirm=function(n,r,o,i){let s=e.defer();return _.isBoolean(o)&&(i=o),t.$emit(t.EVENT_DIALOG_REQUESTED,"confirm",{title:n,question:r,confirm:s.resolve,cancel:s.reject,data:o||{},danger:i},{isCommon:!0,allowMultiple:!0}),s.promise},this.prompt=function(n,r){let o=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"prompt",{label:n,value:r,confirm:o.resolve},{isCommon:!0,allowMultiple:!0}),o.promise},this.dataEntry=function(n,r,o,i){let s=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"data-entry",{parent:r,node:o,pageModels:i,modelType:n,onSubmit:s.resolve},{isCommon:!0}),s.promise},this.about=function(){t.$broadcast(t.EVENT_DIALOG_REQUESTED,"about",{},{isCommon:!0})},this.help=function(){t.$broadcast(t.EVENT_DIALOG_REQUESTED,"help",{},{isCommon:!0})},this.saveConfirm=function(n,r,o){let i=e.defer();return t.$broadcast(t.EVENT_DIALOG_REQUESTED,"save-confirm",{title:n,message:r,noDiscard:o,save:i.resolve,discard:i.reject},{isCommon:!0}),i.promise},this.createWebConnector=function(n){let r=e.defer();return t.$broadcast(t.EVENT_DIALOG_REQUESTED,"create-web-connector",{app:n,onSubmit:r.resolve},{isCommon:!0}),r.promise}}]),angular.module("common").service("layoutService",["config",function(e){this.getConfig=function(){return _.extend(e.layout,JSON.parse(localStorage.getItem("layout")))},this.updateConfig=function(e){var t=JSON.parse(localStorage.getItem("layout"))||{};t[e.id]=e.size+"px",localStorage.setItem("layout",JSON.stringify(t))}}]),angular.module("common").service("modelTreeService",["commonHelperService",function(e){function t(e,t){let n=new RegExp("^"+t.id+".?");return e.id.replace(n,"")}let n=this;n.TYPE_PAGE_MODEL="page-model",n.TYPE_SCREEN_MODEL="screen-model",n.TYPE_SHARED_MODEL="shared-model",n.process=function(e,t,r){_.each(e,(o,i)=>{let s=_.isArray(e)?o.id:i;n.processNode(o,s,t||o,r);let a=o.getChildren();n.process(a,t||o,o)})},n.processNode=function(e,r,o,i){e.id=i&&i.id?i.id+"."+r:r,e.name=r,e.path=t(e,o),e.parent=i,e.root=o,e.expanded=!0,e.getChildren=n.getChildren},n.eachNode=function(e,t,r,o){o=o?o+".":"",_.each(e,i=>{let s=o+i.name;t(i,e,r,s);let a=i.getChildren();n.eachNode(a,t,i,s)})},n.associate=function(e,t){n.eachNode(e.properties,e=>{if("model"===e.type){let r=_.findWhere(t,{id:e.model});if(r){let t=!1;n.eachNode(r.properties,n=>{"model"===e.type&&n.model===e.root.id&&(t=!0)}),t?e.circular=!0:_.extend(e,_.pick(r,"properties","items"))}}})},n.findByPath=function(e,t){if(!t)return e;let r=t.split("."),o=e;for(;r.length;){if(!o)return null;o=n.getChildren(o)[r.shift()]}return o},n.filterTypes=function(e,t){let r=angular.copy(e),o=!1;return n.eachNode(r.getChildren(),(e,n)=>{let r=e.getChildren();!~t.indexOf(e.type)&&!r||r&&0===_.keys(r).length?(delete n[e.name],o=!0):e.expanded=!0}),o&&(r=n.filterTypes(r,t)),r},n.getIcon=function(e){return e.descriptor?"fa-external-link":"Toggle menu"===e.id?"fa-bars":"action"===e.type?"fa-bolt":"method"===e.type?"fa-code":"identifier"===e.type?"fa-question":-1===["array","object"].indexOf(e.type)?"fa-cube":"fa-cubes"},n.getChildren=function(e){return"array"===(e=e||this).type&&"object"===e.items.type?e.items.properties:["object","descriptor","model"].indexOf(e.type)>-1?e.properties:"method"===e.type?e.parameters:null},n.getDescription=function(e){return"model"===e.type?e.circular?"Circular reference!":e.model:"descriptor"===e.type?e.circular?"Circular reference!":e.model:"array"===e.type?e.items.type+"[]":e.type},n.getDescriptionIcon=function(e){return null},n.validateNodeName=function(t,n,r){let o=e.filterName(n,!0),i=!/^\d/.test(n),s=!!o&&i&&n===o,a=_.pluck(t,"name").indexOf(o)<0;return r&&(a=a||o===r),s&&a},n.processModelsWithStubs=function(e,t){_.each(e,(e,r)=>{switch(e.type){case"object":t[r]||(t[r]={}),n.processModelsWithStubs(e.properties,t[r]);break;case"array":t[r]||(t[r]=[]);break;case"select":t[r]||(t[r]={}),t[r].options||(t[r].options=[]),t[r].selected||(t[r].selected={})}})},n.isNodeInArray=function(e){let t=e.parent,n=!1;if(t)do{"array"===t.type&&(n=!0),t=t.parent}while(t);return n},n.addProp=function(e,r){let o={type:r.type};"date"===r.type||"time"===r.type?o.format=r.format:"object"===r.type?o.properties={}:"method"===r.type&&(o.parameters={}),r.isArray&&(o={type:"array",items:o,expanded:!1}),_.extend(o,{id:e.id+"."+r.newName,name:r.newName,parent:e,root:e.root,getChildren:n.getChildren,expanded:!1}),o.path=t(o,e.root),e.expanded=!0;return e.getChildren()[o.name]=o,o},n.updateProp=function(e,r){let o=e.parent.getChildren();"array"!==e.type||r.isArray?"array"!==e.type&&r.isArray&&(e.items={type:e.type},"object"===e.type&&(e.items.properties=e.properties,delete e.properties),e.type="array"):(e.items.name=e.name,e.items.id=e.id,o[r.name]=e.items,e=e.items);let i=e;"array"===i.type&&(i=i.items),i.type!==r.type&&(i.type=r.type,"object"===i.type?i.properties={}:delete i.properties,"date"===i.type||"time"===i.type?i.format=r.format:delete i.format),r.name!==r.newName&&(e.name=r.newName,e.path=t(e,e.root),o[r.newName]=o[r.name],delete o[r.name]),n.process(o,e.root,e.parent)},n.deleteProp=function(e){delete e.parent.getChildren()[e.name]}}]),angular.module("common").service("navigationService",["$httpParamSerializer","$location","$rootScope","$stateParams","$window",function(e,t,n,r,o){var i=n.getLink=function(n){var r=t.search();return"/#!/"+n+"?"+e(r)};this.openNewTab=function(e,t){var n=r.appId,i=r.explorerId;o.name=`${t} - ${n} - ${i}`,this.openModule(e,n,i)},this.openModule=function(e,t,n){var r,s=`${e} - ${t} - ${n}`;switch(e){case"Studio":r=i(`studio/${t}`);break;case"Connect":r=i(`connect/${t}`);break;case"Explorer":r=i(`app/${t}/explorer/${n}`)}const a=o.open(r,s);a.addEventListener("load",function(){a.document.title=`SmartUXâ„¢ ${s}`})}}]),angular.module("common").service("userService",["$q","$state","$rootScope","apiService",function(e,t,n,r){var o=this,i=null;o.get=function(){var t=e.defer();return i?(delete i.canEdit,t.resolve(i)):r.users.getCurrentUser().then(function(e){i=e,n.user=i,t.resolve(i)}),t.promise},o.getCachedUser=function(){return i},o.checkPermissions=function(e){return o.get().then(function(t){return t.canEdit=t.isAdmin?!~t.readOnlyApps.indexOf(e):"edit"===t.permissions[e],t})},o.logout=function(){localStorage.removeItem("accessToken"),i=null},o.grantPermission=function(e,t){i.permissions&&(i.permissions[e]=t)},o.removePermission=function(e){i.permissions&&delete i.permissions[e]},o.checkAdmin=function(){return r.users.checkAdmin().then(function(e){return e.success})},o.listAll=function(){return r.users.listAll().then(function(e){return e})},o.isUnique=function(e){return r.users.isUnique({userId:e}).then(function(e){return e})},o.create=function(e,t){return r.users.create({userId:e,profile:t}).then(function(e){return e})},o.updateProfile=function(e,t){return r.users.updateProfile({userId:e,profile:t}).then(function(e){return e})},o.updatePassword=function(e,t){return r.users.updatePassword({userId:e,password:t}).then(function(e){return e})},o.updatePermissions=function(e,t){return r.users.updatePermissions({userId:e,permissions:t}).then(function(e){return e})},o.delete=function(e){return r.users.delete({userId:e}).then(function(e){return e})}}]),angular.module("common").service("commonSyncService",["modelTreeService",function(e){const t=this;t.isAssignable=function(e,t){let n=Object.keys(t.properties);for(let t of n)if(e.hasOwnProperty("properties")&&!e.properties.hasOwnProperty(t))return!1;return!0},t.compare=function(e,n){if(!e||!n)return!1;let r=t.getPaths(e),o=t.getPaths(n,!0),i=_.difference(r,o),s=_.difference(o,r);return!i.length&&!s.length},t.getPaths=function(t,n){let r=[];return e.eachNode(t.properties,e=>{if(["descriptor","model","identifier"].includes(e.type))return;let o=e.path+"["+e.type+"]";n&&t.path&&(o=o.replace(t.path+".","")),r.push(o)}),r}}]),angular.module("common").service("sessionService",["$stateParams","$state",function(e,t){function n(){switch(t.current.name){case"editor":case"viewer":return"studio";case"explorer":return"explorer";case"connect":return"connect"}}let r=this;r.get=function(t){let r=e.appId,o=n(),i=JSON.parse(localStorage.getItem("session"));return i||(i={}),i[o]||(i[o]={}),i[o][r]||(i[o][r]={files:[]},"studio"===o&&(i[o][r].screens=[])),t?i[o][r][t]||[]:i},r.set=function(t,o){let i=e.appId,s=n(),a=r.get();a[s][i][t]=o,localStorage.setItem("session",JSON.stringify(a))},r.clear=function(t){let o=e.appId,i=n(),s=r.get();delete s[i][o][t],localStorage.setItem("session",JSON.stringify(s))}}]),angular.module("common").service("screenTreeService",["$q","$rootScope","apiService",function(e,t,n){var r=this,o=null;r.fetch=function(e){return n.screens.getTree(e).then(function(e){return o=e,r.eachNode(r.processNode),o})},r.getCachedTree=function(){return o},r.eachScreen=function(e){r.eachNode(function(t,n,r){t.folder||e(t,n,r)})},r.eachChildScreen=function(e,t){r.eachNode((e,n,r)=>{t(e,n,r)},e.screens,e)},r.eachNode=function(e,t,n){(t||o)&&(t=t||o.screens,n=n||o,_.each(t,o=>{e(o,t,n),o.screens&&r.eachNode(e,o.screens,o)}))},r.findById=function(e){if("__BASE__"===e)return o;for(var t=e.split("_"),n=t.shift(),r=_.findWhere(o.screens,{id:n});t.length;){if(!r)return!1;n+="_"+t.shift(),r=_.findWhere(r.screens,{id:n})}return r},r.exists=function(e){return!!r.findById(e)},r.processNode=function(e,t,n){e.parent=n,e.siblings=t}}]),angular.module("common").factory("PmRpcServer",["$window",function(e){return function(t){function n(e,t,n,r){let o=angular.toJson({jsonrpc:"2.0",code:t,error:n,id:r||null});e&&e.postMessage(o,"*")}e.addEventListener("message",e=>{let r;if("string"==typeof e.data){try{r=JSON.parse(e.data)}catch(e){return}if(r&&"2.0"===r.jsonrpc&&!r.error&&!r.result){if("function"!=typeof t[r.method])return n(e.source,-32601,"Method not found: "+r.method,r.id);if(r.method&&!_.isArray(r.params))return n(e.source,-32700,"Invalid request",r.id);try{let o=t[r.method].apply(null,r.params);Promise.resolve(o).then(t=>{if(!e.source)return!1;r.id&&e.source.postMessage(angular.toJson({jsonrpc:"2.0",result:t,id:r.id}),"*")})}catch(t){throw n(e.source,-32e3,t.message,r.id),t}}}},!1)}}]),angular.module("common").factory("PmRpcClient",["$window","$timeout","$q","uuid4",function(e,t,n,r){let o={};return e.addEventListener("message",e=>{let t;if("string"==typeof e.data){try{t=JSON.parse(e.data)}catch(e){return}t&&"2.0"===t.jsonrpc&&t.id&&o[t.id]&&(t.error?(console.log("JSON-RPC error:",o[t.id].request,t),o[t.id].reject(t.error)):o[t.id].resolve(t.result),delete o[t.id])}},!1),function(e){this.$update=function(t){e=t},this.method=function(t){return function(){if(!e)return n.reject();let i=r.generate(),s=Array.prototype.slice.call(arguments),a={jsonrpc:"2.0",method:t,params:s,id:i};return e.postMessage(angular.toJson(a),"*"),n((e,t)=>{o[i]={resolve:e,reject:t,request:a}})}}}}]),angular.module("common").service("canvas",["PmRpcClient",function(e){var t=new e;this.$init=t.$update,this.setScreenData=t.method("setScreenData"),this.refresh=t.method("refresh"),this.clear=t.method("clear"),this.resize=t.method("resize"),this.refreshCss=t.method("refreshCss"),this.showContainers=t.method("showContainers"),this.selectComponentById=t.method("selectComponentById"),this.dragStartedFromPalette=t.method("dragStartedFromPalette"),this.dragEndedFromPalette=t.method("dragEndedFromPalette"),this.getComputedStyle=t.method("getComputedStyle")}]),angular.module("common").filter("filterTree",function(){return function(e,t,n,r){var o=[];if(!t[n])return e;var i=function(e,s){angular.forEach(e,function(e){if(e.hasOwnProperty(n)&&t.hasOwnProperty(n)&&e[n]&&t[n]){var a=e[n].toLowerCase(),l=t[n].toLowerCase();if(a.indexOf(l)>=0)if(s){var c=!1;o.forEach(function(e){e===s&&(c=!0)}),c||o.push(s)}else o.push(e);e.hasOwnProperty(r)&&angular.isArray(e[r])&&e[r].length>0&&i(e[r],s||e)}})};return i(e,null),o}}),angular.module("common").directive("collapsible",["uuid4","$timeout",function(e,t){return{restrict:"A",link:function(n,r){var o=e.generate();t(function(){r.addClass("collapsible"),r.find("> .marker").attr("id",o),r.find("> .target").attr("for",o)},0)}}}]),angular.module("common").directive("dragAndDrop",["$rootScope",function(e){return{restrict:"A",scope:{options:"=dragAndDrop"},link:function(t,n){if(t.options){if(t.$watch("options.draggable",function(e,t){e!==t&&n.attr("draggable",e).css("cursor",e?"move":"pointer")}),!0===t.options.draggable&&(n.attr("draggable",!0).css("cursor","move"),n[0].addEventListener("dragstart",function(e){e.dataTransfer.effectAllowed=t.options.effect||"copy";var r=t.options.data;_.each(r,function(t,n){e.dataTransfer.setData(n,t)}),r.type&&e.dataTransfer.setData("type_"+r.type,null),n.addClass("dragging"),t.options.onStart&&t.options.onStart(r)}),n[0].addEventListener("dragend",function(){n.removeClass("dragging"),t.options.onEnd&&t.options.onEnd()})),t.options.acceptedTypes&&t.options.acceptedTypes.length>0){var r=0;n[0].addEventListener("dragenter",function(e){r++,o(e)&&_.isFunction(t.options.onEnter)&&(e.preventDefault(),t.options.onEnter(n[0],e))}),n[0].addEventListener("dragover",function(e){e.preventDefault(),o(e)&&_.isFunction(t.options.onDragover)&&t.options.onDragover(n[0],e)}),n[0].addEventListener("dragleave",function(e){r--,o(e)&&(0===r||t.options.ignoreCounter)&&_.isFunction(t.options.onLeave)&&(e.preventDefault(),t.options.onLeave(n[0],e))}),n[0].addEventListener("drop",function(i){o(i)&&_.isFunction(t.options.onDrop)&&(i.preventDefault(),i.stopPropagation(),r=0,t.options.onDrop(n[0],i.dataTransfer,i),e.$digest())})}var o=function(e){var n=_.map(t.options.acceptedTypes,function(e){return"type_"+e});return _.intersection(e.dataTransfer.types,n).length>0}}}}}]),angular.module("common").directive("treeRoot",["$rootScope","$timeout",function(e,t){return{restrict:"A",scope:{options:"=options"},priority:10,controller:function(){var n=this,r=["getIcon","getLabel","getDescription","getDescriptionIcon","getItemClass","getChildren","isCollapsible","isClickable","isSelected","isWarned","isHidden","onClick","onDblClick","getControls","isValid","hasAsterisk","hasAssociatedItem","getAssociatedItem","isDraggable","getDragData","getDragStart","getDragEnd","getAcceptedTypes","getDragEnter","getDragLeave","getDragDrop","isSortable","isSortableChildren","getType","moveNode","isEditable","hasAddChild","hasRename","hasDelete","clickAddChild","clickRename","clickDelete","addChildNode","renameNode","deleteNode","confirmEditing","confirmDeleting","hasCheckbox","isChecked","onClickCheckbox","hasLeftButton","hasTemplate","getTemplateSrc","getTemplateModel"];_.extend(n,{edit:{},delete:{},getIcon:function(e){return n.getChildren(e)?"fa-folder-o":"fa-file-o"},getLabel:function(e){return e.name||e.label},getDescriptionIcon:function(e){return null},getItemClass:function(e){return""},getChildren:function(e){return e.children},isCollapsible:function(e){return n.getChildren&&!_.isEmpty(n.getChildren(e))||n.edit.parentNode===e},isSelected:function(e){return e.selected},isClickable:function(e){return!n.isSelected(e)},isSortable:function(e){return!1},isSortableChildren:function(e){return!1},isValid:function(e){return!!e.name},isHidden:function(e){return!1},hasAsterisk:function(){return!1},hasAssociatedItem:function(){return!1},getAssociatedItem:function(){return null},hasAddChild:function(){return!0},clickAddChild:function(e,t){t.stopPropagation(),n.edit.parentNode=e,e.expanded=!0},hasRename:function(){return!0},clickRename:function(e,t){t.stopPropagation(),n.edit.node=e,n.edit.name=e.name},hasDelete:function(){return!0},clickDelete:function(e,t){t.stopPropagation(),e.expanded=!1,n.delete.node=e},cancel:function(){delete n.delete.node,delete n.edit.node,delete n.edit.parentNode,delete n.edit.name},confirmEditing:function(e){var t=n.getChildren(e);n.edit.node&&n.edit.name.length>0?n.renameNode(n.edit.node,n.edit.name).then(function(t){t&&t.id&&(e.id=t.id,e.name=n.edit.name),n.cancel()}):n.addChildNode(n.edit.parentNode,n.edit.name).then(function(e){e&&e.id&&t.push({id:e.id,name:n.edit.name}),n.cancel()})},confirmDeleting:function(r){n.deleteNode(n.delete.node).then(function(){if(r.siblings){var o=r.siblings.indexOf(r);r.siblings.splice(o,1),r.siblings.length||(r.parent.expanded=!1)}n.cancel(),t(e.hideLoading)})},isDraggable:function(e){return!1},getDragData:function(e){return{id:e.id}},getDragStart:function(t){return function(){e.$apply(function(){t.expanded=!1})}},getDragEnd:function(e){return _.noop},moveNode:function(e,t,n){},getAcceptedTypes:function(e){return[]},hasCheckbox:function(e){return!1},isChecked:function(e){return!1},onClickCheckbox:function(e,t){t.stopPropagation()},isArray:function(e){return angular.isArray(e)},isObject:function(e){return angular.isObject(e)},hasLeftButton:function(e){return!1},hasTemplate:function(e){return!1},getTemplateSrc:function(e){return""},getTemplateModel:function(e){return!1}}),n.decorate=function(){_.each(arguments,function(e){_.extend(n,_.pick(e,r))})}},link:function(e,t,n,r){r.decorate(e.options),e.$parent.tree={cancelEditing:r.cancel}}}}]),angular.module("common").directive("treeNode",["RecursionHelper","$rootScope","$timeout",function(e,t,n){return{restrict:"A",templateUrl:"/views/common/directives/tree/treeNode.html",require:"^^treeRoot",scope:{node:"=treeNode",inputModel:"=",inputKey:"="},compile:function(t){return e.compile(t,{pre:function(e,t,n,r){_.extend(e,r)},post:function(e,t){function n(){o(),s.classList.add("drop-before"),i="before"}function r(){o(),s.classList.add("drop-after"),i="after"}function o(){s.classList.remove("drop-before","drop-inside","drop-after")}if(e.node.element=t,e.isSortable(e.node)){var i,s=t.find(".item")[0],a="type_"+e.getType(e.node);s.addEventListener("dragenter",function(t){~t.dataTransfer.types.indexOf(a)&&(t.preventDefault(),e.isCollapsible(e.node)&&!s.classList.contains("dragging")&&e.isSortableChildren(e.node)&&(e.node.expanded=!0,e.$digest()))}),s.addEventListener("dragover",function(t){if(~t.dataTransfer.types.indexOf(a)){t.preventDefault();var l=t.target.offsetHeight;e.isSortableChildren(e.node)?t.offsetY<l/3?n():t.offsetY>=l/3&&t.offsetY<l/3*2?(o(),s.classList.add("drop-inside"),i="inside"):r():t.offsetY<l/2?n():r()}}),s.addEventListener("dragleave",function(e){~e.dataTransfer.types.indexOf(a)&&(e.preventDefault(),o())}),s.addEventListener("drop",function(t){~t.dataTransfer.types.indexOf(a)&&(t.preventDefault(),o(),e.$apply(function(){var n=t.dataTransfer.getData("id"),r=e.node;e.moveNode(n,r,i)}))})}}})}}}]),angular.module("common").directive("compile",["$compile",function(e){return function(t,n,r){t.$watch(function(e){return e.$eval(r.compile)},function(r){n.html(r),e(n.contents())(t)})}}]),angular.module("common").directive("previewTree",["modelTreeService",function(e){return{restrict:"A",require:"treeRoot",link:function(t,n,r,o){o.decorate({getIcon:e.getIcon,getChildren:e.getChildren,getDescription:e.getDescription,getDescriptionIcon:e.getDescriptionIcon,hasRename:()=>!1})}}}]),angular.module("common").directive("arrayPreview",["$timeout","modelTreeService",function(e,t){return{restrict:"A",require:"^ngModel",scope:!0,templateUrl:"/views/common/directives/arrayPreview.html",link:(n,r,o,i)=>{function s(t){e(()=>{n.cols={};let e=i.$modelValue||[];t&&(n.property=t,e=function(e,t){let n=l(t).path.split(".");for(let r=1;r<n.length;r++)e[n[r]]||(e[n[r]]=c(t)),e=e[n[r]];return e}(e,t)),n.dataPath=l(n.property).label,"select"===n.property.type?n.selectData=e:n.cols=a(n.property),n.rows=function(e,t){return"select"===t.type?e.options:"object"===t.type?[e]:e}(e,n.property)},!0)}function a(e){return"array"===e.type?a(e.items):"object"===e.type?e.properties:[e]}function l(e){let n=function(e){let t,n=e;do{n.parent||(t=n),n=n.parent}while(n);return t}(e),r=e.id.split(".");r[0]===n.id&&r.shift();let o=angular.copy(r),i=angular.copy(r);if(d.length>0)for(let e=0;e<r.length-1;e++){let s=r.slice(0,e+1);"array"===t.findByPath(n,s.join(".")).type&&(o[e]+=`[${d[e]}]`,i[e]+=`.${d[e]}`)}return{label:o.join(" > "),path:i.join(".")}}function c(e){switch(e.type){case"object":return{};case"array":return[];case"select":return{options:[]};default:return""}}n.itemTemplate="/views/common/includes/mockDataItem.html",n.property=n.node;let d=[];n.showMocks=!0,n.node.expanded=!1,s(),i.$formatters.push(()=>s(n.property)),n.addRow=(()=>n.rows.push(function(e){let t={};return _.each(e,e=>t[e.name]=c(e)),t}(n.cols))),n.deleteRow=(e=>n.rows.splice(e,1)),n.editChildProp=((e,t)=>{"array"===t.parent.type&&d.push(e),s(t)}),n.invokeAction=((e,t)=>{t.invoke(d.concat([e]))}),n.toggleSelection=(e=>{let t=n.selectData;if(_.isArray(t.selected)){let n=t.selected.indexOf(e);n>-1?t.selected.splice(n,1):t.selected.push(e)}else angular.equals(t.selected,e)?delete t.selected:t.selected=e}),n.isSelected=(e=>{let t=n.selectData;return _.isArray(t.selected)?t.selected.indexOf(e)>-1:angular.equals(t.selected,e)}),n.back=(()=>{"array"===n.property.parent.type&&d.pop(),s(n.property.parent)}),n.showBackButton=(()=>!!d.length),n.showPreviewButton=(()=>{return!("array"===n.node.type)||!_.isEmpty(n.node.items.properties)})}}}]),angular.module("common").directive("inputPreview",["$timeout",function(e){return{restrict:"A",require:"^ngModel",scope:!0,templateUrl:"/views/common/directives/inputPreview.html",link:(t,n,r,o)=>{t.itemTemplate="/views/common/includes/mockDataItem.html",t.row={},e(()=>{t.col=t.node,t.row[t.col.name]=o.$modelValue},!0),t.$watch("row",e=>{e&&t.col&&o.$setViewValue(e[t.col.name])},!0),o.$formatters.push(e=>{t.row&&t.col&&(t.row[t.col.name]=e)})}}}]),angular.module("common").component("header",{templateUrl:"/views/common/components/header.template.html",transclude:!0,bindings:{layoutSizes:"<",tabsData:"<",isTabSelected:"&",tabIcon:"&",onTabClick:"&",onTabClose:"&",onTabDoubleClick:"&",title:"@",noModules:"<"},controller:["dialogService","navigationService",function(e,t){function n(e,t){return{marginLeft:e?parseInt(e)+5:0,marginRight:0}}let r=this;r.noModules||(r.modules=["Studio","Connect","Explorer"]);let o=null,i=null;r.about=function(){e.about()},r.open=function(e){"Explorer"!==e&&t.openNewTab(e,r.title)},r.onInit=function(){r.tabsMargin=n(o)},r.$doCheck=function(){!r.layoutSizes||o===r.layoutSizes.west&&i===r.layoutSizes.east||(o=r.layoutSizes.west,i=r.layoutSizes.east,r.tabsMargin=n(o)),r.tabs=_.values(r.tabsData)}}]}),angular.module("common").component("explorer",{templateUrl:"/views/common/components/explorer.template.html",transclude:!0,bindings:{app:"<",src:"@",hideTitle:"@"},controller:["$rootScope","dialogService","navigationService",function(e,t,n){let r=this;r.app||(r.app=e.app),r.create=function(){t.createWebConnector(r.app).then(function(e){e.success&&(r.app.explorations.push(e.explorerId),r.open(e.explorerId))})},r.open=function(e){n.openModule("Explorer",r.app.id,e)}}]}),angular.module("common").component("fileEditor",{templateUrl:"/views/common/components/allFiles/fileEditor.template.html",transclude:!0,bindings:{selectedFile:"<",readonly:"<?"},controller:["allFilesService",function(e){let t=this;t.updateFile=_.debounce(()=>{console.log(`Setting new content for file: ${t.selectedFile.id}`),e.fileChanged(t.selectedFile.id)},500),t.fileChanged=function(e){e&&e.isFocused()&&e.domElement.getClientRects().length&&t.updateFile()},t.getMode=function(){switch(t.selectedFile.extension){case"js":return"javascript";case"ts":return"typescript";case"html":return"html";case"json":return"json";case"scss":return"scss";default:return"txt"}},t.isFileImage=function(){return t.selectedFile&&["ico","jpg","png","jpeg","gif"].includes(t.selectedFile.extension)},t.onInit=function(){t.selectedFile=e.getSelectedFile()},t.$doCheck=function(){t.selectedFile=e.getSelectedFile()}}]}),angular.module("common").component("filesTree",{templateUrl:"/views/common/components/allFiles/filesTree.template.html",controller:["$q","allFilesService",function(e,t){let n=this;n.search={},n.refresh=function(){t.fetch().then(e=>n.filesTree=e)},n.addFile=function(e,r,o,i){r&&r.stopPropagation(),o||((o=o||n).edit={}),o.edit.parentNode=e,o.edit.type=i||t.TYPE_FILE,e&&(e.expanded=!0)},n.addFolder=function(e,r,o){n.addFile(e,r,o,t.TYPE_DIRECTORY)},n.cancel=function(){n.edit=null},n.confirmEditing=function(){t.createFile(n.filesTree,n.edit.name,n.edit.type).then(r=>(n.cancel(),r.type===t.TYPE_FILE?t.processOpeningFile(r.id):e.resolve()))},n.getIcon=function(){switch(n.edit.type){case t.TYPE_DIRECTORY:return"fa-folder-o";case t.TYPE_FILE:return"fa-file-o"}},n.isValid=function(e){return t.isValidName(e.name,n.filesTree,e.node)};const r=[{icon:"fa-folder-o",title:"Add folder",action:n.addFolder},{icon:"fa fa-plus",title:"Add File",action:n.addFile}];n.treeOptions={isEditable:function(){return!0},getIcon:function(e,n){switch(e.type){case t.TYPE_DIRECTORY:{let r=e.expanded?"fa-folder-open-o":"fa-folder-o";return n?this.edit.type&&this.edit.type===t.TYPE_DIRECTORY?r:this.edit.parentNode?"fa-file-o":r:r}case t.TYPE_LINK:return"fa-external-link";case t.TYPE_FILE:return["html","ts"].includes(e.extension)?"fa-file-code-o":["json","scss"].includes(e.extension)?"fa-file-text-o":["ico","jpg","png","jpeg","gif"].includes(e.extension)?"fa-file-image-o":"fa-file-o";default:return"fa-question-circle-o"}},onDblClick:function(e){e.type===t.TYPE_DIRECTORY?e.expanded=!e.expanded:t.stickFile(e.id)},onClick:function(e){if(e.type===t.TYPE_DIRECTORY)return!1;t.processOpeningFile(e.id)},isSelected:function(e){let n=t.getSelectedFile();return n&&n===e},isClickable:function(){return!0},hasAsterisk:function(e){return e.isDirty},hasRename:function(e){return!e.isDirty},hasDelete:function(){return!0},hasAddChild:function(){return!1},getControls:function(e){if(e.type===t.TYPE_DIRECTORY)return r},confirmEditing:function(n){if(this.edit.node&&this.edit.name.length>0)t.closeAllFiles(),t.renameFile(this.edit.node,this.edit.name).then(t.restoreFiles).then(this.cancel);else{let r=this.edit.type||t.TYPE_FILE;t.createFile(n,this.edit.name,r).then(n=>(this.cancel(),n.type===t.TYPE_FILE?t.processOpeningFile(n.id):e.resolve()))}},confirmDeleting:function(e){this.cancel(),t.deleteFile(e)},isValid:function(e){return t.isValidName(e.name,e.parentNode||e.node.parent,e.node)}},n.$onInit=function(){n.refresh()}}]}),angular.module("common").component("notification",{templateUrl:"/views/common/components/notification.template.html",bindings:{onClose:"&",notification:"<"},controller:["dialogService",function(e){let t=this;t.showDialog=function(){const n=t.notification.dialogInfo;n&&e.info(n.title,n.message)}}]}),angular.module("common").component("floatingButton",{templateUrl:"/views/connect/components/floatingButton.template.html",transclude:!0,bindings:{currentEndpoint:"<"},controller:["dialogService",function(e){let t=this;t.addCustomEvent=function(){e.customEvent(t.currentEndpoint)}}]}),angular.module("common").controller("LoginCtrl",["$scope","apiService","$state",function(e,t,n){e.model={submitted:!1},e.authenticate=function(r){e.model.submitted=!0,r.login.$setValidity("valid",!0),r.password.$setValidity("valid",!0);var o;if("string"==typeof e.model.password){var i=new jsSHA("SHA-1","TEXT");i.update(e.model.password),o=i.getHash("HEX")}t.users.authenticate({login:e.model.login,password:o}).then(function(t){e.model.submitted=!1,!0===t.success?(localStorage.setItem("accessToken",t.accessToken),localStorage.setItem("name",t.name),n.go("home")):(r.login.$setValidity("valid",!1),r.password.$setValidity("valid",!1))})}}]),angular.module("common").controller("AboutCtrl",["$scope",function(e){e.version=e.env.version,e.year=(new Date).getFullYear()}]),angular.module("common").controller("AlertCtrl",["$scope","$interpolate",function(e,t){e.text=t(e.ngDialogData.text)(e.ngDialogData.data)}]),angular.module("common").controller("HelpCtrl",function(){}),angular.module("common").controller("PromptCtrl",["$scope",function(e){e.label=e.ngDialogData.label,e.model={value:e.ngDialogData.value},e.confirm=function(){e.submitted=!0,e.ngDialogData.confirm(e.model.value),e.closeThisDialog()}}]),angular.module("common").controller("ConfirmCtrl",["$scope","$interpolate",function(e,t){e.title=e.ngDialogData.title,e.question=t(e.ngDialogData.question)(e.ngDialogData.data),e.danger=e.ngDialogData.danger,e.confirm=function(){e.submitted=!0,e.ngDialogData.confirm(),e.closeThisDialog()},e.cancel=function(){e.ngDialogData.cancel(),e.closeThisDialog()}}]),angular.module("common").controller("ErrorCtrl",["$scope","$interpolate",function(e,t){let n=e.ngDialogData.text;_.isObject(n)&&(n=JSON.stringify(n,null,2)),n=`<pre>${n}</pre>`,e.text=t(n)(e.ngDialogData.data),e.reload=function(){window.location.reload()}}]),angular.module("common").controller("InfoCtrl",["$scope","$interpolate",function(e,t){let n=e.ngDialogData.text;_.isObject(n)&&(n=JSON.stringify(n,null,2)),n=`<pre>${n}</pre>`,e.text=t(n)(e.ngDialogData.data)}]),angular.module("common").controller("DataEntryCtrl",["$scope","config","hotkeys","modelTreeService","sharedModelService","helperService",function(e,t,n,r,o,i){e.submit=function(){if(!e.isValid()||e.submitted)return!1;e.submitted=!0,e.closeThisDialog(),e.model.isArray=e.model.type.indexOf("[]")>-1,e.model.type=e.model.type.replace("[]",""),e.ngDialogData.onSubmit(e.model)},e.isValid=function(){let t=e.ngDialogData.node||{},n=e.model.newName.length>0,o=!i.isReservedWord(e.model.newName),a=e.model.type.length>0,l=r.validateNodeName(s.getChildren(),e.model.newName,t.name),c=n&&o&&a&&l,d="date"===e.model.type||"time"===e.model.type,u=e.model.format&&e.model.format.length>0;return!!c&&(!d||u)},e.isPageModel=function(){return e.ngDialogData.modelType===r.TYPE_PAGE_MODEL},n.bindTo(e).add({combo:"enter",allowIn:["INPUT"],description:"Submit the form",callback:e.submit});let s=e.ngDialogData.parent,a=e.ngDialogData.node;if(e.isEditing=!!a,e.submitted=!1,e.model={name:"",newName:"",type:"string"},e.isEditing&&(e.model.name=a.name,e.model.newName=a.name,e.isPageModel()&&a.descriptor?(e.model.type="descriptor",e.model.descriptor=a.descriptor):!e.isPageModel()&&a.model?(e.model.type="model",e.model.model=a.model):"array"===a.type?(e.model.type=a.items.type+"[]",e.model.format=a.items.format):(e.model.type=a.type,e.model.format=a.format)),e.isPageModel()){let t=_.pluck(e.ngDialogData.pageModels,"id").sort();e.pageModels=_.without(t,s.root.id)}else{let t=_.pluck(o.getModels(),"id").sort();e.sharedModels=_.without(t,s.root.id)}}]),angular.module("common").controller("MergeConflictsCtrl",["$scope","$state","versionsService",function(e,t,n){e.commitsList=e.ngDialogData.commitsList,e.resolveMerge=function(t){e.showLoading(),n.resolveMerge(t).then(function(t){e.closeThisDialog(),t.success?location.reload():e.hideLoading()})}}]),angular.module("common").controller("SyncModelsCtrl",["$scope","$rootScope","modelTreeService","xSyncService","commonSyncService","pageModelService","powwowService",function(e,t,n,r,o,i,s){function a(e){let t=e;for(;t;){if(f.hasOwnProperty(t.id)||h.hasOwnProperty(t.id))return t;t=t.parent}}function l(){_.each(e.data.screenModels,e=>{e.expanded&&(e.expanded=!1)}),_.each(e.data.pageModels,e=>{e.expanded&&(e.expanded=!1)}),_.each(e.data.sharedModels,e=>{e.expanded&&(e.expanded=!1)})}function c(){let e=m.screenModel,t=m.pageModelObj;e.expanded=!0,t.expanded=!0,n.eachNode(e.getChildren(),e=>{e.expanded=!0}),n.eachNode(t.getChildren(),e=>{e.expanded=!0})}function d(t){if(e.screenModelPaths&&e.pageModelPaths){let n=t.path+"["+t.type+"]",r=~e.screenModelPaths.indexOf(n),o=~e.pageModelPaths.indexOf(n);return r&&!o||o&&!r}}function u(t,n){e.screenModelPaths=o.getPaths(t),e.pageModelPaths=o.getPaths(n,!0)}function p(t,n){let r=t.shift();if(n){if(r){return p(t,_.find(n.getChildren(),e=>e.name===r))}return n}{let n=_.find(e.data.pageModels,e=>e.name===r);if(n)return p(t,n)}}e.data=r.initialize();let f=function(){let t={};return _.each(e.data.screenModels,e=>{e.sourcePath&&(t[e.sourcePath]=e)}),t}(),h=function(){let t={};return _.each(e.data.sharedModels,e=>{e.sourcePath&&(t[e.sourcePath]=e)}),t}(),m={screenModel:null,pageModelObj:null,sharedModel:null};e.model={activeTab:"screen-models"},l(),e.save=function(){e.showLoading(),r.save().then(()=>{e.hideLoading(),e.closeThisDialog(),t.$broadcast(t.EVENT_PAGE_MODEL_UPDATED);let n=i.getAllDescriptorsToInject();return s.evaluate(n)})},e.cancelSync=function(){r.clear(),e.closeThisDialog()},e.copyAllScreenModels=function(){"screen-models"===e.model.activeTab?_.each(e.data.screenModels,t=>{n.validateNodeName(e.data.pageModels,t.id)&&!t.sourcePath&&(r.pageModels.copyScreenModel(t),r.screenModels.link(t,t.name),f[t.name]=t)}):_.each(e.data.sharedModels,t=>{n.validateNodeName(e.data.pageModels,t.id)&&!t.sourcePath&&(r.pageModels.copyScreenModel(t),r.sharedModels.link(t,t.name),h[t.name]=t)})},e.checkAllScreenModels=function(){if(e.data.pageModels.length>0)return!0;let t=!0;return"screen-models"===e.model.activeTab?_.each(e.data.screenModels,e=>{e.sourcePath||(t=!1)}):_.each(e.data.sharedModels,e=>{e.sourcePath||(t=!1)}),t},e.copyAllPageModels=function(){_.each(e.data.pageModels,t=>{let o=n.validateNodeName(e.data.screenModels,t.id);(o=o&&!f.hasOwnProperty(t.id))&&(f[t.id]=r.screenModels.copyPageModelObj(t))})},e.checkAllPageModels=function(){if("screen-models"===e.model.activeTab){if(Object.keys(e.data.screenModels).length>0&&e.data.screenModels.constructor===Object)return!0}else if(Object.keys(e.data.sharedModels).length>0&&e.data.sharedModels.constructor===Object)return!0;let t=!0;return _.each(e.data.pageModels,n=>{"screen-models"===e.model.activeTab?f.hasOwnProperty(n.id)||(t=!1):h.hasOwnProperty(n.id)||(t=!1)}),t},e.screenModelOptions={getIcon:n.getIcon,getChildren:n.getChildren,getDescription:n.getDescription,getDescriptionIcon:n.getDescriptionIcon,getLabel:function(e){return e.name},isCollapsible:function(e){return e.root===m.screenModel&&(e.expanded=!0),!1},isWarned:function(e){return e.isWarned=d(e)},isHidden:function(e){return"identifier"===e.type},getControls:function(e){if(e.parent)return e.isWarned?b.diverged:b.synced;if(e.sourcePath){let t=p(e.root.sourcePath.split("."),null);return o.compare(e,t)?E.synced:E.diverged}return null},isDraggable:function(e){return!e.parent},getDragData:function(e){return{type_screenmodel:e.id}},getAcceptedTypes:function(){return["pagemodel"]},getDragEnter:function(e){return function(e,t){t.stopPropagation();angular.element("#screen-model .drag-target")[0].style.backgroundColor="",e.style.backgroundColor="#FFFFAA"}},getDragLeave:function(e){return function(e,t){t.stopPropagation(),e.style.backgroundColor=""}},getDragDrop:function(t){return function(o,i,s){s.stopPropagation();let a=i.getData("type_pagemodel");if(!t.parent&&!t.sourcePath&&!f.hasOwnProperty(a)){let o=a.split("."),i=o.shift(),s=o.join("."),l=_.find(e.data.pageModels,e=>e.id===i),c=n.findByPath(l,s);r.screenModels.copyPmToExistingSm(t,c),f[a]=t}o.style.backgroundColor=""}},hasAssociatedItem:function(e){return!e.parent},getAssociatedItem:function(e){return e.sourcePath||""}},e.syncScreenModelEntry=function(e){let t=p(e.root.sourcePath.split("."));r.pageModels.pushNode(e,t),u(e.root,t)},e.expandScreenModel=function(e){let t=p(e.sourcePath.split("."),null);u(e,t),l(),e.expanded=!0,m.screenModel=e,m.sharedModel=!1,m.pageModelObj=t,c()},e.unlinkScreenModel=function(e){let t=e.sourcePath;delete f[t],r.screenModels.unlink(e)};let g={icon:"fa-exchange",title:"Sync Model Entries",action:e.expandScreenModel},v={icon:"fa-exchange diverged",title:"Sync Model Entries",action:e.expandScreenModel},S={icon:"fa-arrow-circle-right",title:"Sync Model Entry",action:e.syncScreenModelEntry},y={icon:"fa-chain-broken",title:"Unlink",action:e.unlinkScreenModel},E={synced:[g,y],diverged:[v,y]},b={synced:[],diverged:[S]};e.smGetAcceptedTypes=function(){return["pagemodel"]},e.smOnEnter=function(e){return function(e){e.style.backgroundColor="#FFFFAA"}},e.smOnDrop=function(){return function(t,o){let i=o.getData("type_pagemodel"),s=i.split("."),a=n.validateNodeName(e.data.screenModels,s.pop());if(a=a&&!f.hasOwnProperty(i)&&!h.hasOwnProperty(i)){let t=i.split("."),o=t.shift(),s=t.join("."),a=_.find(e.data.pageModels,e=>e.id===o),l=n.findByPath(a,s);f[i]=r.screenModels.copyPageModelObj(l)}t.style.backgroundColor=""}},e.smOnLeave=function(){return function(e,t){e.style.backgroundColor=""}},e.pageModelOptions={getIcon:n.getIcon,getChildren:function(e){return"array"===(e=e||this).type&&"object"===e.items.type?e.items.properties:"object"===e.type?e.properties:"descriptor"===e.type?e.properties:"method"===e.type?e.parameters:null},getDescription:function(e){return"descriptor"===e.type?"page model":"array"===e.type?e.items.type+"[]":e.type},getDescriptionIcon:n.getDescriptionIcon,isWarned:function(t){return t.isWarned=function(t){if(e.screenModelPaths&&e.pageModelPaths){let n,r=a(t);n=r&&r.path?t.path.replace(r.path+".","")+"["+t.type+"]":t.path+"["+t.type+"]";let o=~e.screenModelPaths.indexOf(n),i=~e.pageModelPaths.indexOf(n);return o&&!i||i&&!o}}(t)},isHidden:function(e){let t=a(e);return m.pageModelObj!==t&&"object"!==e.type&&"descriptor"!==e.type},isCollapsible:function(e){return e.expanded=!0,!1},getControls:function(e){let t,n,r;return e.parent?f.hasOwnProperty(e.id)?(t=f[e.id],(r=o.compare(t,e))?M.synced:M.diverged):h.hasOwnProperty(e.id)?(n=h[e.id],(r=o.compare(n,e))?M.synced:M.diverged):e.isWarned?x.diverged:x.synced:f.hasOwnProperty(e.id)?(t=f[e.id],(r=o.compare(t,e))?M.synced:M.diverged):h.hasOwnProperty(e.id)?(n=h[e.id],(r=o.compare(n,e))?M.synced:M.diverged):null},isDraggable:function(e){return!e.parent||"object"===e.type},getAcceptedTypes:function(){return["screenmodel","sharedmodel"]},getDragData:function(e){return{type_pagemodel:e.id}},getDragEnter:function(e){return function(e,t){t.stopPropagation();angular.element("#page-model .drag-target")[0].style.backgroundColor="",e.style.backgroundColor="#FFFFAA"}},getDragLeave:function(e){return function(e,t){t.stopPropagation(),e.style.backgroundColor=""}},getDragDrop:function(t){return function(o,i,s){s.stopPropagation();let a,l=i.getData("type_screenmodel"),c=i.getData("type_sharedmodel"),d=n.validateNodeName(t.getChildren(),l||c);a=l?e.data.screenModels[l]:e.data.sharedModels[c],d&&!a.sourcePath&&(l?(r.pageModels.screenModelToObject(a,t),r.screenModels.link(a,t.id),f[t.id]=a):(r.pageModels.sharedModelToObject(a,t),r.sharedModels.link(a,t.id),h[t.id]=a)),o.style.backgroundColor=""}},hasAssociatedItem:function(e){return f.hasOwnProperty(e.id)||h.hasOwnProperty(e.id)},getAssociatedItem:function(e){return f[e.id]?f[e.id].id:h[e.id]?h[e.id].id:void 0}},e.expandPageModel=function(e){let t=f[e.id],n=h[e.id];u(t||n,e),l(),e.expanded=!0,t?t.expanded=!0:(n.expanded=!0,m.sharedModel=!0),m.screenModel=t||n,m.pageModelObj=e,c()},e.syncPageModelEntry=function(e){let t=a(e),n=f[t.id],o=h[t.id];n?r.screenModels.pushNode(e,n,t):r.sharedModels.pushNode(e,o,t),u(n||o,t)},e.unlinkPageModel=function(e){let t,n=f[e.id],o=h[e.id];n?(t=n.sourcePath,delete f[t]):(t=o.sourcePath,delete h[t]),n?r.screenModels.unlink(n):r.sharedModels.unlink(o)};let w={icon:"fa-exchange",title:"Sync Model Entries",action:e.expandPageModel},C={icon:"fa-exchange diverged",title:"Sync Model Entries",action:e.expandPageModel},T={icon:"fa-arrow-circle-left",title:"Sync Model Entry",action:e.syncPageModelEntry},D={icon:"fa-chain-broken",title:"Unlink",action:e.unlinkPageModel},M={synced:[w,D],diverged:[C,D]},x={synced:[],diverged:[T]};e.pmGetAcceptedTypes=function(){return["screenmodel","sharedmodel"]},e.pmOnEnter=function(){return function(e){setTimeout(()=>{e.style.backgroundColor="#FFFFAA"})}},e.pmOnDrop=function(){return function(t,o){let i,s=o.getData("type_screenmodel"),a=o.getData("type_sharedmodel"),l=s||a,c=n.validateNodeName(e.data.pageModels,l);i=s?e.data.screenModels[s]:e.data.sharedModels[a],c&&!i.sourcePath&&(s?(r.pageModels.copyScreenModel(i),i.sourcePath=i.id,r.screenModels.link(i,i.id),f[i.id]=i):(r.pageModels.copySharedModel(i),i.sourcePath=i.id,r.sharedModels.link(i,i.id),h[i.id]=i)),t.style.backgroundColor=""}},e.pmOnLeave=function(){return function(e,t){e.style.backgroundColor=""}},e.sharedModelOptions={getIcon:n.getIcon,getChildren:n.getChildren,getDescription:n.getDescription,getDescriptionIcon:n.getDescriptionIcon,getLabel:function(e){return e.name},isCollapsible:function(e){return e.root===m.sharedModel&&(e.expanded=!0),!1},isWarned:function(e){return e.isWarned=d(e)},isHidden:function(e){return"identifier"===e.type},getControls:function(e){if(e.parent)return e.isWarned?N.diverged:N.synced;if(e.sourcePath){let t=p(e.root.sourcePath.split("."),null);return o.compare(e,t)?O.synced:O.diverged}return null},isDraggable:function(e){return!e.parent},getDragData:function(e){return{type_sharedmodel:e.id}},getAcceptedTypes:function(){return["pagemodel"]},getDragEnter:function(e){return function(e,t){t.stopPropagation();angular.element("#screen-model .drag-target")[0].style.backgroundColor="",e.style.backgroundColor="#FFFFAA"}},getDragLeave:function(e){return function(e,t){t.stopPropagation(),e.style.backgroundColor=""}},getDragDrop:function(t){return function(o,i,s){s.stopPropagation();let a=i.getData("type_pagemodel");if(!(t.parent||t.sourcePath||f.hasOwnProperty(a)||h.hasOwnProperty(a))){let o=a.split("."),i=o.shift(),s=o.join("."),l=_.find(e.data.pageModels,e=>e.id===i),c=n.findByPath(l,s);r.sharedModels.copyPmToExistingSm(t,c),h[a]=t}o.style.backgroundColor=""}},hasAssociatedItem:function(e){return!e.parent},getAssociatedItem:function(e){return e.sourcePath||""}},e.syncSharedModelEntry=function(e){let t=p(e.root.sourcePath.split("."));r.pageModels.pushNode(e,t),u(e.root,t)},e.expandSharedModel=function(e){let t=p(e.sourcePath.split("."),null);u(e,t),l(),e.expanded=!0,m.screenModel=e,m.sharedModel=!0,m.pageModelObj=t,c()},e.unlinkSharedModel=function(e){let t=e.sourcePath;delete h[t],r.sharedModels.unlink(e)};let k={icon:"fa-exchange",title:"Sync Model Entries",action:e.expandSharedModel},P={icon:"fa-exchange diverged",title:"Sync Model Entries",action:e.expandSharedModel},A={icon:"fa-arrow-circle-right",title:"Sync Model Entry",action:e.syncSharedModelEntry},I={icon:"fa-chain-broken",title:"Unlink",action:e.unlinkSharedModel},O={synced:[k,I],diverged:[P,I]},N={synced:[],diverged:[A]};e.sharedGetAcceptedTypes=function(){return["pagemodel"]},e.sharedOnEnter=function(e){return function(e){e.style.backgroundColor="#FFFFAA"}},e.sharedOnDrop=function(){return function(t,o){let i=o.getData("type_pagemodel"),s=i.split("."),a=n.validateNodeName(e.data.sharedModels,s.pop());if(a=a&&!f.hasOwnProperty(i)&&!h.hasOwnProperty(i)){let t=i.split("."),o=t.shift(),s=t.join("."),a=_.find(e.data.pageModels,e=>e.id===o),c=n.findByPath(a,s),d=r.sharedModels.copyPageModelObj(c,h,f);_.each(d,e=>{h[e.descriptorId||e.id]=e}),l(),m.screenModel=d[0]||m.screenModel}t.style.backgroundColor=""}},e.sharedOnLeave=function(){return function(e,t){e.style.backgroundColor=""}}}]),angular.module("common").controller("SaveConfirmCtrl",["$scope",function(e){e.title=e.ngDialogData.title,e.message=e.ngDialogData.message,e.save=e.ngDialogData.save,e.noDiscard=e.ngDialogData.noDiscard,e.discard=e.ngDialogData.discard,e.cancel=e.ngDialogData.cancel}]),angular.module("common").controller("CreateWebConnectorCtrl",["$rootScope","$scope","apiService","commonHelperService",function(e,t,n,r){var o=t.ngDialogData.app;t.model={name:o.explorations.length?"":o.id,startURL:""},t.create=function(){t.showLoading(),t.submitted=!0,n.applications.createExploration({appId:o.id,explorerId:t.model.name.toLowerCase(),config:{startURL:{value:r.checkUrlScheme(t.model.startURL),type:"Literal"}},directory:""}).then(function(e){e.success&&t.ngDialogData.onSubmit(_.extend(e,{explorerId:t.model.name.toLowerCase()})),t.closeThisDialog(),t.hideLoading()})},t.isValid=function(){let e=r.filterName(t.model.name),n=r.filterName(t.model.startURL);return e&&n&&o.explorations.indexOf(e)<0}}]),angular.module("studio",["common","webexplorer","angular-jsonrpc-client","RecursionHelper","mp.autoFocus","ngDialog","uiSwitch","cfp.hotkeys","ui.layout","ui.select","ch.filters","ui.uploader","angularSpectrumColorpicker","angularMoment","ngAnimate","toastr","monospaced.elastic","naif.base64","monospaced.qrcode","720kb.tooltips"]).config(["uiSelectConfig",function(e){e.theme="select2",e.appendToBody=!0}]).config(["$httpProvider",function(e){e.interceptors.push("httpInterceptor")}]).config(["msdElasticConfig",function(e){e.append=""}]).config(["jsonrpcConfigProvider","commonConfigProvider",function(e,t){e.set({url:t.$get().serverUrl+"/api"})}]),angular.module("studio").run(["PmRpcServer","screenService","workspaceService","userService","mockService","componentService","dataService","appService","dialogService","helperService","saveService","previewService","screenTreeService","domService",function(e,t,n,r,o,i,s,a,l,c,d,u,p,f){e({getOpenedApp:a.getOpenedApp,canvasInitialized:n.canvasInitialized,getServerUrl:c.getServerUrl,showContainers:n.showContainers,resizeCanvasFrame:n.resizeCanvasFrame,ready:u.zoomBody,getCurrentStateName:c.getCurrentStateName,getSelectedScreenHtml:t.getSelectedScreenHtml,getSelectedScreenSelector:t.getSelectedScreenSelector,getSelectedScreenPlatform:t.getSelectedScreenPlatform,saveSelectedScreen:d.saveSelectedScreen,openScreen:n.openScreen,screenExists:p.exists,getComponentsMap:i.getComponentsMap,getSelectedComponentId:n.getSelectedComponentId,setSelectedComponentId:n.setSelectedComponentId,cutSelectedComponent:n.cutSelectedComponent,copySelectedComponent:n.copySelectedComponent,pasteToSelectedComponent:n.pasteToSelectedComponent,deleteSelectedComponent:n.deleteSelectedComponent,deleteComponentsWithPrefix:n.deleteComponentsWithPrefix,selectParentComponent:n.selectParentComponent,addComponent:n.addComponent,addDataComponent:s.addDataComponent,moveComponent:n.moveComponent,detectBrokenComponents:f.detectBrokenComponents,getScreenDataStubs:s.getScreenDataStubs,getSelectedMockData:o.getSelectedMockData,getUser:r.getCachedUser,showConfigureDataDialog:l.configureComponentData,showConfigureEventDialog:l.configureComponentEvent,showAlertDialog:l.alert,newProjectDialog:l.newProject})}]),angular.module("studio").config(["$stateProvider","$urlRouterProvider",function(e,t){t.when("","/applications"),t.when("/","/applications"),t.when("/home","/applications"),e.state("login",{url:"/login",templateUrl:"/views/common/login.html",controller:"LoginCtrl"}),e.state("home",{templateUrl:"/views/studio/home.html",controller:"HomeCtrl",resolve:{user:["$rootScope","userService",function(e,t){return t.get()}]}}),e.state("home.applications",{url:"/applications",templateUrl:"/views/studio/home/applications.html",controller:"ApplicationsCtrl"}),e.state("home.templates",{url:"/templates",templateUrl:"/views/studio/home/templates.html",controller:"ApplicationsCtrl"}),e.state("home.users",{url:"/users",templateUrl:"/views/studio/home/users.html",controller:"UsersCtrl"}),e.state("editor",{url:"/studio/:appId",resolve:{user:["$stateParams","$state","$q","userService",function(e,t,n,r){return r.checkPermissions(e.appId).then(function(r){return r.canEdit?r:(t.go("viewer",{appId:e.appId}),n.reject())})}],app:["$rootScope","$stateParams","appService","allFilesService","user","dialogService",function(e,t,n,r,o,i){return r.setRoot("client/src"),e.showLoading(),n.openApp(t.appId).then(function(e){if(!(e.errorMessage&&e.errorMessage.indexOf("Version")>=0))return e;i.updateVersions(e)})}]},views:{"@":{templateUrl:"/views/studio/editor.html",controller:"EditorCtrl"},"sidebar@editor":{templateUrl:"/views/studio/editor/sidebar.html",controller:"SidebarCtrl"},"header@editor":{templateUrl:"/views/studio/editor/header.html",controller:"HeaderCtrl"},"allFilesHeader@editor":{templateUrl:"/views/studio/allFiles/header.html",controller:"AllFilesHeaderCtrl"},"leftPane@editor":{templateUrl:"/views/studio/editor/leftPane.html",controller:"LeftPaneCtrl"},"screens@editor":{templateUrl:"/views/studio/editor/leftPane/screens.html",controller:"LeftPaneScreensCtrl"},"components@editor":{templateUrl:"/views/studio/editor/leftPane/components.html",controller:"LeftPaneComponentsCtrl"},"allFiles@editor":{templateUrl:"/views/studio/editor/leftPane/allFiles.html",controller:"LeftPaneAllFilesCtrl"},"allFilesEditor@editor":{templateUrl:"/views/studio/allFiles/editor.html",controller:"AllFilesEditorCtrl"},"canvasHolder@editor":{templateUrl:"/views/studio/editor/canvasHolder.html",controller:"CanvasHolderCtrl"},"bottomPane@editor":{templateUrl:"/views/studio/editor/bottomPane.html",controller:"BottomPaneCtrl"},"styles@editor":{templateUrl:"/views/studio/editor/bottomPane/styles.html",controller:"BottomPaneStylesCtrl"},"mockdata@editor":{templateUrl:"/views/studio/editor/bottomPane/mockdata.html",controller:"BottomPaneMockDataCtrl"},"mockactions@editor":{templateUrl:"/views/studio/editor/bottomPane/mockactions.html",controller:"BottomPaneMockActionsCtrl"},"rightPane@editor":{templateUrl:"/views/studio/editor/rightPane.html",controller:"RightPaneCtrl"},"outline@editor":{templateUrl:"/views/studio/editor/rightPane/outline.html",controller:"RightPaneOutlineCtrl"},"screenModels@editor":{templateUrl:"/views/studio/editor/rightPane/screenModels.html",controller:"RightPaneScreenModelsCtrl"},"propertySheet@editor":{templateUrl:"/views/studio/editor/rightPane/propertySheet.html",controller:"RightPanePropertySheetCtrl"},"screenProperties@editor":{templateUrl:"/views/studio/editor/rightPane/screenProperties.html",controller:"RightPaneScreenPropertiesCtrl"}}}),e.state("connect",{url:"/connect/:appId",resolve:{user:["$stateParams","$state","$q","userService",function(e,t,n,r){return r.checkPermissions(e.appId)}],app:["$rootScope","$stateParams","connectAppService","allFilesService","user",function(e,t,n,r,o){return r.setRoot("server"),e.showLoading(),n.openApp(t.appId)}]},views:{"@":{templateUrl:"/views/connect/connect.html",controller:"ConnectCtrl"},"sidebar@connect":{templateUrl:"/views/connect/sidebar.html",controller:"ConnectSidebarCtrl"},"header@connect":{templateUrl:"/views/connect/header.html",controller:"ConnectHeaderCtrl"},"allFilesHeader@connect":{templateUrl:"/views/connect/allFiles/header.html",controller:"AllFilesConnectHeaderCtrl"},"allFiles@connect":{templateUrl:"/views/studio/editor/leftPane/allFiles.html",controller:"LeftPaneAllFilesCtrl"},"allFilesEditor@connect":{templateUrl:"/views/studio/allFiles/editor.html",controller:"AllFilesEditorCtrl"},"leftPane@connect":{templateUrl:"/views/connect/leftPane.html",controller:"ConnectLeftPaneCtrl"},"screens@connect":{templateUrl:"/views/connect/leftPane/endpoints.html",controller:"LeftPaneEndpointsCtrl"},"blocks@connect":{templateUrl:"/views/connect/leftPane/blocks.html",controller:"LeftPaneBlocksCtrl"},"events@connect":{templateUrl:"/views/connect/leftPane/events.html",controller:"LeftPaneEventsCtrl"},"canvasHolder@connect":{templateUrl:"/views/connect/canvasHolder.html",controller:"CanvasHolderConnectCtrl"},"bottomPane@connect":{templateUrl:"/views/connect/bottomPane.html",controller:"ConnectBottomPaneCtrl"},"styles@connect":{templateUrl:"/views/connect/bottomPane/styles.html",controller:"BottomPaneStylesCtrl"},"mockdata@connect":{templateUrl:"/views/connect/bottomPane/mockdata.html",controller:"BottomPaneMockDataCtrl"},"mockactions@connect":{templateUrl:"/views/connect/bottomPane/mockactions.html",controller:"BottomPaneMockActionsCtrl"},"endpoint@connect":{templateUrl:"/views/connect/centerPane/connectCanvas.html",controller:"ConnectCanvasCtrl"}}}),e.state("viewer",{url:"/viewer/:appId",resolve:{user:["userService","$stateParams",function(e,t){return e.checkPermissions(t.appId)}],app:["$rootScope","$state","$stateParams","appService",function(e,t,n,r){return e.showLoading(),r.openApp(n.appId)}]},views:{"@":{templateUrl:"/views/studio/viewer.html",controller:"ViewerCtrl"},"sidebar@viewer":{templateUrl:"/views/studio/viewer/sidebar.html",controller:"ViewerSidebarCtrl"},"header@viewer":{templateUrl:"/views/studio/viewer/header.html",controller:"ViewerHeaderCtrl"},"leftPane@viewer":{templateUrl:"/views/studio/viewer/leftPane.html"},"screens@viewer":{templateUrl:"/views/studio/viewer/leftPane/screens.html",controller:"ViewerLeftPaneScreensCtrl"},"canvasHolder@viewer":{templateUrl:"/views/studio/viewer/canvasHolder.html",controller:"ViewerCanvasHolderCtrl"},"bottomPane@viewer":{templateUrl:"/views/studio/viewer/bottomPane.html",controller:"ViewerBottomPaneCtrl"},"rightPane@viewer":{templateUrl:"/views/studio/viewer/rightPane.html",controller:"ViewerRightPaneCtrl"},"outline@viewer":{templateUrl:"/views/studio/viewer/rightPane/outline.html",controller:"ViewerRightPaneOutlineCtrl"},"screenModels@viewer":{templateUrl:"/views/studio/viewer/rightPane/screenModels.html",controller:"ViewerRightPaneScreenModelsCtrl"},"propertySheet@viewer":{templateUrl:"/views/studio/viewer/rightPane/propertySheet.html",controller:"ViewerRightPanePropertySheetCtrl"}}}),e.state("explorer",{url:"/app/:appId/explorer/:explorerId",resolve:{user:["$stateParams","$state","$q","userService",function(e,t,n,r){return r.checkPermissions(e.appId).then(function(r){return r.canEdit?r:(t.go("viewer",{appId:e.appId}),n.reject())})}],app:["$q","$rootScope","$stateParams","allFilesService","global",function(e,t,n,r,o){var i=e.defer();return t.appId=n.appId,t.explorerId=n.explorerId,r.setRoot("transform/"+n.explorerId),o.$fetch(i.resolve,i.reject),i.promise}]},views:{"@":{templateUrl:"/views/webexplorer/webexplorer.html",controller:"webExplorerCtrl"},"header@explorer":{templateUrl:"/views/webexplorer/header.html",controller:"xHeaderCtrl"},"xFilesHeader@explorer":{templateUrl:"/views/webexplorer/allFiles/header.html",controller:"xFilesHeaderCtrl"},"sidebar@explorer":{templateUrl:"/views/webexplorer/sidebar.html",controller:"xSidebarCtrl"},"leftPane@explorer":{templateUrl:"/views/webexplorer/leftPane.html",controller:"xLeftPaneCtrl"},"pages@explorer":{templateUrl:"/views/webexplorer/leftPane/pages.html",controller:"PagesCtrl"},"events@explorer":{templateUrl:"/views/webexplorer/leftPane/events.html",controller:"EventsCtrl"},"allFiles@explorer":{templateUrl:"/views/webexplorer/leftPane/allFiles.html",controller:"xFilesCtrl"},"selector@explorer":{templateUrl:"/views/webexplorer/leftPane/selector.html",controller:"SelectorCtrl"},"statusbar@explorer":{templateUrl:"/views/webexplorer/leftPane/statusbar.html",controller:"StatusbarCtrl"},"center@explorer":{templateUrl:"/views/webexplorer/centerPane.html",controller:"CenterPaneCtrl"},"topPane@explorer":{templateUrl:"/views/webexplorer/centerPane/topPane.html",controller:"TopPaneCtrl"},"bottomPane@explorer":{templateUrl:"/views/webexplorer/centerPane/bottomPane.html",controller:"xBottomPaneCtrl"},"xFilesEditor@explorer":{templateUrl:"/views/studio/allFiles/editor.html",controller:"xFilesEditorCtrl"}}})}]),angular.module("studio").factory("config",["commonConfig",function(e){return _.extend({},e,{layout:{west:"325px",east:"310px",south:"300px",eastNorth:"30%"},devices:[{id:"iphone8",name:"iPhone 6/7/8",type:"phone",platform:"ios",mode:"ios"},{id:"iphonex",name:"iPhone X",type:"phone",platform:"ios",mode:"ios"},{id:"ipad-mini",name:"iPad Mini",type:"tablet",platform:"ios",mode:"ios"},{id:"ipad",name:"iPad Pro",type:"tablet",platform:"ios",mode:"ios"},{id:"iphone5",name:"iPhone 4/5",type:"phone",platform:"ios",mode:"ios"},{id:"galaxyS8",name:"Galaxy S8",type:"phone",platform:"android",mode:"md"},{id:"pixel2",name:"Pixel 2",type:"phone",platform:"android",mode:"md"},{id:"galaxyview",name:"Galaxy View",type:"tablet",platform:"android",mode:"md"},{id:"galaxyS6",name:"Galaxy S6",type:"phone",platform:"android",mode:"md"},{id:"hpEliteX3",name:"HP Elite x3",type:"phone",platform:"windows",mode:"wp"},{id:"surfacert",name:"Surface Pro",type:"tablet",platform:"windows",mode:"wp"},{id:"lumia950",name:"Nokia Lumia 950",type:"phone",platform:"windows",mode:"wp"},{id:"desktop",name:"Desktop",type:"desktop",platform:"core",mode:"md"}],layouts:[{id:"PhonePortrait",name:"Phone Portrait"},{id:"PhoneLandscape",name:"Phone Landscape"},{id:"TabletPortrait",name:"Tablet Portrait"},{id:"TabletLandscape",name:"Tablet Landscape"},{id:"Desktop",name:"Desktop"}],messages:{incorrectFileType:"Incorrect type of file. You can upload images only.",deleteAssocModels:'Would you like to also delete associated screen models: "{{assocModels}}"?',noStartScreenChose:"There is no default start screen in this app. Please set it using project settings.",mockDataError:'There was a data mapping and screen model mismatch.<br><br>Screen model path "{{path}}" does not exist.<br>Failed to find "{{subPath}}".<br><br>Please edit screen model or adjust data mapping.',operationNotPermitted:"This operation is not permitted",folderDelete:"All child screens will be deleted by this operation. Are you sure you want to proceed?",appDelete:'Are you sure you want to delete the app "{{name}}"?',screenReset:'Are you sure you want to reset the screen "{{name}}"?',userDelete:'Are you sure you want to delete the user "{{name}}"?',updateComponents:"If changes have been made to an existing component(s) or a new component(s) was added, this button will update the component(s).",repositoryUpdated:"The remote application repository has been updated. Please save your changes and merge possible conflicts, or refresh the window.",compileError:"Compile Error: Click for details"}})}]),angular.module("studio").run(["$rootScope","$window","$document","$location","previewService",function(e,t,n,r,o){e.EVENT_APP_OPENED="app.opened",e.EVENT_CANVAS_READY="canvas.ready",e.EVENT_SCREENS_RESTORED="screens.restored",e.EVENT_SCREEN_SELECTED="screen.selected",e.EVENT_SCREEN_CLOSED="screen.closed",e.EVENT_SCREEN_DELETED="screen.deleted",e.EVENT_VIEW_SELECTED="view.selected",e.EVENT_VIEW_CHANGED="view.changed",e.EVENT_COMPONENT_SELECTED="component.selected",e.EVENT_COMPONENT_CHANGED="component.changed",e.EVENT_COMPONENTS_BROKEN="components.broken",e.EVENT_UPDATED_MOCKS_TREE="updated.mocksTree",e.EVENT_UPDATED_MOCK_DATA="updated.mockData",e.EVENT_UPDATED_SHARED_MODELS="updated.sharedModels",e.EVENT_UPDATED_SCREEN_MODELS="updated.screenModels",e.EVENT_UPDATED_APP_COLORS="updated.appColors",e.EVENT_UPDATED_THEMES="updated.themes",e.EVENT_UPDATED_USERS="updated.users",e.EVENT_ENDPOINT_SELECTED="endpoint.selected",e.EVENT_ENDPOINT_CLOSED="endpoint.closed",e.EVENT_ENDPOINT_CHANGED="endpoint.changed",e.EVENT_BLOCK_SELECTED="block.selected",e.EVENT_KEY_DELETE="key.delete",e.EVENT_CONNECTORS_CHANGED="connectors.changed";var i;e.$on("$stateChangeStart",function(){i=r.search()}),e.$on("$stateChangeSuccess",function(){r.search(i)}),t.addEventListener("webkitfullscreenchange",function(){console.log("bootstrap: Event webkitfullscreenchange ("+n.webkitIsFullScreen+")"),o.resizeDevice(o.zoomBody)})}]),angular.module("studio").run(["$rootScope","$window","apiService","config",function(e,t,n,r){n.env.get().then(function(t){e.env=t});var o="bower_components/monaco-editor/release/min/vs";"production"===r.env&&(o="scripts/monaco-editor/min/vs"),t.require.config({paths:{vs:o},ignoreDuplicateModules:["vscode-languageserver-types","vscode-languageserver-types/main"]}),t.require(["vs/editor/editor.main"],function(){t.monaco=monaco})}]),angular.module("studio").service("apiService",["jsonrpc","$q","$stateParams","$rootScope","commonDialogs",function(e,t,n,r,o){let i=this,s=["screens","styles","images","mocks","screenModels","versions","pageModels","tree","connections","files","endpoints","events","blocks","connectors","sharedModels","components","cordova"];_.each({getters:{env:["get"],framework:["getVersions"],users:["authenticate","checkAdmin","listAll","isUnique","create","updateProfile","updatePassword","updatePermissions","delete","getCurrentUser"],versions:["getList","resetToCommit","resolveMerge"],files:["getTree","getSource"],applications:["getApps","getAllApps","getTemplateGroups","getTemplates","getAppTemplates","createExploration","get","open","importRepository","publish","getPublishInfo","getBuildAssets"],components:["getAll","update","getIconsList"],images:["getList"],mocks:["getDataFilesTree","getActionsTree","getDataFile","getActionSource","getMockSetsByModel"],screenModels:["get"],screens:["getTree","getScreenSources","getControllerMembers"],sharedModels:["get"],styles:["getList","getFile","getThemesAndColors"],blocks:["getAll"],endpoints:["getTree","getEndpoint","saveEndpoint"],events:["getTransformEvents"],connectors:["getActiveWebConnectors","getActiveAPIConnectors","getAllWebConnectors","getConnectorConfig","saveActiveConnectors"],runServer:["start","stop"],pageModels:["get","getModel"],cordova:["getSDKs"]},setters:{files:["setSource","createFile","deleteFile","renameFile"],applications:["create","delete","update","updateClientVersion"],images:["deleteImage"],mocks:["updateDataFile","setActionSource","addSubData","renameSubData","deleteSubData"],screenModels:["addProp","updateProp","deleteProp","setUpdatingProperty"],screens:["moveScreen","createScreen","deleteScreen","updateScreen","createView","deleteView","createFolder","renameFolder","deleteFolder","resetScreen"],sharedModels:["addModel","updateModel","deleteModel","addProp","updateProp","deleteProp","setUpdatingProperty"],styles:["updateFile","renameFile","deleteFile","createFile","createTheme","deleteTheme","setColors"],endpoints:["saveEndpoint"],connectors:["saveActiveConnectors"]}},(n,s)=>{_.each(n,(n,a)=>{i[a]=i[a]||{},_.each(n,n=>{let l="studio/"+a+"."+n;i[a][n]=function(c){return e.request(l,i.prepareParams(c,a)).then(e=>(r.$broadcast(r.EVENT_API_SUCCESS,{name:l,namespace:a,isSetter:"setters"===s}),e)).catch(e=>(r.hideLoading(),console.error(e,l,c),"getCurrentUser"!==n&&o.error(e.name,e.message),t.reject(e)))},i[a][n].$method=l,i[a][n].$namespace=a,i[a][n].$isSetter="setters"===s})})}),i.prepareParams=function(e,t){return e||(e={}),s.indexOf(t)>-1&&(e.appId||(e.appId=n.appId)),!e.wsConnectionId&&r.wsConnectionId&&(e.wsConnectionId=r.wsConnectionId),e}}]),angular.module("studio").service("clipboardService",["$compile","$rootScope","$document",function(e,t,n){this.copy=function(r,o){var i=angular.element('<input id="clipboardCopyId" value="'+o+'">');n.find("body").eq(0).append(e(i)(t));var s=angular.element(document.getElementById("clipboardCopyId"));s.focus(),s.select(),document.execCommand("copy"),i.remove(),r.target.classList.add("copied"),setTimeout(function(){r.target.classList.remove("copied")},1500)}}]),angular.module("studio").service("dialogService",["$q","$rootScope","componentService","screenService","ngDialog","commonDialogs","apiService","connectApiService","appService","templateService","config","workspaceService","versionsService","helperService","modelTreeService","screenModelService",function(e,t,n,r,o,i,s,a,l,c,d,u,p,f,h,m){function g(e){return e&&e.field&&(e.field="'"+e.field+"'"),e?JSON.stringify(e).replace(/"/g,""):null}_.extend(this,i),this.configureComponentData=((o,i,a)=>{let l=n.getComponentTypeFromId(o),c=u.getComponentsMap(),d=u.getRepeatedPropertyId(c,o);a||(a=u.getPropertyValue(o,i));let p;switch(l){case"datetime":p=["date","time"];break;case"select":case"radio-group":p=["select"],a=a&&a.replace(/\.selected$/,"");break;case"toggle":case"radio":case"checkbox":a=a&&a.replace(/\.selected\[i\]$/,""),p=["boolean","select"];break;case"action-sheet":p=["array"];break;default:p=["string","number","date","time","boolean"]}switch(i){case"ngDisabled":case"ngReadonly":p=["boolean"]}let f=r.getSelectedScreen();s.screens.getControllerMembers({id:f.id,selectedView:f.selectedView}).then(n=>{t.$broadcast(t.EVENT_DIALOG_REQUESTED,"data-binding",{selectedValue:a,treeRoot:d,controllerletiables:n.letiables,filter:p,componentType:l,componentId:o,propertyId:i,onSelected:n=>{let r,s=n.binding.replace(/^data\./,""),a=m.getSelectedScreenModel(),c=h.findByPath(a,s)||{},d=[],p=g(n.change);switch(d.push(u.setPropertyValue(o,"powwowChange",p)),d.push(u.setPropertyValue(o,"indices",n.indices||"")),l){case"datetime":d.push(u.setPropertyValue(o,"displayFormat",c.format)),d.push(u.setPropertyValue(o,"pickerFormat",c.format));break;case"select":let e=`let item of ${n.binding}.options`;d.push(u.setPropertyValue(o,"ngRepeat",e)),d.push(u.setPropertyValue(o,"optionLabel","item.label")),d.push(u.setPropertyValue(o,"ngValue","item.value")),n.binding+=".selected";break;case"radio-group":let t=`let item of ${n.binding}.options`;d.push(u.setPropertyValue(o,"ngRepeat",t)),d.push(u.setPropertyValue(o,"optionLabel","item.label")),d.push(u.setPropertyValue(o,"ngValue","item")),n.binding+=".selected";break;case"toggle":case"checkbox":if("select"===c.type){r=`let item of ${n.binding}.options;`,d.push(u.setPropertyValue(o,"ngRepeat",r)),d.push(u.setPropertyValue(o,"innerHTML","{{item.label}}"));let e=`toggleSelection(${n.binding}, item);`;d.push(u.setPropertyValue(o,"ngClick",e));let t=`isSelected(${n.binding}, item)`;d.push(u.setPropertyValue(o,"ngChecked",t)),n.binding=""}else d.push(u.setPropertyValue(o,"ngRepeat",""))}return d.push(u.setPropertyValue(o,i,n.binding)),e.all(d).then(()=>{t.$broadcast(t.EVENT_VIEW_CHANGED)})}})})}),this.configureComponentRepeat=((o,i,a)=>{let l=n.getComponentTypeFromId(o),c=u.getComponentsMap(),d=u.getRepeatedPropertyId(c,o);a&&/.+\sof\s.+/.test(a)&&(a=/(^.+\sof\s.+?)(?:;|\s|$)/.exec(a)[1]),a&&a.indexOf("|")>=0&&(a=a.substring(0,a.indexOf("|")));let p=r.getSelectedScreen();s.screens.getControllerMembers({id:p.id,selectedView:p.selectedView}).then(n=>{t.$broadcast(t.EVENT_DIALOG_REQUESTED,"data-binding",{ngRepeat:!0,treeRoot:d,controllerletiables:n.letiables,selectedValue:a,componentType:l,componentId:o,propertyId:i,onSelected:n=>{let r=/(?:^.+\sof\s(.+?))(?:\s|$)/.exec(n.binding)[1];r=r.replace(/^data\./,"").replace(/.options$/,"");let s=m.getSelectedScreenModel(),a=h.findByPath(s,r)||{},c=[],d=g(n.change);if(c.push(u.setPropertyValue(o,"powwowChange",d)),c.push(u.setPropertyValue(o,"indices",n.indices||"")),~["radio","checkbox","toggle"].indexOf(l)&&"select"===a.type){c.push(u.setPropertyValue(o,"innerHTML","{{item.label}}"));let e=f.parseRepeatValue(n.binding).selectData,t=`toggleSelection(${e}, item);`;c.push(u.setPropertyValue(o,"ngClick",t));let r=`isSelected(${e}, item)`;c.push(u.setPropertyValue(o,"ngChecked",r)),"radio"===l&&c.push(u.setPropertyValue(o,"ngValue","item"))}return n.binding+=";let i = index",c.push(u.setPropertyValue(o,i,n.binding)),e.all(c).then(()=>{t.$broadcast(t.EVENT_VIEW_CHANGED)})}})})}),this.configureComponentEvent=((e,n,o)=>{let i=u.getComponentsMap(),a=u.getRepeatedPropertyId(i,e,!0);o||(o=u.getPropertyValue(e,n));let l=r.getSelectedScreen();s.screens.getControllerMembers({id:l.id,selectedView:l.selectedView}).then(r=>{t.$broadcast(t.EVENT_DIALOG_REQUESTED,"method-binding",{treeRoot:a,controllerMethods:r.methods,selectedValue:o,onSelected:r=>{u.setPropertyValue(e,n,r).then(()=>{t.$broadcast(t.EVENT_VIEW_CHANGED)})}})})}),this.configureComponentAction=((e,n,r)=>{t.$broadcast(t.EVENT_DIALOG_REQUESTED,"action-string-binding",{selectedValue:r,onSelected:r=>{u.setPropertyValue(e,n,r).then(()=>{t.$broadcast(t.EVENT_VIEW_CHANGED)})}})}),this.configureImageSource=((e,n,r)=>{t.$broadcast(t.EVENT_DIALOG_REQUESTED,"image-manager",{selectedValue:r,onSelected:r=>{u.setPropertyValue(e,n,r).then(()=>{t.$broadcast(t.EVENT_VIEW_CHANGED)})}})}),this.selectIcon=((e,n,r)=>{t.showLoading(),s.components.getIconsList({appId:t.app.id}).then(o=>{t.$broadcast(t.EVENT_DIALOG_REQUESTED,"select-icon",{icons:o,selectedValue:r,onSelected:r=>{u.setPropertyValue(e,n,r).then(()=>{t.$broadcast(t.EVENT_VIEW_CHANGED)})}})})}),this.projectSettings=(e=>{t.showLoading(),s.framework.getVersions().then(n=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"project-form",{data:t.app,versions:n,applications:e})})}),this.viewAppSettings=(()=>{t.showLoading(),s.framework.getVersions().then(e=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"view-app-settings",{data:t.app,versions:e})})}),this.newProject=((e,n,r,o)=>{t.showLoading(),s.framework.getVersions().then(i=>{t.$emit(t.EVENT_DIALOG_REQUESTED,e,{versions:i,id:n,withRepo:r,isAppTemplate:o})})}),this.importRepository=(()=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"import-repository")}),this.importZip=(()=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"import-zip")}),this.editMockData=((n,r)=>{let o=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"mock-data",{propId:n,dataPath:r,onSave:o.resolve},{allowMultiple:!0}),o.promise}),this.editScreenModels=(e=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"edit-screen-models",{selectedScreenModel:e})}),this.viewSourceScreenModels=(e=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"view-screen-models",{selectedScreenModel:e})}),this.dataEntryForm=((n,r,o)=>{let i=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"edit-screen-models/property",{data:o,parent:r,screenModel:n,onSubmit:i.resolve}),i.promise}),this.createScreen=(e=>{t.showLoading(),c.getTemplateGroups().then(n=>{t.$broadcast(t.EVENT_DIALOG_REQUESTED,"create-screen",{parent:e,groups:n})})}),this.preview=((e,n,r,o)=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"preview",{app:e,screen:n,screenData:r,fromUsersDir:o})}),this.runAppServer=(e=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"run-app-server",{app:e})}),this.appStyles=(()=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"app-styles")}),this.revisionHistory=(()=>{t.showLoading(),p.getList().then(e=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"revision-history",e),t.hideLoading()})}),this.viewRevisionHistory=(()=>{t.showLoading(),p.getList().then(e=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"view-revision-history",e),t.hideLoading()})}),this.newUser=(()=>{t.showLoading(),t.$broadcast(t.EVENT_DIALOG_REQUESTED,"new-user",{})}),this.editUser=(e=>{t.showLoading(),l.getAllApps().then(n=>{t.$broadcast(t.EVENT_DIALOG_REQUESTED,"edit-user",{apps:n,user:e})})}),this.changePassword=(e=>{t.showLoading(),t.$broadcast(t.EVENT_DIALOG_REQUESTED,"change-password",{user:e})}),this.editComponents=((e,n)=>{t.$broadcast(t.EVENT_DIALOG_REQUESTED,"edit-components",{update:e,updateMessage:n})}),this.manageViews=(e=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"manage-views",{screen:e})}),this.publish=(()=>{s.applications.getPublishInfo({appId:t.app.id}).then(e=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"publish",{data:e})})}),this.copyApp=(n=>{let r=e.defer();return t.$broadcast(t.EVENT_DIALOG_REQUESTED,"copy-app",{app:n,onSubmit:r.resolve}),r.promise}),this.sharedModelForm=(n=>{let r=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"edit-screen-models/shared-model",{data:n,onSubmit:r.resolve}),r.promise}),this.updateVersions=(e=>{t.showLoading(),s.framework.getVersions().then(n=>{a.framework.getVersions().then(r=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"updateVersions",{clientVersions:n,serverVersions:r,data:e}),t.hideLoading()})})}),this.pluginOptions=(n=>{const r=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"project-form/plugin-options",{data:n,onSubmit:r.resolve}),r.promise}),this.pluginOptionArray=(n=>{const r=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"project-form/plugin-option-array",{data:n,onSubmit:r.resolve}),r.promise}),this.setData=function(n,r){let o=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"set-data",{block:n,eventArea:r,onSubmit:o.resolve}),o.promise},this.codeBlockSettings=function(n){let r=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"code-block",{block:n,onSubmit:r.resolve}),r.promise},this.evalSyncBlockSettings=function(e,t){alert("Not yet implemented.  Use code view to manually enter parameters.")},this.imageDataUriBlockSettings=function(e,t){alert("Not yet implemented.  Use code view to manually enter parameters.")},this.conditionBuilder=function(n,r){let o=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"condition-builder",{block:n,eventArea:r,onSubmit:o.resolve}),o.promise},this.triggerBuilder=function(n){let r=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"trigger-builder",{eventArea:n,onSubmit:r.resolve}),r.promise},this.selectScreen=function(n,r){let o=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"select-screen",{block:n,onSubmit:o.resolve}),o.promise},this.selectEvent=function(n,r,o){let i=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"select-event",{block:n,events:r,onSubmit:i.resolve}),i.promise},this.connectConfig=function(n){let r=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"connect-config",{connectors:n,onSubmit:r.resolve}),r.promise},this.connectEditSettings=function(n){let r=e.defer();return t.$emit(t.EVENT_DIALOG_REQUESTED,"connect-edit-settings",{connector:n,onSubmit:r.resolve}),r.promise},this.customEvent=function(n){let r=e.defer();t.$emit(t.EVENT_DIALOG_REQUESTED,"custom-event",{currentEndpoint:n,onSubmit:r.resolve})}}]),angular.module("studio").service("domService",["$injector","$rootScope",function(e,t){function n(e){return c.parseTemplate(`<ion-content data-comp-id="content.1">${e.html()}</ion-content>`)}function r(e){return c.parseTemplate(e("ion-content").html())}function o(e,t){return e(`[data-comp-id="${t}"]`)}function i(e,t,n){let r=1;for(;t(`[data-comp-id="${e}.${r}"]`).length||n&&n.find(`[data-comp-id="${e}.${r}"]`).length;)r++;return e+"."+r}function s(e,t){let n=t.find("[data-comp-id]").toArray();a(n);for(let r of n){let n=r.attribs["data-comp-id"];r.attribs["data-comp-id"]=i(n,e,t)}}function a(e){for(let t of e){let e=t.attribs["data-comp-id"];t.attribs["data-comp-id"]=e.split(".")[0]}}function l(e,t,n,r){switch(t){case"before":e.insertBefore(n);break;case"after":e.insertAfter(n);break;case"last":default:e.appendTo(r)}}let c=this;c.parseTemplate=function(e){return cheerio.load(e,{xmlMode:!1,useHtmlParser2:!0,lowerCaseAttributeNames:!1,decodeEntities:!1})},c.normalizeIds=function(e){let t=e("[data-comp-id]").toArray();a(t);for(let n of t){let t=n.attribs["data-comp-id"];n.attribs["data-comp-id"]=i(t,e)}},c.addComponent=function(t,a,d,u,p,f){f.removeAttr("data-comp-id");let h=!1;t("ion-content").length||(h=!0,t=n(t)),s(t,f);let m=i(p,t);if(f.attr("data-comp-id",m),a.includes("list.")||"ion-item"!==f[0].name)"screen.1"===a&&"footer"===p&&(d="content.1",u="after");else{f=function(e,t){let n=c.parseTemplate(`<${t}></${t}>`)("*").first();return n.append(e),n}(f,"ion-list");let e=i("list",t);f.attr("data-comp-id",e)}let g=o(t,a);l(f,u,d?o(t,d):null,g),h&&(e.get("screenService").getSelectedScreen().dom=r(t))},c.moveComponent=function(t,i,s,a,c){let d=!1;t("ion-content").length||(d=!0,t=n(t));let u=o(t,c),p=o(t,i);l(u,a,s?o(t,s):null,p),d&&(e.get("screenService").getSelectedScreen().dom=r(t))},c.removeComponent=function(e,t){let n=o(e,t),r=n.prev("[data-comp-id]");return r.length||(r=n.next("[data-comp-id]")),r.length||(r=n.parent("[data-comp-id]")),n.remove(),r.attr("data-comp-id")},c.removeComponentsWithPrefix=function(e,t){e(`[data-comp-id^="${t}"]`).remove()},c.getParentComponentId=function(e,t){let n=o(e,t).parent("[data-comp-id]");return n.length?n.attr("data-comp-id"):null},c.copyComponent=function(e,t){let n=o(e,t);return e.html(n)},c.pasteToComponent=function(t,n,r){let a=o(t,n),l=c.parseTemplate(r)("*").first();if(s(t,l),1===l.length&&l.attr("data-comp-id")){let n=l.attr("data-comp-id").split(".")[0];l.attr("data-comp-id",i(n,t));let r=a.attr("data-comp-id").split(".")[0],o=e.get("componentService");return o.isComponentContainer(r)&&0===a.children().length&&o.isAddAllowed(r,n)?l.appendTo(a):l.insertAfter(a),!0}return!1},c.getNearestComponentFromElement=function(e){for(;e&&!e.attribs["data-comp-id"];)e=e.parentNode;return e},c.getPathToComponent=function(e){let t=[];for(;e;)e.attribs["data-comp-id"]&&t.unshift(e.attribs["data-comp-id"]),e=e.parentNode;return t},c.detectBrokenComponents=function(n){let r=new RegExp(n,"gm"),o=[];e.get("screenService").getSelectedScreen().dom("*").each((e,t)=>{t.children.forEach(e=>{"text"===e.type&&r.test(e.data)&&o.push(e)}),_.each(t.attribs,e=>{r.test(e)&&o.push(t)})});let i=[],s=[];return o.forEach(e=>{let t=c.getNearestComponentFromElement(e);s.push(t.attribs["data-comp-id"]);let n=c.getPathToComponent(t);i.push(n)}),t.$broadcast(t.EVENT_COMPONENTS_BROKEN,s),i}}]),angular.module("studio").service("helperService",["commonHelperService","config","$state",function(e,t,n){_.extend(this,e),this.getServerUrl=function(){return t.serverUrl},this.prettyHTML=function(e){try{return prettydiff({source:e,lang:"markup",html:!0,mode:"beautify",report:!1})[0]}catch(t){return e}},this.prettyJSON=function(e){try{return JSON.stringify(JSON.parse(e),null,2)}catch(t){return e}},this.prettyTS=function(e){try{return prettydiff({source:e,lang:"javascript",mode:"beautify",quoteConvert:"double"})[0]}catch(e){return json}},this.checkVersion=function(e,t){return!!t&&(e=e.split(".").map(_.partial(parseInt,_,10)),(t=t.split(".").map(_.partial(parseInt,_,10)))[0]>e[0]||t[0]===e[0]&&t[1]>e[1]||t[0]===e[0]&&t[1]===e[1]&&t[2]>=e[2])},this.getCurrentStateName=function(){return n.current.name}}]),angular.module("studio").service("previewService",["$timeout","$rootScope","config","$sce",function(e,t,n,r){let o=this;o.resizeDevice=function(t){let n=document.querySelector(".preview-content");if(!n)return setTimeout(function(){o.resizeDevice()},5);n.style.opacity=0,e(()=>{n.style.transform="scale(1) translate(-50%, -50%)";let r=n.clientHeight,i=n.clientWidth,s=(window.innerHeight-260)/r,a=(window.innerWidth-280)/i,l=s<a?s:a;l<1&&(n.style.transform=`scale(${l}) translate(-50%, -50%)`,o.zoomBody()),"function"==typeof t&&t(),e(()=>{n.style.opacity=1},100)},200)},o.zoomBody=function(){let e=document.querySelector(".preview-content");if(!e)return!1;let t=e.querySelector("iframe"),n={jsonrpc:"2.0",method:"setZoom",params:[e.style.zoom.replace("scale(","").replace(")","")]};t.contentWindow.postMessage(JSON.stringify(n),"*"),n={jsonrpc:"2.0",method:"hideScrollbars",params:[]},t.contentWindow.postMessage(JSON.stringify(n),"*");n={jsonrpc:"2.0",method:"setBorderRadius",params:[getComputedStyle(e,null).borderRadius]},t.contentWindow.postMessage(JSON.stringify(n),"*")},o.generateUrl=function(e,o){let i=o.fromUsersDir?"user-"+t.user.id+"/":"",s=n.serverUrl+"/apps/"+i+e.previewToken+"-"+e.id+"/index.html",a=o.device,l=s,c="";return o.screen&&(c="&screen="+o.screen),a?(l+="?device="+a.type,a.platform&&(l+="&ionicplatform="+a.platform),l+=!0===o.isMock?"&rpcUrl=mock"+c:"&rpcUrl="+encodeURIComponent(o.rpcUrl)):l+=!0===o.isMock?"?rpcUrl=mock"+c:"?rpcUrl="+encodeURIComponent(o.rpcUrl),o.fromDevice&&(l="powwowpreview://"+encodeURIComponent(l)),r.trustAsResourceUrl(l)}}]),angular.module("studio").service("saveService",["$rootScope","$q","screenService","mockService","styleService","batchRequest","workspaceService","canvas","endpointService","dialogService","screenModelService",function(e,t,n,r,o,i,s,a,l,c,d){const u=this;u.saveAllEditorFiles=function(){return o.saveAllStyles(),r.saveAllMockFiles(),n.saveAllScreens(!0),i.send().then(e=>(d.markModelsNotDirty(),e?s.refreshStudio():t.resolve())).then(()=>{a.refreshCss()})},u.saveSelectedScreen=function(){return e.showLoading(),n.saveSelectedScreen().then(e.hideLoading)},u.hasUnsavedChanges=function(){let e=o.hasDirtyStyles(),t=r.hasDirtyDataFiles()||r.hasDirtySources(),i=n.hasDirtyScreens();return e||t||i},u.ensureAllSaved=function(){let n=t.defer();return u.hasUnsavedChanges()?c.confirm("Save changes","Do you want to save unsaved changes?").then(()=>(e.showLoading(),u.saveAllEditorFiles())).then(()=>{e.hideLoading(),n.resolve()}).catch(n.reject):n.resolve(),n.promise},u.saveSelectedEndpoint=(()=>(e.showLoading(),l.saveSelectedView().then(e.hideLoading))),u.saveAllEndpoints=(()=>(e.showLoading(),l.saveAllViews().then(e.hideLoading)))}]),angular.module("studio").service("settingsService",["config","helperService",function(e,t){var n=this;n.getAll=function(){return JSON.parse(localStorage.getItem("settings"))||{}},n.get=function(e){var t=n.getAll();return t[e.id]=t[e.id]||{},t[e.id]},n.set=function(e,t){var r=n.getAll();r[e.id]=t,localStorage.setItem("settings",JSON.stringify(r))},n.detect=function(r,o){var i=n.get(r);if(_.extend(i,o),!i.preview){var s=t.toKebabCase(r.defaultLayout).split("-");i.preview={device:_.where(e.devices,{type:s[0]})[0].id,landscapeMode:!!s[1]&&"landscape"===s[1],mock:!0,rpcUrl:"ws://localhost:3000"}}return n.set(r,i),i}}]),angular.module("studio").service("versionsService",["$rootScope","apiService",function(e,t){this.getList=function(){return t.versions.getList().then(function(e){return e})},this.resetToCommit=function(e){return t.versions.resetToCommit({version:e}).then(function(e){return e})},this.resolveMerge=function(e){return t.versions.resolveMerge({acceptTheirs:e}).then(function(e){return e})}}]),angular.module("studio").service("workspaceService",["$injector","$rootScope","$q","$timeout","componentService","propertyService","screenService","domService","helperService","canvas","mockService","styleService","appService",function(e,t,n,r,o,i,s,a,l,c,d,u,p){function f(){let e=document.querySelector(".canvas-grid");S.scrollTop=e.scrollTop,S.scrollLeft=e.scrollLeft,S.viewSource=t.globals.viewSource}function h(){t.globals.viewSource=S.viewSource;let e=document.querySelector(".canvas-grid");r(()=>{e.scrollTop=S.scrollTop,e.scrollLeft=S.scrollLeft},100,!0)}function m(e,t,n){let r=null;if(e.attribs&&e.attribs["data-comp-id"]&&(-1!==(r={id:e.attribs["data-comp-id"],parent:n,children:[]}).id.indexOf("content")&&(r.expanded=!0),t.push(r)),e.children)for(let o=0;o<e.children.length;o++)m(e.children[o],r?r.children:t,r||n)}function g(e,t){_.each(e,e=>{t(e),e.children&&g(e.children,t)})}const v=this;let S={scrollTop:0,scrollLeft:0,viewSource:!1};v.showContainers=function(e){t.globals.showContainers=e,c.showContainers(e)},v.canvasInitialized=function(){t.$broadcast(t.EVENT_CANVAS_READY)},v.resizeCanvasFrame=function(e,t){(t=t||{}).storeScrollPosition&&f();document.querySelector("#iframe").style.height=e+"px",t.restoreScrollPosition&&h()},v.getComponentsTree=function(){let e=[];return m(s.getSelectedScreen().dom.root()[0],e),e},v.getComponentsMap=function(e){e||(e=v.getComponentsTree());let t={};return g(e,function(e){t[e.id]=e}),t},v.getSelectedComponentId=function(){let e=s.getSelectedScreen();return e?e.selectedComponentId:null},v.setSelectedComponentId=function(e){let n=s.getSelectedScreen();if(!n||n.selectedComponentId===e)return!1;n.selectedComponentId=e,r(function(){t.$broadcast(t.EVENT_COMPONENT_SELECTED,n.selectedComponentId)},!0)},v.isComponentExists=function(e){return!!s.getSelectedScreen().dom(`[data-comp-id="${e}"]`).length},v.showSelectedComponent=function(e,t){let n=e[t];for(;n&&n.parent;)n.parent.expanded=!0,n=n.parent;r(function(){let e=document.querySelector("[ui-view='outline'] .selected");e&&e.scrollIntoViewIfNeeded()},300)},v.showBrokenComponents=function(e,t){t.forEach(t=>{let n=e[t];for(n.broken=!0;n&&n.parent;)n.parent.expanded=!0,n=n.parent})},v.selectParentComponent=function(){let e=v.getSelectedComponentId();if(e){let t=s.getSelectedScreen(),n=a.getParentComponentId(t.dom,e);v.setSelectedComponentId(n),c.resize()}},v.addComponent=function(e,n,r,i,l,c){let d=s.getSelectedScreen();l||(l=o.getComponentElement(i)),void 0!==c&&"undefined"!==c&&(i=c),a.addComponent(d.dom,e,n,r,i,l),s.screenChanged(),t.$broadcast(t.EVENT_COMPONENT_CHANGED)},v.moveComponent=function(e,n,r,o){let i=s.getSelectedScreen();a.moveComponent(i.dom,e,n,r,o),s.screenChanged(),t.$broadcast(t.EVENT_COMPONENT_CHANGED)},v.deleteComponent=function(e){let t=s.getSelectedScreen();return a.removeComponent(t.dom,e)},v.deleteSelectedComponent=function(){let e=v.getSelectedComponentId();if(e&&!l.startsWith(e,"content")&&!l.startsWith(e,"screen")){if(o.isUndeletableComponent(e))return void alert("screenService component can't be deleted.");let n=v.deleteComponent(e);v.setSelectedComponentId(n),s.screenChanged(),t.$broadcast(t.EVENT_COMPONENT_CHANGED),c.refresh()}},v.copySelectedComponent=function(){let e=v.getSelectedComponentId(),t=null;if(e){var n=s.getSelectedScreen();t=a.copyComponent(n.dom,e)}return t},v.cutSelectedComponent=function(){let e=v.getSelectedComponentId(),t=null;if(e){let n=s.getSelectedScreen();t=a.copyComponent(n.dom,e),v.deleteSelectedComponent()}return t},v.pasteToSelectedComponent=function(e){let n=v.getSelectedComponentId();if(n&&e){let r=s.getSelectedScreen();a.pasteToComponent(r.dom,n,e)&&(s.screenChanged(),t.$broadcast(t.EVENT_COMPONENT_CHANGED),c.refresh())}},v.deleteComponentsWithPrefix=function(e){let n=s.getSelectedScreen();console.log("removeComponentsWithPrefix:",e),a.removeComponentsWithPrefix(n.dom,e),t.$broadcast(t.EVENT_VIEW_CHANGED),s.screenChanged()},v.addComponentUsingScreenModel=function(e){function t(e){if(-1==e.indexOf(" ")&&e.charAt(0).toLowerCase()==e.charAt(0)){let t=e.charAt(0).toUpperCase();for(let n=1;n<e.length;n++){let r=e.charAt(n);r.toUpperCase()==r?t=t+" "+r.toUpperCase():t+=r.toLowerCase()}e=t}return e}let n,r;switch(e.screenModelData.type){case"object":_.each(e.screenModelData.properties,function(t){let n=_.extend({},e);n.screenModelData=t,v.addComponentUsingScreenModel(n)});break;case"array":console.log("array",e.screenModelData);break;case"select":n="select",r=o.getComponentElement(n),i.setElementProperty(r,n,"innerHTML",t(e.screenModelData.name));let s=`data.${e.screenModelData.path}.selected`;i.setElementProperty(r,n,"ngModel",s);let a=`let item of data.${e.screenModelData.path}.options`;i.setElementProperty(r,n,"ngRepeat",a),i.setElementProperty(r,n,"optionLabel","item.label"),i.setElementProperty(r,n,"ngValue","item.value"),v.addComponent(e.parentCmptId,e.relativeCmptId,e.location,n,r);break;case"string":n="input",r=o.getComponentElement(n),i.setElementProperty(r,n,"innerHTML",t(e.screenModelData.name)),i.setElementProperty(r,n,"ngModel","data."+e.screenModelData.path),v.addComponent(e.parentCmptId,e.relativeCmptId,e.location,n,r);break;case"boolean":n="checkbox",r=o.getComponentElement(n),i.setElementProperty(r,n,"innerHTML",t(e.screenModelData.name)),i.setElementProperty(r,n,"ngModel","data."+e.screenModelData.path),v.addComponent(e.parentCmptId,e.relativeCmptId,e.location,n,r);break;case"time":case"date":n="datetime",r=o.getComponentElement(n),i.setElementProperty(r,n,"innerHTML",t(e.screenModelData.name)),i.setElementProperty(r,n,"ngModel","data."+e.screenModelData.path),i.setElementProperty(r,n,"displayFormat",e.screenModelData.format),i.setElementProperty(r,n,"pickerFormat",e.screenModelData.format),v.addComponent(e.parentCmptId,e.relativeCmptId,e.location,n,r);break;case"action":n="button",r=o.getComponentElement(n),i.setElementProperty(r,n,"innerHTML",t(e.screenModelData.name)),i.setElementProperty(r,n,"ngClick",`action('${e.screenModelData.path}')`),v.addComponent(e.parentCmptId,e.relativeCmptId,e.location,n,r);break;case"method":n="button",r=o.getComponentElement(n),i.setElementProperty(r,n,"innerHTML",t(e.screenModelData.name)),i.setElementProperty(r,n,"ngClick",`method('${e.screenModelData.path}')`),v.addComponent(e.parentCmptId,e.relativeCmptId,e.location,n,r);break;default:console.error("Unknown type of object dropped:",e.screenModelData.type)}},v.getRepeatedComponentId=function(e,t,n){let r,o=e[t],i=n?o:o.parent,s="";for(;i&&"content.1"!==i.id;){if((r=v.getPropertyValue(i.id,"ngRepeat"))&&/.+\sof\s.+/.test(r)){s=i.id;break}i=i.parent}return s},v.setPropertyValue=function(e,t,r){let a=s.getSelectedScreen().dom(`[data-comp-id="${e}"]`),l=o.getComponentTypeFromId(e);return i.getElementProperty(a,l,t)===r?n.resolve():(i.setElementProperty(a,l,t,r),v.setSelectedComponentId(e,!0),i.propertyChanged())},v.getPropertyValue=function(e,t){let n=s.getSelectedScreen().dom(`[data-comp-id="${e}"]`),r=o.getComponentTypeFromId(e);return i.getElementProperty(n,r,t)},v.getRepeatedPropertyId=function(e,t,n){let r,o=e[t],i=n?o:o.parent,s="";for(;i&&"content.1"!==i.id;){if((r=v.getPropertyValue(i.id,"ngRepeat"))&&/.+\sof\s.+/.test(r)){s=/(?:^.+\sof\s)(.+?)(?:;|\s|$)/.exec(r)[1].replace(/^(data|item)\./,"")+"."+s}i=i.parent}return s.slice(0,-1)},v.openScreen=function(e){let n=s.getOpenedScreens(),r=s.getSelectedScreen();if(_.isEmpty(n))return s.openScreen(e).then(e=>(s.selectScreen(e.id),e));if(n[e])return r.id!==e?s.selectScreen(e):r.selectedView!==t.app.defaultLayout&&s.selectView(t.app.defaultLayout),Promise.resolve(n[e]);{let t;return _.each(n,e=>{e.isSticky||(t=e)}),s.openScreen(e).then(e=>(s.selectScreen(e.id),t&&s.closeScreen(t.id),e))}},v.refreshStudio=(()=>{let n=e.get("screenModelService");return f(),t.globals.viewSource=!1,p.refreshApp().then(e=>(t.app=e,n.refresh())).then(()=>(s.closeAllScreens(),d.resetCache(),u.resetCache(),s.restoreScreens().then(()=>{t.hideLoading(),r(()=>d.getSelectedMockData().then(c.setScreenData),!0),h()}))).catch(()=>$scope.hideLoading())})}]),angular.module("studio").service("appService",["$rootScope","apiService","mockService","helperService","config","$q","wsService","userService","styleService","allFilesService",function(e,t,n,r,o,i,s,a,l,c){var d;this.fetchList=function(){return t.applications.getApps().then(function(t){return t.forEach(function(t){t.supported=r.checkVersion(e.env.minClientVersion,t.clientVersion),t.isApp=!0}),t})},this.getAllApps=function(){return t.applications.getAllApps()},this.openApp=function(r){return s.$init(r).then(function(){return t.applications.open({appId:r})}).then(function(t){return t.versionError?t.versionError:(document.title=t.app.name+" - SmartUXâ„¢ Studio",n.resetCache(),l.resetCache(),c.resetCache(),t.app.isApp=!t.app.isTemplate&&!t.app.isAppTemplate&&!t.app.isBuiltInTemplate,d=t.app,e.$broadcast(e.EVENT_APP_OPENED),t.app)})},this.refreshApp=function(){return t.applications.open({appId:e.app.id}).then(function(e){return e.app.isApp=!e.app.isTemplate&&!e.app.isAppTemplate&&!e.app.isBuiltInTemplate,d=e.app,e.app})},this.getOpenedApp=function(){return d},this.createApp=function(e){return t.applications.create(e).then(function(e){return a.grantPermission(e.id,"edit"),e.id})},this.updateApp=function(e){return t.applications.update(e).then(function(e){return e})},this.deleteApp=function(e){return t.applications.delete({appId:e}).then(function(t){return a.removePermission(e),t})},this.getIconUrl=function(e){if(!e.iconUrl){if(!e.screensCount)return;e.iconUrl="/assets/icon/icon.png"}let t=(e.iconUrl.indexOf("?")>-1?"&":"?")+"appId="+e.id+"&previewToken="+e.previewToken;return o.serverUrl+e.iconUrl+t},this.importRepository=function(e){return t.applications.importRepository(e).then(function(e){return a.grantPermission(e.id,"edit"),e})},this.getBuildAssets=function(){return t.applications.getBuildAssets({appId:e.app.id})}}]),angular.module("studio").service("sharedModelService",["$q","$rootScope","$timeout","apiService","batchRequest","modelTreeService",function(e,t,n,r,o,i){const s=this;let a=[];s.refresh=function(){return r.sharedModels.get().then(e=>(s.process(e),a=_.values(e),t.$broadcast(t.EVENT_UPDATED_SHARED_MODELS),a))},s.getModels=function(){return a},s.getById=function(e){return _.findWhere(a,{id:e})},s.process=function(e){i.process(e),_.each(e,t=>{i.associate(t,e)})},s.qAddModel=function(e){a.push({id:e.id,type:"object",comment:e.comment||"",properties:{}}),s.process(a),o.add(r.sharedModels.addModel,e)},s.qUpdateModel=function(e){let t=s.getById(e.oldId);t.id=e.id,t.comment=e.comment,s.process(a),o.add(r.sharedModels.updateModel,e)},s.qDeleteModel=function(e){let t=s.getById(e);a.splice(a.indexOf(t),1),s.process(a),o.add(r.sharedModels.deleteModel,{id:e})},s.setUpdatingProperty=function(e){o.add(r.sharedModels.setUpdatingProperty,e);let t=s.getById(e.modelId);i.findByPath(t,e.path).update=e.update},s.qAddProperty=function(e,t){let n=i.addProp(e,t);o.add(r.sharedModels.addProp,{modelId:n.root.id,type:t.type,model:t.model,format:t.format,isArray:t.isArray,name:t.newName,path:e.path},!0)},s.qEditProperty=function(e,t){i.updateProp(e,t),o.add(r.sharedModels.updateProp,{modelId:e.root.id,type:t.type,model:t.model,format:t.format,isArray:t.isArray,name:t.newName,oldName:t.name,path:e.parent.path},!0)},s.qDeleteProperty=function(e){i.deleteProp(e),o.add(r.sharedModels.deleteProp,{modelId:e.root.id,path:e.parent.path,name:e.name},!0)}}]),angular.module("studio").service("componentService",["$rootScope","apiService","domService","commonDialogs",function(e,t,n,r){function o(e){s={};for(let t=0;t<e.length;t++)s[e[t].id]=e[t]}let i=this,s={},a={},l=[],c=[];i.getComponents=function(){return new Promise(function(e,n){t.components.getAll().then(function(t){t.error&&r.error("Component Error",t.error),o(t.components),a=t.properties,l=t.propertyGroups,c=t.componentGroups,e(t.components)},n)})},i.updateComponents=function(){return new Promise(function(e,n){t.components.update().then(function(t){t.error&&r.error("Component Error",t.error),o(t.components),a=t.properties,l=t.propertyGroups,c=t.componentGroups,e(t.components)},n)})},i.getComponentsMap=function(){return s},i.getPropertyGroups=function(){return l},i.getComponentGroups=function(){return c},i.getPropertyDefinitions=function(){return a},i.getComponentElement=function(e){let t=s[e].template;return n.parseTemplate(t)("*").first()},i.getComponentTypeFromId=function(e){return e.split(".")[0]},i.getComponentFromId=function(e){if(!e)return e;let t=i.getComponentTypeFromId(e);return i.getComponentFromType(t)},i.getComponentFromType=function(e){return s[e]},i.isComponentContainer=function(e){return s[e].isContainer},i.isAddAllowed=function(e,t){return("row"!==e||"column"===t)&&!("column"===t&&"row"!==e)},i.isUndeletableComponent=function(){return!1}}]),angular.module("studio").service("dataService",["screenService","apiService","componentService","propertyService","config","workspaceService","helperService","modelTreeService","screenTreeService","commonDialogs","screenModelService",function(e,t,n,r,o,i,s,a,l,c,d){function u(e,t){let n={};return _.each(e,(e,r)=>{"object"===e.type||"model"===e.type?(e.properties=u(e.properties,t),n[r]=e):t.indexOf(e.type)>-1&&(n[r]=e)}),n}function p(e){let t=["method","action"],n={};return _.each(e,(e,r)=>{"object"===e.type||"model"===e.type?(e.properties=p(e.properties),_.isEmpty(e.properties)||(n[r]=e)):t.indexOf(e.type)>-1&&(n[r]=e)}),n}function f(e,t){let n=i.getComponentsMap();return{id:i.getRepeatedComponentId(n,e,t),treeRoot:i.getRepeatedPropertyId(n,e,t)}}function h(e,t){a.eachNode(e,n=>{if("action"===n.type){let r=function(e,t,n){let r={path:"",binding:""};if(!n||!n.id){let n=g(e,t);return r.path=t.id,r.binding=`action('${n}${t.path}')`,r}let o=t.name,a=t.id.split("."),l=[];do{"object"===t.parent.type&&(a.shift(),o=a.join("."));let e=i.getPropertyValue(n.id,"ngRepeat"),c=s.parseRepeatValue(e);r.path=`${c.array}[${c.variable}].${r.path}`,c.index&&l.push(c.index),n=f(n.id)}while(n.id);return r.path+=o,r.binding=`action('${r.path}', [${l.toString()}])`,r}(e,n,t);n.binding=r.binding,n.path=r.path}else n.binding=`method('${n.path}')`})}function m(e,t,n){let r=e.shift();0===e.length?t[r]=n?[]:"":t[r]={},e.length>=1&&m(e,t[r],n)}function g(e,t){let n="";return a.eachNode(e,e=>{"model"===e.type&&a.eachNode(e.properties,r=>{r===t&&(n=e.path+".")})}),n}let v=this;v.getPropertyByBinding=function(e,t){let n=null;return a.eachNode(e,e=>{e.binding===t&&(n=e)}),n},v.getDataForBinding=function(e,t,n){let r;return n?a.eachNode(e.properties,t=>{e.id+"."+t.realPath===n&&(r=angular.copy(t.items.properties),a.eachNode(r,t=>{let r=e.id+"."+t.realPath;t.binding="item"+r.replace(n,""),t.fieldBinding=function(e){let t,n="",r=f(i.getSelectedComponentId(),!0),o=e.name,a=e.id.split(".");do{"object"===e.parent.type&&(a.shift(),o=a.join("."));let l=i.getPropertyValue(r.id,"ngRepeat");n=(t=s.parseRepeatValue(l)).array+"["+t.variable+"]."+n,r=f(r.id)}while(r.id);return{path:n+o,indices:`[${t.index}]`}}(t)}))}):(r=angular.copy(e.properties),a.eachNode(r,e=>{let t=g(r,e);e.binding="data."+t+e.path})),t&&(r=u(r,t)),r},v.getDataForRepeat=function(e,t){let n=v.getDataForBinding(e,["array","select"],t);return a.eachNode(n,e=>{"array"===e.type?(e.binding="let item of "+e.binding,e.items.properties=[]):"select"===e.type&&(e.binding="let item of "+e.binding+".options")}),n},v.getActionsForBinding=function(e){let t,n,r,o={},s=f(i.getSelectedComponentId(),!0);return s.treeRoot&&(a.eachNode(e.properties,e=>{e.path===s.treeRoot&&(t=angular.copy(e.items.properties),o=function(e){let t={},n={};a.eachNode(e,n=>{n.hasActions=!0;let r=n.id.split(".").pop();e[r]&&(t=e[r].parent),t.hasActions=!0});do{t&&(n=t),(t=t.parent)&&(t.hasActions=!0)}while(t);let r="array"===n.type&&"object"===n.items.type?n.items.properties:n.properties;return a.eachNode(r,e=>{let t=e.id.split(".").pop();e.parent&&!e.hasActions&&("array"===e.parent.type?delete e.parent.items.properties[t]:delete e.parent.properties[t])}),r}(p(t)))}),h(o,s)),r=angular.copy(e.properties),n=p(r),h(n),_.extend(o,n)},v.getActionPaths=function(e){let t=f(i.getSelectedComponentId(),!0),n=v.getActionsForBinding(e,t.treeRoot),r=[];return a.eachNode(n,e=>{"action"===e.type&&r.push(e.path)}),r},v.getRelatedScreensForBinding=(e=>[]),v.collapseTree=function(e){a.eachNode(e,e=>e.expanded=!1)},v.expandBranch=function(e,t){a.eachNode(e,e=>{if(e.binding===t){let t=e.parent;for(;t;)t.expanded=!0,t=t.parent}})},v.getScreenDataStubs=function(){let t=d.getSelectedScreenModel(),n={};t&&a.processModelsWithStubs(t.properties,n);let r=e.getSelectedScreen(),o=r?function(e){let t={},n=/(?:\[|\(|\*).+/,r=/(data\.)/;return e("*").each((e,o)=>{_.each(o.attribs,(e,o)=>{if(r.test(e)&&n.test(o)){let n,r;"*ngFor"===o?(n=s.parseRepeatValue(e).array.split("."),r=!0):n=e.replace(/^data\./,"").split("."),m(n,t,r)}})}),t}(r.dom):{};return s.mergeObjects(n,o)},v.addDataComponent=function(e,t,n,r){let o=d.getSelectedScreenModel(),s=a.findByPath(o,r);i.addComponentUsingScreenModel({screenModelId:o.id,screenModelData:s,parentCmptId:e,relativeCmptId:t,location:n})},v.addMethodComponent=function(e,t,o,s){let a=n.getComponentElement("button"),l=`method('${s}')`;r.setElementProperty(a,"button","ngClick",l),i.addComponent(e,t,o,"button",a)},v.getTextPathForScreenModelProp=function(e,t){let n=d.getSelectedScreenModel(),r=e;if(t){let e=t.split("."),i=[];_.each(e,e=>{if(isNaN(parseInt(e))){i.push(e);let s=i.join("."),l=a.findByPath(n,s);l?r+=" > "+l.name:c.error("Mock Data Error",o.messages.mockDataError,{path:t,subPath:s})}else r+=" > Row "+(parseInt(e)+1)})}return r}}]),angular.module("studio").service("mockService",["$q","$rootScope","apiService","screenService","screenTreeService","canvas","batchRequest","$timeout",function(e,t,n,r,o,i,s,a){function l(e,t){let n=(t=angular.copy(t))[0];t.length<2?void 0===e[n]&&(e[n]=null):(t.shift(),void 0===e[n]&&(e[n]={}),l(e[n],t))}function c(e){if(e&&e.options&&e.selected)if(_.isArray(e.selected)){let t=[];_.each(e.selected,n=>{_.each(e.options,e=>{e.value!==n.value&&e.label!==n.label||t.push(e)})}),e.selected=t}else _.each(e.options,t=>{t.value!==e.selected.value&&t.label!==e.selected.label||(e.selected=t)});else _.isObject(e)&&_.each(e,e=>{c(e)})}let d=this,u={},p={},f={};d.resetCache=function(){f={},u={},p={}},d.getOpenedFiles=function(){return u},d.fileChanged=function(e,n){a(()=>{u[e].isDirty=!0,function(e){let t=e.split("."),n=t[0],r=t[1];(f=f||{})[n]=f[n]||{},f[n][r]=JSON.parse(u[e].source)}(e),n||t.$broadcast(t.EVENT_UPDATED_MOCK_DATA)},!0)},d.getDataFile=function(t,r){return u&&u[t+"."+r]?e.resolve(u[t+"."+r].source):n.mocks.getDataFile({screenModel:t,mockSet:r}).then(e=>(u[t+"."+r]={source:e,isDirty:!1,hasError:!1},e))},d.deleteDataFile=function(e){for(let t in u)t.startsWith(e)&&delete u[t];delete f[e]},d.getDataFilesTree=function(){return n.mocks.getDataFilesTree().then(e=>(_.each(e.files,e=>{_.each(e.sub,t=>t.parent=e)}),e))},d.hasDirtyDataFiles=function(){let e=!1;for(let t in u)u[t].isDirty&&(e=!0);return e},d.getMockData=function(t,n){let r=e.defer();t&&n||(console.log("Wrong combination of screenModelId and mockSet."),r.resolve({})),(f=f||{})[t]=f[t]||{};let o=f[t];return o[n]?r.resolve(o[n]):d.getDataFile(t,n).then(e=>{o[n]=JSON.parse(e),_.each(o[n],c),r.resolve(o[n])}),r.promise},d.getSelectedMockData=function(){let t=r.getSelectedScreen();return t&&"__BASE__"!==t.id?d.getMockData(t.id,t.selectedMockSet):e.resolve({})},d.updateDataFile=function(t,o){let a=t.split("."),l=a.pop();return s.add(n.mocks.updateDataFile,{source:o,screenModel:a.join("."),id:l}).then(()=>{let e=r.getSelectedScreen();a.join(".")===e.id&&l===e.selectedMockSet&&i.setScreenData(JSON.parse(o)),u[t]&&(u[t].source=o,u[t].isDirty=!1)}),e.resolve()},d.setMockData=function(e,t,n){(f=f||{})[e]=f[e]||{},f[e][t]=n;let r=angular.toJson(n,2),o=e+"."+t;return u[o]={source:r,isDirty:!1,hasError:!1},d.updateDataFile(o,r)},d.updateMockData=function(e,t,n,r){return d.getMockData(e,t).then(o=>{o=o||{};let i=n.split(".");l(o,i);let s=o;for(let e=0;e<i.length-1;e++)s=s[i[e]];return s[i[i.length-1]]=r,d.setMockData(e,t,o)})},d.getValueById=function(e,t){let n=t.split(".");l(e,n);let r=e;for(let e=0;e<n.length;e++)r=r[n[e]];return r},d.addMockSet=function(e,t){return n.mocks.addSubData({screenModel:e,name:t}).then(t=>{let n=o.findById(e);return r.updateScreensSources([n]).then(()=>t)})},d.renameMockSet=function(e,t,i){return n.mocks.renameSubData({screenModel:e,id:t,name:i}).then(t=>{let n=o.findById(e);return r.updateScreensSources([n]).then(()=>t)})},d.deleteMockSet=function(e,t){return n.mocks.deleteSubData({screenModel:e,id:t}).then(()=>{let t=o.findById(e);return r.updateScreensSources([t])})},d.getMockSetsByModel=function(e){return n.mocks.getMockSetsByModel({id:e})},d.getActionsTree=function(){return n.mocks.getActionsTree().then(e=>(_.each(e.files,e=>{_.each(e.methods,t=>t.parent=e)}),e))},d.getOpenedSources=function(){return p},d.sourceChanged=function(e){p[e].isDirty=!0},d.setActionSource=function(e){let t=e.split("."),r=t.shift();s.add(n.mocks.setActionSource,{screenModelId:r,path:t.join("."),source:p[e].source}).then(()=>{p[e].isDirty=!1})},d.hasDirtySources=function(){let e=!1;for(let t in p)p[t].isDirty&&(e=!0);return e},d.getActionSource=function(t,r){let o=t+"."+r;return p[o]?e.resolve(p[o]):n.mocks.getActionSource({screenModelId:t,path:r}).then(e=>(p[o]={source:e,isDirty:!1,hasError:!1},p[o]))},d.saveAllMockFiles=function(){_.each(u,(e,t)=>{e.isDirty&&!e.hasError&&d.updateDataFile(t,e.source)}),_.each(p,(e,t)=>{e.isDirty&&!e.hasError&&d.setActionSource(t)})}}]),angular.module("studio").service("propertyService",["componentService","$rootScope","screenService","canvas","domService",function(componentService,$rootScope,screenService,canvas,domService){function _getElements(e){let t=[],n=_.isArray(e.selector)?e.selector:[e.selector];return _.each(n,n=>{"."===n?t.push(e.element):t.push(e.element.find(n))}),t}function _getProperty(e,t){let n=e[t.attribute]()||"";return"html"===t.attribute&&(n=n.trim()),n}function _getArribute(e,t){if("checkbox"===t.type){let n=e[0].attribs[t.attribute];return n&&n.trim()===t.attributeValue}return e.attr(t.attribute)}function _getOneOfArribute(e,t){let n="";return _.pluck(t.options,"value").forEach(t=>{""===e.attr(t)&&(n=t)}),n}function _getClass(e,t){switch(t.type){case"singleSelect":let n="";for(let r=0;r<t.options.length;r++)if(t.options[r].multiValue){let o=t.options[r].value.split(" "),i=!0;for(let n=0;n<o.length;n++)_hasClass(e,o[n],t.attribute)||(i=!1);if(i){n=t.options[r].value;break}}else if(_hasClass(e,t.options[r].value,t.attribute)){n=t.options[r].value;break}return n;case"checkbox":return _hasClass(e,t.attributeValue,t.attribute);case"text":return t.attribute&&"class"!==t.attribute?e.attr(t.attribute):e.attr("class");case"icon":let r=e.attr("class")?e.attr("class").match(/(fa-icon\s+(fa)(-[\d\w]+)+)|(ion)(-[\d\w]+)+/):null;return r?r[0]:""}}function _getStyle(e,t){let n;if(t.attribute&&"style"!==t.attribute&&"color"!==t.type){let r=document.createElement("div");r.attr("style",e.attr(t.attribute)),n=r.css(t.style)}else(n="color"===t.type?e.css(t.cssAttribute):e.css(t.style))||canvas.getComputedStyle(t.element.attr("data-comp-id"),t.style,t.selector).then(e=>t.unsetValue=e);return n}function _customGetFunc(e,t){_parseFunc(t.id,"get",t.funcs.get)(e,t,propertyService,$rootScope)}function _setAttribute(e,t){"checkbox"===t.type?t.value?e.attr(t.attribute,t.attributeValue):t.valueIfFalse?e.attr(t.attribute,t.valueIfFalse):e.removeAttr(t.attribute):""===t.value||null===t.value?e.removeAttr(t.attribute):e.attr(t.attribute,t.value)}function _setOneOfAttributes(e,t){_.pluck(t.options,"value").forEach(t=>{t&&e.removeAttr(t)}),t.value&&e.attr(t.value,"")}function _setClass(e,t){switch(t.type){case"singleSelect":if(_.each(t.options,n=>{if(n.multiValue){let r=n.value.split(" ");_.each(r,n=>{_removeClass(e,n,t.attribute)})}else _removeClass(e,n.value,t.attribute)}),""!==t.value)if(t.value.indexOf(" ")>=0){let n=t.value.split(" ");for(let r=0;r<n.length;r++)_addClass(e,n[r],t.attribute)}else _addClass(e,t.value,t.attribute);break;case"checkbox":t.value?_addClass(e,t.attributeValue,t.attribute):_removeClass(e,t.attributeValue,t.attribute);break;case"text":t.attribute&&"class"!==t.attribute?""===t.value||null===t.value?e.removeAttr(t.attribute):e.attr(t.attribute,t.value):e.attr("class",t.value);break;case"icon":let n=/(fa-icon\s+(fa)(-[\d\w]+)+)|(ion)(-[\d\w]+)+/;e.attr("class").match(n)?e.attr("class",e.attr("class").replace(n,t.value)):e.attr("class",e.attr("class")+t.value)}}function _setStyle(e,t){if(t.attribute&&"style"!==t.attribute&&"color"!==t.type){let n=document.createElement("div"),r=e.attr(t.attribute);r&&n.attr("style",r),n.css(t.style,t.value);let o=n.attr("style");e.attr(t.attribute,o)}else{let n="color"===t.type?t.cssAttribute:t.style;e.css(n,t.value)}_.isEmpty(e.css())&&e.removeAttr("style"),setTimeout(()=>{t.value||canvas.getComputedStyle(t.element.attr("data-comp-id"),t.style,t.selector).then(e=>t.unsetValue=e)},10)}function _customSetFunc(e,t){_parseFunc(t.id,"set",t.funcs.set)(e,t,propertyService,$rootScope)}function _hasClass(e,t,n){n||(n="class");let r=e.attr(n);return!!r&&(r=" "+r.trim()+" ").indexOf(" "+t+" ")>=0}function _removeClass(e,t,n){n||(n="class");let r=e.attr(n)||"",o=r.split(" ");for(let e=o.length-1;e>=0;e--)o[e]===t&&o.splice(e,1);r=o.join(" "),e.attr(n,r),e.attr("class")||e.removeAttr("class")}function _addClass(e,t,n){n||(n="class");let r=e.attr(n)||"",o=r.split(" ");for(let e=o.length-1;e>=0;e--)o[e]===t&&o.splice(e,1);r=o.join(" ")+" "+t,e.attr(n,r)}function _parseFunc(id,getOrSet,funcString){if(customFuncCache.hasOwnProperty(id+"."+getOrSet))return customFuncCache[id+"."+getOrSet];{let func=prettydiff({source:funcString,lang:"javascript",mode:"minify",styleguide:"google"})[0];return func=eval("("+func+")"),customFuncCache[id+"."+getOrSet]=func,func}}const propertyService=this;propertyService.propertyChanged=(()=>canvas.refresh().finally(function(){screenService.screenChanged(),$rootScope.$broadcast($rootScope.EVENT_COMPONENT_CHANGED)})),propertyService.getPropertyValue=(e=>{let t=_getElements(e)[0];if(!t.length)return e.element?console.warn(e.element.attr("data-comp-id"),'- Unable to find selector: "'+e.selector+'" when getting',e.attributeType,"-",e.attribute):console.warn("Unable to find selector",e),e.invalid=!0,void(e.value=null);switch(e.attributeType){case"property":e.value=_getProperty(t,e);break;case"attribute":e.value=_getArribute(t,e);break;case"oneOfAttributes":e.value=_getOneOfArribute(t,e);break;case"class":e.value=_getClass(t,e);break;case"tag":e.value=t.get(0).tagName.toUpperCase();break;case"style":e.value=_getStyle(t,e);break;case"function":_customGetFunc(t,e)}}),propertyService.setPropertyValue=(e=>{let t=_getElements(e);return _.each(t,t=>{switch(e.attributeType){case"property":t[e.attribute](e.value);break;case"attribute":_setAttribute(t,e);break;case"oneOfAttributes":_setOneOfAttributes(t,e);break;case"class":_setClass(t,e);break;case"tag":t.get(0).name=e.value.toLowerCase();break;case"style":_setStyle(t,e);break;case"function":_customSetFunc(t,e)}}),!1}),propertyService.setElementProperty=((e,t,n,r)=>{let o=componentService.getComponentFromType(t),i=componentService.getPropertyDefinitions();for(let t=0;t<o.properties.length;t++){let s=o.properties[t];if(s.property===n){let t=i[s.property],n={label:s.label,type:t.type,selector:s.selector,attribute:t.attribute,attributeType:t.attributeType,element:e,value:r,funcs:t.funcs};return"color"===t.type&&(n.options=t.options,(n.value.indexOf("images/")>=0||"image"===n.value||"/default.png"===n.value)&&(n.isImage=!0,n=propertyService.tempImageProp,r&&(n.value=r))),void propertyService.setPropertyValue(n)}}}),propertyService.getElementProperty=((e,t,n)=>{let r=componentService.getComponentFromType(t);if(!r.properties)return;let o=componentService.getPropertyDefinitions();for(let t=0;t<r.properties.length;t++){let i=r.properties[t];if(i.property===n){let t=o[i.property],n={label:i.label,type:t.type,selector:i.selector,attribute:t.attribute,attributeType:t.attributeType,element:e,funcs:t.funcs};return"color"===t.type&&(n.options=t.options),propertyService.getPropertyValue(n),n.value}}}),propertyService.getGradientDirections=(()=>gradientDirections);let customFuncCache={},gradientDirections=[{label:"to top",value:"to top"},{label:"to right",value:"to right"},{label:"to bottom",value:"to bottom"},{label:"to left",value:"to left"},{label:"to top left",value:"to top left"},{label:"to top right",value:"to top right"},{label:"to bottom right",value:"to bottom right"},{label:"to bottom left",value:"to bottom left"}]}]),angular.module("studio").service("screenService",["$q","$rootScope","$timeout","apiService","domService","helperService","screenTreeService","config","settingsService","canvas","batchRequest","sessionService","$injector",function(e,t,n,r,o,i,s,a,l,c,d,u,p){function f(e,n,r){e.folder||(e.binding=`go('${e.id}')`),n&&(e.siblings=n),e.parent=r,"__BASE__"!==r.id&&(e.id=r.id+"_"+e.id.split("_").pop()),e.views=e.views||{},e.views[t.app.defaultLayout]=e.views[t.app.defaultLayout]||{},_.each(e.extraViews,t=>e.views[t]=e.views[t]||{}),E.processViews(e)}function h(e){return v(e).then(()=>(s.eachNode((e,t,n)=>{s.processNode(e,t,n),f(e,t,n)}),!0))}function m(){let e=E.getSelectedScreen();e.dom=o.parseTemplate(e.views[e.selectedView].html),o.normalizeIds(e.dom),c.refresh()}function g(e,t){if(e.folder)s.eachChildScreen(e,e=>{g(e,`${t}_${function(e){return e.split("_").slice(-1).pop()}(e.id)}`)}),e.id=t;else{let n=e.id;e.id=t,b[n]&&(delete b[n],b[t]=e),w===n&&(w=t);s.getCachedTree().startScreen===n&&(s.getCachedTree().startScreen=t)}y()}function v(e){return E.updateScreensSources(e).then(()=>{let n=_.pluck(e,"id").indexOf(w);n>-1&&(t.$broadcast(t.EVENT_SCREEN_SELECTED,e[n].id),t.$broadcast(t.EVENT_VIEW_SELECTED,e[n].id))})}function S(e){let n=e.selectedView||t.app.defaultLayout,r=i.toKebabCase(n).split("-");e.landscape="landscape"===r[1];let o=_.where(a.devices,{type:r[0]});if(_.findWhere(o,{id:e.device}))return!1;let s=l.get(t.app);_.findWhere(o,{id:s.preview.device})?e.device=s.preview.device:e.device=o[0].id}function y(){console.log("Save the list of opened tabs");let e=[];_.each(b,t=>{e.push({id:t.id,sticky:t.isSticky,selected:w===t.id,view:t.selectedView,device:t.device,landscape:t.landscape})}),u.set("screens",e)}let E=this,b={},w=null;E.refreshTree=function(){return s.fetch().then(e=>(s.eachNode(f),e))},E.openScreen=function(e){return r.screens.getScreenSources({id:e}).then(t=>{let n=s.findById(e);return _.extend(n,t),E.processViews(n),S(n),b[n.id]=n,n})},E.createScreen=function(e,t,n,o){let i={parentId:e.id,name:t};return n&&o&&(i.sourceAppId=n,i.sourceScreenId=o),r.screens.createScreen(i).then(t=>(f(t.data,e.screens,e),e.screens.push(t.data),t.data))},E.deleteScreen=function(e){return r.screens.deleteScreen({id:e.id}).then(()=>{p.get("mockService").deleteDataFile(e.id);let n=e.parent.screens;n.splice(n.indexOf(e),1),E.isOpenedScreen(e.id)&&E.closeScreen(e.id),t.$broadcast(t.EVENT_SCREEN_DELETED,e.id)})},E.createFolder=function(e,t){return r.screens.createFolder({parentId:e.id,name:t}).then(t=>(f(t.data,e.screens,e),e.screens.push(t.data),t.data))},E.deleteFolder=function(e){return r.screens.deleteFolder({id:e.id}).then(()=>{s.eachChildScreen(e,e=>{p.get("mockService").deleteDataFile(e.id),E.isOpenedScreen(e.id)&&E.closeScreen(e.id)});let n=e.parent.screens;n.splice(n.indexOf(e),1),t.$broadcast(t.EVENT_SCREEN_DELETED,e.id)})},E.renameFolder=function(e,t){return r.screens.renameFolder({id:e.id,name:t}).then(t=>(_.extend(e,_.pick(t.folder,"id","name")),s.eachNode(f),y(),e))},E.getListForChoosing=function(){let e=[],t=String.fromCharCode(160);return s.eachNode(n=>{if(n.system)return;let r="",o=n.parent;for(;o.parent;){for(let e=0;e<6;e++)r+=t;o=o.parent}e.push({id:n.id,name:r+n.name,folder:n.folder})}),e},E.moveScreen=function(t,n,o){if(t===n.id)return;let i,a=s.findById(t),l=n.parent,c=a.siblings.indexOf(a);if("inside"===o)i=n.screens.length,(l=n).expanded=!0;else{let e=n.siblings.indexOf(n);i=a.parent===l&&e>c?e-1:e,"after"===o&&i++}let d=("__BASE__"===l.id?"":l.id+"_")+t.split("_").pop();return a.parent!==l&&_.findWhere(l.screens,{id:d})?e.resolve(!1):r.screens.moveScreen({id:t,path:l.id,index:i}).then(()=>{if(a.siblings.splice(c,1),l.screens.splice(i,0,a),a.parent!==l){if(a.folder){let e=[];return s.eachChildScreen(a,t=>{e.push(t)}),g(a,d),h(e)}return g(a,d),h([a])}return e.resolve(!1)})},E.getStartScreen=function(){let e=s.getCachedTree(),t=e&&e.startScreen;return t?s.findById(t):null},E.isValidName=function(e,t,n){let r=i.toLowerCase(e),o=!!r,s=!/^\d/.test(r),a="__BASE__"===t.id?r:t.id+"_"+r,l=!!n,c=_.pluck(t.screens,"id").indexOf(a)<0;return l&&(c=c||a===n.id),o&&s&&c},E.getOpenedScreens=function(){return b},E.selectScreen=function(e){if(!b[e])return E.getSelectedScreen();let n=E.getSelectedScreen();n&&(n.views[n.selectedView].html=n.dom.html()),w=e,function(e){let t=s.findById(e).parent;for(;t;)t.expanded=!0,t=t.parent}(e),t.$broadcast(t.EVENT_SCREEN_SELECTED,e);let r=E.getSelectedScreen();return E.selectView(r.selectedView||t.app.defaultLayout,!0),r},E.stickScreen=function(e){b[e]&&(b[e].isSticky=!0),y()},E.isOpenedScreen=function(e){return Object.keys(b).indexOf(e)>-1},E.hasOpenedScreens=function(){return Object.keys(b).length>0},E.hasDirtyScreens=function(){return _.where(b,{isDirty:!0}).length>0},E.saveAllScreens=function(t){return _.each(b,e=>{e.isDirty&&E.saveScreen(e.id)}),t?e.resolve():d.send()},E.saveScreen=function(e){let t=b[e];if(!t.isDirty)return;t.views[t.selectedView].html=i.prettyHTML(t.dom.html());let n={};(n=_.pick(t,"id","name","modal","preventAutoDismiss","disableMenuSwipe","description","appHooks","statusbarContent")).views={},_.each(t.views,e=>{n.views[e.id]={html:e.html,ts:e.ts,scss:e.scss}});let o=t.id.split("_").pop().toLowerCase()!==t.name.toLowerCase();d.add(r.screens.updateScreen,n,o).then(e=>{t.isDirty=!1,o&&(g(t,e.id),v([t]))})},E.closeScreen=function(e,n){if(w===e){let t=Object.keys(b);if(n)w=null;else if(t.length>1){let n=t.indexOf(e),r=n>0?n-1:n+1;E.selectScreen(t[r])}else w=null,c.clear()}b[e]&&(b[e].expanded=!1),["dom","isDirty","isSticky","mockSets","selectedView","device","orientation"].forEach(t=>delete b[e][t]),delete b[e],n||y(),t.$broadcast(t.EVENT_SCREEN_CLOSED,e)},E.closeAllScreens=function(e){_.isEmpty(b)||(e&&u.clear("screens"),_.each(b,(e,t)=>E.closeScreen(t,!0)),w=null,c.clear())},E.restoreScreens=function(){let n,r=[],o=u.get("screens");return o.forEach(e=>{e.selected&&(n=e.id),s.findById(e.id)&&r.push(E.openScreen(e.id).then(n=>{n.isSticky=e.sticky,n.selectedView=e.view||t.app.defaultLayout,n.device=e.device,n.landscape=e.landscape}))}),e.all(r).then(()=>{!n&&o.length>0&&s.findById(o[0].id)&&(n=o[0].id),E.selectScreen(n),t.$broadcast(t.EVENT_SCREENS_RESTORED)})},E.processViews=function(e){_.each(e.views,(t,n)=>{t.id=n,t.name=i.toPascalCase(n),t.view=!0,t.screen=e})},E.updateScreensSources=function(t){let n=[];return t.forEach(e=>{n.push(r.screens.getScreenSources({id:e.id}).then(t=>{_.extend(e,t),E.processViews(e)}))}),e.all(n)},E.getSelectedScreen=function(){return b[w]},E.saveSelectedScreen=function(){return E.saveScreen(w),d.send()},E.screenChanged=function(){let e=E.getSelectedScreen();n(()=>{e.isDirty=!0,e.isSticky=!0},!0),console.log("Screen has been changed and is now dirty: ",e.id)},E.selectView=function(e,n){let r=E.getSelectedScreen();r&&(r.dom&&(r.views[r.selectedView].html=r.dom.html()),r.selectedView=e,m(),n||S(r),c.selectComponentById(null),y(),t.$broadcast(t.EVENT_VIEW_SELECTED,r.id))},E.selectViewForDevice=function(){let e,n,r=E.getSelectedScreen(),o=r.landscape?"landscape":"portrait",s=_.findWhere(a.devices,{id:r.device}).type;_.each(r.extraViews,r=>{let a=r===t.app.defaultLayout?t.app.defaultLayout:r;~a.indexOf(i.toPascalCase(s))&&(n=r,"Desktop"!==a&&a===i.toPascalCase(s+"-"+o)&&(e=n))}),E.selectView(e||n||t.app.defaultLayout,!0)},E.getSelectedScreenHtml=function(){let t=E.getSelectedScreen();return t&&"__BASE__"!==t.id?r.screens.getControllerMembers({id:t.id,selectedView:t.selectedView}).then(e=>(function(e,t){if(!t.length)return e.html();let n=o.parseTemplate(e.html());t=function(e){let t=[];return e.forEach(e=>t.push(/(.*)\(.*\)/.exec(e)[1])),t}(t),n("*").each((e,n)=>{_.each(n.attribs,(e,r)=>{t.forEach(t=>{e.includes(t+"(")&&delete n.attribs[r]})})});let r=n.html();return t.forEach(e=>{let t=new RegExp(`(?!{{\\s*)${e}\\(.*\\)(?=\\s*}})`);r=r.replace(t,e=>`'${e}'`)}),r})(t.dom,e.methods)):e.resolve()},E.getSelectedScreenSelector=function(){let e=w.toLowerCase().replace(/_/g,"-"),t=E.getSelectedScreen();return!0===t.system?`screen-${e}`:`screen-${e}-${t.selectedView.toLowerCase()}`},E.getSelectedScreenPlatform=function(){let e=E.getSelectedScreen();return e?_.findWhere(a.devices,{id:e.device}).mode:null},E.updateScreenHTML=function(e){let n=E.getSelectedScreen();n.views[n.selectedView].html=e,m(),E.screenChanged(),t.$broadcast(t.EVENT_VIEW_CHANGED)},E.updateSelectedScreenTS=function(e){let t=E.getSelectedScreen();t.views[t.selectedView].ts=e,E.screenChanged()},E.updateSelectedScreenScss=function(e){let t=E.getSelectedScreen();t.views[t.selectedView].scss=e,E.screenChanged()},E.updateAppHooks=function(e){E.getSelectedScreen().appHooks=e,E.screenChanged()},E.resetScreen=function(){return r.screens.resetScreen({id:w}).then(e=>{E.getSelectedScreen().isDirty=!1,E.closeScreen(e.id,!0),E.openScreen(e.id).then(()=>{E.selectScreen(e.id),E.stickScreen(e.id)})})}}]),angular.module("studio").service("screenModelService",["$rootScope","$q","apiService","batchRequest","modelTreeService","sharedModelService","screenService",function(e,t,n,r,o,i,s){function a(e){return _.pluck(c,"id").indexOf(e.root.id)>-1?n.screenModels:n.sharedModels}const l=this;let c=[];l.refresh=function(t){return i.refresh().then(()=>n.screenModels.get()).then(n=>(l.process(n),c=_.values(n),e.$broadcast(e.EVENT_UPDATED_SCREEN_MODELS,{forceReload:!!t}),c))},l.getModels=function(){return c},l.getById=function(e){return _.findWhere(c,{id:e})},l.getSelectedScreenModel=function(){let e=s.getSelectedScreen(),t=e?e.id:null;if(!t)return null;let n=l.getById(t);return n?(l.updateRealPaths(n),n):null},l.process=function(e){o.process(e);let t=i.getModels();_.each(e,e=>{o.associate(e,t)})},l.updateRealPaths=function(e){o.eachNode(e.properties,(e,t,n,r)=>{e.realPath=r})},l.markModelsNotDirty=function(){_.each(c,e=>e.isDirty=!1)},l.qAddProperty=function(e,t){let n=o.addProp(e,t);n.root.isDirty=!0,r.add(a(n).addProp,{modelId:n.root.id,type:t.type,model:t.model,format:t.format,isArray:t.isArray,name:t.newName,path:e.path},!0)},l.qEditProperty=function(e,t){o.updateProp(e,t),e.root.isDirty=!0,r.add(a(e).updateProp,{modelId:e.root.id,type:t.type,model:t.model,format:t.format,isArray:t.isArray,name:t.newName,oldName:t.name,path:e.parent.path},!0)},l.qDeleteProperty=function(e){o.deleteProp(e),e.root.isDirty=!0,r.add(a(e).deleteProp,{modelId:e.root.id,path:e.parent.path,name:e.name},!0)},l.setUpdatingProperty=function(e){let t=l.getById(e.modelId),i=o.findByPath(t,e.path);e.update&&!_.isEqual(i.update,e.update)&&(r.add(n.screenModels.setUpdatingProperty,e),i.root.isDirty=!0,i.update=e.update)}}]),angular.module("studio").service("styleService",["$q","$rootScope","apiService","canvas","batchRequest",function(e,t,n,r,o){var i,s,a,l=this,c={};l.resetCache=function(){c={}},l.getOpenedStyles=function(){return c},l.getList=function(){return n.styles.getList()},l.setSelectedTheme=function(e){i=e},l.getSelectedTheme=function(){return i},l.updateThemes=function(e){s=e},l.getThemes=function(){return s},l.updateThemeColors=function(e){a=e},l.getThemeColors=function(){return a},l.createFile=function(e){return n.styles.createFile(e)},l.createTheme=function(e){return n.styles.createTheme(e)},l.deleteTheme=function(e){return n.styles.deleteTheme(e)},l.styleChanged=function(e){c[e].isDirty=!0},l.hasDirtyStyles=function(){let e=!1;for(let t in c)c[t].isDirty&&(e=!0);return e},l.updateFile=function(e){o.add(n.styles.updateFile,e).then(function(t){t.success?(c[e.id].isDirty=!1,c[e.id].compileError=!1):c[e.id].compileError=!0})},l.deleteFile=function(e){return n.styles.deleteFile({id:e}).then(function(){delete c[e]})},l.getFile=function(t){return c[t]?e.resolve(c[t]):n.styles.getFile({id:t}).then(function(e){return c[t]={source:e,isDirty:!1,compileError:!1},c[t]})},l.saveAllStyles=function(){for(var e in c){var t=c[e];t.isDirty&&l.updateFile({id:e,source:t.source})}}}]),angular.module("studio").service("templateService",["apiService","$sce","$rootScope","helperService","config","screenModelService",function(e,t,n,r,o,i){function s(e){e.forEach(e=>{let t=n.env.minClientVersion;e.supported=r.checkVersion(t,e.clientVersion)})}function a(e,n,r){let i=[];return _.each(e,e=>{if(_.isArray(e.screens)){let s=[];_.each(e.screens,i=>{if(!i.folder){let a=r||e.previewToken,l=n||e.id,c=`${o.serverUrl}/apps/${a}-${l}/index.html?device=phone&rpcUrl=mock&screen=${i.id}`,d=`${o.serverUrl}/previews/${a}-${l}/${function(e){return(e||"").replace(/_/g,"/")}(i.id)}.png`;s.push({id:i.id,sourceAppId:l,previewUrl:t.trustAsResourceUrl(c),previewImageURL:d,name:i.name,description:i.description})}});let l=a(e.screens,n||e.id,r||e.previewToken);(s.length>0||l.length>0)&&i.push({id:e.id,name:e.name,folders:l,screens:s})}}),i}this.fetchList=function(){return e.applications.getTemplates().then(e=>(s(e),e))},this.getAppTemplates=function(){return e.applications.getAppTemplates().then(e=>(s(e),e))},this.getScreenModel=function(t,n){return e.screenModels.get({appId:n}).then(e=>(i.process(e),e[t]))},this.getTemplateGroups=function(){return e.applications.getTemplateGroups().then(e=>({templates:function(e){let t=[];return _.each(e,e=>{e.screens.length>0&&t.push({id:e.id,name:e.name,screens:e.screens}),_.each(e.folders,n=>{n.parentName=e.name,t.push(n)})}),_.each(t,e=>{let n=e.name;_.each(t,t=>{t.name===n&&t.parentName!==e.parentName&&(t.parentName&&(t.name+=" ("+t.parentName+")"),e.parentName&&(e.name+=" ("+e.parentName+")"),delete t.parentName,delete e.parentName)})}),t}(a(e.templates)),apptemplates:a(e.apptemplates),apps:a(e.apps)}))}}]),angular.module("studio").service("runServerService",["$rootScope","apiService",function(e,t){this.start=function(e){return t.runServer.start({appId:e}).then(function(e){return e})},this.stop=function(e,n){return t.runServer.stop({appId:e,key:n})}}]),angular.module("studio").service("runServerWsService",["$rootScope","$sce","config","uuid4",function(e,t,n,r){var o=this;o.connect=function(e,t){var n=o.wsUrl(e,t);return new WsWrapper(new WebSocket(n))},o.wsUrl=function(e,t){var r=t||{},i=(n.serverUrl.indexOf("https")>-1?"wss":"ws")+n.serverUrl.replace(/^https?/,"")+"?";if(r.wsConnectionId){i+="wsConnectionId="+o.getWsConnectionId()+"&"}return i+="appId="+e.appId+"&runServerId="+e.key+"&token="+localStorage.getItem("accessToken"),r.runServerType&&(i+="&runServerType="+r.runServerType),r.port&&(i=o.changePort(i,r.port)),r.debuggerUrl&&(i=i.replace("://","=")),i},o.wsDebuggerUrl=function(e,t){var r=(n.serverUrl.indexOf("https")>-1?"wss":"ws")+n.serverUrl.replace(/^https?/,"")+"/";return(r+="ws/"+e.appId+"/"+t.runServerType).replace("://","=")},o.wsCookie=function(e,t){var n={};if((t||{}).wsConnectionId){var r=o.getWsConnectionId();n.wsConnectionId=r}return n.runServerId=e.key,n.token=localStorage.getItem("accessToken"),"wsCookie="+JSON.stringify(n)},o.changePort=function(e,t){var n=document.createElement("a");return n.href=e,n.port=t,n.href},o.getWsConnectionId=function(){var e=localStorage.getItem("runServerWsConnectionId");return e||(e=r.generate(),localStorage.setItem("runServerWsConnectionId",e)),e}}]),angular.module("studio").service("clientVersionsService",function(){var e=this;e.filterVersions=function(t,n){var r=n||{},o=t.filter(function(e){return!!semver.valid(e)});o.sort(semver.rcompare);var i=[];return o.map(function(t){for(var n=!1,o=0;o<i.length;o++)if(e._sameVersion(t,i[o])&&(n=!0,semver.patch(t)>semver.patch(i[o]))){i[o]=t;break}n||!r.includeTest&&function(t){var n=e._prerelease(t);return n&&"test"===n[0]}(t)||i.push(t)},this),r.currentVersion&&!i.includes(r.currentVersion)&&(i.push(r.currentVersion),i.sort(semver.rcompare)),i},e._prerelease=function(e){return new semver.SemVer(e).prerelease},e._sameVersion=function(t,n){var r=semver.diff(t,n);return("patch"===r||"prepatch"===r||"prerelease"===r)&&(!e._prerelease(t)&&!e._prerelease(n)||!(e._prerelease(t)&&!e._prerelease(n)||!e._prerelease(t)&&e._prerelease(n))&&e._prerelease(t)[0]===e._prerelease(n)[0])},e.findBestMatch=function(t,n,r){if(!t||!semver.valid(t))return n[0];for(var o=0;o<n.length;o++){var i=n[o];if(!(semver.patch(t)>semver.patch(i))&&e._sameVersion(t,i))return i}return r?n[0]:t}}),angular.module("studio").directive("screensTree",["$rootScope","$q","$timeout","config","apiService","screenService",function(e,t,n,r,o,i){return{restrict:"A",require:"treeRoot",link:function(e,t,n,r){r.decorate({getIcon:function(e,t){return~e.id.indexOf("__placeholder__")?"":e.folder&&e.expanded&&!t?"fa-folder-open-o":t||e.folder?"fa-folder-o":e.modal?"fa-list-alt":e?"fa-file-text-o":void 0},getLabel:function(e){return e.name||e.id},getChildren:function(e){return e.screens},isValid:function(e){return i.isValidName(e.name,e.parentNode||e.node.parent,e.node)}})}}}]),angular.module("studio").directive("screenModelTree",["modelTreeService",function(e){return{restrict:"A",require:"treeRoot",link:function(t,n,r,o){o.decorate({getIcon:e.getIcon,getChildren:e.getChildren,getDescription:e.getDescription,getDescriptionIcon:e.getDescriptionIcon})}}}]),angular.module("studio").directive("urlInput",["helperService",function(e){return{require:"^ngModel",scope:!0,link:(t,n,r,o)=>{o.$parsers.push(e=>e?"openUrl('"+e+"')":""),o.$formatters.push(t=>{if(!e.startsWith(t,"openUrl"))return"";let n="openUrl".length+2;return t.substr(n,t.length-n-2)})}}}]),angular.module("studio").directive("stylesTree",["apiService",function(e){return{restrict:"A",require:"treeRoot",link:function(t,n,r,o){o.decorate({getIcon:function(){return"fa-file-text-o"},getLabel:function(e){return e.name},isEditable:function(e){return"_colors.scss"!==e.id},clickAddChild:!1,renameNode:function(t,n){return e.styles.renameFile({id:t.id,name:n})}})}}}]),angular.module("studio").directive("colorControl",function(){return{templateUrl:"/views/studio/directives/colorControl.html",restrict:"E",scope:{property:"=",disabled:"=ngDisabled",ngModel:"="},controller:["$scope","$rootScope","$timeout","propertyService","apiService","dialogService","screenService",function(e,t,n,r,o,i,s){e.propertyService=r,e.spectrumToggle=!1,e.editPressed=!1,e.property.classVal="";let a=e.property.customVal,l=e.property.gradientVal,c=e.property.isGradient,d=e.property.isCustom,u=e.property.customVal,p=e.property.gradientVal,f=e.property.value;e.toggleGradient=function(){e.property.isGradient=!e.property.isGradient},e.gradientCheckbox=function(e){e.stopPropagation()},e.getColor=function(t){if(e.colors)return{"background-color":e.colors[t.toLowerCase()]}},e.getLabel=function(){if(!e.property.selected){e.property.isCustom||e.property.isGradient?e.property.selected={label:"Custom",value:"custom"}:e.property.isImage?e.property.selected={label:"Image",value:"image"}:e.property.selected={label:"Default",value:""};for(let t=0;t<e.property.options.length;t++)e.property.options[t].value===e.property.value&&(e.property.selected=e.property.options[t])}return e.property.selected},e.getLabelColor=function(){if(e.colors){let t=e.property.selected.label;return{"background-color":e.colors[t.toLowerCase()]}}},e.select=function(t){"custom"!==t.value||e.property.classVal||(e.property.classVal=e.property.value),"image"!==t.value||e.property.classVal||(e.property.classVal=e.property.value,r.tempImageProp=e.property),e.property.value=t.value,e.property.selectedLabel=t.label,"custom"!==t.value&&"image"!==t.value?(e.property.isCustom=!1,e.property.isGradient=!1,e.property.isImage=!1,e.spectrumToggle=!1,r.tempImageProp=e.property,f=e.property.value,c=!1,d=!1,r.setPropertyValue(e.property)):t.value&&"custom"===t.value?(e.spectrumToggle=!0,e.property.isCustom=!0,e.property.isImage=!1):t.value&&"image"===t.value?(e.property.isImage=!0,e.configureImage()):(e.property.isCustom=!1,e.property.isImage=!1)},e.edit=function(){e.property.isImage?e.configureImage():e.property.isCustom||e.property.isGradient?e.spectrumToggle=!0:i.appStyles()},e.setCustomColor=_.debounce(()=>{e.property.isCustom=!0,"Custom"===e.getLabel().label&&e.property.customVal&&e.spectrumToggle&&a!==e.property.customVal&&(r.setPropertyValue(e.property),a=e.property.customVal)},100),e.setGradient=_.debounce(t=>{e.property.isGradient&&e.property.gradientVal&&e.spectrumToggle&&(l!==e.property.gradientVal||t)&&(r.setPropertyValue(e.property),l=e.property.gradientVal)},100),e.closeAndOriginalColors=function(){c?(e.property.customVal=u,e.property.gradientVal=p):d?(e.property.customVal=u,e.property.isGradient=!1):(e.property.value=f||"",e.property.isCustom=!1,e.property.isGradient=!1),r.setPropertyValue(e.property),e.spectrumToggle=!1},e.chooseAndClose=function(){c=e.property.isGradient,d=e.property.isCustom,u=e.property.customVal,p=e.property.gradientVal,f=e.property.value,e.spectrumToggle=!1},e.configureImage=function(){let t=s.getSelectedScreen();e.selectedComponentId=t.selectedComponentId,r.getPropertyValue(e.property),i.configureImageSource(e.selectedComponentId,e.property.id,e.property.value)},o.styles.getThemesAndColors().then(t=>{e.colors=t.colors}),e.initGradDirections=function(){e.property.gradientDirection||(e.property.gradientDirection=r.getGradientDirections()[0])},e.getLabel(),e.$on(t.EVENT_UPDATED_APP_COLORS,()=>{o.styles.getThemesAndColors().then(t=>{e.colors=t.colors})})}]}}),angular.module("studio").directive("outlineTree",function(){return{restrict:"A",require:"treeRoot",link:function(e,t,n,r){r.decorate({getIcon:function(){return"fa-code"},getLabel:function(e){return e.id},getChildren:function(e){return e.children}})}}}),angular.module("studio").directive("dateFormat",["moment",function(e){return{restrict:"A",require:"?ngModel",link:function(t,n,r,o){o&&(o.$formatters.push(function(t){return e(t,r.dateFormat).toDate()}),o.$parsers.push(function(t){return e(t).format(r.dateFormat)}))}}}]),angular.module("studio").directive("timeFormat",["moment",function(e){return{restrict:"A",require:"?ngModel",link:function(t,n,r,o){o&&(o.$formatters.push(function(t){return e("1970-01-01 "+t,"YYYY-DD-MM "+r.timeFormat).toDate()}),o.$parsers.push(function(t){return e(t).format(r.timeFormat)}))}}}]),angular.module("studio").directive("search",function(){return{restrict:"E",scope:{options:"="},templateUrl:"/views/studio/directives/search.html",link:function(e){e.show=!1,e.options.orderByOptions&&(e.checkedTitle=e.options.orderByOptions[0].title,e.options.orderBy=e.options.orderByOptions[0].value),e.options.findByNameOrId=function(t){var n=e.options.searchText.toLowerCase();if(!n)return!0;var r=t.name||"",o=t.id||"";return-1!==r.toLowerCase().indexOf(n)||-1!==o.toLowerCase().indexOf(n)},e.clickOnItem=function(t){e.checkedTitle=t.title,"updated"!==t.value&&"created"!==t.value||(t.value="-"+t.value),e.options.orderBy=t.value},e.onBlur=function(){e.show=!1}}}}),angular.module("studio").directive("elementOnload",function(){return{scope:{callBack:"&elementOnload"},link:function(e,t){t.on("load",function(){return e.callBack()})}}}),angular.module("studio").directive("dropdown",function(){return{restrict:"E",scope:{options:"=",iconClass:"@",dropdownClass:"@"},templateUrl:"/views/studio/directives/dropdown.html",link:function(e){e.clickOnTitle=function(){e.options.mainAction(),e.onBlur()},e.clickOnItem=function(t){t.action(),e.onBlur()},e.onBlur=function(){e.show=!1}}}}),angular.module("studio").directive("radioTree",["RecursionHelper",function(e){function t(e){_.each(e,function(e){if(e.expanded=!1,e.model.value===e.value||!e.value){var n=null;e.defaultInputValue&&e.parent&&e.parent.model.value&&(n=e.defaultInputValue),e.model.value="html"===e.type&&n}e.children&&t(e.children)})}function n(e,t){_.each(e,function(e){if(e.model.value===e.value||"checkbox"===e.type&&!0===e.model.value||"html"===e.type||e.modelForEmpty){var r=e.model.value;null===e.model.value&&e.defaultInputValue&&(r=e.defaultInputValue),t[e.name]={value:r},n(e.children,t[e.name])}})}function r(e){e.model={value:!1},_.each(e.tree,function(t){t.siblings=_.without(e.tree,t),t.parent=e.parent,t.scope=e,t.expanded=!1,"checkbox"===t.type?t.model={value:!1}:"radio"===t.type?t.model=e.model:t.model={value:t.value},_.isEmpty(e.ngModel)||function(e,t){o(e.ngModel,function(e,n){if(n===t.name&&(t.model.value=e.value,e.value==t.value)){t.expanded=!0;for(var r=t.parent;r;)r.expanded=!0,r=r.parent}})}(e,t)})}function o(e,t){_.each(e,function(e,n){t(e,n),o(e,t)})}return{restrict:"A",scope:{tree:"=",ngModel:"=",parent:"="},templateUrl:"/views/studio/directives/radioTree.html",compile:function(o){return e.compile(o,{pre:function(e){e.$watch("tree",function(){r(e)}),e.$watch("ngModel",function(){r(e)})},post:function(e){e.onChange=function(r){if(r.expanded=!0,r.parent)for(var o=r.parent;o;){o.expanded=!0;var i=o.value||!0;if(o.model.value!==i){var s=o.model.value;if(o.model.value=i,"radio"===o.type&&s){t(_.findWhere(o.siblings,{value:s}).children)}}o=o.parent}"radio"===r.type&&t(r.siblings),"checkbox"===r.type&&r.children&&t(r.children),function(e){for(var t=e.tree[0];t.parent;)t=t.parent;n(t.scope.tree,e.ngModel)}(e)}}})}}}]),angular.module("studio").directive("lowercase",function(){return{require:"ngModel",link:function(e,t,n,r){var o=function(e){void 0==e&&(e="");var t=e.toLowerCase();return t!==e&&(r.$setViewValue(t),r.$render()),t};r.$parsers.push(o),o(e[n.ngModel])}}}),angular.module("studio").directive("passwordsMatch",function(){return{require:"ngModel",link:function(e,t,n,r){var o="#"+n.passwordsMatch;t.add(o).on("keyup",function(){e.$apply(function(){var e=t.val()===$(o).val();r.$setValidity("passwordsmatch",e)})})}}}),angular.module("studio").directive("uniqueUserId",["$q","userService",function(e,t){return{require:"ngModel",link:function(n,r,o,i){i.$asyncValidators.username=function(n,r){if(i.$isEmpty(n))return e.resolve();var o=e.defer();return t.isUnique(n).then(function(e){i.$setValidity("uniqueuserid",e.success),e.success?o.resolve():o.reject()}),o.promise}}}}]),angular.module("studio").directive("monacoEditor",function(){return{restrict:"A",require:"^ngModel",scope:{ngChange:"&ngChange",onLoad:"&onLoad",onEdit:"=onEdit",mode:"=mode",readonly:"&ngReadonly"},link:function(e,t,n,r){monaco.languages.typescript.typescriptDefaults.setCompilerOptions({allowNonTsExtensions:!0,experimentalDecorators:!0,importHelpers:!1,noImplicitAny:!0}),monaco.languages.typescript.typescriptDefaults.setDiagnosticsOptions({noSemanticValidation:!0}),monaco.languages.css.scssDefaults.setDiagnosticsOptions({compatibleVendorPrefixes:"ignore"});let o=monaco.editor.createModel("",e.mode),i=monaco.editor.create(t[0],{model:o,readOnly:!!e.readonly&&e.readonly(),autoIndent:!0,automaticLayout:!0,codeLens:!1,fixedOverflowWidgets:!0,folding:!0,formatOnPaste:!0,formatOnType:!0,lineNumbers:"on",lineDecorationsWidth:5,minimap:{enabled:!1},parameterHints:!0,scrollbar:{horizontal:"visible",horizontalScrollbarSize:5,vertical:"visible",verticalScrollbarSize:5}});e.onLoad({editor:i}),i.onDidChangeModelContent(function(t){e.onEdit&&e.onEdit(t,i),r.$setViewValue(i.getModel().getValue(),!1)}),i.onDidFocusEditor(function(t){i.updateOptions({readOnly:!!e.readonly&&e.readonly()})}),r.$formatters.push(function(t){(t||""===t)&&(o.setValue(t),monaco.editor.setModelLanguage(o,e.mode),i.layout())}),r.$viewChangeListeners.push(function(){e.ngChange({editor:i})}),e.$on("$destroy",function(){i.getModel()&&i.getModel().dispose(),i.dispose(),i.destroy()})}}}),angular.module("studio").directive("actionPreview",["screenService","dataService","mockService","helperService","screenModelService",function(e,t,n,r,o){return{restrict:"A",scope:!0,templateUrl:"/views/studio/directives/actionPreview.html",link:t=>{function i(e,t){let n=`function ${t.replace(/\./g,"_")}(params) {\n                                    this.go("${e}");\n                                }`;return r.prettyTS(n)}function s(e,t){let n=`function ${t.replace(/\./g,"_")}(params) {\n                                    this.screenMocks("${e}");\n                               }`;return r.prettyTS(n)}t.model={selectedScreenId:"",selectedMockSet:""};let a=o.getSelectedScreenModel(),l="",c=`${a.id}.${t.node.realPath}`,d=n.getOpenedSources();n.getMockSetsByModel(a.id).then(e=>t.mockSets=_.pluck(e,"id")).then(()=>n.getActionSource(a.id,t.node.realPath)).then(e=>l=e).then(e=>(function(e){t.screens.forEach(n=>{let o=i(n.id,t.node.realPath);r.prettyTS(e)===o&&(t.selectedChoice=t.choices[1],t.model.selectedScreenId=n.id)}),t.mockSets.forEach(n=>{let o=s(n,t.node.realPath);r.prettyTS(e)===o&&(t.selectedChoice=t.choices[2],t.model.selectedMockSet=n)})})(e.source)),t.choices=[{label:"No Action",value:"none"},{label:"Go To Screen",value:"goto"},{label:"Change mockset",value:"mockset"}],t.selectedChoice=t.choices[0],t.screens=e.getListForChoosing(),t.actionChanged=function(){"none"===t.selectedChoice.value&&(d[c].source=function(e){return`function ${e.replace(/\./g,"_")}(params) {}`}(t.node.realPath),n.sourceChanged(c))},t.screenChanged=function(){let e=t.model.selectedScreenId;d[c].source=i(e,t.node.realPath),n.sourceChanged(c)},t.mocksetChanged=function(){d[c].source=s(t.model.selectedMockSet,t.node.realPath),n.sourceChanged(c)}}}}]),angular.module("studio").component("viewCode",{templateUrl:"/views/studio/components/header/viewCode.template.html",controller:["$rootScope",function(e){let t=this;t.globals=e.globals,t.toggleViewCode=function(){t.globals.viewSource=!t.globals.viewSource}}]}),angular.module("studio").component("preview",{templateUrl:"/views/studio/components/header/preview.template.html",transclude:!0,controller:["appService","dialogService","previewService","settingsService","saveService",function(e,t,n,r,o){let i=e.getOpenedApp();this.preview=function(){o.ensureAllSaved().finally(()=>{let e=i.isVersioned;t.preview(i,null,null,e)})},this.mockApp=function(){o.ensureAllSaved().finally(()=>{let e=n.generateUrl(i,{isMock:!0});window.open(e,"_blank")})},this.testApp=function(){o.ensureAllSaved().finally(()=>{let e=r.detect(i),t=n.generateUrl(i,{rpcUrl:e.preview.rpcUrl});window.open(t,"_blank")})}}]}),angular.module("studio").component("expandedView",{templateUrl:"/views/studio/components/header/expandedView.template.html",controller:["$rootScope","workspaceService",function(e,t){let n=this;n.globals=e.globals,n.toggleExpandedView=function(){t.showContainers(!n.globals.showContainers)}}]}),angular.module("studio").component("deviceView",{templateUrl:"/views/studio/components/header/preview/deviceView.template.html",bindings:{model:"<"},controller:["config","screenService",function(e,t){this.devices=e.devices,this.changeDevice=function(){t.selectViewForDevice()}}]}),angular.module("studio").component("mockData",{templateUrl:"/views/studio/components/header/preview/mockData.template.html",bindings:{model:"<"},controller:["mockService","canvas",function(e,t){this.mockSetChanged=function(){return e.getSelectedMockData().then(t.setScreenData)}}]}),angular.module("studio").component("openScreen",{templateUrl:"/views/studio/components/header/preview/openScreen.template.html",controller:["appService","screenService","dialogService","saveService",function(e,t,n,r){let o=e.getOpenedApp();this.openScreen=function(){r.ensureAllSaved().finally(()=>{let e=o.isVersioned,r=t.getSelectedScreen();n.preview(o,r,null,e)})}}]}),angular.module("studio").component("imageViewer",{templateUrl:"/views/studio/components/allFiles/imageViewer.template.html",require:{fileEditor:"^fileEditor"},controller:["$rootScope",function(e){let t=this;t.getImageSrc=function(){let n=t.fileEditor.selectedFile.id.replace("client/src",""),r="?appId="+e.app.id+"&previewToken="+e.app.previewToken;return e.serverUrl+n+r}}]}),angular.module("studio").controller("AllFilesHeaderCtrl",["$scope","layoutService","allFilesService","canvas","workspaceService",function(e,t,n,r,o){e.openedFiles=n.getOpenedFiles(),e.selectedFile=n.getSelectedFile(),e.layoutSizes=t.getConfig(),e.$on("ui.layout.resize",(t,n,r)=>{let o=n.id?n:r;e.layoutSizes[o.id]=o.size}),e.$on(e.EVENT_FILE_SELECTED,()=>{console.log("header: On EVENT_FILE_SELECTED"),e.selectedFile=n.getSelectedFile()}),e.$on(e.EVENT_FILE_CLOSED,()=>{console.log("header: On EVENT_FILE_CLOSED"),e.selectedFile=n.getSelectedFile()}),e.closeFile=n.processClosingFileTab,e.selectFile=n.processSelectingFileTab,e.stickFile=n.processStickingFileTab,e.saveAll=function(){e.showLoading(),n.saveAllFiles().then(r.refreshCss).then(o.refreshStudio)}}]),angular.module("studio").controller("AllFilesEditorCtrl",["$scope","allFilesService",function(e,t){e.selectedFile=t.getSelectedFile(),e.$on(e.EVENT_FILE_SELECTED,()=>{console.log("editor: On EVENT_FILE_SELECTED"),e.selectedFile=t.getSelectedFile()}),e.$on(e.EVENT_FILE_CLOSED,()=>{console.log("editor: On EVENT_FILE_CLOSED"),e.selectedFile=t.getSelectedFile()})}]),angular.module("studio").controller("HomeCtrl",["$scope","$state","userService","config","dialogService",function(e,t,n,r,o){document.title="SmartUXâ„¢",e.name=localStorage.getItem("name"),e.currentState=function(){return t.current.name},n.checkAdmin().then(function(t){e.isAdmin=t}),e.about=function(){o.about()},e.help=function(){o.help()},e.logout=function(){n.logout(),t.go("login")},"home"===t.current.name&&t.go("home.applications"),e.serverUrl=r.serverUrl}]),angular.module("studio").controller("ApplicationsCtrl",["$scope","$state","appService","screenTreeService","templateService","dialogService","config","helperService","navigationService",function(e,t,n,r,o,i,s,a,l){e.isTemplates="home.templates"===t.current.name,e.templateSections=[{name:"App Templates",allowNew:!1,filter:e=>e.isAppTemplate&&(e.isBuiltInTemplate||e.isTopTemplate)},{name:"Universal Screen Templates",allowNew:!0,newName:"Screen Group",filter:{isAppTemplate:"!true"}},{name:"Custom App Templates",appTemplates:!0,allowNew:!0,newName:"App Template",filter:{isBuiltInTemplate:"!true",isAppTemplate:!0,isTopTemplate:"!true"}}],e.filter={searchText:"",placeholder:e.isTemplates?"Template Groups":"Apps",orderBy:"",orderByOptions:e.isTemplates?null:[{title:"Name",value:"name"},{title:"Created Date",value:"created"},{title:"Modified Date",value:"updated"}]};(e.isTemplates?o.fetchList:n.fetchList)().then(function(t){e.applications=t}),e.newApp=function(){i.newProject("project-form")},e.newTemplate=function(e){i.newProject("new-template-group",null,null,e)},e.previewApp=function(e){r.fetch({appId:e.id}).then(t=>{i.preview(e,null,t)})},e.copyApp=function(e){i.copyApp(e).then(e=>{t.go("editor",{appId:e.appId})})},e.openModule=l.openModule,e.processAppClick=function(t){window.location=e.getLink("studio/"+t.id)},e.importFromRepository=function(){i.importRepository()},e.importFromZip=function(){i.importZip()},e.getIconUrl=function(e){return n.getIconUrl(e)},e.getLayoutClass=function(e){return a.toKebabCase(e)}}]),angular.module("studio").controller("UsersCtrl",["$rootScope","$scope","$state","dialogService","userService",function(e,t,n,r,o){t.filter={searchText:"",placeholder:"Users",orderByOptions:null};var i=function(){o.listAll().then(function(e){t.users=e})};i(),e.$on(e.EVENT_UPDATED_USERS,function(){i()}),t.newUser=function(){r.newUser()},t.processUserClick=function(e){r.editUser(e)}}]),angular.module("studio").controller("EditorCtrl",["$rootScope","$location","$stateParams","config","screenService","helperService","app","$document","canvas","mockService","workspaceService","layoutService","wsService","settingsService","saveService","allFilesService","styleService","dialogService",function(e,t,n,r,o,i,s,a,l,c,d,u,p,f,h,m,g,v){function S(){return m.saveAllFiles().then(l.refreshCss).then(d.refreshStudio)}if(a[0].body.id="studio",e.app=s,s){e.serverUrl=r.serverUrl,e.$stateParams=n,e.globals={showContainers:!1,viewSource:!1,showErrorNotifications:!1,activePane:"screens",layout:u.getConfig()},f.detect(s),e.$on(e.EVENT_BUILD_FINISHED,(t,n)=>{e.app.buildError=n}),"development"!==r.env&&(window.onbeforeunload=function(){return o.hasDirtyScreens()?"You have unsaved changes.":void 0});var y=e.$on("$stateChangeStart",(n,r,i,s)=>{var a=function(){y(),o.closeAllScreens(),p.close(!0),r.name!==s.name&&t.path(r.url)};o.hasDirtyScreens()?(n.preventDefault(),v.saveConfirm().then(()=>{e.showLoading(),o.saveAllScreens().then(()=>{e.hideLoading(),a()})}).catch(()=>{a()})):a()});a.off("keydown"),a.off("keyup"),a.off("cut"),a.off("copy"),a.off("paste"),a.on("keydown",function(e){46===e.keyCode&&"BODY"===e.target.tagName&&e.preventDefault(),8!==e.keyCode||i.isSrcElementInput(e)||e.preventDefault(),83===e.keyCode&&(e.metaKey||e.ctrlKey)&&(E(),e.preventDefault())}),a.on("keyup",e=>{if(8!==e.keyCode&&46!==e.keyCode||"BODY"!==e.target.tagName)83===e.keyCode&&(e.metaKey||e.ctrlKey)&&e.preventDefault();else{var t=d.getSelectedComponentId();!t||i.startsWith(t,"content")||i.startsWith(t,"screen")||d.deleteSelectedComponent(),e.preventDefault()}}),a.on("cut",e=>{if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&!document.querySelector(".ngdialog-overlay")&&d.getSelectedComponentId()){var t=d.cutSelectedComponent();e.originalEvent.clipboardData.setData("text/plain",t),e.preventDefault()}}),a.on("copy",function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&d.getSelectedComponentId()){var t=d.copySelectedComponent();e.originalEvent.clipboardData.setData("text/plain",t),e.preventDefault()}}),a.on("paste",function(e){if("INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&e.originalEvent.clipboardData.types.indexOf("text/plain")>-1){var t=e.originalEvent.clipboardData.getData("text/plain");d.pasteToSelectedComponent(t),e.preventDefault()}}),e.dragStartFromPalette=function(e){l.dragStartedFromPalette(e.type)},e.dragEndFromPalette=function(){l.dragEndedFromPalette()},e.isAllFilesMode=function(){return"allFiles"===e.globals.activePane},e.isNotBaseScreen=function(){let e=o.getSelectedScreen();return!e||"__BASE__"!==e.id},e.hasDirtyEditorFiles=function(){let e=o.hasDirtyScreens(),t=c.hasDirtyDataFiles(),n=c.hasDirtySources(),r=g.hasDirtyStyles();return e||t||n||r},e.hasDirtyFiles=function(){return m.hasDirtyFiles()};var E=_.debounce(function(){e.showLoading();(e.isAllFilesMode()?S:h.saveAllEditorFiles)().then(e.hideLoading)},500,!0)}}]),angular.module("studio").controller("HeaderCtrl",["$scope","layoutService","screenService","screenTreeService","saveService","canvas","batchRequest","dialogService","screenModelService",function(e,t,n,r,o,i,s,a,l){e.openedScreens=n.getOpenedScreens(),e.selectedScreen=n.getSelectedScreen(),e.layoutSizes=t.getConfig(),e.$on(e.EVENT_SCREEN_SELECTED,()=>{console.log("header: On EVENT_SCREEN_SELECTED"),e.selectedScreen=n.getSelectedScreen()}),e.$on(e.EVENT_SCREEN_CLOSED,()=>{console.log("header: On EVENT_SCREEN_CLOSED"),e.selectedScreen=n.getSelectedScreen()}),e.$on("ui.layout.resize",(t,n,r)=>{let o=n.id?n:r;e.layoutSizes[o.id]=o.size}),e.closeScreen=function(t){let o=r.findById(t.id),i=l.getById(o.id);o.isDirty||i&&i.isDirty?a.saveConfirm().then(()=>{e.showLoading(),n.saveScreen(t.id),s.send().then(()=>{l.markModelsNotDirty(),n.closeScreen(t.id),e.hideLoading()})}).catch(()=>{n.closeScreen(t.id)}):n.closeScreen(t.id)},e.selectScreen=function(e){n.getSelectedScreen().id!==e.id&&n.selectScreen(e.id),i.selectComponentById(null)},e.stickScreen=function(e){n.stickScreen(e.id)},e.saveAll=function(){e.showLoading(),o.saveAllEditorFiles().then(e.hideLoading)},e.saveSelected=function(){o.saveSelectedScreen()},e.saveAs=function(){e.$emit(e.EVENT_DIALOG_REQUESTED,"save-as-screen")}}]),angular.module("studio").controller("LeftPaneCtrl",["$scope","screenService","workspaceService","dialogService",function(e,t,n,r){e.showBaseScreen=function(){n.openScreen("__BASE__").then(()=>{t.stickScreen("__BASE__")})},e.showBuildLog=function(){let t=e.app.buildError;r.info("Compile error",t.message+"\nOutput:\n"+t.output)}}]),angular.module("studio").controller("CanvasHolderCtrl",["$rootScope","$scope","$sce","screenService","layoutService","canvas",function(e,t,n,r,o,i){function s(){let t=`/canvas/${e.app.previewToken}-${e.app.id}-${e.user.id}/index.html`;return n.trustAsResourceUrl(t)}t.$on(t.EVENT_SCREEN_SELECTED,()=>{console.log("canvasHolder: On EVENT_SCREEN_SELECTED"),t.selectedScreen=r.getSelectedScreen()}),t.$on(t.EVENT_APP_OPENED,()=>{console.log("canvasHolder: on EVENT_APP_OPENED"),function(){let e=document.querySelector("#iframe");t.canvasUrl=s(),e.setAttribute("src",t.canvasUrl)}()}),t.$on("ui.layout.resize",(e,t,n)=>{let r=t.id&&"central"!==t.id?t:n;o.updateConfig(r)}),t.$on("ui.layout.startresize",()=>{document.querySelector("#layout-resize-overlay").classList.add("layout-resize-overlay")}),t.$on("ui.layout.endresize",()=>{document.querySelector("#layout-resize-overlay").classList.remove("layout-resize-overlay"),i.resize()}),t.clickOutsideCanvas=function(){i.selectComponentById(null)},t.shouldShowCanvas=function(){let e=r.getSelectedScreen();return r.hasOpenedScreens()&&e&&"__BASE__"!==e.id},t.canvasUrl=s()}]),angular.module("studio").controller("BottomPaneCtrl",["$scope","$rootScope","screenService","helperService","$timeout",function(e,t,n,r,o){function i(){e.selectedScreen=n.getSelectedScreen(),e.selectedScreen.activeTab||(e.selectedScreen.activeTab="template")}function s(){let t=n.getSelectedScreen();e.sources={html:r.prettyHTML(t.dom.html()),ts:t.views[t.selectedView].ts,scss:t.views[t.selectedView].scss,appHooks:t.appHooks}}e.$on(e.EVENT_SCREEN_SELECTED,()=>{console.log("bottomPane: On EVENT_SCREEN_SELECTED"),i()}),e.$on(e.EVENT_VIEW_SELECTED,()=>{console.log("bottomPane: On EVENT_VIEW_SELECTED"),s()}),e.$on(e.EVENT_COMPONENT_CHANGED,()=>{console.log("bottomPane: On EVENT_COMPONENT_CHANGED"),s()}),e.sources={},i(),s(),e.updateScreenHtml=_.debounce(()=>{console.log("Setting new HTML for screen: "+e.selectedScreen.id),n.updateScreenHTML(e.sources.html)},500),e.updateScreenTS=_.debounce(()=>{console.log("Setting new TS for screen: "+e.selectedScreen.id),n.updateSelectedScreenTS(e.sources.ts)},500),e.updateScreenScss=_.debounce(()=>{console.log("Setting new SCSS for screen: "+e.selectedScreen.id),n.updateSelectedScreenScss(e.sources.scss)},500),e.updateAppHooks=_.debounce(()=>{console.log("Setting new AppEventHanlder"),n.updateAppHooks(e.sources.appHooks)},500),e.htmlChanged=function(t){t&&t.isFocused()&&t.domElement.getClientRects().length&&e.updateScreenHtml()},e.typescriptChanged=function(t){t&&t.isFocused()&&t.domElement.getClientRects().length&&e.updateScreenTS()},e.scssChanged=function(t){t&&t.isFocused()&&t.domElement.getClientRects().length&&e.updateScreenScss()},e.appHooksChanged=function(t){t&&t.isFocused()&&t.domElement.getClientRects().length&&e.updateAppHooks()},e.editorLoaded=function(r){return r.unwatchers={},!(["editor-view","editor-ctrl","editor-appHooks","editor-scss"].indexOf(r.domElement.id)<0)&&(r.unwatchers.activeTab=e.$watch("selectedScreen.activeTab",()=>(function(t){t.layout(),o(()=>{t.domElement.getClientRects().length&&(console.log("editor ["+e.selectedScreen.id+": "+t.domElement.id+"]: focus"),t.focus())},!0)})(r)),r.unwatchers.screenClosed=e.$on(e.EVENT_SCREEN_CLOSED,(o,i)=>{!function(r){n.hasOpenedScreens()||(console.log("editor ["+e.selectedScreen.id+": "+r.domElement.id+"]: cleanup"),_.each(r.unwatchers,e=>e()),delete r.unwatchers,r.getModel()&&r.getModel().dispose(),r.dispose(),r.destroy(),e.sources={},t.globals.viewSource=!1)}(r)}),"editor-view"===r.domElement.id&&void(r.unwatchers.componentSelected=e.$on(e.EVENT_COMPONENT_SELECTED,(e,t)=>{!function(e,t){if(e.domElement.getClientRects().length){let n=e.getModel();if(!n)return;let r=new RegExp('data-comp-id="'+t),o=n.findMatches(r,!1,!0,!1,!1);if(_.isEmpty(o))return;let i=o[0].range;e.setSelection(i),e.revealLineInCenter(i.startLineNumber)}}(r,t)})))}}]),angular.module("studio").controller("SidebarCtrl",["$scope","apiService","dialogService","config","$location",function(e,t,n,r,o){o.search();e.screens=function(){e.globals.activePane="screens"},e.components=function(){e.globals.activePane="components"},e.allFiles=function(){e.globals.activePane="allFiles"},e.settings=function(){t.applications.getApps().then(function(e){n.projectSettings(e)})},e.revisionHistory=function(){n.revisionHistory()},e.styles=function(){n.appStyles()},e.publish=function(){n.publish()}}]),angular.module("studio").controller("BottomPaneStylesCtrl",["$scope","$rootScope","styleService","helperService","canvas","$timeout",function(e,t,n,r,o,i){function s(t){var n=r.filterStyleName(t.name),o=_.pluck(e.filesList,"id");return!!n&&o.indexOf(n)<0}function a(t){n.getFile(t).then(()=>i(()=>e.fileId=t,!0))}e.$on(e.EVENT_UPDATED_APP_COLORS,()=>{console.log("bottomPane/styles: On EVENT_UPDATED_APP_COLORS");n.getOpenedStyles()["_colors.scss"]&&(n.resetCache(),n.getFile("_colors.scss").then(t=>{e.openedStyles["_colors.scss"]=t})),e.refreshStyles()}),e.refreshStyles=function(){return n.getList().then(t=>{_.each(t,e=>e.siblings=t),e.fileId&&a(e.fileId),e.filesList=t,e.hideLoading()})},e.addFile=function(){e.edit.name="",e.showAddFile=!0},e.confirmEditing=function(){e.showLoading(),n.createFile(e.edit).then(()=>{e.refreshStyles(),e.cancel()})},e.cancel=function(){delete e.edit.name,e.showAddFile=!1},e.amendFile=_.debounce(()=>n.styleChanged(e.fileId),500,!0),e.fileChanged=function(t){t&&t.isFocused()&&e.amendFile()},e.edit={},e.fileId=null,e.openedStyles=n.getOpenedStyles(),e.stylesListOptions={isWarned:function(t){return e.openedStyles[t.id]&&e.openedStyles[t.id].compileError},onClick:function(e){a(e.id)},isSelected:function(t){return e.fileId&&t.id===e.fileId},isValid:s,deleteNode:function(t){return e.showLoading(),n.deleteFile(t.id).then(()=>{e.fileId&&t.id===e.fileId&&(e.fileId=null),e.hideLoading()})},hasAsterisk:function(t){return e.openedStyles[t.id]&&e.openedStyles[t.id].isDirty}},e.isValid=s,e.refreshStyles()}]),angular.module("studio").controller("BottomPaneMockDataCtrl",["$scope","$rootScope","mockService","dataService","$timeout","screenService","screenModelService",function(e,t,n,r,o,i,s){function a(){e.fileId=null,e.openedFiles=n.getOpenedFiles()}function l(t,r){return n.getDataFile(t,r).then(function(){o(function(){e.fileId=t+"."+r},!0)})}e.$on(e.EVENT_UPDATED_SCREEN_MODELS,()=>{console.log("bottomPane/mockdata: On EVENT_UPDATED_SCREEN_MODELS"),e.refreshMockData()}),e.$on(e.EVENT_UPDATED_MOCKS_TREE,()=>{console.log("bottomPane/mockdata: On EVENT_UPDATED_MOCKS_TREE"),e.refreshMockData()}),e.$on(e.EVENT_SCREEN_DELETED,()=>{console.log("bottomPane/mockdata: On EVENT_SCREEN_DELETED"),e.refreshMockData()}),e.$on(e.EVENT_SCREEN_SELECTED,()=>{console.log("bottomPane/mockdata: On EVENT_SCREEN_SELECTED");let e=s.getSelectedScreenModel(),t=i.getSelectedScreen();e&&l(e.id,t.selectedMockSet)}),e.refreshMockData=function(){return n.getDataFilesTree().then(t=>{!function(e){e.forEach(e=>{e.sub&&(e.expanded=!0)})}(t.files),e.filesList=t.files,a()})},e.amendFile=_.debounce(()=>{e.openedFiles[e.fileId].hasError=!1;try{JSON.parse(e.openedFiles[e.fileId].source)}catch(t){e.openedFiles[e.fileId].hasError=!0}e.openedFiles[e.fileId].hasError||n.fileChanged(e.fileId),e.$apply()},500),e.fileChanged=function(t){t&&t.isFocused()&&e.amendFile()},a(),e.mocksListOptions={getIcon:function(){return"fa-table"},getLabel:function(e){return e.name},getChildren:function(e){return e.sub},isEditable:function(){return!0},isWarned:function(t){let n=t.screenModelId+"."+t.id;return e.openedFiles[n]&&e.openedFiles[n].hasError},addChildNode:function(e,t){return n.addMockSet(e.screenModelId,t).then(t=>{e.sub.push({id:t.id,name:t.id,screenModelId:e.screenModelId,parent:e})})},renameNode:function(t,r){return n.renameMockSet(t.screenModelId,t.id,r).then(n=>{let r=t.screenModelId+"."+t.id;t.id=n.id,t.name=n.id,e.fileId===r&&l(t.screenModelId,n.id)})},hasDelete:function(e){return!e.sub},hasRename:function(e){return!e.sub},hasAddChild:function(e){return e.sub},confirmDeleting:function(t){return n.deleteMockSet(t.screenModelId,t.id).then(()=>{let n=t.parent.sub.indexOf(t);t.parent.sub.splice(n,1),e.fileId===t.screenModelId+"."+t.id&&a()})},onClick:function(e){l(e.screenModelId,e.id)},isSelected:function(t){return e.fileId===t.screenModelId+"."+t.id},hasAsterisk:function(t){let n=t.screenModelId+"."+t.id;return e.openedFiles[n]&&e.openedFiles[n].isDirty}},e.refreshMockData()}]),angular.module("studio").controller("BottomPaneMockActionsCtrl",["$scope","$rootScope","mockService",function(e,t,n){function r(){e.fileId=null,e.openedSources=n.getOpenedSources()}e.$on(e.EVENT_UPDATED_SCREEN_MODELS,()=>{console.log("bottomPane/mockactions: On EVENT_UPDATED_SCREEN_MODELS"),e.refreshMockActions()}),e.refreshMockActions=(()=>{n.getActionsTree().then(t=>{e.filesList=t.files,r()})}),e.amendFile=_.debounce(()=>{n.sourceChanged(e.fileId),e.openedSources[e.fileId].hasError=!1},500,!0),e.fileChanged=function(t){t&&t.isFocused()&&e.amendFile()},e.onEdit=function(t,n){let r=n.getModel().getLineMaxColumn(1),o=t.changes[0].range,i=t.changes[0].text,s=1===o.startLineNumber&&1===o.endLineNumber,a=o.startColumn===r&&o.endColumn===r,l=`${t.eol}    `===i,c=i!==e.openedSources[e.fileId].source,d=s&&c,u=t.isUndoing;!d||s&&a&&l||u||n.trigger("","undo")},r(),e.mocksListOptions={getIcon:function(e){return e.type?"action"===e.type?"fa-bolt":"fa-code":"fa-sitemap"},getLabel:function(e){return e.path||e.name},getChildren:function(e){return e.methods},isWarned:function(t){if(t.files||t.methods)return!1;let n=t.screenModelId+"."+t.path;return e.openedSources[n]&&e.openedSources[n].hasError},onClick:function(t){t.files||t.methods||n.getActionSource(t.screenModelId,t.path).then(()=>e.fileId=t.id)},isSelected:function(t){return!t.files&&!t.methods&&e.fileId===t.screenModelId+"."+t.path},isEditable:function(){return!1},hasAsterisk:function(t){if(t.files||t.methods)return!1;let n=t.screenModelId+"."+t.path;return e.openedSources[n]&&e.openedSources[n].isDirty}},e.refreshMockActions()}]),angular.module("studio").controller("RightPaneCtrl",["$scope","screenService","layoutService",function(e,t,n){e.ui={activeTab:"models"},e.$on(e.EVENT_COMPONENT_SELECTED,(t,n)=>{console.log("rightPane: On EVENT_COMPONENT_SELECTED"),e.showScreenProperties=!n}),e.$on(e.EVENT_SCREEN_SELECTED,(n,r)=>{console.log("rightPane: On EVENT_SCREEN_SELECTED"),e.selectedScreenId=r,e.selectedScreen=t.getSelectedScreen(),e.showScreenProperties=!0}),e.$on(e.EVENT_SCREEN_CLOSED,()=>{console.log("rightPane: On EVENT_SCREEN_CLOSED"),t.hasOpenedScreens()||(e.showScreenProperties=!1)}),e.$on("ui.layout.resize",(e,t,r)=>{let o="central"===t.id?r:t;n.updateConfig(o)})}]),angular.module("studio").controller("RightPaneOutlineCtrl",["$scope","$rootScope","$timeout","screenService","workspaceService","canvas",function(e,t,n,r,o,i){function s(){let t=r.getSelectedScreen();t&&"__BASE__"!==t.id?(e.components=o.getComponentsTree(),a=o.getComponentsMap(e.components)):e.components=[],o.showSelectedComponent(a,e.selectedComponentId)}e.components=[],e.selectedComponentId=null;let a={};s(),e.treeOptions={onClick:function(t){e.selectedComponentId=t.id,i.selectComponentById(t.id)},isSelected:function(t){return t.id===e.selectedComponentId},isWarned:function(e){return e.broken}},e.$on(e.EVENT_VIEW_SELECTED,function(){console.log("outline: On EVENT_VIEW_SELECTED"),s()}),e.$on(e.EVENT_SCREEN_CLOSED,function(){console.log("outline: On EVENT_SCREEN_CLOSED"),s()}),e.$on(e.EVENT_COMPONENT_CHANGED,function(){console.log("outline: On EVENT_COMPONENT_CHANGED"),s()}),e.$on(e.EVENT_COMPONENT_SELECTED,function(t,n){console.log("outline: On EVENT_COMPONENT_SELECTED"),e.selectedComponentId=n,o.showSelectedComponent(a,n)}),e.$on(e.EVENT_COMPONENTS_BROKEN,function(e,t){console.log("outline: On EVENT_COMPONENTS_BROKEN"),o.showBrokenComponents(a,t)})}]),angular.module("studio").controller("RightPaneScreenPropertiesCtrl",["$scope","screenService","helperService","config","dialogService","clipboardService","workspaceService",function(e,t,n,r,o,i,s){function a(){let n=t.getSelectedScreen();n&&(e.model=_.pick(n,"id","name","modal","preventAutoDismiss","disableMenuSwipe","description","sourceScreenId","statusbarContent"),e.screen=n,e.screenPath=e.model.id)}a(),e.statusbarVariants=["light","dark"],e.isValid=(()=>{let t=n.toLowerCase(e.model.name),r=!!t,o=!/^\d/.test(t),i=_.pluck(e.screen.siblings,"id"),s=e.screen.parent,a="__BASE__"===s.id?t:s.id+"_"+t,l=i.indexOf(a)<0;return r&&o&&l||a===e.screen.id}),e.reset=(()=>{o.confirm("Confirm Screen Reset",r.messages.screenReset,{name:e.model.name},!1).then(()=>{e.showLoading(),t.resetScreen().then(()=>{s.refreshStudio(),e.hideLoading()})})}),e.copyToClipboard=i.copy,e.modalModelChanged=(()=>{e.model.modal||delete e.model.preventAutoDismiss}),e.$on(e.EVENT_SCREEN_CLOSED,()=>{console.log("rightPane/screenProps: On EVENT_SCREEN_CLOSED"),t.hasOpenedScreens()||(e.model={})}),e.$on(e.EVENT_SCREEN_SELECTED,()=>{console.log("rightPane/screenProps: On EVENT_SCREEN_SELECTED"),a()}),e.$watch("model",(t,r)=>{if(r!==t&&r&&r.id===t.id&&e.isValid()&&!angular.equals(t,r)){if(e.model&&e.screen.parent){let t=e.screen.parent,r=n.toLowerCase(e.model.name);e.screenPath="__BASE__"===t.id?r:t.id+"_"+r}e.screen.isSticky||(e.screen.isSticky=!0),_.extend(e.screen,e.model,{isDirty:!0})}},!0)}]),angular.module("studio").controller("RightPanePropertySheetCtrl",["$scope","$timeout","screenService","componentService","propertyService","dialogService","workspaceService","domService",function(e,t,n,r,o,i,s,a){function l(){let t=n.getSelectedScreen();t&&(e.selectedScreenId=t.id,e.selectedComponentId=t.selectedComponentId,e.component=r.getComponentFromId(e.selectedComponentId),function(){let t=[],i={};if(e.component&&e.component.properties){e.groups=r.getPropertyGroups(),e.propertyDefinitions=r.getPropertyDefinitions();for(let r=0;r<e.component.properties.length;r++){let s=e.component.properties[r],a=i[s.group];0===a||a||(a=t.length,i[s.group]=a,t[a]={label:e.groups[s.group].label,properties:[]});let l=n.getSelectedScreen(),c="[data-comp-id='"+e.selectedComponentId+"']",d=l.dom(c),u=e.propertyDefinitions[s.property],p={id:s.property,label:s.label,type:u.type,selector:s.selector,attribute:u.attribute,attributeType:u.attributeType,criteria:s.criteria,element:d,funcs:u.funcs,isAttribute:u.isAttribute,cssAttribute:u.cssAttribute,style:u.style,tooltip:u.tooltip};"singleSelect"===u.type?p.options=u.options:"checkbox"===u.type&&(p.attributeValue=u.value,u.valueIfFalse&&(p.valueIfFalse=u.valueIfFalse)),"color"===u.type&&(p.options=u.options),o.getPropertyValue(p),"color"===p.type&&(""===p.value&&(p.value=null),p.originalValue=p.value),t[a].properties.push(p)}}e.propertyGroups=t}())}function c(e,t){let n;if(0===e.length)return!1;"tag"===t.type?n=e.get(0).name:"attribute"===t.type?n=e.attr(t.attribute):"class"===t.type&&(n=e.attr("class"));let r=new RegExp(t.match,"i");return!(void 0===n||!r.test(n))}e.$on(e.EVENT_COMPONENT_SELECTED,(e,t)=>{console.log("propertySheet: On EVENT_COMPONENT_SELECTED ("+t+")"),l()}),e.$on(e.EVENT_VIEW_CHANGED,()=>{console.log("propertySheet: On EVENT_VIEW_CHANGED"),l()}),e.$on(e.EVENT_SCREEN_CLOSED,()=>{console.log("propertySheet: On EVENT_SCREEN_CLOSED"),delete e.selectedScreenId,delete e.selectedComponentId,delete e.component,delete e.propertyGroups,delete e.groups,delete e.propertyDefinitions}),e.configureData=(t=>{i.configureComponentData(e.selectedComponentId,t.id,t.value)}),e.configureRepeat=(t=>{i.configureComponentRepeat(e.selectedComponentId,t.id,t.value)}),e.configureEvent=(t=>{i.configureComponentEvent(e.selectedComponentId,t.id,t.value)}),e.configureAction=(t=>{i.configureComponentAction(e.selectedComponentId,t.id,t.value)}),e.configureImage=(t=>{i.configureImageSource(e.selectedComponentId,t.id,t.value)}),e.changeIcon=(t=>{i.selectIcon(e.selectedComponentId,t.id,t.value)}),e.deleteComponent=(e=>{s.deleteSelectedComponent(),e.preventDefault()}),e.setPropertyValue=(t=>{o.setPropertyValue(t)&&(e.selectedComponentId=null),o.propertyChanged()}),e.setColorPropertyValue=(t=>{t.originalValue!==t.value&&(t.originalValue=t.value,e.setPropertyValue(t),o.propertyChanged())}),e.isDisabled=(e=>"ngModel"===e.id&&e.element.attr("ng-checked")),e.isShown=(t=>{if(t.invalid||"hidden"===t.type)return!1;if(t.criteria){let r,o=t.criteria.selector;if(t.criteria.parents){let e=t.element;for(;e.length;){if(c(e,t.criteria))return!t.criteria.negative;e=e.parent()}return t.criteria.negative}if("."===o)r=t.element;else if(".."===o){let t=n.getSelectedScreen(),o="[data-comp-id='"+a.getParentComponentId(t.dom,e.selectedComponentId)+"']";r=t.dom(o)}else r=t.element.find(o);let i=c(r,t.criteria);return t.criteria.negative?!i:i}return!0}),e.isShownDeleteCompButton=(e=>!!e&&"content"!==e.id&&"screen"!==e.id),l()}]),angular.module("studio").controller("RightPaneScreenModelsCtrl",["$q","$scope","$rootScope","$timeout","screenService","dataService","modelTreeService","dialogService","helperService","mockService","batchRequest","screenModelService","saveService","sharedModelService",function(e,t,n,r,o,i,s,a,l,c,d,u,p,f){function h(){t.model.openedFiles=c.getOpenedFiles(),t.model.mockData={},t.model.selectedMockSet="default",t.previewMode=!1;let e=o.getSelectedScreen();e&&"__BASE__"!==e.id&&(t.screenModel=u.getSelectedScreenModel(),t.screenModel&&c.getMockSetsByModel(t.screenModel.id).then(e=>g().then(()=>t.model.mockSets=_.pluck(e,"id"))))}function m(e){"model"===e.type&&(e=f.getById(e.model)),a.dataEntry(s.TYPE_SCREEN_MODEL,e).then(n=>{u.qAddProperty(e,n),u.updateRealPaths(t.screenModel)})}function g(){return t.screenModel?(t.unwatchMockData&&t.unwatchMockData(),c.getDataFile(t.screenModel.id,t.model.selectedMockSet).then(e=>{let n=`${t.screenModel.id}.${t.model.selectedMockSet}`;t.model.mockData={[n]:function(e){let t=i.getScreenDataStubs();return l.mergeObjects(t,JSON.parse(e))}(e)},t.unwatchMockData=t.$watch("model.mockData",E,!0)})):e.resolve()}function v(e){return!s.isNodeInArray(e)&&t.previewMode&&["string","number","date","time","boolean"].includes(e.type)}function S(e){let n=t.previewMode&&"array"===e.type&&"object"===e.items.type,r=t.previewMode&&"select"===e.type;return n||r}function y(e){return!s.isNodeInArray(e)&&t.previewMode&&["action"].includes(e.type)}function E(e,t){let n=Object.keys(e)[0],r=Object.keys(t)[0];if(e&&!_.isEmpty(t)&&e!==t&&n===r){let t=c.getOpenedFiles()[n],r=JSON.stringify(e[n]);t.source=l.prettyJSON(r),c.fileChanged(n,!0)}}t.$on(t.EVENT_SCREEN_SELECTED,()=>{console.log("rightPane/screenModel: On EVENT_SCREEN_SELECTED"),h()}),t.$on(t.EVENT_SCREEN_CLOSED,()=>{console.log("rightPane/screenModel: On EVENT_SCREEN_CLOSED"),h()}),t.$on(t.EVENT_UPDATED_SCREEN_MODELS,()=>{console.log("rightPane/screenModel: On EVENT_UPDATED_SCREEN_MODELS"),r(()=>h(),!0)}),t.$on(t.EVENT_UPDATED_MOCK_DATA,()=>{console.log("rightPane/screenModel: On EVENT_UPDATED_MOCK_DATA"),g()}),t.$on(t.EVENT_UPDATED_MOCKS_TREE,()=>{console.log("rightPane/screenModel: On EVENT_UPDATED_MOCKS_TREE"),h()}),t.refreshScreenModels=function(){if(!o.hasDirtyScreens()&&!t.screenModel.isDirty)return u.refresh(!0);a.saveConfirm().then(()=>{n.showLoading(),p.saveAllEditorFiles().then(n.hideLoading)}).catch(()=>{d.clear(),u.refresh(!0)})},t.editScreenModels=function(){return a.editScreenModels(t.screenModel)},t.changeMockSet=function(){g()},t.togglePreview=function(){return t.previewMode=!t.previewMode},t.checkIsDirty=function(){if(!t.screenModel||!t.model.selectedMockSet)return!1;const e=t.screenModel.id+"."+t.model.selectedMockSet,n=t.model.openedFiles,r=n&&n[e]&&n[e].isDirty,o=c.hasDirtySources();return t.screenModel.isDirty||r||o},t.addMockSet=function(){a.prompt("Mock Set Name","").then(function(e){let r=l.filterName(e);if(!r.length||t.model.mockSets.indexOf(r)>-1)return!1;c.addMockSet(t.screenModel.id,e).then(e=>c.getMockData(t.screenModel.id,e.id).then(()=>n.$broadcast(t.EVENT_UPDATED_MOCKS_TREE)))})},t.addDataEntry=function(e){return m(e)},t.editProperty=function(e){a.dataEntry(s.TYPE_SCREEN_MODEL,e.parent,e).then(n=>{u.qEditProperty(e,n),u.updateRealPaths(t.screenModel)})},t.deleteProperty=function(e){a.confirm(null,"Do you really want to delete this data entry?").then(()=>{u.qDeleteProperty(e)})};t.model={mockSets:[],selectedMockSet:"default",mockData:{},openedFiles:c.getOpenedFiles()},h();let b=[{icon:"fa-pencil",title:"Modify Data Entry",action:t.editProperty},{icon:"fa-trash",title:"Delete Data Entry",action:t.deleteProperty}],w=[{icon:"fa-plus",title:"Add Child",action:m},...b],C=[{icon:"fa-plus",title:"Add Param",action:m},...b];t.treeOptions={isCollapsible:function(e){return!S(e)&&!_.isEmpty(this.getChildren(e))},isDraggable:()=>!t.previewMode,getDragData:e=>{switch(e.type){case"method":return{type:".method."+e.realPath};case"action":return{type:".action."+e.realPath};default:return{type:".data."+e.realPath}}},getDragStart:()=>t.dragStartFromPalette,getDragEnd:()=>t.dragEndFromPalette,hasTemplate:e=>v(e)||S(e)||y(e),getTemplateSrc:e=>v(e)?"/views/common/includes/inputPreview.html":S(e)?"/views/common/includes/arrayPreview.html":y(e)?"/views/studio/includes/actionPreview.html":void 0,getTemplateModel:e=>(function(n){let r=e.realPath.split("."),o=`${t.screenModel.id}.${t.model.selectedMockSet}`,i=t.model.mockData[o];i||(i={},t.model.mockData[o]=i);for(let e=0;e<r.length-1;e++)i[r[e]]||(i[r[e]]={}),i=i[r[e]];let s=r.pop();if((n||""===n)&&(i[s]=n),"array"!==e.type||i[s]||(i[s]=[]),"select"!==e.type||i[s]||(i[s]={options:[]}),i&&i[s])return i[s]}),getItemClass:e=>t.previewMode?S(e)?"array-preview-item":void 0:"",getControls:e=>{if(!t.previewMode)return"method"===e.type?C:"object"===e.type||"array"===e.type&&"object"===e.items.type||"model"===e.type?w:b}}}]),angular.module("studio").controller("LeftPaneAllFilesCtrl",["$scope","allFilesService",function(e,t){const n=["applications.delete"];e.$on(e.EVENT_API_SUCCESS,(e,r)=>{const o=n.reduce((e,t)=>!!r.name.match(new RegExp(t))||e,!1);"files"!==r.namespace&&r.isSetter&&!o&&t.refreshAllFilesTab()})}]),angular.module("studio").controller("LeftPaneComponentsCtrl",["$scope","$rootScope","$stateParams","config","componentService","screenService","dialogService",function(e,t,n,r,o,i,s){function a(){t.showLoading(),o.updateComponents().then(function(n){t.$broadcast(t.EVENT_APP_OPENED),e.components=n,e.$apply(),t.hideLoading()})}e.config=r,e.search={},e.showSearch=!1,e.toggleSearch=function(){e.showSearch=!e.showSearch,e.showSearch||(e.search.name="")},e.edit=function(){s.editComponents(e.updateComponents,r.messages.updateComponents)},e.refreshComponents=function(){o.getComponents().then(function(t){e.components=t,e.componentGroups=o.getComponentGroups(),e.$apply()})},e.checkScreensOpened=function(){return i.hasOpenedScreens()},e.showHeader=function(e,t){var n={"Screen Layouts":"layouts","Screen Elements":"element","Smart Features":"smartFeatures",Desktop:"desktop"};if(e)for(var r=0;r<e.length;r++)if(e[r].group===n[t])return!0;return!1},e.updateComponents=function(){if(i.hasDirtyScreens()){s.saveConfirm("Unsaved screens changes","Do you want to save screens changes?").then(()=>{e.showLoading(),i.saveAllScreens().then(()=>{e.hideLoading(),a()})}).catch(()=>{a()})}else a()},e.refreshComponents()}]),angular.module("studio").controller("LeftPaneScreensCtrl",["$scope","$rootScope","$timeout","screenService","dialogService","apiService","screenModelService","config","screenTreeService","workspaceService","canvas","appService",function(e,t,n,r,o,i,s,a,l,c,d,u){function p(n){f(e.rootScreen)?o.saveConfirm(null,null,!0).then(()=>{t.showLoading(),r.saveAllScreens().then(()=>{s.markModelsNotDirty(),t.hideLoading(),n()})}):n()}function f(e){let t=e.screens?m(e):e.isDirty,n=s.getById(e.id),r=e.screens?g(e):n&&n.isDirty;return t||r}function h(){return r.refreshTree().then(t=>(r.closeAllScreens(),e.rootScreen=t,e.screens=t.screens,r.restoreScreens()))}function m(e){let t=!1;return l.eachChildScreen(e,e=>{let n=e.screens?m(e):e.isDirty;t=t||n}),t}function g(e){let t=!1;return l.eachChildScreen(e,e=>{let n=s.getById(e.id),r=e.screens?g(e):n&&n.isDirty;t=t||r}),t}e.search={},e.showSearch=!1,e.canvasReady=!1;let v=u.getOpenedApp();e.$on(e.EVENT_CANVAS_READY,()=>{console.log("leftPane/screens: On EVENT_CANVAS_READY"),d.$init(document.querySelector("#iframe").contentWindow),d.refreshCss().then(s.refresh).then(h).then(()=>{n(e.hideLoading,!0),e.canvasReady=!0})}),e.$on(e.EVENT_UPDATED_SCREEN_MODELS,(e,t)=>{t.forceReload&&(console.log("leftPane/screens: On EVENT_UPDATED_SCREEN_MODELS"),h())}),e.$on(e.EVENT_VIEW_SELECTED,()=>{console.log("leftPane/screens: On EVENT_VIEW_SELECTED");let e=r.getSelectedScreen();e.selectedView!==t.app.defaultLayout&&(e.expanded=!0)}),n(function(){!1===e.canvasReady&&n(e.hideLoading,!0)},1e4),e.toggleSearch=function(){e.showSearch=!e.showSearch,e.showSearch||(e.search.name="")},e.addScreen=function(e,t){t&&t.stopPropagation(),p(()=>{o.createScreen(e)})},e.addFolder=function(t,n,r){n&&n.stopPropagation(),p(()=>{r||((r=r||e).edit={}),r.edit.parentNode=t,t.expanded=!0})},e.manageViews=function(e,t){t.stopPropagation(),o.manageViews(e)},e.cancel=function(){e.edit=null},e.confirmEditing=function(){r.createFolder(e.rootScreen,e.edit.name).then(e.cancel)},e.getIcon=function(){return"fa-folder-o"},e.isValid=function(t){return r.isValidName(t.name,e.rootScreen,t.node)};let S=[{icon:"ion-md-add",title:"Add screen",action:e.addScreen},{icon:"ion-ios-folder",title:"Add folder",action:e.addFolder}],y=[{icon:"ion ion-ios-albums-outline",title:"Manage Views",action:e.manageViews}];e.treeOptions={isEditable:function(e){return!e.system},hasAsterisk:function(e){return f(e)},onDblClick:function(e){e.folder?e.expanded=!e.expanded:e.view?(r.selectScreen(e.screen.id),r.stickScreen(e.screen.id),r.selectView(e.id)):r.stickScreen(e.id)},onClick:function(e){if(e.folder)return!1;if(e.view){(r.isOpenedScreen(e.screen.id)?Promise.resolve():c.openScreen(e.screen.id)).then(()=>{r.selectScreen(e.screen.id),r.selectView(e.id)})}else c.openScreen(e.id)},getControls:function(e){return!e.view&&!e.system&&(e.folder?S:y)},hasRename:function(e){return e.folder},clickRename:function(e,t){t.stopPropagation(),p(()=>{this.edit.node=e,this.edit.name=e.name})},clickDelete:function(e,t){t.stopPropagation(),p(()=>{e.expanded=!1,this.delete.node=e})},hasAddChild:function(){return!1},getChildren:function(e){return e.folder?e.screens:1===_.keys(e.views).length?null:e.views},isHidden:function(e){return!0===e.view&&e.id===t.app.defaultLayout||"menu"===e.id&&!0===v.disableSideMenu},confirmEditing:function(t){this.edit.node&&this.edit.name.length>0?(e.showLoading(),r.renameFolder(this.edit.node,this.edit.name).then(()=>c.refreshStudio()).then(e.hideLoading).then(this.cancel)):r.createFolder(t,this.edit.name).then(this.cancel)},confirmDeleting:function(n){if(this.cancel(),n.view)return i.screens.deleteView({id:n.screen.id,formFactor:n.id}).then(()=>{r.selectView(t.app.defaultLayout);let e=n.screen.extraViews.indexOf(n.id);n.screen.extraViews.splice(e,1),delete n.screen.views[n.id]});let s,c,d=r.getStartScreen();n.folder&&n.screens.length?s=o.confirm(null,a.messages.folderDelete).then(()=>(e.showLoading(),l.eachChildScreen(n,e=>{e===d&&(c=!0)}),r.deleteFolder(n))):n.folder?(e.showLoading(),s=r.deleteFolder(n)):(e.showLoading(),n===d&&(c=!0),s=r.deleteScreen(n)),s.then(t.hideLoading)},isSelected:function(e){let n=r.getSelectedScreen();return n&&(n===e&&n.selectedView===t.app.defaultLayout||n===e.screen&&n.selectedView===e.id)},isClickable:function(){return!0},isDraggable:function(e){let t=!e.system,n=!e.view;return t&&n},isSortable:function(e){return!e.system&&!e.view},isSortableChildren:function(e){return e.folder},getType:function(){return"screen"},getDragData:function(e){return{id:e.id,type:"screen"}},moveNode:function(t,n,o){p(()=>{e.showLoading(),r.moveScreen(t,n,o).then(t=>{e.hideLoading(),t&&c.refreshStudio()})})}}}]),angular.module("studio").controller("ViewerCtrl",["$rootScope","$location","$stateParams","config","componentService","screenService","helperService","app","$document","mockService","dialogService","dataService","workspaceService","layoutService","wsService","settingsService","canvas",function(e,t,n,r,o,i,s,a,l,c,d,u,p,f,h,m,g){l[0].body.id="studio",e.app=a,e.serverUrl=r.serverUrl,e.$stateParams=n,e.globals={showContainers:!1,viewSource:!1,showErrorNotifications:!1,activePane:"screens",layout:f.getConfig()},m.detect(a),o.getComponents();var v=e.$on("$stateChangeStart",function(n,r,o,s){v(),i.closeAllScreens(),e.hideLoading(),h.close(!0),r.name!==s.name&&t.path(r.url)})}]),angular.module("studio").controller("ViewerHeaderCtrl",["$scope","screenService","canvas","layoutService",function(e,t,n,r){e.openedScreens=t.getOpenedScreens(),e.selectedScreen=t.getSelectedScreen(),e.layoutSizes=r.getConfig(),e.$on(e.EVENT_SCREEN_SELECTED,()=>{console.log("header: On EVENT_SCREEN_SELECTED"),e.selectedScreen=t.getSelectedScreen()}),e.$on(e.EVENT_SCREEN_CLOSED,()=>{console.log("header: On EVENT_SCREEN_CLOSED"),e.selectedScreen=t.getSelectedScreen()}),e.$on("ui.layout.resize",(t,n,r)=>{let o=n.id?n:r;e.layoutSizes[o.id]=o.size}),e.closeScreen=function(e){t.closeScreen(e.id)},e.selectScreen=function(e){t.getSelectedScreen().id!==e.id&&t.selectScreen(e.id),n.selectComponentById(null)},e.stickScreen=function(e){t.stickScreen(e.id)}}]),angular.module("studio").controller("ViewerCanvasHolderCtrl",["$rootScope","$scope","$sce","screenService","layoutService","canvas",function(e,t,n,r,o,i){function s(){let t=`/canvas/${e.app.previewToken}-${e.app.id}-${e.user.id}/index.html`;return n.trustAsResourceUrl(t)}t.$on(t.EVENT_SCREEN_SELECTED,()=>{console.log("canvasHolder: On EVENT_SCREEN_SELECTED"),t.selectedScreen=r.getSelectedScreen()}),t.$on(t.EVENT_APP_OPENED,()=>{console.log("canvasHolder: on EVENT_APP_OPENED"),function(){let e=document.querySelector("#iframe");t.canvasUrl=s(),e.setAttribute("src",t.canvasUrl)}()}),t.$on("ui.layout.resize",(e,t,n)=>{let r=t.id&&"central"!==t.id?t:n;o.updateConfig(r)}),t.$on("ui.layout.startresize",()=>{document.querySelector("#layout-resize-overlay").classList.add("layout-resize-overlay")}),t.$on("ui.layout.endresize",()=>{document.querySelector("#layout-resize-overlay").classList.remove("layout-resize-overlay"),i.resize()}),t.clickOutsideCanvas=function(){i.selectComponentById(null)},t.checkScreensOpened=function(){return r.hasOpenedScreens()},t.canvasUrl=s()}]),angular.module("studio").controller("ViewerSidebarCtrl",["$scope","apiService","dialogService",function(e,t,n){e.screens=function(){e.globals.activePane="screens"},e.viewSettings=function(){n.viewAppSettings()},e.viewRevisionHistory=function(){n.viewRevisionHistory()}}]),angular.module("studio").controller("ViewerRightPaneCtrl",["$scope","layoutService",function(e,t){e.ui={activeTab:"models"},e.$on(e.EVENT_SCREEN_SELECTED,(t,n)=>{console.log("rightPane: On EVENT_SCREEN_SELECTED"),e.selectedScreenId=n}),e.$on("ui.layout.resize",(e,n,r)=>{let o="central"===n.id?r:n;t.updateConfig(o)})}]),angular.module("studio").controller("ViewerBottomPaneCtrl",["$timeout","$scope","$rootScope","screenService","helperService",function(e,t,n,r,o){function i(){t.selectedScreen=r.getSelectedScreen(),t.selectedScreen.activeTab||(t.selectedScreen.activeTab="template-"+t.selectedScreen.id)}function s(){let e=r.getSelectedScreen();t.sources[e.id]={html:o.prettyHTML(e.dom.html()),ts:e.views[e.selectedView].ts,scss:e.views[e.selectedView].scss}}t.$on(t.EVENT_SCREEN_SELECTED,()=>{console.log("bottomPane: On EVENT_SCREEN_SELECTED"),i()}),t.$on(t.EVENT_VIEW_SELECTED,()=>{console.log("bottomPane: On EVENT_VIEW_SELECTED"),s()}),t.$on(t.EVENT_COMPONENT_CHANGED,()=>{console.log("bottomPane: On EVENT_COMPONENT_CHANGED"),s()}),t.sources={},i(),s(),t.shouldShowTab=function(e){let t=r.getSelectedScreen();return t&&t.id===e},t.editorLoaded=function(o){return o.unwatchers={},!(["editor-view","editor-ctrl","editor-appHooks","editor-scss"].indexOf(o.domElement.id)<0)&&(o.unwatchers.activeTab=t.$watch("selectedScreen.activeTab",()=>(function(n){n.layout(),e(()=>{let e=n.domElement.getAttribute("data-screen-id");t.selectedScreen.id===e&&n.domElement.getClientRects().length&&(console.log("editor ["+e+": "+n.domElement.id+"]: focus"),n.focus())},!0)})(o)),o.unwatchers.screenClosed=t.$on(t.EVENT_SCREEN_CLOSED,(e,i)=>{!function(e,o){let i=e.domElement.getAttribute("data-screen-id");if(i!==o)return!1;console.log("editor ["+i+": "+e.domElement.id+"]: cleanup"),_.each(e.unwatchers,e=>e()),delete e.unwatchers,e.getModel()&&e.getModel().dispose(),e.dispose(),e.destroy(),delete t.sources[i],r.hasOpenedScreens()||(n.globals.viewSource=!1)}(o,i)}),"editor-view"===o.domElement.id&&void(o.unwatchers.componentSelected=t.$on(t.EVENT_COMPONENT_SELECTED,(e,n)=>{!function(e,n){let r=e.domElement.getAttribute("data-screen-id");if(t.selectedScreen.id===r||e.domElement.getClientRects().length){let t=e.getModel();if(!t)return;let r=new RegExp('data-comp-id="'+n),o=t.findMatches(r,!1,!0,!1,!1);if(_.isEmpty(o))return;let i=o[0];e.setSelection(i),e.revealLineInCenter(i.startLineNumber)}}(o,n)})))}}]),angular.module("studio").controller("ViewerLeftPaneScreensCtrl",["$scope","$rootScope","$timeout","screenService","screenModelService","workspaceService","canvas",function(e,t,n,r,o,i,s){function a(){return r.refreshTree().then(t=>(r.closeAllScreens(),e.rootScreen=t,e.screens=t.screens,r.restoreScreens()))}e.search={},e.showSearch=!1,e.canvasReady=!1,e.$on(e.EVENT_CANVAS_READY,()=>{console.log("leftPane/screens: On EVENT_CANVAS_READY"),s.$init(document.querySelector("#iframe").contentWindow),s.refreshCss().then(o.refresh).then(a).then(()=>(function(){n(e.hideLoading,!0),e.canvasReady=!0}))}),e.$on(e.EVENT_VIEW_SELECTED,()=>{console.log("leftPane/screens: On EVENT_VIEW_SELECTED");let e=r.getSelectedScreen();e.selectedView!==t.app.defaultLayout&&(e.expanded=!0)}),n(function(){!1===e.canvasReady&&n(e.hideLoading,!0)},1e4),e.toggleSearch=function(){e.showSearch=!e.showSearch,e.showSearch||(e.search.name="")},e.treeOptions={onDblClick:function(e){e.folder?e.expanded=!e.expanded:e.view?(r.selectScreen(e.screen.id),r.stickScreen(e.screen.id),r.selectView(e.id)):r.stickScreen(e.id)},onClick:function(e){if(e.folder)return!1;if(e.view){(r.isOpenedScreen(e.screen.id)?Promise.resolve():i.openScreen(e.screen.id)).then(()=>{r.selectScreen(e.screen.id),r.selectView(e.id)})}else i.openScreen(e.id)},getChildren:function(e){return e.folder?e.screens:1===_.keys(e.views).length?null:e.views},isHidden:function(e){return!0===e.view&&e.id===t.app.defaultLayout},isSelected:function(e){let n=r.getSelectedScreen();return n&&(n===e&&n.selectedView===t.app.defaultLayout||n===e.screen&&n.selectedView===e.id)},isClickable:function(){return!0},getType:function(){return"screen"}}}]),angular.module("studio").controller("ViewerRightPaneScreenModelsCtrl",["$scope","$rootScope","$timeout","screenService","dataService","apiService","screenModelService","dialogService",function(e,t,n,r,o,i,s,a){function l(){let t=r.getSelectedScreen();e.screenModel=t?s.getSelectedScreenModel():null}e.$on(e.EVENT_SCREEN_SELECTED,()=>{console.log("rightPane/screenModel: On EVENT_SCREEN_SELECTED"),l()}),e.$on(e.EVENT_SCREEN_CLOSED,()=>{console.log("rightPane/screenModel: On EVENT_SCREEN_CLOSED"),l()}),e.viewSourceScreenModels=function(){a.viewSourceScreenModels(e.screenModel)},l()}]),angular.module("studio").controller("ViewerRightPaneOutlineCtrl",["$scope","$rootScope","$timeout","screenService","workspaceService","canvas",function(e,t,n,r,o,i){function s(){r.getSelectedScreen()?(e.components=o.getComponentsTree(),a=o.getComponentsMap(e.components)):e.components=[],o.showSelectedComponent(a,e.selectedComponentId)}e.components=[],e.selectedComponentId=null;let a={};s(),e.treeOptions={onClick:function(t){e.selectedComponentId=t.id,i.selectComponentById(t.id)},isSelected:function(t){return t.id===e.selectedComponentId}},e.$on(e.EVENT_VIEW_SELECTED,function(){console.log("outline: On EVENT_VIEW_SELECTED"),s()}),e.$on(e.EVENT_SCREEN_CLOSED,function(){console.log("outline: On EVENT_SCREEN_CLOSED"),s()}),e.$on(e.EVENT_COMPONENT_SELECTED,function(t,n){console.log("outline: On EVENT_COMPONENT_SELECTED"),e.selectedComponentId=n,o.showSelectedComponent(a,n)})}]),angular.module("studio").controller("ViewerRightPanePropertySheetCtrl",["$scope","$timeout","screenService","componentService","propertyService",function(e,t,n,r,o){function i(){let t=n.getSelectedScreen();t&&(e.selectedScreenId=t.id,e.selectedComponentId=t.selectedComponentId,e.component=r.getComponentFromId(e.selectedComponentId),function(){let t=[],i={};if(e.component&&e.component.properties){e.groups=r.getPropertyGroups(),e.propertyDefinitions=r.getPropertyDefinitions();for(let r=0;r<e.component.properties.length;r++){let s=e.component.properties[r],a=i[s.group];0===a||a||(a=t.length,i[s.group]=a,t[a]={label:e.groups[s.group].label,properties:[]});let l=n.getSelectedScreen(),c="[data-comp-id='"+e.selectedComponentId+"']",d=l.dom(c),u=e.propertyDefinitions[s.property],p={id:s.property,label:s.label,type:u.type,selector:s.selector,attribute:u.attribute,attributeType:u.attributeType,criteria:s.criteria,element:d,funcs:u.funcs,isAttribute:u.isAttribute,cssAttribute:u.cssAttribute,style:u.style};"singleSelect"===u.type?p.options=u.options:"checkbox"===u.type&&(p.attributeValue=u.value,u.valueIfFalse&&(p.valueIfFalse=u.valueIfFalse)),"color"===u.type&&(p.options=u.options),o.getPropertyValue(p),"color"===p.type&&(""===p.value&&(p.value=null),p.originalValue=p.value),t[a].properties.push(p)}}e.propertyGroups=t}())}e.$on(e.EVENT_COMPONENT_SELECTED,(e,t)=>{console.log("propertySheet: On EVENT_COMPONENT_SELECTED ("+t+")"),i()}),e.$on(e.EVENT_SCREEN_CLOSED,()=>{console.log("propertySheet: On EVENT_SCREEN_CLOSED"),delete e.selectedScreenId,delete e.selectedComponentId,delete e.component,delete e.propertyGroups,delete e.groups,delete e.propertyDefinitions}),e.isPropertyValueText=function(e){return~["icon","image","repeat","action","data"].indexOf(e)},e.isShown=(e=>{if(e.invalid||"hidden"===e.type)return!1;if(e.criteria){let t,n=e.criteria.selector,r=new RegExp(e.criteria.match,"i"),o="."===n?e.element:e.element.find(n);if(0===o.length)return!1;if("tag"===e.criteria.type?t=o.get(0).name:"attribute"==e.criteria.type?t=o.attr(e.criteria.attribute):"class"==e.criteria.type&&(t=o.attr("class")),void 0===t||!r.test(t))return!1}return!0}),i()}]),angular.module("studio").controller("DataBindingCtrl",["$scope","$rootScope","$timeout","screenService","dataService","dialogService","screenModelService","workspaceService","canvas","sharedModelService",function(e,t,n,r,o,i,s,a,l,c){function d(n){g.onSelected(n).finally(()=>{e.closeThisDialog(),t.hideLoading()})}function u(t){if(h=s.getSelectedScreenModel()){let n=t||g.treeRoot;n.indexOf("|")>=0&&(n=n.substring(0,n.indexOf("|")));let i=r.getSelectedScreen().id.split("_");if(i.length>2){let e=new RegExp(i.pop()+"_");n=n.replace(e,"")}n&&(n=h.id+"."+n),e.dataTreeTitle=h.id,!0===g.ngRepeat?e.propertiesTree=o.getDataForRepeat(h,n):e.propertiesTree=o.getDataForBinding(h,g.filter,n)}else e.propertiesTree=[];p()}function p(){e.propertiesTree&&(o.collapseTree(e.propertiesTree),o.expandBranch(e.propertiesTree,e.model.selectedValue))}function f(){if(!(m=function(){if(!e.model.selectedValue||!h)return;let t=o.getPropertyByBinding(e.propertiesTree,e.model.selectedValue);return angular.copy(t)}()))return;let t=o.getActionPaths(h);e.updateFieldTree[1].children=[],t.forEach(t=>{e.updateFieldTree[1].children.push({label:t,type:"checkbox",name:t})}),m.update?"action"===m.update.type?(e.model.updateField={eventType:{value:2}},m.update.action.forEach(t=>{e.model.updateField.eventType[t]={},e.model.updateField.eventType[t].value=!0})):"change"===m.update.type?e.model.updateField={eventType:{value:3,dynamic:{value:m.update.dynamic,timeout:{value:m.update.timeout}}}}:"none"===m.update.type&&(e.model.updateField={eventType:{value:4}}):(e.model.updateField={eventType:{value:1}},(g.ngRepeat||"array"===m.type||["text","div","nav-title"].indexOf(g.componentType)>-1)&&(e.model.updateField={eventType:{value:4}}))}e.$on(e.EVENT_UPDATED_SCREEN_MODELS,()=>{console.log("dataBinding dialog: On EVENT_UPDATED_SCREEN_MODELS"),a.isComponentExists(g.componentId)?l.selectComponentById(g.componentId).then(()=>{n(()=>{let t=a.getComponentsMap();u(a.getRepeatedPropertyId(t,g.componentId)),h=s.getSelectedScreenModel(),e.model.selectedValue=a.getPropertyValue(g.componentId,g.propertyId),f(),p()},!0)},!0):e.closeThisDialog()});let h,m,g=e.ngDialogData,v=!1;e.model={selectedValue:g.selectedValue,updateField:{}},u(),e.propertiesTreeOptions={isSelected:t=>t.binding===e.model.selectedValue,onClick:t=>{v=!1,e.model.selectedValue=t.binding,f()},onDblClick:t=>{e.propertiesTreeOptions.onClick(t),e.save()}},e.variables=g.controllerVariables,e.showPowwowChange=function(){return["ngModel","ngRepeat"].includes(g.propertyId)},e.onVariableClick=function(t){return v=!0,e.model.selectedValue=t},e.onVariableDblClick=function(t){e.onVariableClick(t),e.save()},e.save=function(){t.showLoading();let n={};if(n.binding=e.model.selectedValue,v)return void d(n);let r={modelId:m.root.id};_.extend(r,_.pick(m,"path","update")),function(e){let t=s.getModels();return _.pluck(t,"id").indexOf(e.root.id)>-1?s:c}(m).setUpdatingProperty(r),function(e){m.update&&"change"===m.update.type&&(e.change=_.pick(m.update,"dynamic","timeout","field"),!1===e.change.dynamic&&m.fieldBinding&&(e.indices=m.fieldBinding.indices))}(n),d(n)},e.isValid=function(){let t=!angular.equals(e.model.updateField,{eventType:{value:2}}),n=e.model.selectedValue&&m&&"object"!==m.type;return!!v||n&&t},e.mockData=function(){let t;if(g.treeRoot){let e=g.treeRoot;e.indexOf("|")>=0&&(e=e.substring(0,e.indexOf("|"))),t=e}else t=(t=e.model.selectedValue.replace(/(.*)data\./,"")).replace("let item of ","").replace(".options","");i.editMockData(t,t).then(()=>{e.isValid()&&e.save()})},e.isMockAllowed=function(){return/data|item\./.test(e.model.selectedValue)},e.editScreenModels=function(){return i.editScreenModels(h)},e.updateFieldTree=[{label:"Any action is clicked",type:"radio",name:"eventType",value:1},{label:"A Specific action is clicked",type:"radio",collapsible:!0,name:"eventType",value:2,children:[]},{label:"It's value changes",type:"radio",collapsible:!0,name:"eventType",value:3,children:[{label:"Another field is affected",type:"checkbox",name:"dynamic",children:[{type:"html",name:"timeout",defaultInputValue:5e3,modelForEmpty:!0,template:'<li class="block padding-left">Stop looking for changes after: <input class="short-input" type="number"ng-model="treeItem.model.value" ng-change="onChange(treeItem)"ng-value="treeItem.value"> ms</li>'}]}]},{label:"Don't send",type:"radio",name:"eventType",value:4}],e.isShownFieldTree=function(){return!!m&&!v},f(),e.$watch("model.updateField",e=>{!function(e){if(m)switch(e.eventType.value){case 1:delete m.update;break;case 2:m.update={},m.update.type="action",m.update.action=_.without(Object.keys(e.eventType),"value");break;case 3:if(m.update={},m.update.type="change",e.eventType.dynamic&&e.eventType.dynamic.value){m.update.dynamic=!0;let t=e.eventType.dynamic.timeout.value;t&&(m.update.timeout=t)}else m.update.dynamic=!1;m.fieldBinding?m.update.field=m.fieldBinding.path:m.update.field=m.realPath;break;case 4:m.update={},m.update.type="none"}}(e)},!0)}]),angular.module("studio").controller("MethodBindingCtrl",["$scope","screenService","dataService","helperService","screenTreeService","screenModelService","appService",function(e,t,n,r,o,i,s){function a(t){if(_.isEmpty(t)||!e.isSelectedValueAction())return;let n,r=e.model.isAuthRequest?"authaction(":"action(",o=e.model.selectedValue.split("(")[1].split(")")[0].split(","),i=o.slice(-1)[0];try{n=parseInt(i)}catch(e){}(n||0===n)&&o.pop();r=c(o,r,t.action.value?", "+(t.action.timeout.value||0)+")":")"),e.model.selectedValue=r}function l(t){if(!e.isSelectedValueRelatedScreen())return;let n="relatedScreen(",r=e.model.selectedValue.split("(")[1].split(")")[0].split(",");r.length>1&&r.pop();n=c(r,n,t?", true)":")"),e.model.selectedValue=n}function c(e,t,n){let r=t;return e.forEach((t,o)=>{r+=t.replace(/\s/g,""),r=o!==e.length-1?r+", ":r+n}),r}const d=e.ngDialogData;let u=r.startsWith(d.selectedValue,"authaction")||r.startsWith(d.selectedValue,"authmethod"),p=s.getOpenedApp();e.model={selectedValue:d.selectedValue||"",actionTimeout:{},refreshModel:!1,isAuthRequest:u};let f=i.getSelectedScreenModel();e.selectedScreenModel=f,e.methodsTree=f?n.getActionsForBinding(f):[],e.methodsTreeOptions={isClickable:e=>"method"===e.type||"action"===e.type,isSelected:t=>{let n=e.model.selectedValue.replace("authmethod","method").replace("authaction","action");return"action"===t.type?r.startsWith(n,t.binding.split(")")[0]):t.binding===n},onClick:t=>e.model.selectedValue=t.binding,onDblClick:t=>{e.methodsTreeOptions.onClick(t),e.save()}},e.actionTimeoutTree=[{label:"Action timeout",type:"checkbox",name:"action",modelForEmpty:!0,children:[{type:"html",name:"timeout",template:'<li class="block padding-left"><input class="short-input" type="number"ng-model="treeItem.model.value"ng-change="onChange(treeItem)"ng-value="treeItem.value"> ms</li>'}]}],e.isSelectedValueAction=(()=>r.startsWith(e.model.selectedValue,"action")||r.startsWith(e.model.selectedValue,"authaction")),e.isSelectedValueMethod=(()=>r.startsWith(e.model.selectedValue,"method")||r.startsWith(e.model.selectedValue,"authmethod")),function(t){if(!t||!e.isSelectedValueAction())return;let n,r=t.split("(")[1].split(")")[0].split(",").slice(-1)[0];try{n=parseInt(r)}catch(e){}e.model.actionTimeout=n||0===n?{action:{value:!0,timeout:{value:n}}}:{action:{value:!1}}}(e.model.selectedValue),e.$watch("model.actionTimeout",e=>{a(e)},!0),e.$watch("model.isAuthRequest",function(t){!function(t){e.model.isAuthRequest=t,0==e.model.selectedValue.indexOf("auth")&&(e.model.selectedValue=e.model.selectedValue.replace("auth","")),e.isSelectedValueAction()?e.model.selectedValue=t?e.model.selectedValue.replace("action(","authaction("):e.model.selectedValue.replace("authaction(","action("):e.isSelectedValueMethod()&&(e.model.selectedValue=t?e.model.selectedValue.replace("method(","authmethod("):e.model.selectedValue.replace("authmethod(","method("))}(t)},!0),e.otherActions=[],p.disableSideMenu||e.otherActions.push({binding:"showMenu()",name:"Toggle menu",id:"Toggle menu",type:"action"}),e.otherActionsOptions={isClickable:e=>"method"===e.type||"action"===e.type,isSelected:t=>t.binding===e.model.selectedValue,onClick:t=>e.model.selectedValue=t.binding,onDblClick:t=>{e.otherActionsOptions.onClick(t),e.save()}},e.relatedScreens=f?n.getRelatedScreensForBinding(f.id):[],e.relatedScreensTreeOptions={isSelected:t=>r.startsWith(e.model.selectedValue,t.binding.split(")")[0]),onClick:t=>e.model.selectedValue=t.binding,onDblClick:t=>{e.relatedScreensTreeOptions.onClick(t),e.save()}},e.isSelectedValueRelatedScreen=(()=>r.startsWith(e.model.selectedValue,"relatedScreen")),function(t){if(!t||!e.isSelectedValueRelatedScreen())return;let n=t.split("(")[1].split(")")[0].split(","),r=!1;n[1]&&(r=n[1].replace(/\s/g,"")),e.model.refreshModel="true"===r}(e.model.selectedValue),e.$watch("model.refreshModel",e=>{l(e)},!0),e.screens=o.getCachedTree().screens,e.screensTreeOptions={isHidden:e=>e.system,isSelected:t=>t.binding===e.model.selectedValue,isClickable:e=>!e.folder,onClick:t=>e.model.selectedValue=t.binding,onDblClick:t=>{e.screensTreeOptions.onClick(t),e.save()}},e.methods=d.controllerMethods,e.onMethodClick=(t=>e.model.selectedValue=t),e.onMethodDblClick=(t=>{e.onMethodClick(t),e.save()}),e.save=(()=>{a(e.model.actionTimeout),l(e.model.refreshModel),d.onSelected(e.model.selectedValue),e.closeThisDialog()}),r.startsWith(e.model.selectedValue,"openUrl")?e.active=2:e.active=1,e.notValidSave=(()=>{switch(e.active){case 1:return!e.model.selectedValue||r.startsWith(e.model.selectedValue,"openUrl");case 2:return!r.startsWith(e.model.selectedValue,"openUrl");case 3:return!1}})}]),angular.module("studio").controller("ActionStringBindingCtrl",["$scope","screenService","dataService","helperService","screenTreeService","screenModelService","appService",function(e,t,n,r,o,i,s){const a=e.ngDialogData;s.getOpenedApp();e.model={selectedValue:a.selectedValue||""};let l=i.getSelectedScreenModel();e.selectedScreenModel=l,e.methodsTree=l?n.getActionsForBinding(l):[],e.methodsTreeOptions={isClickable:e=>"method"===e.type||"action"===e.type,isSelected:t=>{let n=e.model.selectedValue.replace("authmethod","method").replace("authaction","action");return"action"===t.type?r.startsWith(n,t.binding.split(")")[0]):t.binding===n},onClick:t=>e.model.selectedValue=t.binding,onDblClick:t=>{e.methodsTreeOptions.onClick(t),e.save()}},e.save=(()=>{e.model.selectedValue=function(e){return e.match(/'(.*?)'/)[1]}(e.model.selectedValue),a.onSelected(e.model.selectedValue),e.closeThisDialog()}),r.startsWith(e.model.selectedValue,"openUrl")?e.active=2:e.active=1,e.notValidSave=(()=>{switch(e.active){case 1:return!e.model.selectedValue||r.startsWith(e.model.selectedValue,"openUrl");case 2:return!r.startsWith(e.model.selectedValue,"openUrl");case 3:return!1}})}]),angular.module("studio").controller("ProjectFormCtrl",["$rootScope","$scope","appService","templateService","screenService","clientVersionsService","apiService","$state","config","hotkeys","dialogService","helperService","uiUploader","$timeout","$window",function(e,t,n,r,o,i,s,a,l,c,d,u,p,f,h){function m(e){t.submitted=!0,t.showLoading();let r=t.getSelectedSdksArray();_.isEqual(t.initialSelectedSdksArray,r)||(e.sdks=r),n.updateApp(e).then(()=>{t.closeThisDialog(),t.hideLoading(),a.reload()})}t.hideLoading(),t.activeTab="settings",t.isEditing=!!t.ngDialogData.data,t.fromExisting=t.ngDialogData.id,t.withRepo=!!t.ngDialogData.withRepo,t.getDialogTitle=(()=>t.isEditing?"App Settings":t.withRepo?"New App with Repository":"New Application"),t.serverUrl=l.serverUrl,t.showAll=!1,t.refreshSdksList=function(e){t.sdks=[],t.selectedSdksModel=[],t.sdkList=[],s.cordova.getSDKs({appId:e}).then(e=>{t.sdkList=e;let n=0;_.each(e,e=>{e.selected&&(t.selectedSdksModel[n]=[],t.selectedSdksModel[n]=e,t.sdks.push(e),n++)}),t.sdks.length?t.disableSelectedSdks():t.sdks=[{}],t.initialSelectedSdksArray=_.clone(t.getSelectedSdksArray())})},t.disableSelectedSdks=function(){let e=t.getSelectedSdksArray().map(e=>e.id);_.each(t.sdkList,t=>t.disabled=_.indexOf(e,t.id)>-1)},t.getSelectedSdksArray=function(){return t.selectedSdksModel.map(e=>{let t={id:e.id};return e.options&&(t.options=function(e){let t={};return _.each(e,(e,n)=>{t[n]=e.value,e.required&&void 0===e.value&&void 0!==e.defaultValue&&(t[n]=e.defaultValue)}),t}(e.options)),t})},t.versions=i.filterVersions(t.ngDialogData.versions),t.isEditing?(t.model=_.pick(t.ngDialogData.data,"name","description","isVersioned","defaultLayout","clientVersion","creatorName","iconUrl","disableSideMenu"),t.model.startScreenId=o.getStartScreen()?o.getStartScreen().id:null,t.model.studioDisplay=function(e){return e?e.startsWith("/previews")?{mode:"screen",screenId:function(e){let t=e.split("/"),n=t.splice(3,t.length-3),r=n.pop().split(".");return r.pop(),[...n,...r].join("_")}(e)}:{mode:"file",iconUrl:e}:{mode:"file"}}(t.model.iconUrl),t.model.studioDisplay.iconUrl&&(t.model.studioDisplay.iconUrl=t.model.studioDisplay.iconUrl+"?"+Date.now()),t.getQueryParams="&appId="+e.app.id+"&userId="+e.user.id+"&previewToken="+e.app.previewToken,t.postQueryParams="?appId="+e.app.id+"&token="+localStorage.getItem("accessToken")+"&wsConnectionId="+e.wsConnectionId,t.screens=o.getListForChoosing(),t.screens.unshift({id:null,name:"No Screen Selected"}),t.showAll?t.versions=t.ngDialogData.versions:t.versions=i.filterVersions(t.ngDialogData.versions,{currentVersion:t.model.clientVersion}),t.refreshSdksList(e.app.id)):(t.model={name:"",description:"",isVersioned:t.withRepo,defaultLayout:"PhonePortrait",clientVersion:t.versions[0],sourceAppId:"_blank",directory:t.env.appsDirs[0],disableSideMenu:!1},t.fromExisting&&(t.model.id=t.ngDialogData.id,t.model.name=t.ngDialogData.id,t.refreshSdksList(t.ngDialogData.id)),t.refreshSdksList(t.model.sourceAppId),r.getAppTemplates().then(e=>t.templates=e)),t.isEditing&&n.getBuildAssets().then(e=>{t.model.mobileIcon=e.mobileAppIcon,t.model.ssImage=e.mobileSSImage,t.model.mobileIconUrl=e.mobileAppIcon?"/assets/buildAssets/"+e.mobileAppIcon+"?"+Date.now():"",t.model.mobileSSImageUrl=e.mobileSSImage?"/assets/buildAssets/"+e.mobileSSImage+"?"+Date.now():"",t.model.mobileAppName=e.name}),t.create=function(){t.submitted=!0,t.showLoading(),t.selectedSdksModel.length>0&&(t.model.sdks=t.getSelectedSdksArray()),n.createApp(t.model).then(e=>{t.closeThisDialog(),t.hideLoading(),a.go("editor",{appId:e})})},t.save=function(){let n=function(){let n=_.pick(t.model,"description","isVersioned","defaultLayout","startScreenId","clientVersion","mobileAppName","mobileIcon","ssImage","disableSideMenu");n.appId=t.ngDialogData.data.id;let r=t.model.studioDisplay;return"screen"===r.mode&&r.screenId?n.iconUrl="/previews/"+e.app.previewToken+"-"+e.app.id+"/"+function(e){return(e||"").replace(/_/g,"/")}(r.screenId)+".png":r.iconUrl&&(n.iconUrl=r.iconUrl),t.model.name!==e.app.name&&(n.name=t.model.name,n.oldName=e.app.name),n}();o.hasDirtyScreens()?d.saveConfirm().then(()=>{e.showLoading(),o.saveAllScreens().then(()=>m(n))}).catch(()=>{o.closeAllScreens(),m(n)}):m(n)},t.delete=function(){d.confirm("Confirm App Delete",l.messages.appDelete,{name:_.escape(t.app.name)},!0).then(()=>(t.closeThisDialog(),o.closeAllScreens(),n.deleteApp(t.ngDialogData.data.id))).then(()=>window.location=t.getLink("applications"))},t.cancel=function(){t.closeThisDialog(),t.withRepo&&n.deleteApp(t.model.id)},t.isValid=function(){let e=t.model.name.trim(),n=!!e,r=-1===e.indexOf('"'),o=e.search(/\w/)>=0;return n&&r&&o},t.export=function(){let t=localStorage.getItem("accessToken"),n=`${l.serverUrl}/zip?appId=${e.app.id}&token=${t}`;h.open(n,"_blank")};let g;t.fileChanged=((e,n)=>{!function(e){return~["image/png","image/gif","image/jpeg","image/svg+xml","image/webp"].indexOf(e)}(e.files[0].type)?(d.error("Uploading error",l.messages.incorrectFileType),e.value=null):(g=e.files[0],p.addFiles(e.files),p.startUpload({url:t.serverUrl+"/image"+t.postQueryParams,data:{imagePath:n},options:{withCredentials:!0},onProgress:_.noop,onCompleted:(e,r,o)=>{!function(e){f(()=>{switch(e){case"icon":return t.model.studioDisplay.iconUrl=`/assets/icon/${g.name}?`+Date.now();case"mobileIcon":return t.model.mobileIconUrl=`/assets/buildAssets/${g.name}?`+ +Date.now();case"ssImage":return t.model.mobileSSImageUrl=`/assets/buildAssets/${g.name}?`+Date.now()}})}(n)},onCompletedAll:_.noop}),t.$apply(),e.value=null,"mobileIcon"===n?t.model.mobileIcon=g.name:"ssImage"===n&&(t.model.ssImage=g.name))}),c.bindTo(t).add({combo:"enter",allowIn:["INPUT"],description:"Submit the form",callback:e=>{e.preventDefault(),t.isValid()&&(t.isEditing?t.save():t.create())}})}]),angular.module("studio").controller("ViewAppSettingsCtrl",["$rootScope","$scope","apiService","appService","templateService","screenService","$state","config","helperService",function(e,t,n,r,o,i,s,a,l){t.hideLoading(),t.layouts=a.layouts,t.versions=t.ngDialogData.versions,t.model=_.pick(t.ngDialogData.data,"name","description","isVersioned","defaultLayout","clientVersion","creatorName"),t.getLayoutClass=(e=>l.toKebabCase(e))}]),angular.module("studio").controller("PreviewCtrl",["$scope","$rootScope","$state","screenService","dialogService","$location","config","previewService","settingsService","runServerService","runServerWsService",function(e,t,n,r,o,i,s,a,l,c,d){e.$watch("model",function(){let t="",n=r.getStartScreen();(!n||e.model.startScreenId&&e.model.startScreenId!==n.id)&&(t=e.model.startScreenId),e.previewUrl=a.generateUrl(p,{device:e.model.activeDevice,isMock:e.model.mock,rpcUrl:e.model.rpcUrl,screen:t,fromUsersDir:e.model.fromUsersDir}),e.devicePreviewUrl=a.generateUrl(p,{isMock:e.model.mock,rpcUrl:e.model.rpcUrl,screen:t,fromDevice:!0}),e.appUrl=a.generateUrl(p,{isMock:e.model.mock,rpcUrl:e.model.rpcUrl,screen:t}),l.detect(p,{preview:{mock:e.model.mock,device:e.model.activeDevice.id,landscapeMode:e.model.landscapeMode,rpcUrl:e.model.rpcUrl}})},!0),e.$watch("model.activeDevice",function(){console.log("preview: Changed model.activeDevice ("+e.model.activeDevice+")"),a.resizeDevice()}),e.$watch("model.landscapeMode",function(){console.log("preview: Changed model.landscapeMode ("+e.model.landscapeMode+")"),a.resizeDevice()});const u=_.debounce(()=>{let e=document.getElementById("runServerOutput");e&&(e.scrollTop=e.scrollHeight)},300);e.$watch("model.runServer.output",u),e.serverRunning=!1,e.startServer=function(){c.start(p.id).then(function(t){t.appId=p.id,e.model.runServer.output="",e.serverRunning=!0,e.runServerKey=t.key;let n=d.connect(t,{wsConnectionId:!0});n.onmessage=function(n){switch(n.method){case"logMessage":e.model.runServer.output+=n.params.msg;break;case"port":e.model.rpcUrl=d.wsUrl(t);break;case"debug":document.cookie=d.wsCookie(t);let r=d.wsDebuggerUrl(t,{runServerType:"debug"});e.debugUrl="chrome-devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&"+r;break;case"sourceApp":document.cookie=d.wsCookie(t);let o="/connections/"+t.appId+"/sourceApp/"+t.key+"/"+localStorage.getItem("accessToken");e.sourceAppUrl=s.serverUrl+o+"/?sourceapp="+o+"/inspector"}e.$apply()},n.onclose=function(){e.serverRunning=!1,e.debugUrl=null,e.sourceAppUrl=null,e.$apply()}})},e.copyLink=function(e){let t=e.target.dataset.copytarget,n=t?document.querySelector(t):null;if(n&&n.select){n.select();try{document.execCommand("copy"),n.blur()}catch(e){alert("please press Ctrl/Cmd+C to copy")}}},e.stopServer=function(){c.stop(p.id,e.runServerKey),e.runServerKey=null},e.devices=_.clone(s.devices),e.screens=r.getListForChoosing(),e.defaultScreen=r.getStartScreen();let p=e.ngDialogData.app;if(e.defaultScreen)_.findWhere(e.screens,{id:e.defaultScreen.id}).name="Application Default";else{for(let t=0;t<e.screens.length;t++)if(!e.screens[t].folder){e.defaultScreen=e.screens[t];break}p.isTemplate||o.alert("Warning!",s.messages.noStartScreenChose)}e.ngDialogData.screen&&(e.defaultScreen=e.ngDialogData.screen);let f=l.detect(p),h=_.findWhere(s.devices,{id:f.preview.device});e.model={mock:f.preview.mock,activeDevice:h||s.devices[0],landscapeMode:f.preview.landscapeMode,rpcUrl:f.preview.rpcUrl,startScreenId:e.defaultScreen?e.defaultScreen.id:null,expanded:"devices",fromUsersDir:e.ngDialogData.fromUsersDir,runServer:{output:""}}}]),angular.module("studio").controller("ImageManagerCtrl",["$scope","$rootScope","config","apiService","uiUploader","dialogService","screenService",function(e,t,n,r,o,i,s){function a(){r.images.getList({screenId:c}).then(t=>{e.imagesList=t})}function l(e){return"assets/images/"+e}let c=s.getSelectedScreen().id;e.defaultImageName="default.png",e.model={selectedValue:e.ngDialogData.selectedValue},e.getQueryParams="?appId="+e.app.id+"&userId="+e.user.id+"&previewToken="+t.app.previewToken;let d="?appId="+e.app.id+"&userId="+e.user.id+"&token="+localStorage.getItem("accessToken")+"&wsConnectionId="+t.wsConnectionId;a(),e.isSelected=(t=>e.model.selectedValue===l(t)||e.model.selectedValue==="/"+l(t)),e.getFileName=(e=>{return e.split("/").pop()}),e.selectImage=(t=>{e.model.selectedValue=l(t)}),e.selectAndSave=(t=>{e.selectImage(t),e.save()}),e.save=(()=>{e.ngDialogData.onSelected(e.model.selectedValue),e.closeThisDialog()}),e.delete=(e=>{i.confirm(null,"Do you want to delete this image?").then(()=>{r.images.deleteImage({file:e}).then(a)})}),e.fileChanged=((t,r)=>{let s="screen"===r?c:"/";!function(e){return~["image/png","image/gif","image/jpeg","image/svg+xml","image/webp"].indexOf(e)}(t.files[0].type)?(i.error("Uploading error",n.messages.incorrectFileType),t.value=null):(o.addFiles(t.files),o.startUpload({url:e.serverUrl+"/image"+d,data:{imagePath:s},options:{withCredentials:!0},onProgress:_.noop,onCompleted:(e,t,n)=>{a()},onCompletedAll:_.noop}),e.$apply(),t.value=null)})}]),angular.module("studio").controller("ManageViewsCtrl",["$rootScope","$scope","config","apiService","screenService","dialogService","helperService",function(e,t,n,r,o,i,s){t.layouts=n.layouts;let a=t.ngDialogData.screen;t.screenViews=_.keys(a.views),t.getLayoutClass=function(e){return s.toKebabCase(e)},t.createView=(e=>{t.$emit(t.EVENT_DIALOG_REQUESTED,"manage-views/create",{screen:a,formFactor:e,onCreated:(e,n)=>{a.extraViews=a.extraViews||[],a.extraViews.push(e),a.views=a.views||{},a.views[e]={},a.views[e].html=n.html,a.views[e].ts=n.ts,a.views[e].scss=n.scss,o.processViews(a),t.screenViews=_.keys(a.views)}})}),t.deleteView=(n=>{i.confirm(null,"Do you want to delete this view?").then(()=>r.screens.deleteView({id:a.id,formFactor:n})).then(()=>{o.selectView(e.app.defaultLayout);let r=a.extraViews.indexOf(n);a.extraViews.splice(r,1),delete a.views[n],t.screenViews=_.keys(a.views)})})}]),angular.module("studio").controller("ManageViewsCreateCtrl",["$scope","apiService","config",function(e,t,n){e.model={baseView:""};let r=_.filter(n.layouts,t=>-1!==_.keys(e.ngDialogData.screen.views).indexOf(t.id));r.unshift({id:"",name:"None (create empty)"}),e.views=r,e.create=(()=>{e.submitted=!0,t.screens.createView({id:e.ngDialogData.screen.id,formFactor:e.ngDialogData.formFactor,baseView:e.model.baseView}).then(t=>{e.ngDialogData.onCreated(e.ngDialogData.formFactor,t.view),e.closeThisDialog()})})}]),angular.module("studio").controller("MockDataCtrl",["$scope","$rootScope","$q","screenService","dataService","mockService","dialogService","helperService","modelTreeService","screenModelService",function(e,t,n,r,o,i,s,a,l,c){function d(e){return"array"===e.type?d(e.items):"object"===e.type?e.properties:[e]}function u(t,n){e.tabs[n]=e.tabs[n]||{},e.tabs[n].propData=i.getValueById(angular.copy(t),f),"select"!==e.propDef.type||e.tabs[n].propData?"array"!==e.propDef.type||e.tabs[n].propData?"object"!==e.propDef.type||e.tabs[n].propData||(e.tabs[n].propData={}):e.tabs[n].propData=[]:e.tabs[n].propData={options:[]},e.tabs[n].rows=function(e,t){return"select"===t.type?e.options:"array"===t.type?e:[e]}(e.tabs[n].propData,e.propDef)}e.tableTemplate="/views/studio/includes/mockDataTable.html",e.itemTemplate="/views/studio/includes/mockDataItem.html";var p=e.ngDialogData.propId,f=e.ngDialogData.dataPath,h=r.getSelectedScreen(),m=c.getSelectedScreenModel();e.dialog={},e.dialog.activeTab=e.ngDialogData.mockSet||"default",e.dialogTitle=o.getTextPathForScreenModelProp("Mock Data",f),e.propDef=l.findByPath(m,p),"select"!==e.propDef.type&&(e.cols=d(e.propDef)),0===h.mockSets.length&&h.mockSets.push("default"),e.tabs={};var g={};_.each(h.mockSets,function(e){g[e]=i.getMockData(h.id,e)}),n.all(g).then(function(e){_.each(e,u)}),e.addRow=function(t){var n={};_.each(e.cols,function(e){n[e.name]="object"===e.type?{}:""}),e.tabs[t].rows||(e.tabs[t].rows=[]),e.tabs[t].rows.push(n)},e.deleteRow=function(t,n){e.tabs[t].rows.splice(n,1)},e.editChildProp=function(t,n,r){var o=f;"array"===e.propDef.type&&(o+="."+n),o+="."+r.name,s.editMockData(r.realPath,o).then(function(t){"array"===e.propDef.type?e.tabs[t.mockSet].propData[n][r.name]=t.data:(e.tabs[t.mockSet].rows[0]||(e.tabs[t.mockSet].rows[0]={}),e.tabs[t.mockSet].rows[0][r.name]=t.data)})},e.toggleSelection=function(t,n){var r=e.tabs[t].propData;if(_.isArray(r.selected)){var o=r.selected.indexOf(n);o>-1?r.selected.splice(o,1):r.selected.push(n)}else r.selected===n?r.selected=null:r.selected=n},e.isSelected=function(t,n){var r=e.tabs[t].propData;return _.isArray(r.selected)?r.selected.indexOf(n)>-1:r.selected===n},e.save=function(){let r=[];_.each(e.tabs,(t,n)=>{let o=["array","select"].indexOf(e.propDef.type)<0?t.rows[0]:t.propData,s=i.updateMockData(m.id,n,f,o).then(()=>i.getDataFile(m.id,n).then(()=>{e.ngDialogData.onSave({mockSet:n,data:o})}));r.push(s)}),n.all(r).then(()=>{t.$broadcast(e.EVENT_UPDATED_MOCKS_TREE),e.closeThisDialog()})},e.createMockSet=function(){s.prompt("Subset Name","").then(function(t){var n=a.filterName(t);if(!n.length||h.mockSets.indexOf(n)>-1)return!1;e.showLoading(),i.addMockSet(h.id,t).then(function(t){i.getMockData(h.id,t.id).then(function(n){u(n,t.id),e.dialog.activeTab=t.id,e.hideLoading(),e.$root.$broadcast(e.EVENT_UPDATED_MOCKS_TREE)})})})},e.renameMockSet=function(t){s.prompt("Subset Name",t).then(function(n){var r=a.filterName(n);if(!r.length||h.mockSets.indexOf(r)>-1)return!1;i.renameMockSet(h.id,t,n).then(function(n){e.tabs[n.id]=e.tabs[t],delete e.tabs[t],e.dialog.activeTab=n.id,e.$root.$broadcast(e.EVENT_UPDATED_MOCKS_TREE)})})},e.deleteMockSet=function(t){s.confirm(null,"Do you want to delete it?").then(function(){i.deleteMockSet(h.id,t).then(function(){e.dialog.activeTab="default",delete e.tabs[t],e.$root.$broadcast(e.EVENT_UPDATED_MOCKS_TREE)})})}}]),angular.module("studio").controller("EditScreenModelsCtrl",["$scope","$rootScope","screenService","dataService","dialogService","batchRequest","screenModelService","workspaceService","sharedModelService","modelTreeService",function(e,t,n,r,o,i,s,a,l,c){function d(){switch(e.model.activeTab){case"screen-models":return s;case"shared-models":return l}}function u(){switch(e.model.activeTab){case"screen-models":return c.TYPE_SCREEN_MODEL;case"shared-models":return c.TYPE_SHARED_MODEL}}function p(){return e.showLoading(),i.send().then(()=>a.refreshStudio()).then(e.closeThisDialog)}let f=e.ngDialogData;e.$watch("model.selectedScreenModel",()=>{console.log("editScreenModel: Changed model.selectedScreenModel"),e.model.selectedScreenModel&&r.collapseTree(e.model.selectedScreenModel.properties),e.model.selectedSharedModel&&r.collapseTree(e.model.selectedSharedModel.properties)}),e.$on(e.EVENT_UPDATED_SCREEN_MODELS,()=>{console.log("editScreenModel: On EVENT_UPDATED_SCREEN_MODELS"),e.screenModels=s.getModels()}),e.save=function(){if(n.hasDirtyScreens()){o.saveConfirm("Unsaved screens changes","Do you want to save screens changes?").then(()=>{t.showLoading(),n.saveAllScreens().then(()=>p())}).catch(()=>{p()})}else p()},e.close=function(){i.count()>0?o.saveConfirm().then(()=>{e.save()}).catch(()=>{i.clear(),s.refresh(),e.closeThisDialog()}):e.closeThisDialog()},e.addSharedModel=(()=>{o.sharedModelForm().then(e=>l.qAddModel(e))}),e.editSharedModel=(e=>{o.sharedModelForm(e).then(e=>l.qUpdateModel(e))}),e.deleteSharedModel=(t=>{o.confirm(null,`Do you want to delete the "${t.id}" model?`).then(()=>{l.qDeleteModel(t.id),e.model.selectedSharedModel=null})}),e.addProperty=function(e){"model"===e.type&&(e=l.getById(e.model)),o.dataEntry(u(),e).then(t=>{d().qAddProperty(e,t)})},e.editProperty=function(e){o.dataEntry(u(),e.parent,e).then(t=>{d().qEditProperty(e,t)})},e.deleteProperty=function(e){o.confirm(null,"Do you really want to delete this data entry?").then(()=>{d().qDeleteProperty(e)})},e.countUnsaved=function(){return i.count()},e.model={activeTab:"screen-models",selectedScreenModel:f.selectedScreenModel,selectedSharedModel:null},e.screenModels=s.getModels(),e.sharedModels=l.getModels();let h=[{icon:"fa-pencil",title:"Modify Data Entry",action:e.editProperty},{icon:"fa-trash",title:"Delete Data Entry",action:e.deleteProperty}],m=[{icon:"fa-plus",title:"Add Child",action:e.addProperty},...h],g=[{icon:"fa-plus",title:"Add Param",action:e.addProperty},...h];e.propertiesTreeOptions={getControls:e=>"method"===e.type?g:"object"===e.type||"array"===e.type&&"object"===e.items.type||"model"===e.type?m:h}}]),angular.module("studio").controller("EditScreenModelsSharedModelCtrl",["$scope","helperService","hotkeys","sharedModelService","screenModelService",function(e,t,n,r,o){if(e.submit=function(){if(!e.isValid()||e.submitted)return!1;e.submitted=!0,e.ngDialogData.onSubmit(e.model),e.closeThisDialog()},e.isValid=function(){let n=e.ngDialogData.data||{},r=t.filterName(e.model.id),o=r.length>0,i=s.indexOf(r)<0&&l.indexOf(r)<0||r===n.id,a=t.filterName(r)===r;return o&&i&&a},n.bindTo(e).add({combo:"enter",allowIn:["INPUT"],description:"Submit the form",callback:function(t){t.preventDefault(),e.submit()}}),e.isEditing=!!e.ngDialogData.data,e.model={comment:"",id:""},e.isEditing){let t=e.ngDialogData.data;e.model.id=t.id,e.model.comment=t.comment}e.model.oldId=e.model.id;let i=r.getModels(),s=_.pluck(i,"id"),a=o.getModels(),l=_.pluck(a,"id")}]),angular.module("studio").controller("ViewScreenModelsCtrl",["$scope","screenModelService","dataService",function(e,t,n){let r=e.ngDialogData;e.$watch("model.selectedScreenModel",()=>{console.log("editScreenModel: Changed model.selectedScreenModel"),function(t){e.model.selectedScreenModel&&(e.propertiesTree={},t&&n.collapseTree(e.model.selectedScreenModel.properties),e.propertiesTree=e.model.selectedScreenModel.properties)}(!0)}),e.model={},e.screenModels=t.getModels(),r.selectedScreenModel&&(e.model.selectedScreenModel=r.selectedScreenModel)}]),angular.module("studio").controller("SaveAsScreenCtrl",["$scope","$rootScope","$q","helperService","apiService","screenService","screenTreeService","versionsService","screenModelService","dialogService","workspaceService","canvas",function(e,t,n,r,o,i,s,a,l,c,d,u){e.placeholder=i.getSelectedScreen().name,e.model={name:""},e.isValid=(()=>{let t=r.toLowerCase(e.model.name),n=!!t,o=!/^\d/.test(t),s=_.pluck(i.getListForChoosing(),"id").indexOf(t)<0;return n&&o&&s}),e.save=(()=>{let a=i.getSelectedScreen();e.submitted=!0,e.closeThisDialog(),e.showLoading();let c;i.createScreen(s.findById("__BASE__"),e.model.name,t.app.id,a.id).then(e=>(function(e,t){if(!e.isDirty)return n.resolve(t);e.views[e.selectedView].html=r.prettyHTML(e.dom.html());let i={};return _.each(e.views,e=>{i[e.id]={html:e.html,ts:e.ts,scss:e.scss}}),o.screens.updateScreen({id:t.id,views:i,appHooks:e.appHooks,updateControllers:!0})})(a,e)).then(e=>{c=e}).then(()=>l.refresh()).then(()=>{i.closeScreen(a.id)}).then(()=>u.refreshCss()).then(()=>d.openScreen(c.id)).then(t=>{i.stickScreen(t.id),e.hideLoading()})})}]),angular.module("studio").controller("SaveAsNewThemeCtrl",["$scope","$rootScope","$q","helperService","apiService","styleService","screenTreeService","versionsService","screenModelService","dialogService","workspaceService","canvas",function(e,t,n,r,o,i,s,a,l,c,d,u){e.placeholder=i.getSelectedTheme(),e.model={name:""},e.isValid=(()=>{let t=r.toLowerCase(e.model.name),n=!!t,o=!/^\d/.test(t),s=_.pluck(i.getThemes(),"label"),a=[];_.each(s,function(e){a.push(r.toLowerCase(e))});let l=/^[0-9a-zA-Z ... ]+$/.test(e.model.name),c=a.indexOf(t)<0;return n&&o&&l&&c}),e.save=(()=>{let n=i.getThemes(),r=i.getSelectedTheme(),o=_.findWhere(n,{label:r}),s=i.getThemeColors();e.submitted=!0,e.closeThisDialog(),e.showLoading(),i.createTheme({name:e.model.name,source:o.id,colors:s}).then(e=>{t.$broadcast(t.EVENT_UPDATED_THEMES,e.newTheme)})})}]),angular.module("studio").controller("CreateScreenCtrl",["$rootScope","$scope","$timeout","screenService","helperService","screenModelService","dialogService","workspaceService","sharedModelService","canvas",function(e,t,n,r,o,i,s,a,l,c){n(()=>e.hideLoading()),t.groups=t.ngDialogData.groups,t.model={name:"",selectedFolder:t.groups.templates[0],selectedScreen:{}},t.model.selectedFolder&&(t.model.selectedFolder.selected=!0),t.search={};let d=t.ngDialogData.parent.screens,u=_.pluck(d,"id"),p=l.getModels(),f=_.pluck(p,"id");t.isValid=function(){let e=o.toLowerCase(t.model.name),n=!!e,r=!/^\d/.test(e),i=t.ngDialogData.parent,s="__BASE__"===i.id?e:i.id+"_"+e,a=u.indexOf(s)<0&&f.indexOf(s)<0,l=!_.isEmpty(t.model.selectedScreen);return n&&r&&a&&l},t.save=function(){t.submitted=!0,t.showLoading(),t.closeThisDialog(),r.createScreen(t.ngDialogData.parent,t.model.name,t.model.selectedScreen.sourceAppId,t.model.selectedScreen.id).then(n=>{let r=e.$on(t.EVENT_SCREENS_RESTORED,()=>{r(),c.refreshCss().then(()=>a.openScreen(n.id)).then(t.hideLoading)});i.refresh(!0)})},t.selectScreen=function(e){function n(e,r){r=r||0,t.model.name=r?e+r:e,t.isValid()||n(e,++r)}t.model.selectedScreen=e,t.screenName.$pristine&&n(e.name)},t.treeOptions={getChildren:function(e){return e.folders},getIcon:function(){return!1},onClick:function(e){delete t.model.selectedFolder.selected,t.model.selectedFolder=e,t.model.selectedFolder.selected=!0,t.model.selectedScreen={}},isClickable:function(e){return!e.selected&&e.screens.length>0}}}]),angular.module("studio").controller("NewTemplateGroupCtrl",["$scope","$state","apiService","appService","templateService","config",function(e,t,n,r,o,i){o.fetchList().then(function(t){e.templates=t}),e.hideLoading(),e.versions=e.ngDialogData.versions,e.serverUrl=i.serverUrl,e.model={name:"",description:"",isTemplate:!0,defaultLayout:"PhonePortrait",clientVersion:e.versions[0],sourceAppId:"_blank",directory:e.env.appsDirs[0],isAppTemplate:e.ngDialogData.isAppTemplate},e.create=function(){e.showLoading(),r.createApp(e.model).then(function(n){e.closeThisDialog(),e.hideLoading(),t.go("editor",{appId:n})})},e.isValid=function(){return!!e.model.name},e.getIconUrl=function(e){return r.getIconUrl(e)}}]),angular.module("studio").controller("RevisionHistoryCtrl",["$scope","$rootScope","$state","dialogService","versionsService","screenService",function(e,t,n,r,o,i){function s(t){r.confirm(null,"Do you really want to restore this version?").then(()=>{e.showLoading(),e.closeThisDialog(),i.closeAllScreens(!0),o.resetToCommit(t).then(t=>{t.error?(e.hideLoading(),r.error("Failure",t.error)):t.mergeConflicts?e.hideLoading():n.reload()})})}e.appVersions=e.ngDialogData,e.restore=function(e){i.hasDirtyScreens()?r.saveConfirm().then(()=>{t.showLoading(),i.saveAllScreens().then(()=>{t.hideLoading(),s(e)})}).catch(()=>{s(e)}):s(e)}}]),angular.module("studio").controller("SelectScreenCtrl",["$scope","$rootScope","$timeout","screenService","endpointService",function(e,t,n,r,o){e.modelTreeOptions={isSelected:function(t){return e.selected===t.id},onClick:function(t){e.selected=t.id}},r.refreshTree().then(function(t){e.screens=t.screens,e.selected=e.ngDialogData.block.screenId}),e.save=function(){e.ngDialogData.block.screenId=e.selected,o.endpointChanged("canvas"),e.close()},e.isHidden=function(e){return"menu"===e.id},e.close=function(){e.closeThisDialog()}}]),angular.module("studio").controller("ViewRevisionHistoryCtrl",["$scope",function(e){e.appVersions=e.ngDialogData}]),angular.module("studio").controller("AppStylesCtrl",["$scope","$rootScope","$timeout","$state","screenService","apiService","canvas","styleService",function(e,t,n,r,o,i,s,a){e.selectColorForEdit=function(t,r){return n(function(){e.selectedColorName=t,e.selectedColorValue=r},!0),!1},e.onChangeColor=function(){e.selectedColorName&&(e.colors[e.selectedColorName]=e.selectedColorValue,a.updateThemeColors(e.colors))},e.isAppColors=function(t){let n=_.findWhere(e.themes,{label:t});return!n||!n.id},e.changeTheme=function(){e.colors=_.findWhere(e.themes,{label:e.selectedTheme}).colors,a.updateThemeColors(e.colors),e.selectColorForEdit("primary",e.colors.primary),a.setSelectedTheme(e.selectedTheme),e.updateSpectrum()},e.updateSpectrum=function(){e.defaultThemes.indexOf(e.selectedTheme)>-1?document.getElementById("color-picker").classList.add("spectrum-disabled"):document.getElementById("color-picker").classList.remove("spectrum-disabled")},e.save=function(){e.submitted=!0,e.showLoading();let n=_.findWhere(e.themes,{label:e.selectedTheme});t.app.theme=n.id,i.styles.setColors({colors:e.colors,theme:n.id}).then(s.refreshCss).then(()=>{t.$broadcast(t.EVENT_UPDATED_APP_COLORS),e.closeThisDialog(),e.hideLoading()})},e.saveAsNewTheme=function(){e.$emit(e.EVENT_DIALOG_REQUESTED,"save-as-new-theme")},e.deleteTheme=function(){e.showLoading(),a.deleteTheme({name:e.selectedTheme}).then(e=>{t.$broadcast(t.EVENT_UPDATED_THEMES,{id:e.theme})})},e.$on(e.EVENT_UPDATED_THEMES,(n,r)=>{console.log("On EVENT_UPDATED_THEMES"),s.refreshCss();let o=_.findWhere(e.themes,{id:r.id});o||(o=r),e.selectedTheme=o.label,t.app.theme=o.id,t.$broadcast(t.EVENT_UPDATED_APP_COLORS),e.initialize()}),e.initialize=function(){e.showLoading(),i.styles.getThemesAndColors().then(function(r){n(function(){e.colors=r.colors,e.themes=r.themes,e.defaultThemes=r.defaultThemes;let n=_.findWhere(e.themes,{id:t.app.theme});n=n||_.findWhere(e.themes,{id:null}),e.selectedTheme=n.label,a.setSelectedTheme(e.selectedTheme),a.updateThemes(e.themes),a.updateThemeColors(e.colors),e.selectedColorValue=r.colors[Object.keys(r.colors)[0]],e.selectedColorName=Object.keys(r.colors)[0],e.updateSpectrum(),e.hideLoading()},!0)})},e.initialize()}]),angular.module("studio").controller("ImportRepositoryCtrl",["$rootScope","$scope","apiService","appService","dialogService","userService","$state",function(e,t,n,r,o,i,s){t.isValid=function(){return new RegExp(/(git|ssh|http(s)?)|(git@[\w\.]+)/).test(t.model.url)&&(t.sshProtocol&&t.model.privateKey||!t.sshProtocol&&t.model.username&&t.model.password)},t.import=function(){t.submitted=!0,t.sshProtocol?(t.model.username="",t.model.password=""):t.model.privateKey="",t.showLoading(),r.importRepository(t.model).then(function(e){if(t.hideLoading(),t.closeThisDialog(),e.emptyRepo){var n="Create a new project using the given repository "+(0!==t.model.url.indexOf("http")?t.model.url+" ?":'<a href="'+t.model.url+'" target="_blank">'+t.model.url+"</a> ?");o.confirm("Repository is empty",n).then(function(){t.closeThisDialog(),o.newProject("project-form",e.id,!0)}).catch(function(){r.deleteApp(e.id)})}else i.grantPermission(e.id,"edit"),s.go("editor",{appId:e.id})}).catch(function(){t.submitted=!1})},t.checkProtocol=function(){t.sshProtocol=t.model.url&&0!==t.model.url.indexOf("http")},t.sshProtocol=!1,t.model={url:"",directory:t.env.appsDirs[0]}}]),angular.module("studio").controller("ImportZipCtrl",["$scope","$state","uiUploader","config","userService","commonDialogs",function(e,t,n,r,o,i){e.files=null,e.isValid=function(){return e.files&&("application/zip"===e.files[0].type||"application/x-zip-compressed"===e.files[0].type)},e.fileChanged=(t=>{e.files=t.files,n.removeAll(),n.addFiles(t.files),e.$digest()}),e.upload=function(){e.submitted=!0,e.showLoading(),n.startUpload({url:`${r.serverUrl}/zip?token=${localStorage.getItem("accessToken")}`,options:{withCredentials:!0},onProgress:_.noop,onCompleted:(n,r,s)=>{if(e.hideLoading(),e.closeThisDialog(),200===s){let e=JSON.parse(r);o.grantPermission(e.appId,"edit"),t.go("editor",{appId:e.appId})}else i.error("Import failed",r)},onCompletedAll:_.noop})}}]),angular.module("studio").controller("ChangePasswordCtrl",["$rootScope","$scope","userService","dialogService",function(e,t,n,r){e.hideLoading(),t.model={id:t.ngDialogData.user.id},t.isValid=function(){var e=t.model.password,n=e===t.model.confirmPassword;return e&&"string"==typeof e&&e.length>0&&n},t.save=function(){var e;if("string"==typeof t.model.password){var r=new jsSHA("SHA-1","TEXT");r.update(t.model.password),e=r.getHash("HEX")}t.submitted=!0,t.showLoading(),n.updatePassword(t.model.id,e).then(function(e){t.closeThisDialog(),t.hideLoading()})}}]),angular.module("studio").controller("EditUserCtrl",["$rootScope","$scope","userService","dialogService","config",function(e,t,n,r,o){e.hideLoading(),t.user=_.clone(t.ngDialogData.user),t.permissions=getAppPermissions(t.user,t.ngDialogData.apps),t.isValid=function(){var e=t.user.name,n=t.user.email;return e&&e.length>0&&n&&n.length>0&&t.myForm.email.$valid},t.changePassword=function(){r.changePassword(t.user)},t.save=function(){var r={name:t.user.name,isAdmin:t.user.isAdmin,email:t.user.email};t.submitted=!0,t.showLoading(),n.updateProfile(t.user.id,r).then(function(e){return t.closeThisDialog(),n.updatePermissions(t.user.id,setAppPermissions(t.permissions))}).then(function(n){t.hideLoading(),e.$broadcast(e.EVENT_UPDATED_USERS)})},t.delete=function(){e.user.id==t.user.id?r.alert("Permission Denied",o.messages.operationNotPermitted):r.confirm("Confirm User Delete",o.messages.userDelete,{name:t.user.name},!0).then(function(){return t.closeThisDialog(),n.delete(t.user.id)}).then(function(){e.$broadcast(e.EVENT_UPDATED_USERS)})}}]),angular.module("studio").controller("NewUserCtrl",["$rootScope","$scope","userService","dialogService",function(e,t,n,r){e.hideLoading(),t.model={id:"",name:"",email:""},t.isValid=function(){var e=t.model.id,n=t.model.name,r=t.model.password,o=r===t.model.confirmPassword,i=t.model.email;return e&&e.length>0&&n&&n.length>0&&i&&i.length>0&&r&&"string"==typeof r&&r.length>0&&o&&t.myForm.email.$valid},t.save=function(){var r;if("string"==typeof t.model.password){var o=new jsSHA("SHA-1","TEXT");o.update(t.model.password),r=o.getHash("HEX")}var i={name:t.model.name,password:r,email:t.model.email};t.submitted=!0,t.showLoading(),n.create(t.model.id,i).then(function(n){t.closeThisDialog(),t.hideLoading(),e.$broadcast(e.EVENT_UPDATED_USERS)})}}]),angular.module("studio").controller("SelectIconCtrl",["$scope","$timeout","$document",function(e,t,n){function r(e,t){for(var n=[],r=0,o=e.length;r!==o;r++)e[r].indexOf(t)>-1&&n.push(e[r]);return n}var o=e.ngDialogData.icons;e.ionIcons=o.ionIcons,e.fontAwesome=o.fontAwesome,e.model={value:e.ngDialogData.selectedValue},t(function(){e.hideLoading(),t(function(){var e=n[0].querySelector(".icon-wrap.selected");e&&e.scrollIntoView(!1)},!0)},!0),e.filterIcons=function(t){e.model.value=null,e.ionIcons=""===t?o.ionIcons:r(o.ionIcons,t),setTimeout(function(){e.fontAwesome=""===t?o.fontAwesome:r(o.fontAwesome,t),e.$digest()},0)},e.isValid=function(){return e.model.value},e.save=function(){e.ngDialogData.onSelected(e.model.value),e.closeThisDialog()}}]),angular.module("studio").controller("EditComponentsCtrl",["$scope",function(e){e.title=e.ngDialogData.title,e.message=e.ngDialogData.message,e.update=e.ngDialogData.update,e.updateMessage=e.ngDialogData.updateMessage}]),angular.module("studio").controller("PublishCtrl",["$scope","apiService","config","dialogService",function(e,t,n,r){e.data=e.ngDialogData.data,e.model={appId:e.app.id,version:e.data.version,debug:!1},e.publish=function(){e.submitted=!0,e.showLoading(),t.applications.publish(e.model).then(function(t){if(e.hideLoading(),e.closeThisDialog(),t.file){var r=document.createElement("iframe");r.style.display="none",r.src=n.serverUrl+t.file,document.body.appendChild(r),setTimeout(function(){r.parentNode.removeChild(r)},1e3)}}).catch(e.closeThisDialog)}}]),angular.module("studio").controller("CopyAppCtrl",["$scope","appService",function(e,t){var n=e.ngDialogData.app;e.placeholder=n.name,e.model={name:"",isAppTemplate:!1,directory:e.env.appsDirs[0]},e.submit=function(){e.showLoading(),e.submitted=!0,e.model.sourceAppId=n.id,_.extend(e.model,_.pick(n,"isVersioned","defaultLayout","clientVersion")),e.model.isAppTemplate&&delete e.model.isVersioned,t.createApp(e.model).then(function(t){e.closeThisDialog(),e.hideLoading(),e.ngDialogData.onSubmit({appId:t})})},e.isValid=function(){return!!e.model.name}}]),angular.module("studio").controller("SelectEventCtrl",["$scope","$q","eventService","endpointService",function(e,t,n,r){e.events=e.ngDialogData.events,e.selected={event:null,awaitCall:e.ngDialogData.block.awaitCall},function(){for(let t of e.events)if(t.value===e.ngDialogData.block.eventName)return void(e.selected.event=t);e.selected.event=e.events[0]}(),e.save=function(){e.ngDialogData.block.eventName=e.selected.event.value||"",e.ngDialogData.block.awaitCall=e.selected.awaitCall,r.endpointChanged("canvas"),e.closeThisDialog()},e.close=function(){e.closeThisDialog()}}]),angular.module("studio").controller("UpdateVersionsCtrl",["$scope","$rootScope","apiService","connectApiService","navigationService","clientVersionsService",function(e,t,n,r,o,i){e.model=e.ngDialogData.data,e.model.clientVersionExists&&!e.model.clientVersionOutdated||(e.clientVersion=i.findBestMatch(e.model.clientVersion,e.ngDialogData.clientVersions,!0)),e.model.serverVersionExists&&!e.model.serverVersionOutdated||(e.serverVersion=i.findBestMatch(e.model.serverVersion,e.ngDialogData.serverVersions,!0)),e.submit=function(){e.showLoading(),e.submitted=!0;var t=[];if(!e.model.clientVersionExists||e.model.clientVersionOutdated){var o=n.applications.updateClientVersion({appId:e.model.appId,clientVersion:e.clientVersion});t.push(o)}if(!e.model.serverVersionExists||e.model.serverVersionOutdated){var i=r.framework.updateConnectVersion({appId:e.model.appId,connectVersion:e.serverVersion});t.push(i)}Promise.all(t).then(function(){window.location.reload()})},e.cancel=function(){e.closeThisDialog(),window.location=e.getLink("applications")}}]),angular.module("studio").controller("ProjectFormSettingsCtrl",["$scope","config","clientVersionsService","helperService",function(e,t,n,r){e.layouts=t.layouts,e.getLayoutClass=function(e){return r.toKebabCase(e)},e.toggleShowAll=function(t){e.showAll=t,e.versions=t?e.ngDialogData.versions:n.filterVersions(e.ngDialogData.versions,{currentVersion:e.model.clientVersion})}}]),angular.module("studio").controller("ProjectFormSdksCtrl",["$scope","dialogService",function(e,t){e.addSdkList=function(){e.sdks.push({}),e.disableSelectedSdks()},e.removeSdkList=function(t){e.selectedSdksModel.splice(t,1),1===e.sdks.length&&0===e.selectedSdksModel.length?e.sdks[0]={}:e.sdks.splice(t,1),e.disableSelectedSdks()},e.onMultiSelectItemClick=function(){e.disableSelectedSdks()},e.showPluginInfo=function(t){let n=e.selectedSdksModel[t].repo;window.open(n,"_blank")},e.showPluginOptions=function(n){let r=e.selectedSdksModel[n];t.pluginOptions(r).then(t=>{e.selectedSdksModel[n].options=t})},e.isAddButtonShow=function(t){const n=e.selectedSdksModel.length===e.sdks.length,r=e.selectedSdksModel.length-1===t,o=e.sdks.length<e.sdkList.length;return n&&r&&o}}]),angular.module("studio").controller("ProjectFormTemplatesCtrl",["$scope","clientVersionsService","appService",function(e,t,n){e.selectTemplate=function(n){e.model.sourceAppId=n.id;let r=e.ngDialogData.versions;e.showAll||(r=t.filterVersions(r)),e.model.clientVersion=t.findBestMatch(n.clientVersion,r),e.versions=r,e.showAll||(e.versions=t.filterVersions(e.ngDialogData.versions,{currentVersion:e.model.clientVersion})),e.refreshSdksList(n.id)},e.getIconUrl=function(e){return n.getIconUrl(e)}}]),angular.module("studio").controller("ProjectFormPluginOptionsCtrl",["$scope","dialogService",function(e,t){e.plugin=function(){let t=angular.copy(e.ngDialogData.data);return _.each(t.options,e=>{void 0===e.value&&void 0!==e.defaultValue&&(e.value=e.defaultValue)}),t}(),e.pluginOptionTemplate="/views/studio/includes/pluginOptionInput.html",e.showOptionArray=function(e,n){t.pluginOptionArray({propName:n,option:e}).then(t=>e.value=t)},e.save=function(){if(e.submitted)return!1;e.submitted=!0,e.ngDialogData.onSubmit(e.plugin.options),e.closeThisDialog()},e.isValid=function(){let t=!0;return _.each(e.plugin.options,e=>{e.required&&("array"===e.type&&0===e.value.length||!e.value)&&(t=t&&!1)}),t}}]),angular.module("studio").controller("ProjectFormPluginOptionArrayCtrl",["$scope",function(e){function t(t){return t.map(t=>({value:t,type:e.itemsType}))}e.itemsType=e.ngDialogData.data.option.items.type,e.option=function(e){let n={};return n.required=e.required,e.value?n.items=t(e.value):n.items=e.defaultValue?t(e.defaultValue):[],n}(e.ngDialogData.data.option),e.propName=e.ngDialogData.data.propName,e.pluginOptionTemplate="/views/studio/includes/pluginOptionInput.html",e.addRow=function(){e.option.items.push({value:null,type:e.itemsType})},e.deleteRow=function(t){e.option.items.splice(t,1)},e.save=function(){if(e.submitted)return!1;let t=e.option.items.map(e=>e.value);e.submitted=!0,e.ngDialogData.onSubmit(t),e.closeThisDialog()},e.isValid=function(){let t=!0;return _.each(e.option.items,n=>{e.option.required&&!n.value&&(t=t&&!1)}),e.option.required&&0===e.option.items.length&&(t=!1),t}}]),angular.module("studio").filter("highlight",function(){return function(e,t,n){return e&&(t||angular.isNumber(t))?(e=e.toString(),t=t.toString(),n?_.unescape(e).split(t).map(function(e){return _.escape(e)}).join('<span class="ui-match">'+t+"</span>"):_.unescape(e).split(new RegExp("("+t+")","i")).map(function(e){return e.toLowerCase()===t.toLowerCase()?'<span class="ui-match">'+e+"</span>":_.escape(e)}).join("")):e}}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).jsesc=e()}}(function(){return function(){function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){return o(t[s][1][e]||e)},d,d.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}return e}()({1:[function(e,t,n){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],2:[function(e,t,n){(function(e){const n={},r=n.hasOwnProperty,o=(e,t)=>{for(const n in e)r.call(e,n)&&t(n,e[n])},i=n.toString,s=Array.isArray,a=e.isBuffer,l={'"':'\\"',"'":"\\'","\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},c=/["'\\\b\f\n\r\t]/,d=/[0-9]/,u=/[ !#-&\(-\[\]-~]/,p=(e,t)=>{const n=()=>{S=v,++t.indentLevel,v=t.indent.repeat(t.indentLevel)},r={escapeEverything:!1,minimal:!1,isScriptContext:!1,quotes:"single",wrap:!1,es6:!1,json:!1,compact:!0,lowercaseHex:!1,numbers:"decimal",indent:"\t",indentLevel:0,__inline1__:!1,__inline2__:!1},f=t&&t.json;f&&(r.quotes="double",r.wrap=!0),"single"!=(t=((e,t)=>t?(o(t,(t,n)=>{e[t]=n}),e):e)(r,t)).quotes&&"double"!=t.quotes&&"backtick"!=t.quotes&&(t.quotes="single");const h="double"==t.quotes?'"':"backtick"==t.quotes?"`":"'",m=t.compact,g=t.lowercaseHex;let v=t.indent.repeat(t.indentLevel),S="";const y=t.__inline1__,E=t.__inline2__,b=m?"":"\n";let w,C=!0;const _="binary"==t.numbers,T="octal"==t.numbers,D="decimal"==t.numbers,M="hexadecimal"==t.numbers;if(f&&e&&(e=>"function"==typeof e)(e.toJSON)&&(e=e.toJSON()),!(e=>"string"==typeof e||"[object String]"==i.call(e))(e)){if((e=>"[object Map]"==i.call(e))(e))return 0==e.size?"new Map()":(m||(t.__inline1__=!0,t.__inline2__=!1),"new Map("+p(Array.from(e),t)+")");if((e=>"[object Set]"==i.call(e))(e))return 0==e.size?"new Set()":"new Set("+p(Array.from(e),t)+")";if(a(e))return 0==e.length?"Buffer.from([])":"Buffer.from("+p(Array.from(e),t)+")";if(s(e))return w=[],t.wrap=!0,y&&(t.__inline1__=!1,t.__inline2__=!0),E||n(),((e,t)=>{const n=e.length;let r=-1;for(;++r<n;)t(e[r])})(e,e=>{C=!1,E&&(t.__inline2__=!1),w.push((m||E?"":v)+p(e,t))}),C?"[]":E?"["+w.join(", ")+"]":"["+b+w.join(","+b)+b+(m?"":S)+"]";if(!(e=>"number"==typeof e||"[object Number]"==i.call(e))(e))return(e=>"[object Object]"==i.call(e))(e)?(w=[],t.wrap=!0,n(),o(e,(e,n)=>{C=!1,w.push((m?"":v)+p(e,t)+":"+(m?"":" ")+p(n,t))}),C?"{}":"{"+b+w.join(","+b)+b+(m?"":S)+"}"):f?JSON.stringify(e)||"null":String(e);if(f)return JSON.stringify(e);if(D)return String(e);if(M){let t=e.toString(16);return g||(t=t.toUpperCase()),"0x"+t}if(_)return"0b"+e.toString(2);if(T)return"0o"+e.toString(8)}const x=e;let k=-1;const P=x.length;for(w="";++k<P;){const e=x.charAt(k);if(t.es6){const e=x.charCodeAt(k);if(e>=55296&&e<=56319&&P>k+1){const t=x.charCodeAt(k+1);if(t>=56320&&t<=57343){let n=(1024*(e-55296)+t-56320+65536).toString(16);g||(n=n.toUpperCase()),w+="\\u{"+n+"}",++k;continue}}}if(!t.escapeEverything){if(u.test(e)){w+=e;continue}if('"'==e){w+=h==e?'\\"':e;continue}if("`"==e){w+=h==e?"\\`":e;continue}if("'"==e){w+=h==e?"\\'":e;continue}}if("\0"==e&&!f&&!d.test(x.charAt(k+1))){w+="\\0";continue}if(c.test(e)){w+=l[e];continue}const n=e.charCodeAt(0);if(t.minimal&&8232!=n&&8233!=n){w+=e;continue}let r=n.toString(16);g||(r=r.toUpperCase());const o=r.length>2||f,i="\\"+(o?"u":"x")+("0000"+r).slice(o?-4:-2);w+=i}return t.wrap&&(w=h+w+h),"`"==h&&(w=w.replace(/\$\{/g,"\\${")),t.isScriptContext?w.replace(/<\/(script|style)/gi,"<\\/$1").replace(/<!--/g,f?"\\u003C!--":"\\x3C!--"):w};p.version="2.5.1",t.exports=p}).call(this,{isBuffer:e("../is-buffer/index.js")})},{"../is-buffer/index.js":1}]},{},[2])(2)}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).ConnectParser=e()}}(function(){var define,module,exports;return function(){function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!a&&l)return l(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){return o(t[s][1][e]||e)},d,d.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}return e}()({1:[function(e,t,n){let r=0;t.exports=class{constructor(){this.body=[],this.ci=r++,this.blockIndex=0}addBlock(e){e.index=this.blockIndex++,this.body.push(e)}isEmpty(){return 0==this.body.length}}},{}],2:[function(e,t,n){const r=e("./Generator");t.exports=class extends r{constructor(e,t){super(),this.id=e,this.code=t}makeFunction(e,t){let n=this.createStatementsFromString(this.code);for(let e of n)t.push(e)}getScript(e){let t=this.createEmptyProgram();return this.makeFunction(e,t.body),this.generateProgram(t)}getId(){return this.id}isCode(){return!0}appendCodeString(e){this.code+="\n",this.code+=e}getCodeString(){return this.code}getRootContextBody(){return[]}}},{"./Generator":10}],3:[function(e,t,n){const r=e("./Visitor"),o=e("./Generator"),i=e("./util/fieldUtil");t.exports=class extends o{constructor(){super()}setTest(e){this.test=e}setLHSType(e){this.lhsType=e}setRHSType(e){this.rhsType=e}setLHSModel(e){this.lhsModel=e}setRHSModel(e){this.rhsModel=e}setLHSVariableType(e){this.lhsVarType=e}setRHSVariableType(e){this.rhsVarType=e}setLHSTransformId(e){this.lhsTransformId=e}setRHSTransformId(e){this.rhsTransformId=e}setRHS(e){this.rhs=e}setLHS(e){this.lhs=e}setLHSValue(e){this.lhsValue=e}setRHSValue(e){this.rhsValue=e}parse(e,t){new class extends r{constructor(e,t,n){super(),this.condition=e,this.identifiers=n,this.visitNode(t)}visitNode(e){this.processConditionNode(e),this.condition.hasOwnProperty("test")||this.condition.setTest("isTrue")}processConditionNode(e,t){if("UnaryExpression"==e.type&&"!"==e.operator)t?logger.error("TODO: Handle case where RHS has a unary operator!"):this.condition.setTest("isFalse"),this.processConditionNode(e.argument,t);else if(this.isIME(e))t?this.setRHSObjectMember(this.IMEtoArray(e)):this.setLHSObjectMember(this.IMEtoArray(e));else if(this.isCallExpression(e)){var n=this.IMEtoArray(e.callee);t?this.setRHSFunction(n):this.setLHSFunction(n)}else this.isBinaryExpression(e)?(this.condition.setTest(e.operator),this.processConditionNode(e.left),this.processConditionNode(e.right,!0)):this.isLiteral(e)?t?this.setRHSValue(e.value):this.setLHSValue(e.value):console.log("Unhandled Condition")}setRHSObjectMember(e){this.setTypeAndProp(e,"rhs",!1)}setLHSObjectMember(e){this.setTypeAndProp(e,"lhs",!1)}setRHSFunction(e){this.setTypeAndProp(e,"rhs",!0)}setLHSFunction(e){this.setTypeAndProp(e,"lhs",!0)}setLHSValue(e){this.condition.setLHSType("value"),this.condition.setLHSValue(e)}setRHSValue(e){this.condition.setRHSType("value"),this.condition.setRHSValue(e)}setRHSModel(e,t){this.condition.setRHSType("model"),this.condition.setRHSModel(e),this.condition.setRHS(t)}setLHSModel(e,t){this.condition.setLHSType("model"),this.condition.setLHSModel(e),this.condition.setLHS(t)}setRHSVariable(e,t){this.condition.setRHSType("vars"),this.condition.setRHSVariableType(e),this.condition.setRHS(t)}setLHSVariable(e,t){this.condition.setLHSType("vars"),this.condition.setLHSVariableType(e),this.condition.setLHS(t)}setRHSTransformMethod(e,t){this.condition.setRHSType("transform"),this.condition.setRHSTransformId(e),this.condition.setRHS(t+"()")}setLHSTransformMethod(e,t){this.condition.setLHSType("transform"),this.condition.setLHSTransformId(e),this.condition.setLHS(t+"()")}setTypeAndProp(e,t,n){let r=e[0];r==this.identifiers.models?this["lhs"==t?"setLHSModel":"setRHSModel"](e[1],e.slice(2).join(".")):r==this.identifiers.session?"transform"==e[1]&&n?this["lhs"==t?"setLHSTransformMethod":"setRHSTransformMethod"](e[2],e[3]):"api"==e[1]?console.error("TODO: Handle API calls in Condition Builder."):console.error("Unexpected session call"):r==this.identifiers.vars?this["lhs"==t?"setLHSVariable":"setRHSVariable"](e[1],e.slice(2).join(".")):this["lhs"==t?"setLHSVariable":"setRHSVariable"]("local",e.join("."))}}(this,e,t)}createLHSExpression(){if("model"==this.lhsType)return this.createIMEFromPath(`models.${this.lhsModel}.${this.lhs}`);if("transform"==this.lhsType&&this.lhs.endsWith("()")){let e=this.lhs.substring(0,this.lhs.length-2);return this.createCallExpression(["session","transform",this.lhsTransformId,e],[])}return"vars"==this.lhsType?"local"==this.lhsVarType?this.createIMEFromPath(this.lhs):this.createIMEFromPath(`vars.${this.lhsVarType}.${this.lhs}`):"value"==this.lhsType?(this.value=this.lhs||this.lhsValue,i.determineLiteralTypeFromValue(this),this.createLiteral(this.value)):void console.error("TODO: Handle unknown type of unary expression!!!")}createRHSExpression(){if("model"==this.rhsType)return this.createIMEFromPath(`models.${this.rhsModel}.${this.rhs}`);if("transform"==this.rhsType&&this.rhs.endsWith("()")){let e=this.rhs.substring(0,this.rhs.length-2);return this.createCallExpression(["session","transform",this.rhsTransformId,e],[])}return"vars"==this.rhsType?"local"==this.rhsVarType?this.createIMEFromPath(this.rhs):this.createIMEFromPath(`vars.${this.rhsVarType}.${this.rhs}`):"value"==this.rhsType?(this.value=this.rhs||this.rhsValue,i.determineLiteralTypeFromValue(this),this.createLiteral(this.value)):void console.error("TODO: Handle unknown type of unary expression!!!")}generate(){if("isTrue"==this.test)return this.createLHSExpression();if("isFalse"==this.test)return this.createUnaryExpression("!",this.createLHSExpression());{let e=this.createLHSExpression(),t=this.createRHSExpression();return this.createBinaryExpression(this.test,e,t)}}}},{"./Generator":10,"./Visitor":15,"./util/fieldUtil":49}],4:[function(e,t,n){const r=e("./Visitor"),o=e("./Generator"),i=e("./Condition");t.exports=class extends o{constructor(e){super(),this.conditionsTree=e}getConditionsTree(){return this.conditionsTree}parse(e,t){new class extends r{constructor(e,t,n){super(),this.conditions=e,this.identifiers=n,this.visitNode(t)}visitLogicalExpression(e){this.conditions.conditionsTree={operator:e.operator,children:[]},this.processLogicalExpression(e.left,this.conditions.conditionsTree),this.processLogicalExpression(e.right,this.conditions.conditionsTree)}visitCallExpression(e){this.conditions.conditionsTree={operator:"&&",children:[]},this.conditions.conditionsTree.children.push(this.processCondition(e))}visitBinaryExpression(e){this.conditions.conditionsTree={operator:"&&",children:[]},this.conditions.conditionsTree.children.push(this.processCondition(e))}visitUnaryExpression(e){this.conditions.conditionsTree={operator:"&&",children:[]},this.conditions.conditionsTree.children.push(this.processCondition(e))}visitMemberExpression(e){this.conditions.conditionsTree={operator:"&&",children:[]},this.conditions.conditionsTree.children.push(this.processCondition(e))}processLogicalExpression(e,t){if("LogicalExpression"==e.type)if(t.operator==e.operator)this.processLogicalExpression(e.left,t),this.processLogicalExpression(e.right,t);else{let n={operator:e.operator,children:[]};this.processLogicalExpression(e.left,n),this.processLogicalExpression(e.right,n),t.children.push(n)}else t.children.push(this.processCondition(e))}processCondition(e){let t=new i;return t.parse(e,this.identifiers),t}}(this,e,t)}isConditionsTree(e){return!(!e.hasOwnProperty("operator")||!e.hasOwnProperty("children"))}generateCondition(e){return this.isConditionsTree(e)?new Conditions(e).generate():Object.assign(new i,e).generate()}generate(){return this.conditionsTree&&0!=this.conditionsTree.children.length?1==this.conditionsTree.children.length?this.generateCondition(this.conditionsTree.children[0]):2==this.conditionsTree.children.length?this.createLogicalExpression(this.conditionsTree.operator,this.generateCondition(this.conditionsTree.children[0]),this.generateCondition(this.conditionsTree.children[1])):(console.error("TODO: Handle more than 2 conditions in conditions tree - just handling 2 for now!!!"),this.createLogicalExpression(this.conditionsTree.operator,this.generateCondition(this.conditionsTree.children[0]),this.generateCondition(this.conditionsTree.children[1]))):this.createLiteral(!0)}}},{"./Condition":3,"./Generator":10,"./Visitor":15}],5:[function(e,t,n){t.exports={RUNTIME_MODULE:"smartux-connect"}},{}],6:[function(e,t,n){const r=e("./Visitor"),o=e("./Generator"),i=e("./Constants"),s=e("./TriggerConditions"),a=(e("./EventAreaParser"),e("./EventArea")),l=e("./CodeBlockEventArea"),c=e("./util/modelUtil");t.exports=class extends o{constructor(e){super(),this.id=e,this.externalModules=[],this.mainModules=[],this.eventAreas=[]}addExternalModule(e,t){this.externalModules.push({var:e,module:t})}addMainModule(e,t){this.mainModules.push({var:e,module:t})}getId(){return this.id}parse(e){new class extends r{constructor(e,t){super(),this.endPoint=e,this.triggerIdentifier="",this.visitNode(t)}visitAssignmentExpression(e){if(this.isEqualsOperator(e.operator)&&this.isIME(e.left)&&this.isFunctionExpression(e.right)){let t=this.IMEtoArray(e.left);if("exports"==t[0])return void this.processEventArea(this.processSimpleTrigger(t[1]),e.right)}this.unexpectedNode(e)}visitCallExpression(e){this.isCallExpression(e,this.triggerIdentifier)&&2==e.arguments.length&&this.isObjectExpression(e.arguments[0])&&this.isFunctionExpression(e.arguments[1])?this.processEventArea(this.processComplexTrigger(e.arguments[0]),e.arguments[1]):this.unexpectedNode(e)}visitVariableDeclaration(e){for(let t of e.declarations)if(this.isMECallExpression(t.init,["require"],[i.RUNTIME_MODULE],["trigger"]))this.triggerIdentifier=[t.id.name];else if(this.isMECallExpression(t.init,["require"],[i.RUNTIME_MODULE],[]))this.triggerIdentifier=[t.id.name,"trigger"];else if(this.isCallExpression(t.init,["require"])&&1==t.init.arguments.length&&"Literal"==t.init.arguments[0].type)this.endPoint.addExternalModule(t.id.name,t.init.arguments[0].value);else if(this.isCallExpression(t.init,["require","main","require"])&&1==t.init.arguments.length&&"Literal"==t.init.arguments[0].type)this.endPoint.addMainModule(t.id.name,t.init.arguments[0].value);else{let n={type:e.type,kind:e.kind,declarations:[t]};this.unexpectedNode(n)}}unexpectedNode(e){let t=new l(this.makeUniqueId("code"),this.nodeAsString(e));this.endPoint.addCodeBlockEventArea(t)}processSimpleTrigger(e){let t=this.endPoint.getId();return{id:this.makeUniqueId("trigger"),events:[`${t}.${e}`]}}processComplexTrigger(e){let t={id:"",events:[]};for(let n of e.properties)"Identifier"==n.key.type&&("id"==n.key.name?t.id=this.makeUniqueIdIfNecessary(n.value.value):"events"==n.key.name?t.events=this.readArrayOfLiteralsFromArrayExpression(n.value):"conditions"==n.key.name&&(t.conditions=this.processConditionFunctionExpression(n.value)));return t}processEventArea(e,t){let n=new a(e);n.parse(t),this.endPoint.addEventArea(n)}processConditionFunctionExpression(e){if(this.isFunctionExpression(e)){let t=new s;return t.parse(e),t.getConditionsTree()}return{}}}(this,e)}addEventArea(e){this.eventAreas.push(e)}addCodeBlockEventArea(e){this.eventAreas.length>0&&this.eventAreas[this.eventAreas.length-1].isCode()?this.eventAreas[this.eventAreas.length-1].appendCodeString(e.getCodeString()):this.eventAreas.push(e)}removeEventArea(e){const t=this.eventAreas.findIndex(t=>t.getId()===e);t>=0&&this.eventAreas.splice(t,1)}addEventAreaBefore(e,t){for(let n=0;n<this.eventAreas.length;n++)if(this.eventAreas[n].getId()===t)return void this.eventAreas.splice(n,0,e)}getEventAreas(){return this.eventAreas}createFullEventId(e){return`${this.id}.${e}`}findOrCreateEventArea(e){let t=this.createFullEventId(e),n=this.getEventAreas(),r=null;for(let e of n)if(e.handlesEvent(t)){r=e;break}return null==r&&(r=new a({id:e,events:[t]}),this.addEventArea(r)),r}removeEventAreaByEvent(e){let t=this.createFullEventId(e),n=this.getEventAreas(),r=null;for(let e of n)if(e.handlesEvent(t)){r=e;break}r&&endPoint.removeEventArea(r.getId())}findHandledEvents(){let e={},t=this.getEventAreas();for(let n of t)if(!n.isCode()&&n.isSimpleTrigger(this.id)){let t=n.getSimpleTriggerEventId(this.id),r=n.getEventTypeAndData();"updateWithAction"==r.type?e[t]={sourcePath:r.sourcePath,action:r.action,isDeletable:!0,eventArea:n}:"event"==r.type?e[t]={isDeletable:r.isEmpty,eventArea:n}:e[t]={isDeletable:!1,eventArea:n}}return e}updateUsingScreenAndPageModels(e,t,n,r,o){let i=[];c.findActionPaths(t,"",i);let s=[],a="";o&&c.findActionPaths(o,"",s),t.sourcePath&&(a=c.makeSourcePath(t.sourcePath));let l=this.findHandledEvents(),d=!1;for(let o of i){let i=s.indexOf(c.extendPath(a,o))>=0,u=l[o];if(u)u.isDeletable?u.sourcePath==t.sourcePath&&u.action==o?(console.log(`${e}.${o} - no changed needed.`),delete l[o]):t.sourcePath&&r?(u.eventArea.convertToUpdateWithActionEvent(e,t.sourcePath,n,r,o),d=!0,delete l[o]):delete l[o]:(console.log(`Not creating action for ${e}.${o} - there is some existing code that can't be altered.`),delete l[o]);else{let s=this.findOrCreateEventArea(o);i&&s.convertToUpdateWithActionEvent(e,t.sourcePath,n,r,o),d=!0}}let u=Object.keys(l);for(let e of u){let t=l[e];t.isDeletable&&(this.removeEventArea(t.eventArea.getId()),d=!0)}return d}getScript(){let e=this.createEmptyProgram();for(let t of this.externalModules){let n=this.createRequireVariableDeclaration(t.var,t.module,[]);e.body.push(n)}for(let t of this.mainModules){let n=this.createMainRequireVariableDeclaration(t.var,t.module,[]);e.body.push(n)}let t=!1;for(let n of this.eventAreas)n.isCode()?n.makeFunction(this.id,e.body):(n.isSimpleTrigger(this.id)||(t=!0),n.makeFunction(this.id,e.body));if(t){let t=this.createRequireVariableDeclaration("trigger",i.RUNTIME_MODULE,["trigger"]);e.body.unshift(t)}return this.generateProgram(e)}}},{"./CodeBlockEventArea":2,"./Constants":5,"./EventArea":7,"./EventAreaParser":8,"./Generator":10,"./TriggerConditions":14,"./Visitor":15,"./util/modelUtil":50}],7:[function(e,t,n){const r=e("./Generator"),o=e("./Conditions"),i=e("./EventAreaParser"),s=e("./blocks/RelatedScreensBlock"),a=e("./blocks/ScreenBlock"),l=e("./blocks/TransformBlock"),c=(e("./fields/ConstantField"),e("./fields/InputField")),d=e("./fields/ModelField"),u=e("./fields/VariableField");e("./fields/ActionField");t.exports=class extends r{constructor(e){super(),this.trigger=e,this.rootContext={body:[]},this.localVariables={}}getLabel(){return this.trigger.events[0]}getEvents(){return this.trigger.events}handlesEvent(e){return this.trigger.events.includes(e)}getEventTypeAndData(){let e={type:"event"};if(0==this.rootContext.body.length)e.isEmpty=!0;else if(1==this.rootContext.body.length){let t=this.rootContext.body[0];"transform"==t.type&&"action"==t.method?t.args.hasOwnProperty("action")&&"constant"===t.args.action.type&&(e.type="action",e.action=t.args.action.value):"relatedscreens"==t.type?(e.type="screens",e.screens=t.screenIds):"screen"==t.type&&(e.type="screens",e.screens=[t.screenId])}else if(2==this.rootContext.body.length){let[t,n]=this.rootContext.body;if("transform"==t.type&&"update"==t.method&&"transform"==n.type&&"action"==n.method){let r=t.getMappings();1==r.length&&"input"==r[0].to.type&&"models"==r[0].from.type&&n.args.hasOwnProperty("action")&&"constant"===n.args.action.type&&(e.type="updateWithAction",e.screenModelId=r[0].from.path,e.sourcePath=r[0].to.path,e.pageModelId=n.args.pageModel.value,e.action=n.args.action.value)}}return e}getPageSourcePath(e){let t=e.indexOf(".");return-1==t?"":e.substring(t+1)}convertToScreensEvent(e,t){if(this.clearAllBlocks(),1==e.length){let r;if(t){var n=this.getPageSourcePath(t);n=n.length>0?"page."+n:"page",r=new u(n)}else r=new u("page");let o=new a(e[0]);o.addMapping({from:r,to:new d(e[0])}),this.addBlock(o)}else{let t=new s(e);this.addBlock(t)}}convertToActionEvent(e,t,n){this.clearAllBlocks();let r=new l(e,"action");r.setPageModel(t),r.setAction(n),this.addBlock(r)}convertToUpdateWithActionEvent(e,t,n,r,o){this.clearAllBlocks();let i;i=new c(t?this.getPageSourcePath(t):"");let s=new l(n,"update");s.addMapping({from:new d(e),to:i}),s.setPageModel(r),this.addBlock(s);let a=new l(n,"action");a.setPageModel(r),a.setAction(o),this.addBlock(a)}getId(){return this.trigger.id}getLocalVariables(){return this.localVariables?Object.keys(this.localVariables):[]}getRootContextBody(){return this.rootContext.body}hasBlocks(){return this.rootContext.body.length>0}getFirstBlock(){return this.rootContext.body[0]}clearAllBlocks(){this.rootContext={body:[]}}parse(e){let t=new i;t.parseFunction(e),this.rootContext=t.getRoot(),this.localVariables=t.localVariables}addBlock(e){this.rootContext.body.push(e)}removeBlock(e,t){const n=t.findIndex(t=>t.getId()===e);n>=0&&t.splice(n,1)}removeRootContextTransformBlock(e,t){const n=this.rootContext.body.findIndex(n=>"transform"==n.type&&n.transformId==e&&n.method==t);n>=0&&this.rootContext.body.splice(n,1)}addBlockAfter(e,t,n){for(let r=0;r<n.length;r++)if(n[r].id==e)return void this.insertBlockAtIndex(r+1,t,n);this.addFirstBlock(t,n)}insertBlockAtIndex(e,t,n){n.splice(e,0,t)}addFirstBlock(e,t){t.unshift(e)}isSimpleTrigger(e){return 1==this.trigger.events.length&&!this.trigger.hasOwnProperty("conditions")&&0==this.trigger.events[0].indexOf(e)}getSimpleTriggerEventId(e){return this.trigger.events[0].substring(e.length+1)}getSimpleTriggerFunctionName(e,t){return t.events[0].substring(e.length+1)}createSimpleTrigger(e,t,n){let r=this.getSimpleTriggerFunctionName(e,t);return this.createEqualsExpressionStatement({left:this.createIMEFromArray(["exports",r]),right:this.createArrowFunctionExpression(!0,["session","models","vars"],this.createBlockStatement(n))})}createFullTrigger(e,t,n){let r=[];return r.push(this.createObjectProperty("id",this.createLiteral(t.id))),r.push(this.createObjectProperty("events",this.createLiteralsArrayExpression(t.events))),t.conditions&&r.push(this.createObjectProperty("conditions",this.createArrowFunctionExpression(!1,["session","models","vars"],this.createBlockStatement([this.createReturnStatement(new o(t.conditions).generate())])))),this.createExpressionStatement(this.createCallExpression(["trigger"],[this.createObjectExpression(r),this.createArrowFunctionExpression(!0,["session","models","vars"],this.createBlockStatement(n))]))}createBodyFromContext(e,t){let n={};for(let r of e.body)r.generate(t,null,null,n)}makeFunction(e,t){let n=[];this.createBodyFromContext(this.rootContext,n),this.isSimpleTrigger(e)?t.push(this.createSimpleTrigger(e,this.trigger,n)):t.push(this.createFullTrigger(e,this.trigger,n))}getScript(e){let t=this.createEmptyProgram();return this.makeFunction(e,t.body),this.generateProgram(t)}isCode(){return!1}}},{"./Conditions":4,"./EventAreaParser":8,"./Generator":10,"./blocks/RelatedScreensBlock":26,"./blocks/ScreenBlock":27,"./blocks/TransformBlock":29,"./fields/ActionField":32,"./fields/ConstantField":34,"./fields/InputField":38,"./fields/ModelField":40,"./fields/VariableField":44}],8:[function(e,t,n){const r=e("./Visitor"),o=(e("./Generator"),e("./Conditions")),i=e("./ReferenceFinder"),s=e("./BlockContext"),a=e("./blocks/ApiBlock"),l=e("./blocks/IfBlock"),c=e("./blocks/TryCatchBlock"),d=e("./blocks/SetDataBlock"),u=e("./blocks/TransformBlock"),p=e("./blocks/CopyModelBlock"),f=e("./blocks/ScreenBlock"),h=e("./blocks/CallBlock"),m=e("./blocks/RelatedScreensBlock"),g=e("./blocks/CodeBlock"),v=e("./blocks/DataBlock"),S=e("./blocks/NewVarBlock"),y=e("./blocks/UpdateUserInfoBlock"),E=e("./fields/ActionField"),b=e("./fields/ConditionField"),w=e("./fields/ConstantField"),C=e("./fields/ErrorOutputField"),_=e("./fields/ExpressionField"),T=e("./fields/InputField"),D=e("./fields/ModelField"),M=e("./fields/OutputField"),x=e("./fields/TemplateField"),k=e("./fields/UnknownField"),P=e("./fields/VariableField"),A=e("./fields/InputMappingsField"),I=e("./ReferenceTree"),O=e("./util/fieldUtil"),N=e("lodash");t.exports=class{constructor(){this.currentBlockContext=this.rootBlockContext=new s,this.localVariables={},this.referenceTree=new I(this.localVariables)}switchBlockContext(e){let t=this.currentBlockContext;return this.currentBlockContext=e,t}addNode(e,t){this.currentBlockContext.addBlock(e),this.referenceTree.addBlock(e,t)}addLocalVariable(e){this.localVariables[e]=!0}getRoot(){return this.rootBlockContext}parseFunction(e){new class extends r{constructor(e,t){super(),this.eventAreaParser=e,this.inAwaitCallExpression=!1}visitMainFunction(e){this.identifiers=this.getParameterIdentifiers(e.params),this.visitNode(e.body)}visitAwaitExpression(e){this.inAwaitCallExpression=!0,this.visitNode(e.argument),this.inAwaitCallExpression=!1}visitAssignmentExpression(e){if("="==e.operator){let t=this.assigneeObject=this.processSetExpression(e.left),n=this.processSetExpression(e.right);if(!n||!this.hasOwnProperty("assigneeObject"))return;{delete this.assigneeObject;let e=new v(n,t);if("unknown"!=e.to.type&&"unknown"!=e.from.type)return void this.eventAreaParser.addNode(e,this.identifiers)}}this.processAsCode(e)}visitCallExpression(e){try{let{arr:t,node:n}=this.MEtoArrayPlusMainObj(e.callee);if(this.isIdentifier(n))if(t.length>2){if("transform"==t[0])return void this.processTransformMethod(t[1],t[2],e.arguments);if("api"==t[0])return void this.processAPIMethod(t[1],t[2],e.arguments)}else{if(N.isEqual(t,["screen"]))return void this.processScreenMethod(e.arguments);if(N.isEqual(t,["relatedScreens"]))return void this.processRelatedScreensMethod(e.arguments);if(N.isEqual(t,["copyModel"]))return void this.processCopyModelMethod(e.arguments);if(N.isEqual(t,["call"]))return void this.processCallMethod(e.arguments,this.inAwaitCallExpression);if(N.isEqual(t,["updateUserInfo"]))return void this.processUpdateUserInfoMethod(e.arguments)}this.hasOwnProperty("assigneeObject")||this.processAsCode(e)}catch(t){this.processAsCode(e)}}visitForOfStatement(e){this.processAsCode(e)}visitForStatement(e){this.processAsCode(e)}visitIfStatement(e){let t=new l;t.parse(this,e,this.identifiers),this.eventAreaParser.addNode(t,this.identifiers)}visitTryStatement(e){let t=new c;t.parse(this,e,this.identifiers),this.eventAreaParser.addNode(t,this.identifiers)}visitCatchClause(e){this.identifiers.errorOutput=e.param.name,this.visitNode(e.body),delete this.identifiers.errorOutput}visitVariableDeclarator(e){if(this.isIdentifier(e.id)){let t=e.id.name;return this.eventAreaParser.addLocalVariable(t),this.eventAreaParser.addNode(new S(`local.${t}`),this.identifiers),this.assigneeObject=new P(`local.${t}`),delete this.assignedObject,e.init&&this.visitNode(e.init),this.assignedObject&&this.assigneeObject&&(this.eventAreaParser.addNode(new v(this.assignedObject,this.assigneeObject),this.identifiers),delete this.assignedObject),void delete this.assigneeObject}this.unexpectedNode(e)}visitObjectExpression(e){if(0==e.properties.length)this.assignedObject=new w("{}","object");else if("input"==this.processSetExpressionType){let t={};this.processObjectExpression(t,e,""),this.assignedObject=new A(t)}else this.assignedObject=new _(this.nodeAsString(e)),this.assignedObject.setExpressionRefs(this.findAllReferences(e))}processKey(e){if("Literal"==e.type)return e.value;if("Identifier"==e.type)return e.name;throw"ConfigFileVisitor: Unexpected key type "+e.type}processObjectExpression(e,t,n){for(let r of t.properties){let t=this.processKey(r.key),o=0==n.length?t:n+"."+t;this.processKeyValue(e,t,r.value,o)}}processKeyValue(e,t,n,r){if("ObjectExpression"==n.type)this.processObjectExpression(e,n,r);else{let t=this.assignedObject,o=this.assigneeObject;e[r]=this.processSetExpression(n),this.assignedObject=t,this.assigneeObject=o}}visitUnaryExpression(e){this.assignedObject=new _(this.nodeAsString(e)),this.assignedObject.setExpressionRefs(this.findAllReferences(e))}visitBinaryExpression(e){this.assignedObject=new _(this.nodeAsString(e)),this.assignedObject.setExpressionRefs(this.findAllReferences(e))}visitArrayExpression(e){if(0==e.elements.length)this.assignedObject=new w("[]","array");else{let t=!0,n=[];for(let r of e.elements)"Literal"==r.type?n.push(r.value):t=!1;this.assignedObject=t?new w(JSON.stringify(n),"array"):new _(this.nodeAsString(e))}}visitMemberExpression(e){this.isPureIME(e)?this.processIME(e):this.assignedObject=new k}visitIdentifier(e){this.processIME(e)}visitLiteral(e){this.assignedObject=new w(e.value)}visitTemplateLiteral(e){if(this.assignedObject=new x(this.nodeAsString(e)),this.assignedObject.setExpressionRefs(this.findAllReferences(e)),"action"==this.processSetExpressionType){let e=this.assignedObject;this.assignedObject=new E,this.assignedObject.setField(e)}}visitLogicalExpression(e){let t=new o;t.parse(e,this.identifiers),this.assignedObject=new b(t.getConditionsTree())}processIME(e){let t=this.IMEtoArray(e);this.assignedObject=O.createPathBasedField(t,this.eventAreaParser.localVariables,this.identifiers)}processAsCode(e){let t=this.nodeAsString(e),n=new g(t);this.eventAreaParser.addNode(n,this.identifiers)}processCallMethod(e,t){let n=new h(e[0].value,t);this.eventAreaParser.addNode(n,this.identifiers)}processUpdateUserInfoMethod(e){let t=new y;e.length>0&&(t.input=this.processSetExpression(e[0],"input")),this.eventAreaParser.addNode(t,this.identifiers)}processTransformMethod(e,t,n){let r=null;"action"==t?r=["pageModel","action"]:"extract"==t?r=["pageModel"]:"update"==t?r=["pageModel","input"]:"url"==t?r=["url"]:"authenticate"==t?r=["username","password","urlPattern"]:"screenshot"==t?r=["imageFilePath"]:"evalSync"==t?r=["func"]:"acceptDialog"==t?r=["promptText"]:"uploadFiles"==t?r=["pageModel","inputPath","filePaths"]:"imageDataUri"==t?r=["pageModel","entryPath"]:"checkState"==t&&(r=["softCheck"]);let o=this.createTransformBlock(e,t,n,r);"extract"==t&&this.assigneeObject&&(o.output=this.assigneeObject),this.eventAreaParser.addNode(o,this.identifiers)}createTransformBlock(e,t,n,r){let o=new u(e,t),i={};for(let e=0;e<n.length;e++){let t=r&&r[e]||"arg"+e;"input"==t?o.input=this.processSetExpression(n[e],"input"):i[t]="action"==t?this.processSetExpression(n[e],"action"):this.processSetExpression(n[e])}return o.setArguments(i),o}processScreenMethod(e){let t=this.readArrayOfLiterals(e),n="";t.length>0&&(n=t[0]);let r=new f(n);this.eventAreaParser.addNode(r,this.identifiers)}processRelatedScreensMethod(e){let t=this.readArrayOfLiteralsFromArrayExpression(e[0]),n=new m(t);n.setDataField(this.processSetExpression(e[1])),this.eventAreaParser.addNode(n,this.identifiers)}processCopyModelMethod(e){let t=new p;e.length>0&&(t.input=this.processSetExpression(e[0],"input")),this.assigneeObject&&(t.output=this.assigneeObject,delete this.assigneeObject),this.eventAreaParser.addNode(t,this.identifiers)}findAllReferences(e){let t=new i;return t.parse(e),t.getReferences()}processSetExpression(e,t){let n;return delete this.assignedObject,this.processSetExpressionType=t,this.visitNode(e),delete this.processSetExpressionType,this.assignedObject?(n=this.assignedObject,delete this.assignedObject):this.assigneeObject&&(n=new _(this.nodeAsString(e))).setExpressionRefs(this.findAllReferences(e)),n}processAPIMethod(e,t,n){let r=new a(e,t);n.length>0&&(r.input=this.processSetExpression(n[0],"input")),this.assigneeObject&&("vars"==this.assigneeObject.type&&0==this.assigneeObject.path.indexOf("local.")&&(r.outputVariableName=this.assigneeObject.path.substring(6)),r.output=this.assigneeObject,delete this.assigneeObject),this.eventAreaParser.addNode(r,this.identifiers)}}(this,e).visitMainFunction(e),this.collapseDataNodes(this.rootBlockContext)}processBlockFirstPass(e,t){if("api"==e.type||"transform"==e.type&&("update"==e.method||"extract"==e.method)||"updateUserInfo"==e.type){if(e.input){if("vars"==e.input.type){let n="vars."+e.input.path,r=this.referenceTree.lookup(n);r.create&&t.push(r.create[0]),this.handleUpdateRefs(r,e.mappings,t,"",e)}else if("inputMappings"==e.input.type){let t=e.input.getMappings();for(let n of t)e.mappings.push(n)}else e.mappings.push({to:new T(""),from:e.input});delete e.input}if(e.output){if("vars"==e.output.type){let n="vars."+e.output.path,r=this.referenceTree.lookup(n);if(r.create&&t.push(r.create[0]),r.update){let t=r.update.indexOf(e);t>=0&&r.update.splice(t,1)}this.handleReadRefs(r,e.mappings,t,"",e,"output");let o=!1;r.read&&(o=!0);for(let t of e.mappings)if("output"==t.from.type){o=!0;break}o||e.mappings.push({from:new M(""),to:e.output})}else e.mappings.push({from:new M(""),to:e.output});delete e.output}if(e.errorOutput){let n=this.referenceTree.lookup("errorOutput");this.handleReadRefs(n,e.mappings,t,"",e,"errorOutput"),delete e.errorOutput}}else if("screen"==e.type){e.mappings=[];let n=this.referenceTree.lookup("models."+e.screenId);this.handleUpdateRefs(n,e.mappings,t,"",e)}}collapseDataNodes(e,t){let n=[];t&&(t.index=-1,this.processBlockFirstPass(t,n));for(let t of e.body)this.processBlockFirstPass(t,n);for(let t of n){let n=e.body.indexOf(t);n>=0&&e.body.splice(n,1)}let r=[];n=[];let o=-1;for(let t=0;t<e.body.length;t++){let i=e.body[t];if("newvar"==i.type)n.push(i);else if("data"==i.type)0==r.length&&(o=t),r.push(i);else if(r.length>0){let i=new d;for(let e of r)i.addMapping({from:e.from,to:e.to}),n.push(e);e.body.splice(o,0,i),t++,r=[]}}if(r.length>0){let t=new d;for(let e of r)t.addMapping({from:e.from,to:e.to}),n.push(e);e.body.splice(o,0,t),r=[]}for(let t of n){let n=e.body.indexOf(t);e.body.splice(n,1)}}handleUpdateRefs(e,t,n,r,o){if(e.update)for(let i of e.update)if(i.index<o.index&&-1==n.indexOf(i))if(n.push(i),"screen"==o.type){let e=""==r?o.screenId:`${o.screenId}.${r}`;t.push({to:new D(e),from:i.from})}else t.push({to:new T(r),from:i.from});if(e.children)for(let i in e.children)this.handleUpdateRefs(e.children[i],t,n,r.length>0?r+"."+i:i,o)}handleReadRefs(e,t,n,r,o,i){if(e.read)for(let s of e.read)s.index>o.index&&-1==n.indexOf(s)&&(n.push(s),"expression"==s.from.type||"template"==s.from.type?t.push({from:s.from,to:s.to}):"errorOutput"==i?t.push({from:new C(r),to:s.to}):t.push({from:new M(r),to:s.to}));if(e.children)for(let s in e.children)this.handleReadRefs(e.children[s],t,n,r.length>0?r+"."+s:s,o,i)}}},{"./BlockContext":1,"./Conditions":4,"./Generator":10,"./ReferenceFinder":12,"./ReferenceTree":13,"./Visitor":15,"./blocks/ApiBlock":16,"./blocks/CallBlock":18,"./blocks/CodeBlock":19,"./blocks/CopyModelBlock":20,"./blocks/DataBlock":21,"./blocks/IfBlock":23,"./blocks/NewVarBlock":25,"./blocks/RelatedScreensBlock":26,"./blocks/ScreenBlock":27,"./blocks/SetDataBlock":28,"./blocks/TransformBlock":29,"./blocks/TryCatchBlock":30,"./blocks/UpdateUserInfoBlock":31,"./fields/ActionField":32,"./fields/ConditionField":33,"./fields/ConstantField":34,"./fields/ErrorOutputField":35,"./fields/ExpressionField":36,"./fields/InputField":38,"./fields/InputMappingsField":39,"./fields/ModelField":40,"./fields/OutputField":41,"./fields/TemplateField":42,"./fields/UnknownField":43,"./fields/VariableField":44,"./util/fieldUtil":49,lodash:48}],9:[function(e,t,n){t.exports=class{constructor(e){this.id=e,this.fake=!0}getLabel(){return this.id}getId(){return this.id}isFake(){return!0}getRootContextBody(){return[]}isCode(){return!1}}},{}],10:[function(e,t,n){(function(n){const r="undefined"!=typeof window?window.esprima:void 0!==n?n.esprima:null,o="undefined"!=typeof window?window.escodegen:void 0!==n?n.escodegen:null,i="undefined"!=typeof window?window.isVarName:void 0!==n?n.isVarName:null,s=e("lodash"),a=e("jsesc");t.exports=class{constructor(){}createIdentifier(e){return{type:"Identifier",name:e}}createLiteral(e){return{type:"Literal",value:e}}createCallExpressionWithLiteralArgs(e,t){return this.createCallExpression(e,t.map(this.createLiteral))}createCallExpression(e,t){return{type:"CallExpression",callee:this.createIMEFromArray(e),arguments:t}}createCallExpressionWithCallee(e,t){return{type:"CallExpression",callee:e,arguments:t}}createIMEFromPath(e){return this.createAssignRightExpressionFromString(e)}createIMEFromArray(e){let t=e.length>0?this.createIdentifier(e[0]):null;return this.createMemberExpressionFromMainObjAndArray(t,e.slice(1))}createMemberExpressionFromMainObjAndArray(e,t){let n=e;for(let e=0;e<t.length;e++){let r=i(t[e]),o={};o.type="MemberExpression",o.computed=!r,o.property=r?this.createIdentifier(t[e]):this.createLiteral(t[e]),o.object=n,n=o}return n}createLiteralsArrayExpression(e){return this.createArrayExpression(e.map(this.createLiteral))}createObjectProperty(e,t){let n=i(e);return{type:"Property",key:n?this.createIdentifier(e):this.createLiteral(e),computed:!n,value:t,kind:"init",method:!1,shorthand:!1}}createArrayExpression(e){return{type:"ArrayExpression",elements:e}}createVariableDeclaration(e,t,n){return{type:"VariableDeclaration",declarations:[{type:"VariableDeclarator",id:this.createIdentifier(t),init:n}],kind:e}}createRequireVariableDeclaration(e,t,n){return this.createVariableDeclaration("const",e,this.createMemberExpressionFromMainObjAndArray(this.createCallExpressionWithLiteralArgs(["require"],[t]),n))}createMainRequireVariableDeclaration(e,t,n){return this.createVariableDeclaration("const",e,this.createMemberExpressionFromMainObjAndArray(this.createCallExpressionWithLiteralArgs(["require","main","require"],[t]),n))}createEqualsExpressionStatement(e){return this.createExpressionStatement({type:"AssignmentExpression",operator:"=",left:e.left,right:e.right})}createEmptyProgram(){return r.parseScript("",{attachComment:!0})}createStatementsFromString(e){try{return r.parseScript(e,{attachComment:!0}).body}catch(t){return console.error("The string",e,"is not valid"),[]}}createAssignRightExpressionFromString(e,t){let n,r="f = async function() {\n"+(n=s.isString(e)?0==e.indexOf("$EXPR$")?"x = "+e.substring(6):t?"x = '"+a(e)+"'":"x = "+e:"x = "+e)+"\n}",o=this.createStatementsFromString(r);if(1==o.length){let t=o[0].expression.right.body.body;if(t.length>1)throw console.error("createAssignmentExpressionFromString: More than one statement in an expression block:",e),"createAssignmentExpressionFromString: More than one statement in an expression block!";if("ExpressionStatement"==t[0].type)return t[0].expression.right;throw console.error("createAssignmentExpressionFromString: Unexpected type of expression block: "+t[0].type+"!"),"createAssignmentExpressionFromString: Unexpected type of expression block: "+t[0].type+"!"}throw"createAssignmentExpressionFromString: Unable to parse expression string!"}createExpressionStatement(e){return{type:"ExpressionStatement",expression:e}}createBlockStatement(e){return{type:"BlockStatement",body:e}}createReturnStatement(e){return{type:"ReturnStatement",argument:e}}createTryCatchStatement(e,t,n){return{type:"TryStatement",block:{type:"BlockStatement",body:e},handler:{type:"CatchClause",param:{type:"Identifier",name:t},body:{type:"BlockStatement",body:n}},finalizer:null}}createArrowFunctionExpression(e,t,n){return{type:"ArrowFunctionExpression",id:null,params:t.map(this.createIdentifier),body:n,generator:!1,expression:!1,async:e}}createLogicalExpression(e,t,n){return{type:"LogicalExpression",operator:e,left:t,right:n}}createUnaryExpression(e,t){return{type:"UnaryExpression",operator:e,argument:t,prefix:!0}}createBinaryExpression(e,t,n){return{type:"BinaryExpression",operator:e,left:t,right:n}}createAwaitStatement(e){return{type:"AwaitExpression",argument:e}}createIfStatement(e,t,n){return{type:"IfStatement",test:e,consequent:{type:"BlockStatement",body:t},alternate:n.length>0?{type:"BlockStatement",body:n}:null}}createAwaitExpressionStatement(e){return this.createExpressionStatement(this.createAwaitStatement(e))}createObjectExpression(e){return{type:"ObjectExpression",properties:e}}createConstantObjectExpressionFromJSON(e){if("{}"==e)return this.createObjectExpression([]);console.error("Unhandled constant object expression")}createConstantArrayExpressionFromJSON(e){return this.createLiteralsArrayExpression(JSON.parse(e))}generateProgram(e){return o.generate(e,{comment:!0})}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{jsesc:47,lodash:48}],11:[function(e,t,n){const r=e("./Generator");t.exports=class extends r{constructor(){super(),this.treeRoots={}}getTreeRoot(e){return this.treeRoots.hasOwnProperty(e)||(this.treeRoots[e]=new o(e)),this.treeRoots[e]}addMappings(e){for(let t of e)this.getTreeRoot(t.to.type).insert(t.to.getFullPath(),t.from)}getNewInputVariableName(e){let t=2,n="input";for(;e.hasOwnProperty(n);)n="input"+t++;return e[n]=!0,n}releaseInputVariableName(e,t){delete e[t]}getNewOutputVariableName(e,t){let n=t||"output",r=2,o=n;for(;e.hasOwnProperty(o);)o=n+r++;return e[o]=!0,o}releaseOutputVariableName(e,t){delete e[t]}getInputExpression(e,t){let n=[],r=this.getNewInputVariableName(t);if(this.treeRoots.input&&this.treeRoots.input.generate(r,{},this,n,null,null,null,t),0==n.length)return this.releaseInputVariableName(t,r),null;if(1==n.length)return this.releaseInputVariableName(t,r),n[0].expression.right;n[0]=this.createVariableDeclaration("let",r,n[0].expression.right);for(let t of n)e.push(t);return this.createIdentifier(r)}getOutputExpression(e,t,n,r,o,i){let s=[],a=this.getNewOutputVariableName(o,i);if(this.treeRoots.vars&&this.treeRoots.vars.generate("vars",{},this,s,a,n,r,o),this.treeRoots.models&&this.treeRoots.models.generate("models",{},this,s,a,n,r,o),0==s.length)return this.releaseOutputVariableName(o,a),void t.push(this.createExpressionStatement(e));if(1==s.length){let n=s[0].expression.right;if("Identifier"==n.type&&n.name==a)return void("Identifier"!==s[0].expression.left.type?(this.releaseOutputVariableName(o,a),t.push(this.createEqualsExpressionStatement({left:s[0].expression.left,right:e}))):t.push(this.createVariableDeclaration("let",a,e)))}t.push(this.createVariableDeclaration("let",a,e));for(let e of s)t.push(e)}getMappingsExpression(e,t,n,r){this.treeRoots.vars&&this.treeRoots.vars.generate("vars",{},this,e,"__output__",t,n,r),this.treeRoots.models&&this.treeRoots.models.generate("models",{},this,e,"__output__",t,n,r)}getScript(e,t){let n=this.createEmptyProgram();var r={};let o,i=this.getInputExpression(n.body,r);return o=i?this.createCallExpression([e],[i]):this.createCallExpression([e],[]),this.getOutputExpression(o,n.body,null,null,r,t),this.generateProgram(n)}};class o{constructor(e){this.id=e,this.source=null,this.children=[]}createObjectExpression(e,t,n){e[t]=!0;let r=[];for(let o of this.children){let i,s=t+"."+o.id;o.source?(e[s]=!0,i=o.source.generate()):i=o.createObjectExpression(e,s,n),r.push(n.createObjectProperty(o.id,i))}return n.createObjectExpression(r)}generate(e,t,n,r,o,i,s,a){t[e]||(this.source?"errorOutput"==this.source.type?(i||(i=r,s="errorOutput"),this.createExpressionStatement(i,e,n,this.source.generate(s),a)):(this.source.type,this.createExpressionStatement(r,e,n,this.source.generate(o),a)):o||this.createExpressionStatement(r,e,n,this.createObjectExpression(t,e,n),a));for(let l of this.children)l.generate(e+"."+l.id,t,n,r,o,i,s,a)}createExpressionStatement(e,t,n,r,o){if(0==t.indexOf("vars.local.")&&(t=t.substring(11),!o.hasOwnProperty(t)))return o[t]=!0,void e.push(n.createVariableDeclaration("let",t,r));e.push(n.createEqualsExpressionStatement({left:n.createIMEFromPath(t),right:r}))}findChild(e){for(let t of this.children)if(t.id==e)return t;return null}insert(e,t){let n=this.isArray?this.id+"[]":this.id;if(0==e.indexOf(n)){let r=e.slice(n.length+1);if(0==r.length)this.source=t;else{let e=r.indexOf("."),n=-1==e?r:r.substring(0,e),i=n.indexOf("[]"),s=-1!==i&&i==n.length-2;s&&(n=n.substring(0,n.length-2));let a=this.findChild(n);a||(a=new o(n),this.children.push(a)),a.isArray=s,a.insert(r,t)}}else console.error("Insert path passed into the wrong node!!!")}}},{"./Generator":10}],12:[function(e,t,n){const r=e("./Visitor"),o=e("./Generator");t.exports=class extends o{constructor(){super(),this.references=[],this.localVariables=[]}parse(e){new class extends r{constructor(e,t){super(),this.referenceFinder=e,this.visitNode(t)}visitBinaryExpression(e){this.visitNode(e.left),this.visitNode(e.right)}visitMemberExpression(e){let t=this.IMEtoArray(e).join(".");this.referenceFinder.addReference(t)}visitLiteral(e){}visitObjectExpression(e){for(let t of e.properties)this.visitNode(t)}visitProperty(e){this.visitNode(e.value)}visitCallExpression(e){"MemberExpression"==e.callee.type&&this.visitNode(e.callee.object);for(let t of e.arguments)this.visitNode(t)}visitTemplateLiteral(e){for(let t of e.expressions)this.visitNode(t)}visitArrowFunctionExpression(e){this.visitNode(e.body)}visitFunctionExpression(e){this.visitNode(e.body)}visitAssignmentExpression(e){if(this.isEqualsOperator(e.operator)&&this.isIME(e.left)&&this.isFunctionExpression(e.right)){let t=this.IMEtoArray(e.left);if("exports"==t[0])return this.referenceFinder.inEventArea=!0,this.visitNode(e.right),void(this.referenceFinder.inEventArea=!1)}this.visitNode(e.left),this.visitNode(e.right)}visitArrayExpression(e){for(let t of e.elements)this.visitNode(t)}visitAwaitExpression(e){this.visitNode(e.argument)}visitIdentifier(e){this.referenceFinder.addReference(e.name)}visitVariableDeclaration(e){e.kind;for(let t of e.declarations)this.visitNode(t)}visitVariableDeclarator(e){this.referenceFinder.addLocalVariable(e.id.name),e.init&&this.visitNode(e.init)}visitForStatement(e){this.referenceFinder.inBlockScope=!0,e.init&&this.visitNode(e.init),e.test&&this.visitNode(e.test),e.update&&this.visitNode(e.update),e.body&&this.visitNode(e.body),this.referenceFinder.inBlockScope=!1}visitForOfStatement(e){this.referenceFinder.inBlockScope=!0,this.visitNode(e.left),this.visitNode(e.right),this.visitNode(e.body),this.referenceFinder.inBlockScope=!1}visitIfStatement(e){this.visitNode(e.test),e.consequent&&this.visitNode(e.consequent),e.alternate&&this.visitNode(e.alternate)}visitTryStatement(e){this.visitNode(e.block),e.handler&&this.visitNode(e.handler),e.finalizer&&this.visitNode(e.finalizer)}visitCatchClause(e){this.visitNode(e.body)}visitReturnStatement(e){this.visitNode(e.argument)}visitLogicalExpression(e){this.visitNode(e.left),this.visitNode(e.right)}visitUnaryExpression(e){this.visitNode(e.argument)}visitCallExpression(e){"MemberExpression"==e.callee.type&&this.visitNode(e.callee.object);for(let t of e.arguments)this.visitNode(t)}visitUpdateExpression(e){this.visitNode(e.argument)}}(this,e)}addReference(e){this.references.push(e)}addLocalVariable(e){this.inEventArea&&!this.inBlockScope&&this.localVariables.push(e)}getReferences(){return this.references}getLocalVariables(){return this.localVariables}}},{"./Generator":10,"./Visitor":15}],13:[function(e,t,n){const r=e("./util/fieldUtil");t.exports=class{constructor(e){this.referenceTree={},this.localVariables=e}lookup(e){return this.referenceTree[e]}addMainBlockForCatch(e,t){this.addToRefTree("errorOutput","","update",e)}addDataMapping(e,t){if(!e.from||"vars"!=e.from.type&&"models"!=e.from.type&&"errorOutput"!=e.from.type||this.addToRefTree(e.from.type,e.from.path,"read",e),e.from&&"expression"==e.from.type&&e.from.expressionRefs){let n=[];for(let o of e.from.expressionRefs){let i=o.split("."),s=r.createPathBasedField(i,this.localVariables,t);if(s&&"unknown"!==s.type&&this.addToRefTree(s.getType(),s.getPath(),"read",e),"vars"==s.type&&0==s.path.indexOf("local.")){i[0]="__variable__";let e=i.join(".");n.push({original:o,replacement:e})}}e.from.replacementRefs=n,delete e.from.expressionRefs}!e.to||"vars"!=e.to.type&&"models"!=e.to.type&&"errorOutput"!=e.to.type||this.addToRefTree(e.to.type,e.to.path,"update",e)}addBlock(e,t){if("newvar"==e.type)this.addToRefTree("vars",e.path,"create",e);else if("data"==e.type)this.addDataMapping(e,t);else if("api"==e.type||"transform"==e.type||"copyModel"==e.type){if(e.input)if("vars"==e.input.type||"models"==e.input.type||"errorOutput"==e.input.type)this.addToRefTree(e.input.type,e.input.path,"read",e);else if("inputMappings"==e.input.type)for(let n of e.input.arrMappings)this.addDataMapping(n,t);!e.output||"vars"!=e.output.type&&"model"!=e.output.type&&"errorOutput"!=e.output.type||this.addToRefTree(e.output.type,e.output.path,"update",e)}else"screen"==e.type?this.addToRefTree("models",e.screenId,"read",e):"if"==e.type||"tryCatch"==e.type||"code"==e.type||console.log("updateReferenceTree",e.type)}addToRefTree(e,t,n,r){let o,i,s=t.split(".");if("errorOutput"==e)return 0==t.length&&(s=[]),void this.setInRefTree(this.referenceTree,e,s,n,r);"vars"==e?(o=s.slice(0,2).join("."),i=s.slice(2)):(o=s.slice(0,1).join("."),i=s.slice(1)),this.setInRefTree(this.referenceTree,e+"."+o,i,n,r)}setInRefTree(e,t,n,r,o){e.hasOwnProperty(t)||(e[t]={}),n.length>0?(e[t].hasOwnProperty("children")||(e[t].children={}),this.setInRefTree(e[t].children,n[0],n.slice(1),r,o)):(e[t].hasOwnProperty(r)||(e[t][r]=[]),e[t][r].push(o))}}},{"./util/fieldUtil":49}],14:[function(e,t,n){const r=e("./Visitor"),o=e("./Generator"),i=(e("./Constants"),e("./Conditions"));t.exports=class extends o{constructor(){super(),this.conditionsTree=null}getConditionsTree(){return this.conditionsTree}setConditionsTree(e){this.conditionsTree=e}parse(e){new class extends r{constructor(e,t){super(),this.triggerConditions=e,this.identifiers=this.getParameterIdentifiers(t.params),this.visitNode(t.body)}visitReturnStatement(e){this.visitNode(e.argument)}visitLogicalExpression(e){let t=new i;t.parse(e,this.identifiers),this.triggerConditions.setConditionsTree(t.getConditionsTree())}visitCallExpression(e){console.error("Ignored call expression in Trigger Conditions.")}visitBinaryExpression(e){let t=new i;t.parse(e,this.identifiers),this.triggerConditions.setConditionsTree(t.getConditionsTree())}visitUnaryExpression(e){let t=new i;t.parse(e,this.identifiers),this.triggerConditions.setConditionsTree(t.getConditionsTree())}visitMemberExpression(e){let t=new i;t.parse(e,this.identifiers),this.triggerConditions.setConditionsTree(t.getConditionsTree())}}(this,e)}}},{"./Conditions":4,"./Constants":5,"./Generator":10,"./Visitor":15}],15:[function(e,t,n){(function(n){const r=e("lodash"),o="undefined"!=typeof window?window.escodegen:void 0!==n?n.escodegen:null;let i={};t.exports=class{constructor(){}visitNode(e){switch(e.type){case"ArrayExpression":return this.visitArrayExpression(e);case"ArrowFunctionExpression":return this.visitArrowFunctionExpression(e);case"AssignmentExpression":return this.visitAssignmentExpression(e);case"AwaitExpression":return this.visitAwaitExpression(e);case"BinaryExpression":return this.visitBinaryExpression(e);case"BlockStatement":return this.visitBlockStatement(e);case"CallExpression":return this.visitCallExpression(e);case"CatchClause":return this.visitCatchClause(e);case"ExpressionStatement":return this.visitExpressionStatement(e);case"ForOfStatement":return this.visitForOfStatement(e);case"ForStatement":return this.visitForStatement(e);case"FunctionDeclaration":return this.visitFunctionDeclaration(e);case"FunctionExpression":return this.visitFunctionExpression(e);case"Identifier":return this.visitIdentifier(e);case"IfStatement":return this.visitIfStatement(e);case"Literal":return this.visitLiteral(e);case"LogicalExpression":return this.visitLogicalExpression(e);case"MemberExpression":return this.visitMemberExpression(e);case"ObjectExpression":return this.visitObjectExpression(e);case"Program":return this.visitProgram(e);case"Property":return this.visitProperty(e);case"ReturnStatement":return this.visitReturnStatement(e);case"TemplateLiteral":return this.visitTemplateLiteral(e);case"TryStatement":return this.visitTryStatement(e);case"UnaryExpression":return this.visitUnaryExpression(e);case"UpdateExpression":return this.visitUpdateExpression(e);case"VariableDeclaration":return this.visitVariableDeclaration(e);case"VariableDeclarator":return this.visitVariableDeclarator(e);default:console.log("Unhandled node type",e.type)}}isCallExpression(e,t){if("CallExpression"==e.type&&this.isIME(e.callee)){if(t){let n=this.IMEtoArray(e.callee);return r.isEqual(n,t)}return!0}return!1}isMECallExpression(e,t,n,o){let{arr:i,node:s}=this.MEtoArrayPlusMainObj(e);return this.isCallExpression(s,t)&&this.hasLiteralArguments(s,n)&&r.isEqual(i,o)}isIME(e){return"MemberExpression"==e.type||"Identifier"==e.type}isPureIME(e){let t=!1;for(;"MemberExpression"==e.type;){if(t=!0,"Identifier"!=e.property.type&&"Literal"!=e.property.type)return!1;e=e.object}return!!("Identifier"==e.type||"Literal"==e.type&&t)}isEqualsOperator(e){return"="==e}isFunctionExpression(e){return"ArrowFunctionExpression"==e.type||"FunctionExpression"==e.type}isObjectExpression(e){return"ObjectExpression"==e.type}isIdentifier(e){return"Identifier"==e.type}isBinaryExpression(e){return"BinaryExpression"==e.type}isLiteral(e){return"Literal"==e.type}isArrayExpression(e){return"ArrayExpression"==e.type}IMEtoArray(e){let{arr:t,node:n}=this.MEtoArrayPlusMainObj(e);return"Identifier"==n.type?t.unshift(n.name):console.log("Unexpected type",n.type),t}MEtoArrayPlusMainObj(e){for(var t=[];"MemberExpression"==e.type;)"Identifier"==e.property.type?t.unshift(e.property.name):"Literal"==e.property.type?t.unshift(e.property.value):console.log("Unknown type of node property when testing Member Expression."),e=e.object;return{arr:t,node:e}}hasLiteralArguments(e,t){let n=[];for(let t of e.arguments)"Literal"==t.type?n.push(t.value):n.push(void 0);return r.isEqual(n,t)}visitProgram(e){for(let t of e.body)this.visitNode(t)}visitVariableDeclaration(e){for(let t of e.declarations)this.visitNode(t)}visitExpressionStatement(e){this.visitNode(e.expression)}visitBlockStatement(e){for(let t of e.body)this.visitNode(t)}visitArrayExpression(e){this.unexpectedNode(e)}visitArrowFunctionExpression(e){this.unexpectedNode(e)}visitAssignmentExpression(e){this.unexpectedNode(e)}visitAwaitExpression(e){this.unexpectedNode(e)}visitBinaryExpression(e){this.unexpectedNode(e)}visitCallExpression(e){this.unexpectedNode(e)}visitCatchClause(e){this.unexpectedNode(e)}visitForOfStatement(e){this.unexpectedNode(e)}visitForStatement(e){this.unexpectedNode(e)}visitFunctionDeclaration(e){this.unexpectedNode(e)}visitFunctionExpression(e){this.unexpectedNode(e)}visitIdentifier(e){this.unexpectedNode(e)}visitIfStatement(e){this.unexpectedNode(e)}visitLiteral(e){this.unexpectedNode(e)}visitLogicalExpression(e){this.unexpectedNode(e)}visitMemberExpression(e){this.unexpectedNode(e)}visitObjectExpression(e){this.unexpectedNode(e)}visitProperty(e){this.unexpectedNode(e)}visitReturnStatement(e){this.unexpectedNode(e)}visitTemplateLiteral(e){this.unexpectedNode(e)}visitTryStatement(e){this.unexpectedNode(e)}visitUnaryExpression(e){this.unexpectedNode(e)}visitUpdateExpression(e){this.unexpectedNode(e)}visitVariableDeclarator(e){this.unexpectedNode(e)}unexpectedNode(e){console.error("Unexpected node:",this.nodeAsString(e))}makeUniqueId(e){let t=1,n=e+t;for(;i.hasOwnProperty(n);)n=e+ ++t;return i[n]=!0,n}makeUniqueIdIfNecessary(e){let t=1,n=e;for(;i.hasOwnProperty(n);)n=e+t++;return i[n]=!0,n}readArrayOfLiteralsFromArrayExpression(e){return"ArrayExpression"==e.type?this.readArrayOfLiterals(e.elements):[]}readArrayOfLiterals(e){let t=[];for(let n of e)"Literal"==n.type&&t.push(n.value);return t}getParameterIdentifiers(e){let t={session:"session",models:"models",vars:"vars"};return e.length>0&&this.isIdentifier(e[0].type)&&(t.session=e[0].name),e.length>1&&this.isIdentifier(e[1].type)&&(t.models=e[1].name),e.length>2&&this.isIdentifier(e[2].type)&&(t.vars=e[2].name),t}nodeAsString(e){return o.generate(e)}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{lodash:48}],16:[function(e,t,n){const r=e("./MappingBlock");t.exports=class extends r{constructor(e,t){super("api"),this.apiId=e,this.method=t}getIcon(){return"fa-plug"}getLabel(){return this.apiId+" - "+this.method}getDefId(){return`${this.type}.${this.apiId}.${this.method}`}generate(e,t,n,r){this.generateMappingBlock(e,t,n,r,["session","api",this.apiId,this.method],[])}}},{"./MappingBlock":24}],17:[function(e,t,n){const r=e("../Generator");let o={};t.exports=class extends r{constructor(e){super(),this.type=e,o.hasOwnProperty(e)||(o[e]=0),this.id=e+o[e]++}getId(){return this.id}getDefId(){return this.type}hasSubContexts(){return!1}hasSubContextBlocks(){return!1}getSubContexts(){return[]}getLabel(){return"Block"}getIcon(){return"fa-table"}hasSettings(){return!1}generate(e){console.error("Unhandled block:",this.type)}getSinglePath(){return this._makeSinglePath()}getPaths(){return this.hasSubContextBlocks()?this.getSubContexts().map((e,t)=>this._makeMultiPath(t)):[this._makeSinglePath()]}_makeSinglePath(){return"M100 0 v32"}_makeMultiPath(e){const t=0===e?0:200;return 100>t?"M100 0 L100,6 A6,6 0 0,1 94,12 L"+(t+6)+",12 A6,6 0 0,0 "+t+",18 L"+t+",33":"M100 0 L100,6 A6,6 0 0,0 106,12 L"+(t-6)+",12 A6,6 0 0,1 "+t+",18 L"+t+",33"}}},{"../Generator":10}],18:[function(e,t,n){const r=e("./Block");e("../BlockContext"),e("../Conditions");t.exports=class extends r{constructor(e,t){super("call"),this.eventName=e,this.awaitCall=t}getLabel(){return(this.awaitCall?"Call &amp; Wait":"Call")+"<br>"+this.eventName}getIcon(){return"fa-share"}hasSettings(){return!0}generate(e,t,n,r){let o=this.createLiteral(this.eventName),i=this.createIdentifier("session"),s=this.createIdentifier("models"),a=this.createIdentifier("vars"),l=this.createCallExpression(["session","call"],[o,i,s,a]);l=this.awaitCall?this.createAwaitExpressionStatement(l):this.createExpressionStatement(l),e.push(l)}}},{"../BlockContext":1,"../Conditions":4,"./Block":17}],19:[function(e,t,n){const r=e("./Block");t.exports=class extends r{constructor(e){super("code"),this.code=e}getIcon(){return"fa-code"}getLabel(){return"Code"}hasSettings(){return!0}generate(e){let t=this.createStatementsFromString(this.code);for(let n of t)e.push(n)}}},{"./Block":17}],20:[function(e,t,n){const r=e("./MappingBlock");t.exports=class extends r{constructor(){super("copyModel")}getLabel(){return"Copy Model"}generate(e,t,n,r){this.generateMappingBlock(e,t,n,r,["session","copyModel"],[])}}},{"./MappingBlock":24}],21:[function(e,t,n){const r=e("./Block");t.exports=class extends r{constructor(e,t){super("data"),this.from=e,this.to=t}}},{"./Block":17}],22:[function(e,t,n){const r=e("./Block");t.exports=class extends r{constructor(){super("fake")}getIcon(){return"fa-mouse-pointer"}getLabel(){return"..."}}},{"./Block":17}],23:[function(e,t,n){const r=e("./Block"),o=e("../BlockContext"),i=e("../Conditions");t.exports=class extends r{constructor(){super("if"),this.truePart=new o,this.falsePart=new o,this.conditionsTree={operator:"&&",children:[]}}getLabel(){return"If/Then"}getIcon(){return"fa-question-circle"}hasSettings(){return!0}hasSubContexts(){return!0}getSubContexts(){return[this.truePart,this.falsePart]}hasSubContextBlocks(){return this.truePart.body.length>0||this.falsePart.body.length>0}generate(e,t,n,r){let o=[],s=[];var a=new i(this.conditionsTree).generate();for(let e of this.truePart.body)e.generate(o,t,n,r);for(let e of this.falsePart.body)e.generate(s,t,n,r);e.push(this.createIfStatement(a,o,s))}parse(e,t,n){let r=e.eventAreaParser,o=new i;o.parse(t.test,n),this.conditionsTree=o.getConditionsTree();let s=r.switchBlockContext(this.truePart);e.visitNode(t.consequent),r.collapseDataNodes(this.truePart),r.switchBlockContext(this.falsePart),t.alternate&&e.visitNode(t.alternate),r.collapseDataNodes(this.falsePart),r.switchBlockContext(s)}}},{"../BlockContext":1,"../Conditions":4,"./Block":17}],24:[function(e,t,n){const r=e("./Block"),o=e("../MappingsTree");t.exports=class extends r{constructor(e){super(e),this.clearMappings()}getMappings(){return this.mappings}clearMappings(){this.mappings=[]}getCustomInputTree(){return null}hasSettings(){return!0}addMapping(e){this.mappings.push(e)}generateMappingBlock(e,t,n,r,i,s){let a=new o;this.hasOwnProperty("mappings")&&a.addMappings(this.mappings);let l=a.getInputExpression(e,r),c=[...s];l&&c.push(l);let d=this.createAwaitStatement(this.createCallExpression(i,c));a.getOutputExpression(d,e,t,n,r,this.outputVariableName)}generateMappingsOnlyBlock(e,t,n,r){let i=new o;this.hasOwnProperty("mappings")&&i.addMappings(this.mappings),i.getMappingsExpression(e,t,n,r)}}},{"../MappingsTree":11,"./Block":17}],25:[function(e,t,n){const r=e("./Block");t.exports=class extends r{constructor(e){super("newvar"),this.path=e}}},{"./Block":17}],26:[function(e,t,n){const r=e("./Block"),o=e("../fields/VariableField");t.exports=class extends r{constructor(e){super("relatedscreens"),this.screenIds=e,this.dataField=new o("page")}setDataField(e){this.dataField=e}getIcon(){return"fa-mobile"}getLabel(){return"Screens: "+this.screenIds.join(",")}generate(e){let t=this.createAwaitExpressionStatement(this.createCallExpression(["session","relatedScreens"],[this.createLiteralsArrayExpression(this.screenIds),this.dataField.generate()]));e.push(t)}}},{"../fields/VariableField":44,"./Block":17}],27:[function(e,t,n){const r=e("./MappingBlock");t.exports=class extends r{constructor(e){super("screen"),this.screenId=e,this.clearMappings()}clearMappings(){this.mappings=[]}addMapping(e){this.mappings.push(e)}getIcon(){return"fa-mobile"}getLabel(){return"Screen: "+this.screenId}generate(e,t,n){this.generateMappingsOnlyBlock(e,t,n);let r=this.createAwaitExpressionStatement(this.createCallExpressionWithLiteralArgs(["session","screen"],[this.screenId]));e.push(r)}}},{"./MappingBlock":24}],28:[function(e,t,n){const r=e("./MappingBlock");t.exports=class extends r{constructor(){super("setdata")}getLabel(){return"Set Data"}getDefId(){return"session.data"}generate(e,t,n,r){this.generateMappingsOnlyBlock(e,t,n,r)}}},{"./MappingBlock":24}],29:[function(e,t,n){const r=e("./MappingBlock"),o=e("../fields/ConstantField"),i=e("../fields/InputField"),s=e("../fields/ActionField");t.exports=class extends r{constructor(e,t){super("transform"),this.args={},this.transformId=e,this.method=t}setArguments(e){this.args=e}setPageModel(e){this.args.pageModel=new o(e,"string")}getPageModel(){return this.args.pageModel&&this.args.pageModel.value?this.args.pageModel.value:null}setAction(e){this.args.action=new s,this.args.action.setActionPath(e)}clearMappings(){if("url"==this.method)delete this.args.url;else if("authenticate"==this.method)delete this.args.username,delete this.args.password,delete this.args.urlPattern;else if("screenshot"==this.method)delete this.args.imageFilePath;else if("acceptDialog"==this.method||"dismissDialog"==this.method)delete this.args.promptText;else{if("checkState"!=this.method)return super.clearMappings();delete this.args.softCheck}}getCustomInputTree(){return"url"==this.method?{arguments:{type:"object",properties:{url:{type:"string"}}}}:"authenticate"==this.method?{arguments:{type:"object",properties:{username:{type:"string"},password:{type:"string"},urlPattern:{type:"string"}}}}:"screenshot"==this.method?{arguments:{type:"object",properties:{imageFilePath:{type:"string"}}}}:"acceptDialog"==this.method||"dismissDialog"==this.method?{arguments:{type:"object",properties:{promptText:{type:"string"}}}}:"checkState"==this.method?{arguments:{type:"object",properties:{softCheck:{type:"boolean"}}}}:null}handleArgMappings(e,t){for(let n of e)if(t.to.path==n)return void(this.args[n]=t.from);if(""==t.to.path)for(let n of e)this.args[n]=t.from,this.args[n].path+="."+n;else console.log("Error: unexpected mapping path",t.to.path)}addMapping(e){if("url"==this.method)this.handleArgMappings(["url"],e);else if("authenticate"==this.method)this.handleArgMappings(["username","password","urlPattern"],e);else if("screenshot"==this.method)this.handleArgMappings(["imageFilePath"],e);else if("acceptDialog"==this.method||"dismissDialog"==this.method)this.handleArgMappings(["promptText"],e);else{if("checkState"!=this.method)return super.addMapping(e);this.handleArgMappings(["softCheck"],e)}}getArgMappings(e){let t=[];for(let n of e)t.push({from:this.args[n],to:new i(n)});return t}getMappings(){return"url"==this.method?this.getArgMappings(["url"]):"authenticate"==this.method?this.getArgMappings(["username","password","urlPattern"]):"screenshot"==this.method?this.getArgMappings(["imageFilePath"]):"acceptDialog"==this.method||"dismissDialog"==this.method?this.getArgMappings(["promptText"]):"checkState"==this.method?this.getArgMappings(["softCheck"]):super.getMappings()}hasSettings(){return"extract"==this.method||"update"==this.method||"url"==this.method||"authenticate"==this.method||"screenshot"==this.method||"evalSync"==this.method||"acceptDialog"==this.method||"dismissDialog"==this.method||"uploadFiles"==this.method||"imageDataUri"==this.method||"checkState"==this.method}getLabel(){return"action"==this.method?this.transformId+" "+this.args.pageModel.toString()+"<br>"+this.args.action.toString():this.args.hasOwnProperty("pageModel")&&this.args.pageModel?this.transformId+" "+this.args.pageModel.toString()+"<br>"+this.method:this.transformId+" "+this.method}getIcon(){return"start"==this.method?"fa-play":"stop"==this.method?"fa-stop":"extract"==this.method?"fa-arrow-circle-right":"update"==this.method?"fa-pencil-square-o":"action"==this.method?"fa-bolt":"url"==this.method?"fa-chrome":"close"==this.method?"fa-window-close":"authenticate"==this.method?"fa-id-card":"screenshot"==this.method?"fa-camera":"evalSync"==this.method?"fa-file-code-o":"acceptDialog"==this.method?"fa-check-circle-o":"dismissDialog"==this.method?"fa-times-circle-o":"uploadFiles"==this.method?"fa-upload":"imageDataUri"==this.method?"fa-picture-o":"checkState"==this.method?"fa-question-circle-o":"fa-square-o"}generate(e,t,n,r){let o=[],i=Object.keys(this.args);for(let e of i)o.push(this.args[e].generate());this.generateMappingBlock(e,t,n,r,["session","transform",this.transformId,this.method],o)}}},{"../fields/ActionField":32,"../fields/ConstantField":34,"../fields/InputField":38,"./MappingBlock":24}],30:[function(e,t,n){const r=e("./Block"),o=e("../BlockContext");t.exports=class extends r{constructor(){super("tryCatch"),this.tryPart=new o,this.catchPart=new o,this.mainBlock=new r,this.strCatchIdentifier="errorOutput"}getMappings(){return this.mainBlock.getMappings()}getDefId(){return this.mainBlock.getDefId()}getMainBlock(){return this.mainBlock}setMainBlock(e){this.mainBlock=e}hasSettings(){return this.mainBlock.hasSettings()}getLabel(){return this.mainBlock.getLabel()}getIcon(){return this.mainBlock.getIcon()}hasSubContexts(){return!0}getSubContexts(){return[this.tryPart,this.catchPart]}hasSubContextBlocks(){return this.tryPart.body.length>0||this.catchPart.body.length>0}parse(e,t){let n=e.eventAreaParser,r=n.switchBlockContext(this.tryPart);e.visitNode(t.block),n.collapseDataNodes(this.tryPart),this.mainBlock=this.tryPart.body.shift(),n.referenceTree.addMainBlockForCatch(this.mainBlock),this.mainBlock.errorOutput={},n.switchBlockContext(this.catchPart),e.visitNode(t.handler),n.collapseDataNodes(this.catchPart,this.mainBlock),this.strCatchIdentifier=t.handler.param.name,n.switchBlockContext(r)}generate(e,t,n,r){let o=[],i=[];this.mainBlock.generate(o,i,this.strCatchIdentifier,r);for(let e of this.tryPart.body)e.generate(o,i,this.strCatchIdentifier,r);for(let e of this.catchPart.body)e.generate(i,i,this.strCatchIdentifier,r);e.push(this.createTryCatchStatement(o,this.strCatchIdentifier,i))}}},{"../BlockContext":1,"./Block":17}],31:[function(e,t,n){const r=e("./MappingBlock");t.exports=class extends r{constructor(){super("updateUserInfo")}getIcon(){return"fa-user-circle"}getLabel(){return"Update User Info"}getDefId(){return"session.updateUserInfo"}getCustomInputTree(){return{userInfo:{type:"object",properties:{userId:{type:"string"},displayName:{type:"string"}}}}}generate(e,t,n,r){this.createIdentifier("session");this.generateMappingBlock(e,t,n,r,["session","updateUserInfo"],[])}}},{"./MappingBlock":24}],32:[function(e,t,n){const r=e("./Field"),o=e("./ConstantField"),i=e("./TemplateField");t.exports=class extends r{constructor(){super("action")}setActionPath(e){-1==e.indexOf("[]")?this.field=new o(e,"string"):this.field=new i(this.createTemplate(e))}setField(e){this.field=e}generate(e,t,n,r){return this.field.generate(e,t,n,r)}toString(){let e=this.field.toString();return"`"==e.charAt(0)&&(e=(e=e.substring(1,e.length-1)).replace(/\[.*?\]/g,"[]")),e}createTemplate(e){let t="`",n="",r=e.split("[]");for(var o=0;o<r.length;o++)t+=r[o],o<r.length-1&&(o>0&&(n+=r[o]),t+="[${vars.item"+n+".$i}]");return t+="`"}}},{"./ConstantField":34,"./Field":37,"./TemplateField":42}],33:[function(e,t,n){const r=e("./Field"),o=e("../Conditions");t.exports=class extends r{constructor(e){super("condition"),this.conditionsTree=e}generate(e,t,n,r){return new o(this.conditionsTree).generate()}toString(){return"?condition?"}}},{"../Conditions":4,"./Field":37}],34:[function(e,t,n){const r=e("./Field"),o=e("../util/fieldUtil");t.exports=class extends r{constructor(e,t){super("constant"),this.value=e,t?this.dataType=t:o.determineLiteralTypeFromValue(this)}generate(e,t,n,r){return"object"==this.dataType?this.createConstantObjectExpressionFromJSON(this.value):"string"==this.dataType||"number"==this.dataType||"boolean"==this.dataType||"nil"==this.dataType?this.createLiteral(this.value):"array"==this.dataType?this.createConstantArrayExpressionFromJSON(this.value):"date"==this.dataType?this.createAssignRightExpressionFromString(this.value):void console.error("Unhandled constant data mapping part.")}toString(){return this.value}}},{"../util/fieldUtil":49,"./Field":37}],35:[function(e,t,n){const r=e("./Field");t.exports=class extends r{constructor(e){super("errorOutput"),this.path=e}getPath(){return this.path}hasPath(){return!0}getFullPath(){return""==this.path?"errorOutput":"errorOutput."+this.path}generate(e){let t=e;return this.path.length>0&&(t+="."+this.path),this.createIMEFromPath(t)}toString(){return this.getFullPath()}}},{"./Field":37}],36:[function(e,t,n){const r=e("./Field");t.exports=class extends r{constructor(e){super("expression"),this.value=e,this.expressionRefs=null}setExpressionRefs(e){this.expressionRefs=e}generate(e){if(e&&"__output__"!==e&&this.replacementRefs)for(let t of this.replacementRefs)t.replacement=t.replacement.replace("__variable__",e),this.value=this.value.replace(t.original,t.replacement);return this.createAssignRightExpressionFromString(this.value)}toString(){return this.value}getFullPath(){return this.value}getPath(){return this.value}}},{"./Field":37}],37:[function(e,t,n){const r=e("../Generator");t.exports=class extends r{constructor(e){super(),this.type=e}getType(){return this.type}hasPath(){return!1}generate(){console.error("Unhandled type of mapping part.",JSON.stringify(this,0,2))}}},{"../Generator":10}],38:[function(e,t,n){const r=e("./Field");t.exports=class extends r{constructor(e){super("input"),this.path=e}getPath(){return this.path}hasPath(){return!0}getFullPath(){return""==this.path?"input":"input."+this.path}toString(){return this.getFullPath()}}},{"./Field":37}],39:[function(e,t,n){const r=e("./InputField"),o=e("./Field");t.exports=class extends o{constructor(e){super("inputMappings"),this.arrMappings=[];let t=Object.keys(e);for(let n of t)this.arrMappings.push({from:e[n],to:new r(n)})}getMappings(){return this.arrMappings}}},{"./Field":37,"./InputField":38}],40:[function(e,t,n){const r=e("./Field");t.exports=class extends r{constructor(e){super("models"),this.path=e}getPath(){return this.path}hasPath(){return!0}getFullPath(){return"models."+this.path}generate(e,t,n,r){let o=`${this.type}.${this.path}`;return this.createIMEFromPath(o)}toString(){return this.getFullPath()}}},{"./Field":37}],41:[function(e,t,n){const r=e("./Field");t.exports=class extends r{constructor(e){super("output"),this.path=e}getPath(){return this.path}hasPath(){return!0}getFullPath(){return""==this.path?"output":"output."+this.path}generate(e){let t=e;return this.path.length>0&&(t+="."+this.path),this.createIMEFromPath(t)}toString(){return this.getFullPath()}}},{"./Field":37}],42:[function(e,t,n){const r=e("./Field");t.exports=class extends r{constructor(e){super("template"),this.template=e,this.expressionRefs=null}setExpressionRefs(e){this.expressionRefs=e}toString(){return this.template}generate(){return this.createAssignRightExpressionFromString(this.template)}}},{"./Field":37}],43:[function(e,t,n){const r=e("./Field");t.exports=class extends r{constructor(e){super("unknown"),console.warn("Unknown field:",e),this.path=e}getPath(){return this.path}getFullPath(){return this.path}generate(e,t,n,r){return this.createIMEFromPath(this.path)}toString(){return this.getFullPath()}}},{"./Field":37}],44:[function(e,t,n){const r=e("./Field");t.exports=class extends r{constructor(e){super("vars"),this.path=e}getPath(){return this.path}hasPath(){return!0}getFullPath(){return"vars."+this.path}generate(e,t,n,r){if(0==this.path.indexOf("local.")){let e=this.path.substring(6);return this.createIMEFromPath(e)}{let e=`${this.type}.${this.path}`;return this.createIMEFromPath(e)}}toString(){return this.getFullPath()}}},{"./Field":37}],45:[function(e,t,n){n.Condition=e("./Condition"),n.Conditions=e("./Conditions"),n.TriggerConditions=e("./TriggerConditions"),n.EndPoint=e("./EndPoint"),n.EventArea=e("./EventArea"),n.FakeEventArea=e("./FakeEventArea"),n.ApiBlock=e("./blocks/ApiBlock"),n.CallBlock=e("./blocks/CallBlock"),n.CodeBlock=e("./blocks/CodeBlock"),n.CopyModelBlock=e("./blocks/CopyModelBlock"),n.FakeBlock=e("./blocks/FakeBlock"),n.IfBlock=e("./blocks/IfBlock"),n.RelatedScreensBlock=e("./blocks/RelatedScreensBlock"),n.ScreenBlock=e("./blocks/ScreenBlock"),n.SetDataBlock=e("./blocks/SetDataBlock"),n.TransformBlock=e("./blocks/TransformBlock"),n.TryCatchBlock=e("./blocks/TryCatchBlock"),n.UpdateUserInfoBlock=e("./blocks/UpdateUserInfoBlock"),n.ActionField=e("./fields/ActionField"),n.ConditionField=e("./fields/ConditionField"),n.ConstantField=e("./fields/ConstantField"),n.ErrorOutputField=e("./fields/ErrorOutputField"),n.ExpressionField=e("./fields/ExpressionField"),n.InputField=e("./fields/InputField"),n.ModelField=e("./fields/ModelField"),n.OutputField=e("./fields/OutputField"),n.TemplateField=e("./fields/TemplateField"),n.VariableField=e("./fields/VariableField")},{"./Condition":3,"./Conditions":4,"./EndPoint":6,"./EventArea":7,"./FakeEventArea":9,"./TriggerConditions":14,"./blocks/ApiBlock":16,"./blocks/CallBlock":18,"./blocks/CodeBlock":19,"./blocks/CopyModelBlock":20,"./blocks/FakeBlock":22,"./blocks/IfBlock":23,"./blocks/RelatedScreensBlock":26,"./blocks/ScreenBlock":27,"./blocks/SetDataBlock":28,"./blocks/TransformBlock":29,"./blocks/TryCatchBlock":30,"./blocks/UpdateUserInfoBlock":31,"./fields/ActionField":32,"./fields/ConditionField":33,"./fields/ConstantField":34,"./fields/ErrorOutputField":35,"./fields/ExpressionField":36,"./fields/InputField":38,"./fields/ModelField":40,"./fields/OutputField":41,"./fields/TemplateField":42,"./fields/VariableField":44}],46:[function(e,t,n){function r(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}t.exports=function(e){return null!=e&&(r(e)||function(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&r(e.slice(0,0))}(e)||!!e._isBuffer)}},{}],47:[function(e,t,n){(function(e){const n={},r=n.hasOwnProperty,o=(e,t)=>{for(const n in e)r.call(e,n)&&t(n,e[n])},i=n.toString,s=Array.isArray,a=e.isBuffer,l={'"':'\\"',"'":"\\'","\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"},c=/["'\\\b\f\n\r\t]/,d=/[0-9]/,u=/[ !#-&\(-\[\]-~]/,p=(e,t)=>{const n=()=>{S=v,++t.indentLevel,v=t.indent.repeat(t.indentLevel)},r={escapeEverything:!1,minimal:!1,isScriptContext:!1,quotes:"single",wrap:!1,es6:!1,json:!1,compact:!0,lowercaseHex:!1,numbers:"decimal",indent:"\t",indentLevel:0,__inline1__:!1,__inline2__:!1},f=t&&t.json;f&&(r.quotes="double",r.wrap=!0),"single"!=(t=((e,t)=>t?(o(t,(t,n)=>{e[t]=n}),e):e)(r,t)).quotes&&"double"!=t.quotes&&"backtick"!=t.quotes&&(t.quotes="single");const h="double"==t.quotes?'"':"backtick"==t.quotes?"`":"'",m=t.compact,g=t.lowercaseHex;let v=t.indent.repeat(t.indentLevel),S="";const y=t.__inline1__,E=t.__inline2__,b=m?"":"\n";let w,C=!0;const _="binary"==t.numbers,T="octal"==t.numbers,D="decimal"==t.numbers,M="hexadecimal"==t.numbers;if(f&&e&&(e=>"function"==typeof e)(e.toJSON)&&(e=e.toJSON()),!(e=>"string"==typeof e||"[object String]"==i.call(e))(e)){if((e=>"[object Map]"==i.call(e))(e))return 0==e.size?"new Map()":(m||(t.__inline1__=!0,t.__inline2__=!1),"new Map("+p(Array.from(e),t)+")");if((e=>"[object Set]"==i.call(e))(e))return 0==e.size?"new Set()":"new Set("+p(Array.from(e),t)+")";if(a(e))return 0==e.length?"Buffer.from([])":"Buffer.from("+p(Array.from(e),t)+")";if(s(e))return w=[],t.wrap=!0,y&&(t.__inline1__=!1,t.__inline2__=!0),E||n(),((e,t)=>{const n=e.length;let r=-1;for(;++r<n;)t(e[r])})(e,e=>{C=!1,E&&(t.__inline2__=!1),w.push((m||E?"":v)+p(e,t))}),C?"[]":E?"["+w.join(", ")+"]":"["+b+w.join(","+b)+b+(m?"":S)+"]";if(!(e=>"number"==typeof e||"[object Number]"==i.call(e))(e))return(e=>"[object Object]"==i.call(e))(e)?(w=[],t.wrap=!0,n(),o(e,(e,n)=>{C=!1,w.push((m?"":v)+p(e,t)+":"+(m?"":" ")+p(n,t))}),C?"{}":"{"+b+w.join(","+b)+b+(m?"":S)+"}"):f?JSON.stringify(e)||"null":String(e);if(f)return JSON.stringify(e);if(D)return String(e);if(M){let t=e.toString(16);return g||(t=t.toUpperCase()),"0x"+t}if(_)return"0b"+e.toString(2);if(T)return"0o"+e.toString(8)}const x=e;let k=-1;const P=x.length;for(w="";++k<P;){const e=x.charAt(k);if(t.es6){const e=x.charCodeAt(k);if(e>=55296&&e<=56319&&P>k+1){const t=x.charCodeAt(k+1);if(t>=56320&&t<=57343){let n=(1024*(e-55296)+t-56320+65536).toString(16);g||(n=n.toUpperCase()),w+="\\u{"+n+"}",++k;continue}}}if(!t.escapeEverything){if(u.test(e)){w+=e;continue}if('"'==e){w+=h==e?'\\"':e;continue}if("`"==e){w+=h==e?"\\`":e;continue}if("'"==e){w+=h==e?"\\'":e;continue}}if("\0"==e&&!f&&!d.test(x.charAt(k+1))){w+="\\0";continue}if(c.test(e)){w+=l[e];continue}const n=e.charCodeAt(0);if(t.minimal&&8232!=n&&8233!=n){w+=e;continue}let r=n.toString(16);g||(r=r.toUpperCase());const o=r.length>2||f,i="\\"+(o?"u":"x")+("0000"+r).slice(o?-4:-2);w+=i}return t.wrap&&(w=h+w+h),"`"==h&&(w=w.replace(/\$\{/g,"\\${")),t.isScriptContext?w.replace(/<\/(script|style)/gi,"<\\/$1").replace(/<!--/g,f?"\\u003C!--":"\\x3C!--"):w};p.version="2.5.1",t.exports=p}).call(this,{isBuffer:e("../is-buffer/index.js")})},{"../is-buffer/index.js":46}],48:[function(e,t,n){(function(e){(function(){function r(e,t){return e.set(t[0],t[1]),e}function o(e,t){return e.add(t),e}function i(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}function s(e,t,n,r){for(var o=-1,i=null==e?0:e.length;++o<i;){var s=e[o];t(r,s,n(s),e)}return r}function a(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}function l(e,t){for(var n=null==e?0:e.length;n--&&!1!==t(e[n],n,e););return e}function c(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(!t(e[n],n,e))return!1;return!0}function d(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var s=e[n];t(s,n,e)&&(i[o++]=s)}return i}function u(e,t){return!!(null==e?0:e.length)&&E(e,t,0)>-1}function p(e,t,n){for(var r=-1,o=null==e?0:e.length;++r<o;)if(n(t,e[r]))return!0;return!1}function f(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}function h(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e}function m(e,t,n,r){var o=-1,i=null==e?0:e.length;for(r&&i&&(n=e[++o]);++o<i;)n=t(n,e[o],o,e);return n}function g(e,t,n,r){var o=null==e?0:e.length;for(r&&o&&(n=e[--o]);o--;)n=t(n,e[o],o,e);return n}function v(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function S(e,t,n){var r;return n(e,function(e,n,o){if(t(e,n,o))return r=n,!1}),r}function y(e,t,n,r){for(var o=e.length,i=n+(r?1:-1);r?i--:++i<o;)if(t(e[i],i,e))return i;return-1}function E(e,t,n){return t==t?function(e,t,n){var r=n-1,o=e.length;for(;++r<o;)if(e[r]===t)return r;return-1}(e,t,n):y(e,w,n)}function b(e,t,n,r){for(var o=n-1,i=e.length;++o<i;)if(r(e[o],t))return o;return-1}function w(e){return e!=e}function C(e,t){var n=null==e?0:e.length;return n?M(e,t)/n:ye}function _(e){return function(t){return null==t?B:t[e]}}function T(e){return function(t){return null==e?B:e[t]}}function D(e,t,n,r,o){return o(e,function(e,o,i){n=r?(r=!1,e):t(n,e,o,i)}),n}function M(e,t){for(var n,r=-1,o=e.length;++r<o;){var i=t(e[r]);i!==B&&(n=n===B?i:n+i)}return n}function x(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function k(e){return function(t){return e(t)}}function P(e,t){return f(t,function(t){return e[t]})}function A(e,t){return e.has(t)}function I(e,t){for(var n=-1,r=e.length;++n<r&&E(t,e[n],0)>-1;);return n}function O(e,t){for(var n=e.length;n--&&E(t,e[n],0)>-1;);return n}function N(e){return"\\"+Sn[e]}function $(e){return pn.test(e)}function V(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function L(e,t){return function(n){return e(t(n))}}function F(e,t){for(var n=-1,r=e.length,o=0,i=[];++n<r;){var s=e[n];s!==t&&s!==Y||(e[n]=Y,i[o++]=n)}return i}function R(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}function U(e){return $(e)?function(e){var t=dn.lastIndex=0;for(;dn.test(e);)++t;return t}(e):$n(e)}function j(e){return $(e)?function(e){return e.match(dn)||[]}(e):function(e){return e.split("")}(e)}var B,q=200,H="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",W="Expected a function",G="__lodash_hash_undefined__",z=500,Y="__lodash_placeholder__",K=1,J=2,Q=4,X=1,Z=2,ee=1,te=2,ne=4,re=8,oe=16,ie=32,se=64,ae=128,le=256,ce=512,de=30,ue="...",pe=800,fe=16,he=1,me=2,ge=1/0,ve=9007199254740991,Se=1.7976931348623157e308,ye=NaN,Ee=4294967295,be=Ee-1,we=Ee>>>1,Ce=[["ary",ae],["bind",ee],["bindKey",te],["curry",re],["curryRight",oe],["flip",ce],["partial",ie],["partialRight",se],["rearg",le]],_e="[object Arguments]",Te="[object Array]",De="[object AsyncFunction]",Me="[object Boolean]",xe="[object Date]",ke="[object DOMException]",Pe="[object Error]",Ae="[object Function]",Ie="[object GeneratorFunction]",Oe="[object Map]",Ne="[object Number]",$e="[object Null]",Ve="[object Object]",Le="[object Proxy]",Fe="[object RegExp]",Re="[object Set]",Ue="[object String]",je="[object Symbol]",Be="[object Undefined]",qe="[object WeakMap]",He="[object WeakSet]",We="[object ArrayBuffer]",Ge="[object DataView]",ze="[object Float32Array]",Ye="[object Float64Array]",Ke="[object Int8Array]",Je="[object Int16Array]",Qe="[object Int32Array]",Xe="[object Uint8Array]",Ze="[object Uint8ClampedArray]",et="[object Uint16Array]",tt="[object Uint32Array]",nt=/\b__p \+= '';/g,rt=/\b(__p \+=) '' \+/g,ot=/(__e\(.*?\)|\b__t\)) \+\n'';/g,it=/&(?:amp|lt|gt|quot|#39);/g,st=/[&<>"']/g,at=RegExp(it.source),lt=RegExp(st.source),ct=/<%-([\s\S]+?)%>/g,dt=/<%([\s\S]+?)%>/g,ut=/<%=([\s\S]+?)%>/g,pt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ft=/^\w*$/,ht=/^\./,mt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,gt=/[\\^$.*+?()[\]{}|]/g,vt=RegExp(gt.source),St=/^\s+|\s+$/g,yt=/^\s+/,Et=/\s+$/,bt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,wt=/\{\n\/\* \[wrapped with (.+)\] \*/,Ct=/,? & /,_t=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Tt=/\\(\\)?/g,Dt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Mt=/\w*$/,xt=/^[-+]0x[0-9a-f]+$/i,kt=/^0b[01]+$/i,Pt=/^\[object .+?Constructor\]$/,At=/^0o[0-7]+$/i,It=/^(?:0|[1-9]\d*)$/,Ot=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Nt=/($^)/,$t=/['\n\r\u2028\u2029\\]/g,Vt="\\ud800-\\udfff",Lt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Ft="a-z\\xdf-\\xf6\\xf8-\\xff",Rt="A-Z\\xc0-\\xd6\\xd8-\\xde",Ut="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",jt="["+Vt+"]",Bt="["+Ut+"]",qt="["+Lt+"]",Ht="\\d+",Wt="[\\u2700-\\u27bf]",Gt="["+Ft+"]",zt="[^"+Vt+Ut+Ht+"\\u2700-\\u27bf"+Ft+Rt+"]",Yt="\\ud83c[\\udffb-\\udfff]",Kt="[^"+Vt+"]",Jt="(?:\\ud83c[\\udde6-\\uddff]){2}",Qt="[\\ud800-\\udbff][\\udc00-\\udfff]",Xt="["+Rt+"]",Zt="(?:"+Gt+"|"+zt+")",en="(?:"+Xt+"|"+zt+")",tn="(?:['â€™](?:d|ll|m|re|s|t|ve))?",nn="(?:['â€™](?:D|LL|M|RE|S|T|VE))?",rn="(?:"+qt+"|"+Yt+")"+"?",on="[\\ufe0e\\ufe0f]?"+rn+("(?:\\u200d(?:"+[Kt,Jt,Qt].join("|")+")[\\ufe0e\\ufe0f]?"+rn+")*"),sn="(?:"+[Wt,Jt,Qt].join("|")+")"+on,an="(?:"+[Kt+qt+"?",qt,Jt,Qt,jt].join("|")+")",ln=RegExp("['â€™]","g"),cn=RegExp(qt,"g"),dn=RegExp(Yt+"(?="+Yt+")|"+an+on,"g"),un=RegExp([Xt+"?"+Gt+"+"+tn+"(?="+[Bt,Xt,"$"].join("|")+")",en+"+"+nn+"(?="+[Bt,Xt+Zt,"$"].join("|")+")",Xt+"?"+Zt+"+"+tn,Xt+"+"+nn,"\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)","\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)",Ht,sn].join("|"),"g"),pn=RegExp("[\\u200d"+Vt+Lt+"\\ufe0e\\ufe0f]"),fn=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,hn=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],mn=-1,gn={};gn[ze]=gn[Ye]=gn[Ke]=gn[Je]=gn[Qe]=gn[Xe]=gn[Ze]=gn[et]=gn[tt]=!0,gn[_e]=gn[Te]=gn[We]=gn[Me]=gn[Ge]=gn[xe]=gn[Pe]=gn[Ae]=gn[Oe]=gn[Ne]=gn[Ve]=gn[Fe]=gn[Re]=gn[Ue]=gn[qe]=!1;var vn={};vn[_e]=vn[Te]=vn[We]=vn[Ge]=vn[Me]=vn[xe]=vn[ze]=vn[Ye]=vn[Ke]=vn[Je]=vn[Qe]=vn[Oe]=vn[Ne]=vn[Ve]=vn[Fe]=vn[Re]=vn[Ue]=vn[je]=vn[Xe]=vn[Ze]=vn[et]=vn[tt]=!0,vn[Pe]=vn[Ae]=vn[qe]=!1;var Sn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},yn=parseFloat,En=parseInt,bn="object"==typeof e&&e&&e.Object===Object&&e,wn="object"==typeof self&&self&&self.Object===Object&&self,Cn=bn||wn||Function("return this")(),_n="object"==typeof n&&n&&!n.nodeType&&n,Tn=_n&&"object"==typeof t&&t&&!t.nodeType&&t,Dn=Tn&&Tn.exports===_n,Mn=Dn&&bn.process,xn=function(){try{return Mn&&Mn.binding&&Mn.binding("util")}catch(e){}}(),kn=xn&&xn.isArrayBuffer,Pn=xn&&xn.isDate,An=xn&&xn.isMap,In=xn&&xn.isRegExp,On=xn&&xn.isSet,Nn=xn&&xn.isTypedArray,$n=_("length"),Vn=T({"Ã€":"A","Ã":"A","Ã‚":"A","Ãƒ":"A","Ã„":"A","Ã…":"A","Ã ":"a","Ã¡":"a","Ã¢":"a","Ã£":"a","Ã¤":"a","Ã¥":"a","Ã‡":"C","Ã§":"c","Ã":"D","Ã°":"d","Ãˆ":"E","Ã‰":"E","ÃŠ":"E","Ã‹":"E","Ã¨":"e","Ã©":"e","Ãª":"e","Ã«":"e","ÃŒ":"I","Ã":"I","ÃŽ":"I","Ã":"I","Ã¬":"i","Ã­":"i","Ã®":"i","Ã¯":"i","Ã‘":"N","Ã±":"n","Ã’":"O","Ã“":"O","Ã”":"O","Ã•":"O","Ã–":"O","Ã˜":"O","Ã²":"o","Ã³":"o","Ã´":"o","Ãµ":"o","Ã¶":"o","Ã¸":"o","Ã™":"U","Ãš":"U","Ã›":"U","Ãœ":"U","Ã¹":"u","Ãº":"u","Ã»":"u","Ã¼":"u","Ã":"Y","Ã½":"y","Ã¿":"y","Ã†":"Ae","Ã¦":"ae","Ãž":"Th","Ã¾":"th","ÃŸ":"ss","Ä€":"A","Ä‚":"A","Ä„":"A","Ä":"a","Äƒ":"a","Ä…":"a","Ä†":"C","Äˆ":"C","ÄŠ":"C","ÄŒ":"C","Ä‡":"c","Ä‰":"c","Ä‹":"c","Ä":"c","ÄŽ":"D","Ä":"D","Ä":"d","Ä‘":"d","Ä’":"E","Ä”":"E","Ä–":"E","Ä˜":"E","Äš":"E","Ä“":"e","Ä•":"e","Ä—":"e","Ä™":"e","Ä›":"e","Äœ":"G","Äž":"G","Ä ":"G","Ä¢":"G","Ä":"g","ÄŸ":"g","Ä¡":"g","Ä£":"g","Ä¤":"H","Ä¦":"H","Ä¥":"h","Ä§":"h","Ä¨":"I","Äª":"I","Ä¬":"I","Ä®":"I","Ä°":"I","Ä©":"i","Ä«":"i","Ä­":"i","Ä¯":"i","Ä±":"i","Ä´":"J","Äµ":"j","Ä¶":"K","Ä·":"k","Ä¸":"k","Ä¹":"L","Ä»":"L","Ä½":"L","Ä¿":"L","Å":"L","Äº":"l","Ä¼":"l","Ä¾":"l","Å€":"l","Å‚":"l","Åƒ":"N","Å…":"N","Å‡":"N","ÅŠ":"N","Å„":"n","Å†":"n","Åˆ":"n","Å‹":"n","ÅŒ":"O","ÅŽ":"O","Å":"O","Å":"o","Å":"o","Å‘":"o","Å”":"R","Å–":"R","Å˜":"R","Å•":"r","Å—":"r","Å™":"r","Åš":"S","Åœ":"S","Åž":"S","Å ":"S","Å›":"s","Å":"s","ÅŸ":"s","Å¡":"s","Å¢":"T","Å¤":"T","Å¦":"T","Å£":"t","Å¥":"t","Å§":"t","Å¨":"U","Åª":"U","Å¬":"U","Å®":"U","Å°":"U","Å²":"U","Å©":"u","Å«":"u","Å­":"u","Å¯":"u","Å±":"u","Å³":"u","Å´":"W","Åµ":"w","Å¶":"Y","Å·":"y","Å¸":"Y","Å¹":"Z","Å»":"Z","Å½":"Z","Åº":"z","Å¼":"z","Å¾":"z","Ä²":"IJ","Ä³":"ij","Å’":"Oe","Å“":"oe","Å‰":"'n","Å¿":"s"}),Ln=T({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}),Fn=T({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Rn=function e(t){function n(e){if(fi(e)&&!nl(e)&&!(e instanceof Lt)){if(e instanceof Vt)return e;if(ns.call(e,"__wrapped__"))return Vo(e)}return new Vt(e)}function T(){}function Vt(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=B}function Lt(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=Ee,this.__views__=[]}function Ft(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Rt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function Ut(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function jt(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Ut;++t<n;)this.add(e[t])}function Bt(e){var t=this.__data__=new Rt(e);this.size=t.size}function qt(e,t){var n=nl(e),r=!n&&tl(e),o=!n&&!r&&ol(e),i=!n&&!r&&!o&&cl(e),s=n||r||o||i,a=s?x(e.length,Ki):[],l=a.length;for(var c in e)!t&&!ns.call(e,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||wo(c,l))||a.push(c);return a}function Ht(e){var t=e.length;return t?e[sr(0,t-1)]:B}function Wt(e,t){return Oo(Lr(e),en(t,0,e.length))}function Gt(e){return Oo(Lr(e))}function zt(e,t,n){(n===B||ii(e[t],n))&&(n!==B||t in e)||Xt(e,t,n)}function Yt(e,t,n){var r=e[t];ns.call(e,t)&&ii(r,n)&&(n!==B||t in e)||Xt(e,t,n)}function Kt(e,t){for(var n=e.length;n--;)if(ii(e[n][0],t))return n;return-1}function Jt(e,t,n,r){return ea(e,function(e,o,i){t(r,e,n(e),i)}),r}function Qt(e,t){return e&&Fr(t,Mi(t),e)}function Xt(e,t,n){"__proto__"==t&&Es?Es(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}function Zt(e,t){for(var n=-1,r=t.length,o=Bi(r),i=null==e;++n<r;)o[n]=i?B:Ti(e,t[n]);return o}function en(e,t,n){return e==e&&(n!==B&&(e=e<=n?e:n),t!==B&&(e=e>=t?e:t)),e}function tn(e,t,n,i,s,l){var c,d=t&K,u=t&J,p=t&Q;if(n&&(c=s?n(e,i,s,l):n(e)),c!==B)return c;if(!pi(e))return e;var f=nl(e);if(f){if(c=function(e){var t=e.length,n=e.constructor(t);return t&&"string"==typeof e[0]&&ns.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(e),!d)return Lr(e,c)}else{var h=pa(e),g=h==Ae||h==Ie;if(ol(e))return Ar(e,d);if(h==Ve||h==_e||g&&!s){if(c=u||g?{}:Eo(e),!d)return u?function(e,t){return Fr(e,ua(e),t)}(e,function(e,t){return e&&Fr(t,xi(t),e)}(c,e)):function(e,t){return Fr(e,da(e),t)}(e,Qt(c,e))}else{if(!vn[h])return s?e:{};c=function(e,t,n,i){var s=e.constructor;switch(t){case We:return Ir(e);case Me:case xe:return new s(+e);case Ge:return function(e,t){var n=t?Ir(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,i);case ze:case Ye:case Ke:case Je:case Qe:case Xe:case Ze:case et:case tt:return Or(e,i);case Oe:return function(e,t,n){return m(t?n(V(e),K):V(e),r,new e.constructor)}(e,i,n);case Ne:case Ue:return new s(e);case Fe:return function(e){var t=new e.constructor(e.source,Mt.exec(e));return t.lastIndex=e.lastIndex,t}(e);case Re:return function(e,t,n){return m(t?n(R(e),K):R(e),o,new e.constructor)}(e,i,n);case je:return function(e){return Qs?zi(Qs.call(e)):{}}(e)}}(e,h,tn,d)}}l||(l=new Bt);var v=l.get(e);if(v)return v;l.set(e,c);var S=f?B:(p?u?po:uo:u?xi:Mi)(e);return a(S||e,function(r,o){S&&(r=e[o=r]),Yt(c,o,tn(r,t,n,o,e,l))}),c}function nn(e,t,n){var r=n.length;if(null==e)return!r;for(e=zi(e);r--;){var o=n[r],i=t[o],s=e[o];if(s===B&&!(o in e)||!i(s))return!1}return!0}function rn(e,t,n){if("function"!=typeof e)throw new Ji(W);return ma(function(){e.apply(B,n)},t)}function on(e,t,n,r){var o=-1,i=u,s=!0,a=e.length,l=[],c=t.length;if(!a)return l;n&&(t=f(t,k(n))),r?(i=p,s=!1):t.length>=q&&(i=A,s=!1,t=new jt(t));e:for(;++o<a;){var d=e[o],h=null==n?d:n(d);if(d=r||0!==d?d:0,s&&h==h){for(var m=c;m--;)if(t[m]===h)continue e;l.push(d)}else i(t,h,r)||l.push(d)}return l}function sn(e,t){var n=!0;return ea(e,function(e,r,o){return n=!!t(e,r,o)}),n}function an(e,t,n){for(var r=-1,o=e.length;++r<o;){var i=e[r],s=t(i);if(null!=s&&(a===B?s==s&&!vi(s):n(s,a)))var a=s,l=i}return l}function dn(e,t){var n=[];return ea(e,function(e,r,o){t(e,r,o)&&n.push(e)}),n}function pn(e,t,n,r,o){var i=-1,s=e.length;for(n||(n=bo),o||(o=[]);++i<s;){var a=e[i];t>0&&n(a)?t>1?pn(a,t-1,n,r,o):h(o,a):r||(o[o.length]=a)}return o}function Sn(e,t){return e&&na(e,t,Mi)}function bn(e,t){return e&&ra(e,t,Mi)}function wn(e,t){return d(t,function(t){return ci(e[t])})}function _n(e,t){for(var n=0,r=(t=kr(t,e)).length;null!=e&&n<r;)e=e[No(t[n++])];return n&&n==r?e:B}function Tn(e,t,n){var r=t(e);return nl(e)?r:h(r,n(e))}function Mn(e){return null==e?e===B?Be:$e:ys&&ys in zi(e)?function(e){var t=ns.call(e,ys),n=e[ys];try{e[ys]=B;var r=!0}catch(e){}var o=is.call(e);return r&&(t?e[ys]=n:delete e[ys]),o}(e):function(e){return is.call(e)}(e)}function xn(e,t){return e>t}function $n(e,t){return null!=e&&ns.call(e,t)}function Un(e,t){return null!=e&&t in zi(e)}function jn(e,t,n){for(var r=n?p:u,o=e[0].length,i=e.length,s=i,a=Bi(i),l=1/0,c=[];s--;){var d=e[s];s&&t&&(d=f(d,k(t))),l=Is(d.length,l),a[s]=!n&&(t||o>=120&&d.length>=120)?new jt(s&&d):B}d=e[0];var h=-1,m=a[0];e:for(;++h<o&&c.length<l;){var g=d[h],v=t?t(g):g;if(g=n||0!==g?g:0,!(m?A(m,v):r(c,v,n))){for(s=i;--s;){var S=a[s];if(!(S?A(S,v):r(e[s],v,n)))continue e}m&&m.push(v),c.push(g)}}return c}function Bn(e,t,n){var r=null==(e=Po(e,t=kr(t,e)))?e:e[No(jo(t))];return null==r?B:i(r,e,n)}function qn(e){return fi(e)&&Mn(e)==_e}function Hn(e,t,n,r,o){return e===t||(null==e||null==t||!fi(e)&&!fi(t)?e!=e&&t!=t:function(e,t,n,r,o,i){var s=nl(e),a=nl(t),l=s?Te:pa(e),c=a?Te:pa(t),d=(l=l==_e?Ve:l)==Ve,u=(c=c==_e?Ve:c)==Ve,p=l==c;if(p&&ol(e)){if(!ol(t))return!1;s=!0,d=!1}if(p&&!d)return i||(i=new Bt),s||cl(e)?lo(e,t,n,r,o,i):function(e,t,n,r,o,i,s){switch(n){case Ge:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case We:return!(e.byteLength!=t.byteLength||!i(new us(e),new us(t)));case Me:case xe:case Ne:return ii(+e,+t);case Pe:return e.name==t.name&&e.message==t.message;case Fe:case Ue:return e==t+"";case Oe:var a=V;case Re:var l=r&X;if(a||(a=R),e.size!=t.size&&!l)return!1;var c=s.get(e);if(c)return c==t;r|=Z,s.set(e,t);var d=lo(a(e),a(t),r,o,i,s);return s.delete(e),d;case je:if(Qs)return Qs.call(e)==Qs.call(t)}return!1}(e,t,l,n,r,o,i);if(!(n&X)){var f=d&&ns.call(e,"__wrapped__"),h=u&&ns.call(t,"__wrapped__");if(f||h){var m=f?e.value():e,g=h?t.value():t;return i||(i=new Bt),o(m,g,n,r,i)}}return!!p&&(i||(i=new Bt),function(e,t,n,r,o,i){var s=n&X,a=uo(e),l=a.length,c=uo(t).length;if(l!=c&&!s)return!1;for(var d=l;d--;){var u=a[d];if(!(s?u in t:ns.call(t,u)))return!1}var p=i.get(e);if(p&&i.get(t))return p==t;var f=!0;i.set(e,t),i.set(t,e);for(var h=s;++d<l;){u=a[d];var m=e[u],g=t[u];if(r)var v=s?r(g,m,u,t,e,i):r(m,g,u,e,t,i);if(!(v===B?m===g||o(m,g,n,r,i):v)){f=!1;break}h||(h="constructor"==u)}if(f&&!h){var S=e.constructor,y=t.constructor;S!=y&&"constructor"in e&&"constructor"in t&&!("function"==typeof S&&S instanceof S&&"function"==typeof y&&y instanceof y)&&(f=!1)}return i.delete(e),i.delete(t),f}(e,t,n,r,o,i))}(e,t,n,r,Hn,o))}function Wn(e,t,n,r){var o=n.length,i=o,s=!r;if(null==e)return!i;for(e=zi(e);o--;){var a=n[o];if(s&&a[2]?a[1]!==e[a[0]]:!(a[0]in e))return!1}for(;++o<i;){var l=(a=n[o])[0],c=e[l],d=a[1];if(s&&a[2]){if(c===B&&!(l in e))return!1}else{var u=new Bt;if(r)var p=r(c,d,l,e,t,u);if(!(p===B?Hn(d,c,X|Z,r,u):p))return!1}}return!0}function Gn(e){return!(!pi(e)||function(e){return!!os&&os in e}(e))&&(ci(e)?ls:Pt).test($o(e))}function zn(e){return"function"==typeof e?e:null==e?$i:"object"==typeof e?nl(e)?Zn(e[0],e[1]):Xn(e):Ri(e)}function Yn(e){if(!Do(e))return Ps(e);var t=[];for(var n in zi(e))ns.call(e,n)&&"constructor"!=n&&t.push(n);return t}function Kn(e){if(!pi(e))return function(e){var t=[];if(null!=e)for(var n in zi(e))t.push(n);return t}(e);var t=Do(e),n=[];for(var r in e)("constructor"!=r||!t&&ns.call(e,r))&&n.push(r);return n}function Jn(e,t){return e<t}function Qn(e,t){var n=-1,r=si(e)?Bi(e.length):[];return ea(e,function(e,o,i){r[++n]=t(e,o,i)}),r}function Xn(e){var t=vo(e);return 1==t.length&&t[0][2]?xo(t[0][0],t[0][1]):function(n){return n===e||Wn(n,e,t)}}function Zn(e,t){return _o(e)&&Mo(t)?xo(No(e),t):function(n){var r=Ti(n,e);return r===B&&r===t?Di(n,e):Hn(t,r,X|Z)}}function er(e,t,n,r,o){e!==t&&na(t,function(i,s){if(pi(i))o||(o=new Bt),function(e,t,n,r,o,i,s){var a=e[n],l=t[n],c=s.get(l);if(c)zt(e,n,c);else{var d=i?i(a,l,n+"",e,t,s):B,u=d===B;if(u){var p=nl(l),f=!p&&ol(l),h=!p&&!f&&cl(l);d=l,p||f||h?nl(a)?d=a:ai(a)?d=Lr(a):f?(u=!1,d=Ar(l,!0)):h?(u=!1,d=Or(l,!0)):d=[]:mi(l)||tl(l)?(d=a,tl(a)?d=Ci(a):(!pi(a)||r&&ci(a))&&(d=Eo(l))):u=!1}u&&(s.set(l,d),o(d,l,r,i,s),s.delete(l)),zt(e,n,d)}}(e,t,s,n,er,r,o);else{var a=r?r(e[s],i,s+"",e,t,o):B;a===B&&(a=i),zt(e,s,a)}},xi)}function tr(e,t){var n=e.length;if(n)return t+=t<0?n:0,wo(t,n)?e[t]:B}function nr(e,t,n){var r=-1;return t=f(t.length?t:[$i],k(mo())),function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}(Qn(e,function(e,n,o){return{criteria:f(t,function(t){return t(e)}),index:++r,value:e}}),function(e,t){return function(e,t,n){for(var r=-1,o=e.criteria,i=t.criteria,s=o.length,a=n.length;++r<s;){var l=Nr(o[r],i[r]);if(l){if(r>=a)return l;var c=n[r];return l*("desc"==c?-1:1)}}return e.index-t.index}(e,t,n)})}function rr(e,t,n){for(var r=-1,o=t.length,i={};++r<o;){var s=t[r],a=_n(e,s);n(a,s)&&ur(i,kr(s,e),a)}return i}function or(e,t,n,r){var o=r?b:E,i=-1,s=t.length,a=e;for(e===t&&(t=Lr(t)),n&&(a=f(e,k(n)));++i<s;)for(var l=0,c=t[i],d=n?n(c):c;(l=o(a,d,l,r))>-1;)a!==e&&gs.call(a,l,1),gs.call(e,l,1);return e}function ir(e,t){for(var n=e?t.length:0,r=n-1;n--;){var o=t[n];if(n==r||o!==i){var i=o;wo(o)?gs.call(e,o,1):br(e,o)}}return e}function sr(e,t){return e+Ts($s()*(t-e+1))}function ar(e,t){var n="";if(!e||t<1||t>ve)return n;do{t%2&&(n+=e),(t=Ts(t/2))&&(e+=e)}while(t);return n}function lr(e,t){return ga(ko(e,t,$i),e+"")}function cr(e){return Ht(Pi(e))}function dr(e,t){var n=Pi(e);return Oo(n,en(t,0,n.length))}function ur(e,t,n,r){if(!pi(e))return e;for(var o=-1,i=(t=kr(t,e)).length,s=i-1,a=e;null!=a&&++o<i;){var l=No(t[o]),c=n;if(o!=s){var d=a[l];(c=r?r(d,l,a):B)===B&&(c=pi(d)?d:wo(t[o+1])?[]:{})}Yt(a,l,c),a=a[l]}return e}function pr(e){return Oo(Pi(e))}function fr(e,t,n){var r=-1,o=e.length;t<0&&(t=-t>o?0:o+t),(n=n>o?o:n)<0&&(n+=o),o=t>n?0:n-t>>>0,t>>>=0;for(var i=Bi(o);++r<o;)i[r]=e[r+t];return i}function hr(e,t){var n;return ea(e,function(e,r,o){return!(n=t(e,r,o))}),!!n}function mr(e,t,n){var r=0,o=null==e?r:e.length;if("number"==typeof t&&t==t&&o<=we){for(;r<o;){var i=r+o>>>1,s=e[i];null!==s&&!vi(s)&&(n?s<=t:s<t)?r=i+1:o=i}return o}return gr(e,t,$i,n)}function gr(e,t,n,r){t=n(t);for(var o=0,i=null==e?0:e.length,s=t!=t,a=null===t,l=vi(t),c=t===B;o<i;){var d=Ts((o+i)/2),u=n(e[d]),p=u!==B,f=null===u,h=u==u,m=vi(u);if(s)var g=r||h;else g=c?h&&(r||p):a?h&&p&&(r||!f):l?h&&p&&!f&&(r||!m):!f&&!m&&(r?u<=t:u<t);g?o=d+1:i=d}return Is(i,be)}function vr(e,t){for(var n=-1,r=e.length,o=0,i=[];++n<r;){var s=e[n],a=t?t(s):s;if(!n||!ii(a,l)){var l=a;i[o++]=0===s?0:s}}return i}function Sr(e){return"number"==typeof e?e:vi(e)?ye:+e}function yr(e){if("string"==typeof e)return e;if(nl(e))return f(e,yr)+"";if(vi(e))return Xs?Xs.call(e):"";var t=e+"";return"0"==t&&1/e==-ge?"-0":t}function Er(e,t,n){var r=-1,o=u,i=e.length,s=!0,a=[],l=a;if(n)s=!1,o=p;else if(i>=q){var c=t?null:la(e);if(c)return R(c);s=!1,o=A,l=new jt}else l=t?[]:a;e:for(;++r<i;){var d=e[r],f=t?t(d):d;if(d=n||0!==d?d:0,s&&f==f){for(var h=l.length;h--;)if(l[h]===f)continue e;t&&l.push(f),a.push(d)}else o(l,f,n)||(l!==a&&l.push(f),a.push(d))}return a}function br(e,t){return t=kr(t,e),null==(e=Po(e,t))||delete e[No(jo(t))]}function wr(e,t,n,r){return ur(e,t,n(_n(e,t)),r)}function Cr(e,t,n,r){for(var o=e.length,i=r?o:-1;(r?i--:++i<o)&&t(e[i],i,e););return n?fr(e,r?0:i,r?i+1:o):fr(e,r?i+1:0,r?o:i)}function _r(e,t){var n=e;return n instanceof Lt&&(n=n.value()),m(t,function(e,t){return t.func.apply(t.thisArg,h([e],t.args))},n)}function Tr(e,t,n){var r=e.length;if(r<2)return r?Er(e[0]):[];for(var o=-1,i=Bi(r);++o<r;)for(var s=e[o],a=-1;++a<r;)a!=o&&(i[o]=on(i[o]||s,e[a],t,n));return Er(pn(i,1),t,n)}function Dr(e,t,n){for(var r=-1,o=e.length,i=t.length,s={};++r<o;){var a=r<i?t[r]:B;n(s,e[r],a)}return s}function Mr(e){return ai(e)?e:[]}function xr(e){return"function"==typeof e?e:$i}function kr(e,t){return nl(e)?e:_o(e,t)?[e]:va(_i(e))}function Pr(e,t,n){var r=e.length;return n=n===B?r:n,!t&&n>=r?e:fr(e,t,n)}function Ar(e,t){if(t)return e.slice();var n=e.length,r=ps?ps(n):new e.constructor(n);return e.copy(r),r}function Ir(e){var t=new e.constructor(e.byteLength);return new us(t).set(new us(e)),t}function Or(e,t){var n=t?Ir(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}function Nr(e,t){if(e!==t){var n=e!==B,r=null===e,o=e==e,i=vi(e),s=t!==B,a=null===t,l=t==t,c=vi(t);if(!a&&!c&&!i&&e>t||i&&s&&l&&!a&&!c||r&&s&&l||!n&&l||!o)return 1;if(!r&&!i&&!c&&e<t||c&&n&&o&&!r&&!i||a&&n&&o||!s&&o||!l)return-1}return 0}function $r(e,t,n,r){for(var o=-1,i=e.length,s=n.length,a=-1,l=t.length,c=As(i-s,0),d=Bi(l+c),u=!r;++a<l;)d[a]=t[a];for(;++o<s;)(u||o<i)&&(d[n[o]]=e[o]);for(;c--;)d[a++]=e[o++];return d}function Vr(e,t,n,r){for(var o=-1,i=e.length,s=-1,a=n.length,l=-1,c=t.length,d=As(i-a,0),u=Bi(d+c),p=!r;++o<d;)u[o]=e[o];for(var f=o;++l<c;)u[f+l]=t[l];for(;++s<a;)(p||o<i)&&(u[f+n[s]]=e[o++]);return u}function Lr(e,t){var n=-1,r=e.length;for(t||(t=Bi(r));++n<r;)t[n]=e[n];return t}function Fr(e,t,n,r){var o=!n;n||(n={});for(var i=-1,s=t.length;++i<s;){var a=t[i],l=r?r(n[a],e[a],a,n,e):B;l===B&&(l=e[a]),o?Xt(n,a,l):Yt(n,a,l)}return n}function Rr(e,t){return function(n,r){var o=nl(n)?s:Jt,i=t?t():{};return o(n,e,mo(r,2),i)}}function Ur(e){return lr(function(t,n){var r=-1,o=n.length,i=o>1?n[o-1]:B,s=o>2?n[2]:B;for(i=e.length>3&&"function"==typeof i?(o--,i):B,s&&Co(n[0],n[1],s)&&(i=o<3?B:i,o=1),t=zi(t);++r<o;){var a=n[r];a&&e(t,a,r,i)}return t})}function jr(e,t){return function(n,r){if(null==n)return n;if(!si(n))return e(n,r);for(var o=n.length,i=t?o:-1,s=zi(n);(t?i--:++i<o)&&!1!==r(s[i],i,s););return n}}function Br(e){return function(t,n,r){for(var o=-1,i=zi(t),s=r(t),a=s.length;a--;){var l=s[e?a:++o];if(!1===n(i[l],l,i))break}return t}}function qr(e){return function(t){var n=$(t=_i(t))?j(t):B,r=n?n[0]:t.charAt(0),o=n?Pr(n,1).join(""):t.slice(1);return r[e]()+o}}function Hr(e){return function(t){return m(Oi(Ii(t).replace(ln,"")),e,"")}}function Wr(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var n=Zs(e.prototype),r=e.apply(n,t);return pi(r)?r:n}}function Gr(e){return function(t,n,r){var o=zi(t);if(!si(t)){var i=mo(n,3);t=Mi(t),n=function(e){return i(o[e],e,o)}}var s=e(t,n,r);return s>-1?o[i?t[s]:s]:B}}function zr(e){return co(function(t){var n=t.length,r=n,o=Vt.prototype.thru;for(e&&t.reverse();r--;){var i=t[r];if("function"!=typeof i)throw new Ji(W);if(o&&!s&&"wrapper"==fo(i))var s=new Vt([],!0)}for(r=s?r:n;++r<n;){var a=fo(i=t[r]),l="wrapper"==a?ca(i):B;s=l&&To(l[0])&&l[1]==(ae|re|ie|le)&&!l[4].length&&1==l[9]?s[fo(l[0])].apply(s,l[3]):1==i.length&&To(i)?s[a]():s.thru(i)}return function(){var e=arguments,r=e[0];if(s&&1==e.length&&nl(r))return s.plant(r).value();for(var o=0,i=n?t[o].apply(this,e):r;++o<n;)i=t[o].call(this,i);return i}})}function Yr(e,t,n,r,o,i,s,a,l,c){function d(){for(var v=arguments.length,S=Bi(v),y=v;y--;)S[y]=arguments[y];if(h)var E=ho(d),b=function(e,t){for(var n=e.length,r=0;n--;)e[n]===t&&++r;return r}(S,E);if(r&&(S=$r(S,r,o,h)),i&&(S=Vr(S,i,s,h)),v-=b,h&&v<c){var w=F(S,E);return to(e,t,Yr,d.placeholder,n,S,w,a,l,c-v)}var C=p?n:this,_=f?C[e]:e;return v=S.length,a?S=function(e,t){for(var n=e.length,r=Is(t.length,n),o=Lr(e);r--;){var i=t[r];e[r]=wo(i,n)?o[i]:B}return e}(S,a):m&&v>1&&S.reverse(),u&&l<v&&(S.length=l),this&&this!==Cn&&this instanceof d&&(_=g||Wr(_)),_.apply(C,S)}var u=t&ae,p=t&ee,f=t&te,h=t&(re|oe),m=t&ce,g=f?B:Wr(e);return d}function Kr(e,t){return function(n,r){return function(e,t,n,r){return Sn(e,function(e,o,i){t(r,n(e),o,i)}),r}(n,e,t(r),{})}}function Jr(e,t){return function(n,r){var o;if(n===B&&r===B)return t;if(n!==B&&(o=n),r!==B){if(o===B)return r;"string"==typeof n||"string"==typeof r?(n=yr(n),r=yr(r)):(n=Sr(n),r=Sr(r)),o=e(n,r)}return o}}function Qr(e){return co(function(t){return t=f(t,k(mo())),lr(function(n){var r=this;return e(t,function(e){return i(e,r,n)})})})}function Xr(e,t){var n=(t=t===B?" ":yr(t)).length;if(n<2)return n?ar(t,e):t;var r=ar(t,_s(e/U(t)));return $(t)?Pr(j(r),0,e).join(""):r.slice(0,e)}function Zr(e){return function(t,n,r){return r&&"number"!=typeof r&&Co(t,n,r)&&(n=r=B),t=yi(t),n===B?(n=t,t=0):n=yi(n),r=r===B?t<n?1:-1:yi(r),function(e,t,n,r){for(var o=-1,i=As(_s((t-e)/(n||1)),0),s=Bi(i);i--;)s[r?i:++o]=e,e+=n;return s}(t,n,r,e)}}function eo(e){return function(t,n){return"string"==typeof t&&"string"==typeof n||(t=wi(t),n=wi(n)),e(t,n)}}function to(e,t,n,r,o,i,s,a,l,c){var d=t&re;t|=d?ie:se,(t&=~(d?se:ie))&ne||(t&=~(ee|te));var u=[e,t,o,d?i:B,d?s:B,d?B:i,d?B:s,a,l,c],p=n.apply(B,u);return To(e)&&ha(p,u),p.placeholder=r,Ao(p,e,t)}function no(e){var t=Gi[e];return function(e,n){if(e=wi(e),n=null==n?0:Is(Ei(n),292)){var r=(_i(e)+"e").split("e");return+((r=(_i(t(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}function ro(e){return function(t){var n=pa(t);return n==Oe?V(t):n==Re?function(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=[e,e]}),n}(t):function(e,t){return f(t,function(t){return[t,e[t]]})}(t,e(t))}}function oo(e,t,n,r,o,s,a,l){var c=t&te;if(!c&&"function"!=typeof e)throw new Ji(W);var d=r?r.length:0;if(d||(t&=~(ie|se),r=o=B),a=a===B?a:As(Ei(a),0),l=l===B?l:Ei(l),d-=o?o.length:0,t&se){var u=r,p=o;r=o=B}var f=c?B:ca(e),h=[e,t,n,r,o,u,p,s,a,l];if(f&&function(e,t){var n=e[1],r=t[1],o=n|r,i=o<(ee|te|ae),s=r==ae&&n==re||r==ae&&n==le&&e[7].length<=t[8]||r==(ae|le)&&t[7].length<=t[8]&&n==re;if(!i&&!s)return e;r&ee&&(e[2]=t[2],o|=n&ee?0:ne);var a=t[3];if(a){var l=e[3];e[3]=l?$r(l,a,t[4]):a,e[4]=l?F(e[3],Y):t[4]}(a=t[5])&&(l=e[5],e[5]=l?Vr(l,a,t[6]):a,e[6]=l?F(e[5],Y):t[6]),(a=t[7])&&(e[7]=a),r&ae&&(e[8]=null==e[8]?t[8]:Is(e[8],t[8])),null==e[9]&&(e[9]=t[9]),e[0]=t[0],e[1]=o}(h,f),e=h[0],t=h[1],n=h[2],r=h[3],o=h[4],!(l=h[9]=h[9]===B?c?0:e.length:As(h[9]-d,0))&&t&(re|oe)&&(t&=~(re|oe)),t&&t!=ee)m=t==re||t==oe?function(e,t,n){function r(){for(var s=arguments.length,a=Bi(s),l=s,c=ho(r);l--;)a[l]=arguments[l];var d=s<3&&a[0]!==c&&a[s-1]!==c?[]:F(a,c);return(s-=d.length)<n?to(e,t,Yr,r.placeholder,B,a,d,B,B,n-s):i(this&&this!==Cn&&this instanceof r?o:e,this,a)}var o=Wr(e);return r}(e,t,l):t!=ie&&t!=(ee|ie)||o.length?Yr.apply(B,h):function(e,t,n,r){function o(){for(var t=-1,l=arguments.length,c=-1,d=r.length,u=Bi(d+l),p=this&&this!==Cn&&this instanceof o?a:e;++c<d;)u[c]=r[c];for(;l--;)u[c++]=arguments[++t];return i(p,s?n:this,u)}var s=t&ee,a=Wr(e);return o}(e,t,n,r);else var m=function(e,t,n){function r(){return(this&&this!==Cn&&this instanceof r?i:e).apply(o?n:this,arguments)}var o=t&ee,i=Wr(e);return r}(e,t,n);return Ao((f?oa:ha)(m,h),e,t)}function io(e,t,n,r){return e===B||ii(e,Zi[n])&&!ns.call(r,n)?t:e}function so(e,t,n,r,o,i){return pi(e)&&pi(t)&&(i.set(t,e),er(e,t,B,so,i),i.delete(t)),e}function ao(e){return mi(e)?B:e}function lo(e,t,n,r,o,i){var s=n&X,a=e.length,l=t.length;if(a!=l&&!(s&&l>a))return!1;var c=i.get(e);if(c&&i.get(t))return c==t;var d=-1,u=!0,p=n&Z?new jt:B;for(i.set(e,t),i.set(t,e);++d<a;){var f=e[d],h=t[d];if(r)var m=s?r(h,f,d,t,e,i):r(f,h,d,e,t,i);if(m!==B){if(m)continue;u=!1;break}if(p){if(!v(t,function(e,t){if(!A(p,t)&&(f===e||o(f,e,n,r,i)))return p.push(t)})){u=!1;break}}else if(f!==h&&!o(f,h,n,r,i)){u=!1;break}}return i.delete(e),i.delete(t),u}function co(e){return ga(ko(e,B,Ro),e+"")}function uo(e){return Tn(e,Mi,da)}function po(e){return Tn(e,xi,ua)}function fo(e){for(var t=e.name+"",n=Hs[t],r=ns.call(Hs,t)?n.length:0;r--;){var o=n[r],i=o.func;if(null==i||i==e)return o.name}return t}function ho(e){return(ns.call(n,"placeholder")?n:e).placeholder}function mo(){var e=n.iteratee||Vi;return e=e===Vi?zn:e,arguments.length?e(arguments[0],arguments[1]):e}function go(e,t){var n=e.__data__;return function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}(t)?n["string"==typeof t?"string":"hash"]:n.map}function vo(e){for(var t=Mi(e),n=t.length;n--;){var r=t[n],o=e[r];t[n]=[r,o,Mo(o)]}return t}function So(e,t){var n=function(e,t){return null==e?B:e[t]}(e,t);return Gn(n)?n:B}function yo(e,t,n){for(var r=-1,o=(t=kr(t,e)).length,i=!1;++r<o;){var s=No(t[r]);if(!(i=null!=e&&n(e,s)))break;e=e[s]}return i||++r!=o?i:!!(o=null==e?0:e.length)&&ui(o)&&wo(s,o)&&(nl(e)||tl(e))}function Eo(e){return"function"!=typeof e.constructor||Do(e)?{}:Zs(fs(e))}function bo(e){return nl(e)||tl(e)||!!(vs&&e&&e[vs])}function wo(e,t){return!!(t=null==t?ve:t)&&("number"==typeof e||It.test(e))&&e>-1&&e%1==0&&e<t}function Co(e,t,n){if(!pi(n))return!1;var r=typeof t;return!!("number"==r?si(n)&&wo(t,n.length):"string"==r&&t in n)&&ii(n[t],e)}function _o(e,t){if(nl(e))return!1;var n=typeof e;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!vi(e))||ft.test(e)||!pt.test(e)||null!=t&&e in zi(t)}function To(e){var t=fo(e),r=n[t];if("function"!=typeof r||!(t in Lt.prototype))return!1;if(e===r)return!0;var o=ca(r);return!!o&&e===o[0]}function Do(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Zi)}function Mo(e){return e==e&&!pi(e)}function xo(e,t){return function(n){return null!=n&&n[e]===t&&(t!==B||e in zi(n))}}function ko(e,t,n){return t=As(t===B?e.length-1:t,0),function(){for(var r=arguments,o=-1,s=As(r.length-t,0),a=Bi(s);++o<s;)a[o]=r[t+o];o=-1;for(var l=Bi(t+1);++o<t;)l[o]=r[o];return l[t]=n(a),i(e,this,l)}}function Po(e,t){return t.length<2?e:_n(e,fr(t,0,-1))}function Ao(e,t,n){var r=t+"";return ga(e,function(e,t){var n=t.length;if(!n)return e;var r=n-1;return t[r]=(n>1?"& ":"")+t[r],t=t.join(n>2?", ":" "),e.replace(bt,"{\n/* [wrapped with "+t+"] */\n")}(r,function(e,t){return a(Ce,function(n){var r="_."+n[0];t&n[1]&&!u(e,r)&&e.push(r)}),e.sort()}(function(e){var t=e.match(wt);return t?t[1].split(Ct):[]}(r),n)))}function Io(e){var t=0,n=0;return function(){var r=Os(),o=fe-(r-n);if(n=r,o>0){if(++t>=pe)return arguments[0]}else t=0;return e.apply(B,arguments)}}function Oo(e,t){var n=-1,r=e.length,o=r-1;for(t=t===B?r:t;++n<t;){var i=sr(n,o),s=e[i];e[i]=e[n],e[n]=s}return e.length=t,e}function No(e){if("string"==typeof e||vi(e))return e;var t=e+"";return"0"==t&&1/e==-ge?"-0":t}function $o(e){if(null!=e){try{return ts.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function Vo(e){if(e instanceof Lt)return e.clone();var t=new Vt(e.__wrapped__,e.__chain__);return t.__actions__=Lr(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Lo(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=null==n?0:Ei(n);return o<0&&(o=As(r+o,0)),y(e,mo(t,3),o)}function Fo(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=r-1;return n!==B&&(o=Ei(n),o=n<0?As(r+o,0):Is(o,r-1)),y(e,mo(t,3),o,!0)}function Ro(e){return null!=e&&e.length?pn(e,1):[]}function Uo(e){return e&&e.length?e[0]:B}function jo(e){var t=null==e?0:e.length;return t?e[t-1]:B}function Bo(e,t){return e&&e.length&&t&&t.length?or(e,t):e}function qo(e){return null==e?e:Vs.call(e)}function Ho(e){if(!e||!e.length)return[];var t=0;return e=d(e,function(e){if(ai(e))return t=As(e.length,t),!0}),x(t,function(t){return f(e,_(t))})}function Wo(e,t){if(!e||!e.length)return[];var n=Ho(e);return null==t?n:f(n,function(e){return i(t,B,e)})}function Go(e){var t=n(e);return t.__chain__=!0,t}function zo(e,t){return t(e)}function Yo(){return this}function Ko(e,t){return(nl(e)?a:ea)(e,mo(t,3))}function Jo(e,t){return(nl(e)?l:ta)(e,mo(t,3))}function Qo(e,t){return(nl(e)?f:Qn)(e,mo(t,3))}function Xo(e,t,n){return t=n?B:t,t=e&&null==t?e.length:t,oo(e,ae,B,B,B,B,t)}function Zo(e,t){var n;if("function"!=typeof t)throw new Ji(W);return e=Ei(e),function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=B),n}}function ei(e,t,n){var r=oo(e,re,B,B,B,B,B,t=n?B:t);return r.placeholder=ei.placeholder,r}function ti(e,t,n){var r=oo(e,oe,B,B,B,B,B,t=n?B:t);return r.placeholder=ti.placeholder,r}function ni(e,t,n){function r(t){var n=l,r=c;return l=c=B,h=t,u=e.apply(r,n)}function o(e){var n=e-f;return f===B||n>=t||n<0||g&&e-h>=d}function i(){var e=Ha();if(o(e))return s(e);p=ma(i,function(e){var n=t-(e-f);return g?Is(n,d-(e-h)):n}(e))}function s(e){return p=B,v&&l?r(e):(l=c=B,u)}function a(){var e=Ha(),n=o(e);if(l=arguments,c=this,f=e,n){if(p===B)return function(e){return h=e,p=ma(i,t),m?r(e):u}(f);if(g)return p=ma(i,t),r(f)}return p===B&&(p=ma(i,t)),u}var l,c,d,u,p,f,h=0,m=!1,g=!1,v=!0;if("function"!=typeof e)throw new Ji(W);return t=wi(t)||0,pi(n)&&(m=!!n.leading,d=(g="maxWait"in n)?As(wi(n.maxWait)||0,t):d,v="trailing"in n?!!n.trailing:v),a.cancel=function(){p!==B&&aa(p),h=0,l=f=c=p=B},a.flush=function(){return p===B?u:s(Ha())},a}function ri(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new Ji(W);var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],i=n.cache;if(i.has(o))return i.get(o);var s=e.apply(this,r);return n.cache=i.set(o,s)||i,s};return n.cache=new(ri.Cache||Ut),n}function oi(e){if("function"!=typeof e)throw new Ji(W);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function ii(e,t){return e===t||e!=e&&t!=t}function si(e){return null!=e&&ui(e.length)&&!ci(e)}function ai(e){return fi(e)&&si(e)}function li(e){if(!fi(e))return!1;var t=Mn(e);return t==Pe||t==ke||"string"==typeof e.message&&"string"==typeof e.name&&!mi(e)}function ci(e){if(!pi(e))return!1;var t=Mn(e);return t==Ae||t==Ie||t==De||t==Le}function di(e){return"number"==typeof e&&e==Ei(e)}function ui(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=ve}function pi(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function fi(e){return null!=e&&"object"==typeof e}function hi(e){return"number"==typeof e||fi(e)&&Mn(e)==Ne}function mi(e){if(!fi(e)||Mn(e)!=Ve)return!1;var t=fs(e);if(null===t)return!0;var n=ns.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&ts.call(n)==ss}function gi(e){return"string"==typeof e||!nl(e)&&fi(e)&&Mn(e)==Ue}function vi(e){return"symbol"==typeof e||fi(e)&&Mn(e)==je}function Si(e){if(!e)return[];if(si(e))return gi(e)?j(e):Lr(e);if(Ss&&e[Ss])return function(e){for(var t,n=[];!(t=e.next()).done;)n.push(t.value);return n}(e[Ss]());var t=pa(e);return(t==Oe?V:t==Re?R:Pi)(e)}function yi(e){return e?(e=wi(e))===ge||e===-ge?(e<0?-1:1)*Se:e==e?e:0:0===e?e:0}function Ei(e){var t=yi(e),n=t%1;return t==t?n?t-n:t:0}function bi(e){return e?en(Ei(e),0,Ee):0}function wi(e){if("number"==typeof e)return e;if(vi(e))return ye;if(pi(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=pi(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(St,"");var n=kt.test(e);return n||At.test(e)?En(e.slice(2),n?2:8):xt.test(e)?ye:+e}function Ci(e){return Fr(e,xi(e))}function _i(e){return null==e?"":yr(e)}function Ti(e,t,n){var r=null==e?B:_n(e,t);return r===B?n:r}function Di(e,t){return null!=e&&yo(e,t,Un)}function Mi(e){return si(e)?qt(e):Yn(e)}function xi(e){return si(e)?qt(e,!0):Kn(e)}function ki(e,t){if(null==e)return{};var n=f(po(e),function(e){return[e]});return t=mo(t),rr(e,n,function(e,n){return t(e,n[0])})}function Pi(e){return null==e?[]:P(e,Mi(e))}function Ai(e){return $l(_i(e).toLowerCase())}function Ii(e){return(e=_i(e))&&e.replace(Ot,Vn).replace(cn,"")}function Oi(e,t,n){return e=_i(e),(t=n?B:t)===B?function(e){return fn.test(e)}(e)?function(e){return e.match(un)||[]}(e):function(e){return e.match(_t)||[]}(e):e.match(t)||[]}function Ni(e){return function(){return e}}function $i(e){return e}function Vi(e){return zn("function"==typeof e?e:tn(e,K))}function Li(e,t,n){var r=Mi(t),o=wn(t,r);null!=n||pi(t)&&(o.length||!r.length)||(n=t,t=e,e=this,o=wn(t,Mi(t)));var i=!(pi(n)&&"chain"in n&&!n.chain),s=ci(e);return a(o,function(n){var r=t[n];e[n]=r,s&&(e.prototype[n]=function(){var t=this.__chain__;if(i||t){var n=e(this.__wrapped__);return(n.__actions__=Lr(this.__actions__)).push({func:r,args:arguments,thisArg:e}),n.__chain__=t,n}return r.apply(e,h([this.value()],arguments))})}),e}function Fi(){}function Ri(e){return _o(e)?_(No(e)):function(e){return function(t){return _n(t,e)}}(e)}function Ui(){return[]}function ji(){return!1}var Bi=(t=null==t?Cn:Rn.defaults(Cn.Object(),t,Rn.pick(Cn,hn))).Array,qi=t.Date,Hi=t.Error,Wi=t.Function,Gi=t.Math,zi=t.Object,Yi=t.RegExp,Ki=t.String,Ji=t.TypeError,Qi=Bi.prototype,Xi=Wi.prototype,Zi=zi.prototype,es=t["__core-js_shared__"],ts=Xi.toString,ns=Zi.hasOwnProperty,rs=0,os=function(){var e=/[^.]+$/.exec(es&&es.keys&&es.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),is=Zi.toString,ss=ts.call(zi),as=Cn._,ls=Yi("^"+ts.call(ns).replace(gt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),cs=Dn?t.Buffer:B,ds=t.Symbol,us=t.Uint8Array,ps=cs?cs.allocUnsafe:B,fs=L(zi.getPrototypeOf,zi),hs=zi.create,ms=Zi.propertyIsEnumerable,gs=Qi.splice,vs=ds?ds.isConcatSpreadable:B,Ss=ds?ds.iterator:B,ys=ds?ds.toStringTag:B,Es=function(){try{var e=So(zi,"defineProperty");return e({},"",{}),e}catch(e){}}(),bs=t.clearTimeout!==Cn.clearTimeout&&t.clearTimeout,ws=qi&&qi.now!==Cn.Date.now&&qi.now,Cs=t.setTimeout!==Cn.setTimeout&&t.setTimeout,_s=Gi.ceil,Ts=Gi.floor,Ds=zi.getOwnPropertySymbols,Ms=cs?cs.isBuffer:B,xs=t.isFinite,ks=Qi.join,Ps=L(zi.keys,zi),As=Gi.max,Is=Gi.min,Os=qi.now,Ns=t.parseInt,$s=Gi.random,Vs=Qi.reverse,Ls=So(t,"DataView"),Fs=So(t,"Map"),Rs=So(t,"Promise"),Us=So(t,"Set"),js=So(t,"WeakMap"),Bs=So(zi,"create"),qs=js&&new js,Hs={},Ws=$o(Ls),Gs=$o(Fs),zs=$o(Rs),Ys=$o(Us),Ks=$o(js),Js=ds?ds.prototype:B,Qs=Js?Js.valueOf:B,Xs=Js?Js.toString:B,Zs=function(){function e(){}return function(t){if(!pi(t))return{};if(hs)return hs(t);e.prototype=t;var n=new e;return e.prototype=B,n}}();n.templateSettings={escape:ct,evaluate:dt,interpolate:ut,variable:"",imports:{_:n}},(n.prototype=T.prototype).constructor=n,(Vt.prototype=Zs(T.prototype)).constructor=Vt,(Lt.prototype=Zs(T.prototype)).constructor=Lt,Ft.prototype.clear=function(){this.__data__=Bs?Bs(null):{},this.size=0},Ft.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},Ft.prototype.get=function(e){var t=this.__data__;if(Bs){var n=t[e];return n===G?B:n}return ns.call(t,e)?t[e]:B},Ft.prototype.has=function(e){var t=this.__data__;return Bs?t[e]!==B:ns.call(t,e)},Ft.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Bs&&t===B?G:t,this},Rt.prototype.clear=function(){this.__data__=[],this.size=0},Rt.prototype.delete=function(e){var t=this.__data__,n=Kt(t,e);return!(n<0||(n==t.length-1?t.pop():gs.call(t,n,1),--this.size,0))},Rt.prototype.get=function(e){var t=this.__data__,n=Kt(t,e);return n<0?B:t[n][1]},Rt.prototype.has=function(e){return Kt(this.__data__,e)>-1},Rt.prototype.set=function(e,t){var n=this.__data__,r=Kt(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this},Ut.prototype.clear=function(){this.size=0,this.__data__={hash:new Ft,map:new(Fs||Rt),string:new Ft}},Ut.prototype.delete=function(e){var t=go(this,e).delete(e);return this.size-=t?1:0,t},Ut.prototype.get=function(e){return go(this,e).get(e)},Ut.prototype.has=function(e){return go(this,e).has(e)},Ut.prototype.set=function(e,t){var n=go(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this},jt.prototype.add=jt.prototype.push=function(e){return this.__data__.set(e,G),this},jt.prototype.has=function(e){return this.__data__.has(e)},Bt.prototype.clear=function(){this.__data__=new Rt,this.size=0},Bt.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Bt.prototype.get=function(e){return this.__data__.get(e)},Bt.prototype.has=function(e){return this.__data__.has(e)},Bt.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Rt){var r=n.__data__;if(!Fs||r.length<q-1)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ut(r)}return n.set(e,t),this.size=n.size,this};var ea=jr(Sn),ta=jr(bn,!0),na=Br(),ra=Br(!0),oa=qs?function(e,t){return qs.set(e,t),e}:$i,ia=Es?function(e,t){return Es(e,"toString",{configurable:!0,enumerable:!1,value:Ni(t),writable:!0})}:$i,sa=lr,aa=bs||function(e){return Cn.clearTimeout(e)},la=Us&&1/R(new Us([,-0]))[1]==ge?function(e){return new Us(e)}:Fi,ca=qs?function(e){return qs.get(e)}:Fi,da=Ds?function(e){return null==e?[]:(e=zi(e),d(Ds(e),function(t){return ms.call(e,t)}))}:Ui,ua=Ds?function(e){for(var t=[];e;)h(t,da(e)),e=fs(e);return t}:Ui,pa=Mn;(Ls&&pa(new Ls(new ArrayBuffer(1)))!=Ge||Fs&&pa(new Fs)!=Oe||Rs&&"[object Promise]"!=pa(Rs.resolve())||Us&&pa(new Us)!=Re||js&&pa(new js)!=qe)&&(pa=function(e){var t=Mn(e),n=t==Ve?e.constructor:B,r=n?$o(n):"";if(r)switch(r){case Ws:return Ge;case Gs:return Oe;case zs:return"[object Promise]";case Ys:return Re;case Ks:return qe}return t});var fa=es?ci:ji,ha=Io(oa),ma=Cs||function(e,t){return Cn.setTimeout(e,t)},ga=Io(ia),va=function(e){var t=ri(e,function(e){return n.size===z&&n.clear(),e}),n=t.cache;return t}(function(e){var t=[];return ht.test(e)&&t.push(""),e.replace(mt,function(e,n,r,o){t.push(r?o.replace(Tt,"$1"):n||e)}),t}),Sa=lr(function(e,t){return ai(e)?on(e,pn(t,1,ai,!0)):[]}),ya=lr(function(e,t){var n=jo(t);return ai(n)&&(n=B),ai(e)?on(e,pn(t,1,ai,!0),mo(n,2)):[]}),Ea=lr(function(e,t){var n=jo(t);return ai(n)&&(n=B),ai(e)?on(e,pn(t,1,ai,!0),B,n):[]}),ba=lr(function(e){var t=f(e,Mr);return t.length&&t[0]===e[0]?jn(t):[]}),wa=lr(function(e){var t=jo(e),n=f(e,Mr);return t===jo(n)?t=B:n.pop(),n.length&&n[0]===e[0]?jn(n,mo(t,2)):[]}),Ca=lr(function(e){var t=jo(e),n=f(e,Mr);return(t="function"==typeof t?t:B)&&n.pop(),n.length&&n[0]===e[0]?jn(n,B,t):[]}),_a=lr(Bo),Ta=co(function(e,t){var n=null==e?0:e.length,r=Zt(e,t);return ir(e,f(t,function(e){return wo(e,n)?+e:e}).sort(Nr)),r}),Da=lr(function(e){return Er(pn(e,1,ai,!0))}),Ma=lr(function(e){var t=jo(e);return ai(t)&&(t=B),Er(pn(e,1,ai,!0),mo(t,2))}),xa=lr(function(e){var t=jo(e);return t="function"==typeof t?t:B,Er(pn(e,1,ai,!0),B,t)}),ka=lr(function(e,t){return ai(e)?on(e,t):[]}),Pa=lr(function(e){return Tr(d(e,ai))}),Aa=lr(function(e){var t=jo(e);return ai(t)&&(t=B),Tr(d(e,ai),mo(t,2))}),Ia=lr(function(e){var t=jo(e);return t="function"==typeof t?t:B,Tr(d(e,ai),B,t)}),Oa=lr(Ho),Na=lr(function(e){var t=e.length,n=t>1?e[t-1]:B;return n="function"==typeof n?(e.pop(),n):B,Wo(e,n)}),$a=co(function(e){var t=e.length,n=t?e[0]:0,r=this.__wrapped__,o=function(t){return Zt(t,e)};return!(t>1||this.__actions__.length)&&r instanceof Lt&&wo(n)?((r=r.slice(n,+n+(t?1:0))).__actions__.push({func:zo,args:[o],thisArg:B}),new Vt(r,this.__chain__).thru(function(e){return t&&!e.length&&e.push(B),e})):this.thru(o)}),Va=Rr(function(e,t,n){ns.call(e,n)?++e[n]:Xt(e,n,1)}),La=Gr(Lo),Fa=Gr(Fo),Ra=Rr(function(e,t,n){ns.call(e,n)?e[n].push(t):Xt(e,n,[t])}),Ua=lr(function(e,t,n){var r=-1,o="function"==typeof t,s=si(e)?Bi(e.length):[];return ea(e,function(e){s[++r]=o?i(t,e,n):Bn(e,t,n)}),s}),ja=Rr(function(e,t,n){Xt(e,n,t)}),Ba=Rr(function(e,t,n){e[n?0:1].push(t)},function(){return[[],[]]}),qa=lr(function(e,t){if(null==e)return[];var n=t.length;return n>1&&Co(e,t[0],t[1])?t=[]:n>2&&Co(t[0],t[1],t[2])&&(t=[t[0]]),nr(e,pn(t,1),[])}),Ha=ws||function(){return Cn.Date.now()},Wa=lr(function(e,t,n){var r=ee;if(n.length){var o=F(n,ho(Wa));r|=ie}return oo(e,r,t,n,o)}),Ga=lr(function(e,t,n){var r=ee|te;if(n.length){var o=F(n,ho(Ga));r|=ie}return oo(t,r,e,n,o)}),za=lr(function(e,t){return rn(e,1,t)}),Ya=lr(function(e,t,n){return rn(e,wi(t)||0,n)});ri.Cache=Ut;var Ka=sa(function(e,t){var n=(t=1==t.length&&nl(t[0])?f(t[0],k(mo())):f(pn(t,1),k(mo()))).length;return lr(function(r){for(var o=-1,s=Is(r.length,n);++o<s;)r[o]=t[o].call(this,r[o]);return i(e,this,r)})}),Ja=lr(function(e,t){var n=F(t,ho(Ja));return oo(e,ie,B,t,n)}),Qa=lr(function(e,t){var n=F(t,ho(Qa));return oo(e,se,B,t,n)}),Xa=co(function(e,t){return oo(e,le,B,B,B,t)}),Za=eo(xn),el=eo(function(e,t){return e>=t}),tl=qn(function(){return arguments}())?qn:function(e){return fi(e)&&ns.call(e,"callee")&&!ms.call(e,"callee")},nl=Bi.isArray,rl=kn?k(kn):function(e){return fi(e)&&Mn(e)==We},ol=Ms||ji,il=Pn?k(Pn):function(e){return fi(e)&&Mn(e)==xe},sl=An?k(An):function(e){return fi(e)&&pa(e)==Oe},al=In?k(In):function(e){return fi(e)&&Mn(e)==Fe},ll=On?k(On):function(e){return fi(e)&&pa(e)==Re},cl=Nn?k(Nn):function(e){return fi(e)&&ui(e.length)&&!!gn[Mn(e)]},dl=eo(Jn),ul=eo(function(e,t){return e<=t}),pl=Ur(function(e,t){if(Do(t)||si(t))Fr(t,Mi(t),e);else for(var n in t)ns.call(t,n)&&Yt(e,n,t[n])}),fl=Ur(function(e,t){Fr(t,xi(t),e)}),hl=Ur(function(e,t,n,r){Fr(t,xi(t),e,r)}),ml=Ur(function(e,t,n,r){Fr(t,Mi(t),e,r)}),gl=co(Zt),vl=lr(function(e){return e.push(B,io),i(hl,B,e)}),Sl=lr(function(e){return e.push(B,so),i(Cl,B,e)}),yl=Kr(function(e,t,n){e[t]=n},Ni($i)),El=Kr(function(e,t,n){ns.call(e,t)?e[t].push(n):e[t]=[n]},mo),bl=lr(Bn),wl=Ur(function(e,t,n){er(e,t,n)}),Cl=Ur(function(e,t,n,r){er(e,t,n,r)}),_l=co(function(e,t){var n={};if(null==e)return n;var r=!1;t=f(t,function(t){return t=kr(t,e),r||(r=t.length>1),t}),Fr(e,po(e),n),r&&(n=tn(n,K|J|Q,ao));for(var o=t.length;o--;)br(n,t[o]);return n}),Tl=co(function(e,t){return null==e?{}:function(e,t){return rr(e,t,function(t,n){return Di(e,n)})}(e,t)}),Dl=ro(Mi),Ml=ro(xi),xl=Hr(function(e,t,n){return t=t.toLowerCase(),e+(n?Ai(t):t)}),kl=Hr(function(e,t,n){return e+(n?"-":"")+t.toLowerCase()}),Pl=Hr(function(e,t,n){return e+(n?" ":"")+t.toLowerCase()}),Al=qr("toLowerCase"),Il=Hr(function(e,t,n){return e+(n?"_":"")+t.toLowerCase()}),Ol=Hr(function(e,t,n){return e+(n?" ":"")+$l(t)}),Nl=Hr(function(e,t,n){return e+(n?" ":"")+t.toUpperCase()}),$l=qr("toUpperCase"),Vl=lr(function(e,t){try{return i(e,B,t)}catch(e){return li(e)?e:new Hi(e)}}),Ll=co(function(e,t){return a(t,function(t){t=No(t),Xt(e,t,Wa(e[t],e))}),e}),Fl=zr(),Rl=zr(!0),Ul=lr(function(e,t){return function(n){return Bn(n,e,t)}}),jl=lr(function(e,t){return function(n){return Bn(e,n,t)}}),Bl=Qr(f),ql=Qr(c),Hl=Qr(v),Wl=Zr(),Gl=Zr(!0),zl=Jr(function(e,t){return e+t},0),Yl=no("ceil"),Kl=Jr(function(e,t){return e/t},1),Jl=no("floor"),Ql=Jr(function(e,t){return e*t},1),Xl=no("round"),Zl=Jr(function(e,t){return e-t},0);return n.after=function(e,t){if("function"!=typeof t)throw new Ji(W);return e=Ei(e),function(){if(--e<1)return t.apply(this,arguments)}},n.ary=Xo,n.assign=pl,n.assignIn=fl,n.assignInWith=hl,n.assignWith=ml,n.at=gl,n.before=Zo,n.bind=Wa,n.bindAll=Ll,n.bindKey=Ga,n.castArray=function(){if(!arguments.length)return[];var e=arguments[0];return nl(e)?e:[e]},n.chain=Go,n.chunk=function(e,t,n){t=(n?Co(e,t,n):t===B)?1:As(Ei(t),0);var r=null==e?0:e.length;if(!r||t<1)return[];for(var o=0,i=0,s=Bi(_s(r/t));o<r;)s[i++]=fr(e,o,o+=t);return s},n.compact=function(e){for(var t=-1,n=null==e?0:e.length,r=0,o=[];++t<n;){var i=e[t];i&&(o[r++]=i)}return o},n.concat=function(){var e=arguments.length;if(!e)return[];for(var t=Bi(e-1),n=arguments[0],r=e;r--;)t[r-1]=arguments[r];return h(nl(n)?Lr(n):[n],pn(t,1))},n.cond=function(e){var t=null==e?0:e.length,n=mo();return e=t?f(e,function(e){if("function"!=typeof e[1])throw new Ji(W);return[n(e[0]),e[1]]}):[],lr(function(n){for(var r=-1;++r<t;){var o=e[r];if(i(o[0],this,n))return i(o[1],this,n)}})},n.conforms=function(e){return function(e){var t=Mi(e);return function(n){return nn(n,e,t)}}(tn(e,K))},n.constant=Ni,n.countBy=Va,n.create=function(e,t){var n=Zs(e);return null==t?n:Qt(n,t)},n.curry=ei,n.curryRight=ti,n.debounce=ni,n.defaults=vl,n.defaultsDeep=Sl,n.defer=za,n.delay=Ya,n.difference=Sa,n.differenceBy=ya,n.differenceWith=Ea,n.drop=function(e,t,n){var r=null==e?0:e.length;return r?(t=n||t===B?1:Ei(t),fr(e,t<0?0:t,r)):[]},n.dropRight=function(e,t,n){var r=null==e?0:e.length;return r?(t=n||t===B?1:Ei(t),t=r-t,fr(e,0,t<0?0:t)):[]},n.dropRightWhile=function(e,t){return e&&e.length?Cr(e,mo(t,3),!0,!0):[]},n.dropWhile=function(e,t){return e&&e.length?Cr(e,mo(t,3),!0):[]},n.fill=function(e,t,n,r){var o=null==e?0:e.length;return o?(n&&"number"!=typeof n&&Co(e,t,n)&&(n=0,r=o),function(e,t,n,r){var o=e.length;for((n=Ei(n))<0&&(n=-n>o?0:o+n),(r=r===B||r>o?o:Ei(r))<0&&(r+=o),r=n>r?0:bi(r);n<r;)e[n++]=t;return e}(e,t,n,r)):[]},n.filter=function(e,t){return(nl(e)?d:dn)(e,mo(t,3))},n.flatMap=function(e,t){return pn(Qo(e,t),1)},n.flatMapDeep=function(e,t){return pn(Qo(e,t),ge)},n.flatMapDepth=function(e,t,n){return n=n===B?1:Ei(n),pn(Qo(e,t),n)},n.flatten=Ro,n.flattenDeep=function(e){return null!=e&&e.length?pn(e,ge):[]},n.flattenDepth=function(e,t){return null!=e&&e.length?(t=t===B?1:Ei(t),pn(e,t)):[]},n.flip=function(e){return oo(e,ce)},n.flow=Fl,n.flowRight=Rl,n.fromPairs=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var o=e[t];r[o[0]]=o[1]}return r},n.functions=function(e){return null==e?[]:wn(e,Mi(e))},n.functionsIn=function(e){return null==e?[]:wn(e,xi(e))},n.groupBy=Ra,n.initial=function(e){return null!=e&&e.length?fr(e,0,-1):[]},n.intersection=ba,n.intersectionBy=wa,n.intersectionWith=Ca,n.invert=yl,n.invertBy=El,n.invokeMap=Ua,n.iteratee=Vi,n.keyBy=ja,n.keys=Mi,n.keysIn=xi,n.map=Qo,n.mapKeys=function(e,t){var n={};return t=mo(t,3),Sn(e,function(e,r,o){Xt(n,t(e,r,o),e)}),n},n.mapValues=function(e,t){var n={};return t=mo(t,3),Sn(e,function(e,r,o){Xt(n,r,t(e,r,o))}),n},n.matches=function(e){return Xn(tn(e,K))},n.matchesProperty=function(e,t){return Zn(e,tn(t,K))},n.memoize=ri,n.merge=wl,n.mergeWith=Cl,n.method=Ul,n.methodOf=jl,n.mixin=Li,n.negate=oi,n.nthArg=function(e){return e=Ei(e),lr(function(t){return tr(t,e)})},n.omit=_l,n.omitBy=function(e,t){return ki(e,oi(mo(t)))},n.once=function(e){return Zo(2,e)},n.orderBy=function(e,t,n,r){return null==e?[]:(nl(t)||(t=null==t?[]:[t]),n=r?B:n,nl(n)||(n=null==n?[]:[n]),nr(e,t,n))},n.over=Bl,n.overArgs=Ka,n.overEvery=ql,n.overSome=Hl,n.partial=Ja,n.partialRight=Qa,n.partition=Ba,n.pick=Tl,n.pickBy=ki,n.property=Ri,n.propertyOf=function(e){return function(t){return null==e?B:_n(e,t)}},n.pull=_a,n.pullAll=Bo,n.pullAllBy=function(e,t,n){return e&&e.length&&t&&t.length?or(e,t,mo(n,2)):e},n.pullAllWith=function(e,t,n){return e&&e.length&&t&&t.length?or(e,t,B,n):e},n.pullAt=Ta,n.range=Wl,n.rangeRight=Gl,n.rearg=Xa,n.reject=function(e,t){return(nl(e)?d:dn)(e,oi(mo(t,3)))},n.remove=function(e,t){var n=[];if(!e||!e.length)return n;var r=-1,o=[],i=e.length;for(t=mo(t,3);++r<i;){var s=e[r];t(s,r,e)&&(n.push(s),o.push(r))}return ir(e,o),n},n.rest=function(e,t){if("function"!=typeof e)throw new Ji(W);return t=t===B?t:Ei(t),lr(e,t)},n.reverse=qo,n.sampleSize=function(e,t,n){return t=(n?Co(e,t,n):t===B)?1:Ei(t),(nl(e)?Wt:dr)(e,t)},n.set=function(e,t,n){return null==e?e:ur(e,t,n)},n.setWith=function(e,t,n,r){return r="function"==typeof r?r:B,null==e?e:ur(e,t,n,r)},n.shuffle=function(e){return(nl(e)?Gt:pr)(e)},n.slice=function(e,t,n){var r=null==e?0:e.length;return r?(n&&"number"!=typeof n&&Co(e,t,n)?(t=0,n=r):(t=null==t?0:Ei(t),n=n===B?r:Ei(n)),fr(e,t,n)):[]},n.sortBy=qa,n.sortedUniq=function(e){return e&&e.length?vr(e):[]},n.sortedUniqBy=function(e,t){return e&&e.length?vr(e,mo(t,2)):[]},n.split=function(e,t,n){return n&&"number"!=typeof n&&Co(e,t,n)&&(t=n=B),(n=n===B?Ee:n>>>0)?(e=_i(e))&&("string"==typeof t||null!=t&&!al(t))&&!(t=yr(t))&&$(e)?Pr(j(e),0,n):e.split(t,n):[]},n.spread=function(e,t){if("function"!=typeof e)throw new Ji(W);return t=null==t?0:As(Ei(t),0),lr(function(n){var r=n[t],o=Pr(n,0,t);return r&&h(o,r),i(e,this,o)})},n.tail=function(e){var t=null==e?0:e.length;return t?fr(e,1,t):[]},n.take=function(e,t,n){return e&&e.length?(t=n||t===B?1:Ei(t),fr(e,0,t<0?0:t)):[]},n.takeRight=function(e,t,n){var r=null==e?0:e.length;return r?(t=n||t===B?1:Ei(t),t=r-t,fr(e,t<0?0:t,r)):[]},n.takeRightWhile=function(e,t){return e&&e.length?Cr(e,mo(t,3),!1,!0):[]},n.takeWhile=function(e,t){return e&&e.length?Cr(e,mo(t,3)):[]},n.tap=function(e,t){return t(e),e},n.throttle=function(e,t,n){var r=!0,o=!0;if("function"!=typeof e)throw new Ji(W);return pi(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),ni(e,t,{leading:r,maxWait:t,trailing:o})},n.thru=zo,n.toArray=Si,n.toPairs=Dl,n.toPairsIn=Ml,n.toPath=function(e){return nl(e)?f(e,No):vi(e)?[e]:Lr(va(_i(e)))},n.toPlainObject=Ci,n.transform=function(e,t,n){var r=nl(e),o=r||ol(e)||cl(e);if(t=mo(t,4),null==n){var i=e&&e.constructor;n=o?r?new i:[]:pi(e)&&ci(i)?Zs(fs(e)):{}}return(o?a:Sn)(e,function(e,r,o){return t(n,e,r,o)}),n},n.unary=function(e){return Xo(e,1)},n.union=Da,n.unionBy=Ma,n.unionWith=xa,n.uniq=function(e){return e&&e.length?Er(e):[]},n.uniqBy=function(e,t){return e&&e.length?Er(e,mo(t,2)):[]},n.uniqWith=function(e,t){return t="function"==typeof t?t:B,e&&e.length?Er(e,B,t):[]},n.unset=function(e,t){return null==e||br(e,t)},n.unzip=Ho,n.unzipWith=Wo,n.update=function(e,t,n){return null==e?e:wr(e,t,xr(n))},n.updateWith=function(e,t,n,r){return r="function"==typeof r?r:B,null==e?e:wr(e,t,xr(n),r)},n.values=Pi,n.valuesIn=function(e){return null==e?[]:P(e,xi(e))},n.without=ka,n.words=Oi,n.wrap=function(e,t){return Ja(xr(t),e)},n.xor=Pa,n.xorBy=Aa,n.xorWith=Ia,n.zip=Oa,n.zipObject=function(e,t){return Dr(e||[],t||[],Yt)},n.zipObjectDeep=function(e,t){return Dr(e||[],t||[],ur)},n.zipWith=Na,n.entries=Dl,n.entriesIn=Ml,n.extend=fl,n.extendWith=hl,Li(n,n),n.add=zl,n.attempt=Vl,n.camelCase=xl,n.capitalize=Ai,n.ceil=Yl,n.clamp=function(e,t,n){return n===B&&(n=t,t=B),n!==B&&(n=(n=wi(n))==n?n:0),t!==B&&(t=(t=wi(t))==t?t:0),en(wi(e),t,n)},n.clone=function(e){return tn(e,Q)},n.cloneDeep=function(e){return tn(e,K|Q)},n.cloneDeepWith=function(e,t){return t="function"==typeof t?t:B,tn(e,K|Q,t)},n.cloneWith=function(e,t){return t="function"==typeof t?t:B,tn(e,Q,t)},n.conformsTo=function(e,t){return null==t||nn(e,t,Mi(t))},n.deburr=Ii,n.defaultTo=function(e,t){return null==e||e!=e?t:e},n.divide=Kl,n.endsWith=function(e,t,n){e=_i(e),t=yr(t);var r=e.length,o=n=n===B?r:en(Ei(n),0,r);return(n-=t.length)>=0&&e.slice(n,o)==t},n.eq=ii,n.escape=function(e){return(e=_i(e))&&lt.test(e)?e.replace(st,Ln):e},n.escapeRegExp=function(e){return(e=_i(e))&&vt.test(e)?e.replace(gt,"\\$&"):e},n.every=function(e,t,n){var r=nl(e)?c:sn;return n&&Co(e,t,n)&&(t=B),r(e,mo(t,3))},n.find=La,n.findIndex=Lo,n.findKey=function(e,t){return S(e,mo(t,3),Sn)},n.findLast=Fa,n.findLastIndex=Fo,n.findLastKey=function(e,t){return S(e,mo(t,3),bn)},n.floor=Jl,n.forEach=Ko,n.forEachRight=Jo,n.forIn=function(e,t){return null==e?e:na(e,mo(t,3),xi)},n.forInRight=function(e,t){return null==e?e:ra(e,mo(t,3),xi)},n.forOwn=function(e,t){return e&&Sn(e,mo(t,3))},n.forOwnRight=function(e,t){return e&&bn(e,mo(t,3))},n.get=Ti,n.gt=Za,n.gte=el,n.has=function(e,t){return null!=e&&yo(e,t,$n)},n.hasIn=Di,n.head=Uo,n.identity=$i,n.includes=function(e,t,n,r){e=si(e)?e:Pi(e),n=n&&!r?Ei(n):0;var o=e.length;return n<0&&(n=As(o+n,0)),gi(e)?n<=o&&e.indexOf(t,n)>-1:!!o&&E(e,t,n)>-1},n.indexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=null==n?0:Ei(n);return o<0&&(o=As(r+o,0)),E(e,t,o)},n.inRange=function(e,t,n){return t=yi(t),n===B?(n=t,t=0):n=yi(n),e=wi(e),function(e,t,n){return e>=Is(t,n)&&e<As(t,n)}(e,t,n)},n.invoke=bl,n.isArguments=tl,n.isArray=nl,n.isArrayBuffer=rl,n.isArrayLike=si,n.isArrayLikeObject=ai,n.isBoolean=function(e){return!0===e||!1===e||fi(e)&&Mn(e)==Me},n.isBuffer=ol,n.isDate=il,n.isElement=function(e){return fi(e)&&1===e.nodeType&&!mi(e)},n.isEmpty=function(e){if(null==e)return!0;if(si(e)&&(nl(e)||"string"==typeof e||"function"==typeof e.splice||ol(e)||cl(e)||tl(e)))return!e.length;var t=pa(e);if(t==Oe||t==Re)return!e.size;if(Do(e))return!Yn(e).length;for(var n in e)if(ns.call(e,n))return!1;return!0},n.isEqual=function(e,t){return Hn(e,t)},n.isEqualWith=function(e,t,n){var r=(n="function"==typeof n?n:B)?n(e,t):B;return r===B?Hn(e,t,B,n):!!r},n.isError=li,n.isFinite=function(e){return"number"==typeof e&&xs(e)},n.isFunction=ci,n.isInteger=di,n.isLength=ui,n.isMap=sl,n.isMatch=function(e,t){return e===t||Wn(e,t,vo(t))},n.isMatchWith=function(e,t,n){return n="function"==typeof n?n:B,Wn(e,t,vo(t),n)},n.isNaN=function(e){return hi(e)&&e!=+e},n.isNative=function(e){if(fa(e))throw new Hi(H);return Gn(e)},n.isNil=function(e){return null==e},n.isNull=function(e){return null===e},n.isNumber=hi,n.isObject=pi,n.isObjectLike=fi,n.isPlainObject=mi,n.isRegExp=al,n.isSafeInteger=function(e){return di(e)&&e>=-ve&&e<=ve},n.isSet=ll,n.isString=gi,n.isSymbol=vi,n.isTypedArray=cl,n.isUndefined=function(e){return e===B},n.isWeakMap=function(e){return fi(e)&&pa(e)==qe},n.isWeakSet=function(e){return fi(e)&&Mn(e)==He},n.join=function(e,t){return null==e?"":ks.call(e,t)},n.kebabCase=kl,n.last=jo,n.lastIndexOf=function(e,t,n){var r=null==e?0:e.length;if(!r)return-1;var o=r;return n!==B&&(o=(o=Ei(n))<0?As(r+o,0):Is(o,r-1)),t==t?function(e,t,n){for(var r=n+1;r--;)if(e[r]===t)return r;return r}(e,t,o):y(e,w,o,!0)},n.lowerCase=Pl,n.lowerFirst=Al,n.lt=dl,n.lte=ul,n.max=function(e){return e&&e.length?an(e,$i,xn):B},n.maxBy=function(e,t){return e&&e.length?an(e,mo(t,2),xn):B},n.mean=function(e){return C(e,$i)},n.meanBy=function(e,t){return C(e,mo(t,2))},n.min=function(e){return e&&e.length?an(e,$i,Jn):B},n.minBy=function(e,t){return e&&e.length?an(e,mo(t,2),Jn):B},n.stubArray=Ui,n.stubFalse=ji,n.stubObject=function(){return{}},n.stubString=function(){return""},n.stubTrue=function(){return!0},n.multiply=Ql,n.nth=function(e,t){return e&&e.length?tr(e,Ei(t)):B},n.noConflict=function(){return Cn._===this&&(Cn._=as),this},n.noop=Fi,n.now=Ha,n.pad=function(e,t,n){e=_i(e);var r=(t=Ei(t))?U(e):0;if(!t||r>=t)return e;var o=(t-r)/2;return Xr(Ts(o),n)+e+Xr(_s(o),n)},n.padEnd=function(e,t,n){e=_i(e);var r=(t=Ei(t))?U(e):0;return t&&r<t?e+Xr(t-r,n):e},n.padStart=function(e,t,n){e=_i(e);var r=(t=Ei(t))?U(e):0;return t&&r<t?Xr(t-r,n)+e:e},n.parseInt=function(e,t,n){return n||null==t?t=0:t&&(t=+t),Ns(_i(e).replace(yt,""),t||0)},n.random=function(e,t,n){if(n&&"boolean"!=typeof n&&Co(e,t,n)&&(t=n=B),n===B&&("boolean"==typeof t?(n=t,t=B):"boolean"==typeof e&&(n=e,e=B)),e===B&&t===B?(e=0,t=1):(e=yi(e),t===B?(t=e,e=0):t=yi(t)),e>t){var r=e;e=t,t=r}if(n||e%1||t%1){var o=$s();return Is(e+o*(t-e+yn("1e-"+((o+"").length-1))),t)}return sr(e,t)},n.reduce=function(e,t,n){var r=nl(e)?m:D,o=arguments.length<3;return r(e,mo(t,4),n,o,ea)},n.reduceRight=function(e,t,n){var r=nl(e)?g:D,o=arguments.length<3;return r(e,mo(t,4),n,o,ta)},n.repeat=function(e,t,n){return t=(n?Co(e,t,n):t===B)?1:Ei(t),ar(_i(e),t)},n.replace=function(){var e=arguments,t=_i(e[0]);return e.length<3?t:t.replace(e[1],e[2])},n.result=function(e,t,n){var r=-1,o=(t=kr(t,e)).length;for(o||(o=1,e=B);++r<o;){var i=null==e?B:e[No(t[r])];i===B&&(r=o,i=n),e=ci(i)?i.call(e):i}return e},n.round=Xl,n.runInContext=e,n.sample=function(e){return(nl(e)?Ht:cr)(e)},n.size=function(e){if(null==e)return 0;if(si(e))return gi(e)?U(e):e.length;var t=pa(e);return t==Oe||t==Re?e.size:Yn(e).length},n.snakeCase=Il,n.some=function(e,t,n){var r=nl(e)?v:hr;return n&&Co(e,t,n)&&(t=B),r(e,mo(t,3))},n.sortedIndex=function(e,t){return mr(e,t)},n.sortedIndexBy=function(e,t,n){return gr(e,t,mo(n,2))},n.sortedIndexOf=function(e,t){var n=null==e?0:e.length;if(n){var r=mr(e,t);if(r<n&&ii(e[r],t))return r}return-1},n.sortedLastIndex=function(e,t){return mr(e,t,!0)},n.sortedLastIndexBy=function(e,t,n){return gr(e,t,mo(n,2),!0)},n.sortedLastIndexOf=function(e,t){if(null!=e&&e.length){var n=mr(e,t,!0)-1;if(ii(e[n],t))return n}return-1},n.startCase=Ol,n.startsWith=function(e,t,n){return e=_i(e),n=null==n?0:en(Ei(n),0,e.length),t=yr(t),e.slice(n,n+t.length)==t},n.subtract=Zl,n.sum=function(e){return e&&e.length?M(e,$i):0},n.sumBy=function(e,t){return e&&e.length?M(e,mo(t,2)):0},n.template=function(e,t,r){var o=n.templateSettings;r&&Co(e,t,r)&&(t=B),e=_i(e),t=hl({},t,o,io);var i,s,a=hl({},t.imports,o.imports,io),l=Mi(a),c=P(a,l),d=0,u=t.interpolate||Nt,p="__p += '",f=Yi((t.escape||Nt).source+"|"+u.source+"|"+(u===ut?Dt:Nt).source+"|"+(t.evaluate||Nt).source+"|$","g"),h="//# sourceURL="+("sourceURL"in t?t.sourceURL:"lodash.templateSources["+ ++mn+"]")+"\n";e.replace(f,function(t,n,r,o,a,l){return r||(r=o),p+=e.slice(d,l).replace($t,N),n&&(i=!0,p+="' +\n__e("+n+") +\n'"),a&&(s=!0,p+="';\n"+a+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),d=l+t.length,t}),p+="';\n";var m=t.variable;m||(p="with (obj) {\n"+p+"\n}\n"),p=(s?p.replace(nt,""):p).replace(rt,"$1").replace(ot,"$1;"),p="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(s?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g=Vl(function(){return Wi(l,h+"return "+p).apply(B,c)});if(g.source=p,li(g))throw g;return g},n.times=function(e,t){if((e=Ei(e))<1||e>ve)return[];var n=Ee,r=Is(e,Ee);t=mo(t),e-=Ee;for(var o=x(r,t);++n<e;)t(n);return o},n.toFinite=yi,n.toInteger=Ei,n.toLength=bi,n.toLower=function(e){return _i(e).toLowerCase()},n.toNumber=wi,n.toSafeInteger=function(e){return e?en(Ei(e),-ve,ve):0===e?e:0},n.toString=_i,n.toUpper=function(e){return _i(e).toUpperCase()},n.trim=function(e,t,n){if((e=_i(e))&&(n||t===B))return e.replace(St,"");if(!e||!(t=yr(t)))return e;var r=j(e),o=j(t);return Pr(r,I(r,o),O(r,o)+1).join("")},n.trimEnd=function(e,t,n){if((e=_i(e))&&(n||t===B))return e.replace(Et,"");if(!e||!(t=yr(t)))return e;var r=j(e);return Pr(r,0,O(r,j(t))+1).join("")},n.trimStart=function(e,t,n){if((e=_i(e))&&(n||t===B))return e.replace(yt,"");if(!e||!(t=yr(t)))return e;var r=j(e);return Pr(r,I(r,j(t))).join("")},n.truncate=function(e,t){var n=de,r=ue;if(pi(t)){var o="separator"in t?t.separator:o;n="length"in t?Ei(t.length):n,r="omission"in t?yr(t.omission):r}var i=(e=_i(e)).length;if($(e)){var s=j(e);i=s.length}if(n>=i)return e;var a=n-U(r);if(a<1)return r;var l=s?Pr(s,0,a).join(""):e.slice(0,a);if(o===B)return l+r;if(s&&(a+=l.length-a),al(o)){if(e.slice(a).search(o)){var c,d=l;for(o.global||(o=Yi(o.source,_i(Mt.exec(o))+"g")),o.lastIndex=0;c=o.exec(d);)var u=c.index;l=l.slice(0,u===B?a:u)}}else if(e.indexOf(yr(o),a)!=a){var p=l.lastIndexOf(o);p>-1&&(l=l.slice(0,p))}return l+r},n.unescape=function(e){return(e=_i(e))&&at.test(e)?e.replace(it,Fn):e},n.uniqueId=function(e){var t=++rs;return _i(e)+t},n.upperCase=Nl,n.upperFirst=$l,n.each=Ko,n.eachRight=Jo,n.first=Uo,Li(n,function(){var e={};return Sn(n,function(t,r){ns.call(n.prototype,r)||(e[r]=t)}),e}(),{chain:!1}),n.VERSION="4.17.4",a(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){n[e].placeholder=n}),a(["drop","take"],function(e,t){Lt.prototype[e]=function(n){n=n===B?1:As(Ei(n),0);var r=this.__filtered__&&!t?new Lt(this):this.clone();return r.__filtered__?r.__takeCount__=Is(n,r.__takeCount__):r.__views__.push({size:Is(n,Ee),type:e+(r.__dir__<0?"Right":"")}),r},Lt.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}}),a(["filter","map","takeWhile"],function(e,t){var n=t+1,r=n==he||3==n;Lt.prototype[e]=function(e){var t=this.clone();return t.__iteratees__.push({iteratee:mo(e,3),type:n}),t.__filtered__=t.__filtered__||r,t}}),a(["head","last"],function(e,t){var n="take"+(t?"Right":"");Lt.prototype[e]=function(){return this[n](1).value()[0]}}),a(["initial","tail"],function(e,t){var n="drop"+(t?"":"Right");Lt.prototype[e]=function(){return this.__filtered__?new Lt(this):this[n](1)}}),Lt.prototype.compact=function(){return this.filter($i)},Lt.prototype.find=function(e){return this.filter(e).head()},Lt.prototype.findLast=function(e){return this.reverse().find(e)},Lt.prototype.invokeMap=lr(function(e,t){return"function"==typeof e?new Lt(this):this.map(function(n){return Bn(n,e,t)})}),Lt.prototype.reject=function(e){return this.filter(oi(mo(e)))},Lt.prototype.slice=function(e,t){e=Ei(e);var n=this;return n.__filtered__&&(e>0||t<0)?new Lt(n):(e<0?n=n.takeRight(-e):e&&(n=n.drop(e)),t!==B&&(n=(t=Ei(t))<0?n.dropRight(-t):n.take(t-e)),n)},Lt.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Lt.prototype.toArray=function(){return this.take(Ee)},Sn(Lt.prototype,function(e,t){var r=/^(?:filter|find|map|reject)|While$/.test(t),o=/^(?:head|last)$/.test(t),i=n[o?"take"+("last"==t?"Right":""):t],s=o||/^find/.test(t);i&&(n.prototype[t]=function(){var t=this.__wrapped__,a=o?[1]:arguments,l=t instanceof Lt,c=a[0],d=l||nl(t),u=function(e){var t=i.apply(n,h([e],a));return o&&p?t[0]:t};d&&r&&"function"==typeof c&&1!=c.length&&(l=d=!1);var p=this.__chain__,f=!!this.__actions__.length,m=s&&!p,g=l&&!f;if(!s&&d){t=g?t:new Lt(this);var v=e.apply(t,a);return v.__actions__.push({func:zo,args:[u],thisArg:B}),new Vt(v,p)}return m&&g?e.apply(this,a):(v=this.thru(u),m?o?v.value()[0]:v.value():v)})}),a(["pop","push","shift","sort","splice","unshift"],function(e){var t=Qi[e],r=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",o=/^(?:pop|shift)$/.test(e);n.prototype[e]=function(){var e=arguments;if(o&&!this.__chain__){var n=this.value();return t.apply(nl(n)?n:[],e)}return this[r](function(n){return t.apply(nl(n)?n:[],e)})}}),Sn(Lt.prototype,function(e,t){var r=n[t];if(r){var o=r.name+"";(Hs[o]||(Hs[o]=[])).push({name:t,func:r})}}),Hs[Yr(B,te).name]=[{name:"wrapper",func:B}],Lt.prototype.clone=function(){var e=new Lt(this.__wrapped__);return e.__actions__=Lr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Lr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Lr(this.__views__),e},Lt.prototype.reverse=function(){if(this.__filtered__){var e=new Lt(this);e.__dir__=-1,e.__filtered__=!0}else(e=this.clone()).__dir__*=-1;return e},Lt.prototype.value=function(){var e=this.__wrapped__.value(),t=this.__dir__,n=nl(e),r=t<0,o=n?e.length:0,i=function(e,t,n){for(var r=-1,o=n.length;++r<o;){var i=n[r],s=i.size;switch(i.type){case"drop":e+=s;break;case"dropRight":t-=s;break;case"take":t=Is(t,e+s);break;case"takeRight":e=As(e,t-s)}}return{start:e,end:t}}(0,o,this.__views__),s=i.start,a=i.end,l=a-s,c=r?a:s-1,d=this.__iteratees__,u=d.length,p=0,f=Is(l,this.__takeCount__);if(!n||!r&&o==l&&f==l)return _r(e,this.__actions__);var h=[];e:for(;l--&&p<f;){for(var m=-1,g=e[c+=t];++m<u;){var v=d[m],S=v.iteratee,y=v.type,E=S(g);if(y==me)g=E;else if(!E){if(y==he)continue e;break e}}h[p++]=g}return h},n.prototype.at=$a,n.prototype.chain=function(){return Go(this)},n.prototype.commit=function(){return new Vt(this.value(),this.__chain__)},n.prototype.next=function(){this.__values__===B&&(this.__values__=Si(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?B:this.__values__[this.__index__++]}},n.prototype.plant=function(e){for(var t,n=this;n instanceof T;){var r=Vo(n);r.__index__=0,r.__values__=B,t?o.__wrapped__=r:t=r;var o=r;n=n.__wrapped__}return o.__wrapped__=e,t},n.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Lt){var t=e;return this.__actions__.length&&(t=new Lt(this)),(t=t.reverse()).__actions__.push({func:zo,args:[qo],thisArg:B}),new Vt(t,this.__chain__)}return this.thru(qo)},n.prototype.toJSON=n.prototype.valueOf=n.prototype.value=function(){return _r(this.__wrapped__,this.__actions__)},n.prototype.first=n.prototype.head,Ss&&(n.prototype[Ss]=Yo),n}();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(Cn._=Rn,define(function(){return Rn})):Tn?((Tn.exports=Rn)._=Rn,_n._=Rn):Cn._=Rn}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],49:[function(require,module,exports){function createPathFromArray(e){let t="";for(var n of e)_.isNumber(n)?t+="["+n+"]":(t.length>0&&(t+="."),t+=n);return t}const ModelField=require("../fields/ModelField"),VariableField=require("../fields/VariableField"),ErrorOutputField=require("../fields/ErrorOutputField"),ExpressionField=require("../fields/ExpressionField"),_=require("lodash");exports.createPathBasedField=function(e,t,n){let r={};return r=e[0]==n.models?new ModelField(createPathFromArray(e.slice(1))):e[0]==n.vars?new VariableField(createPathFromArray(e.slice(1))):t.hasOwnProperty(e[0])?new VariableField(createPathFromArray(["local",...e])):n.hasOwnProperty("errorOutput")&&e[0]==n.errorOutput?new ErrorOutputField(createPathFromArray(e.slice(1))):1==e.length?new VariableField(createPathFromArray(["local",e[0]])):new ExpressionField(createPathFromArray(e))},exports.determineLiteralTypeFromValue=function(field){if(_.isBoolean(field.value))field.dataType="boolean";else if(_.isNumber(field.value))field.dataType="number";else if(_.isDate(field.value))field.dataType="date";else if(_.isRegExp(field.value))field.dataType="regexp";else if(_.isString(field.value))if("true"==field.value)field.dataType="boolean",field.value=!0;else if("false"==field.value)field.dataType="boolean",field.value=!1;else if(field.value.match(/^-?\d+\.?\d*$/)){field.dataType="number";try{field.value=parseFloat(field.value)}catch(e){field.dataType="string"}}else if(0==field.value.indexOf("new Date(")){field.dataType="date";try{eval(field.value)}catch(e){field.dataType="string"}}else"null"==field.value?(field.dataType="nil",field.value=null):field.dataType="string";else(_.isNull(field.value)||_.isUndefined(field.value))&&(field.dataType="nil")}},{"../fields/ErrorOutputField":35,"../fields/ExpressionField":36,"../fields/ModelField":40,"../fields/VariableField":44,lodash:48}],50:[function(e,t,n){n.findActionPaths=((e,t,r)=>{if("object"==e.type&&e.hasOwnProperty("properties")){let o=Object.keys(e.properties);for(let i of o)n.findActionPaths(e.properties[i],n.extendPath(t,i),r)}else"array"==e.type&&e.hasOwnProperty("items")?n.findActionPaths(e.items,n.incrementArrayPath(t),r):"action"==e.type&&r.push(t)}),n.extendPath=((e,t)=>0==e.length?t:e+"."+t),n.incrementArrayPath=(e=>e+"[]"),n.makeSourcePath=(e=>{let t=e.indexOf(".");return t>=0?e.substring(t+1):""})},{}]},{},[45])(45)}),angular.module("studio").service("connectApiService",["jsonrpc","$q","$stateParams","$rootScope","commonDialogs",function(e,t,n,r,o){let i=this,s=["files","endpoints","events","blocks","connectors","framework"];_.each({getters:{files:["getTree","getSource"],blocks:["getAll"],endpoints:["getTree","getEndpoint","saveEndpoint","getProjectVariables"],events:["getTransformEvents"],connectors:["getActiveWebConnectors","getActiveAPIConnectors","getAllWebConnectors","getConnectorConfig"],framework:["getVersions","getSelectedVersion"]},setters:{files:["setSource","createFile","deleteFile","renameFile"],endpoints:["saveEndpoint"],connectors:["saveActiveConnectors"],framework:["updateConnectSettings","updateConnectVersion"]}},(n,s)=>{_.each(n,(n,a)=>{i[a]=i[a]||{},_.each(n,n=>{let l="connect/"+a+"."+n;i[a][n]=function(c){return e.request(l,i.prepareParams(c,a)).then(e=>(r.$broadcast(r.EVENT_API_SUCCESS,{name:l,namespace:a,isSetter:"setters"===s}),e)).catch(e=>(r.hideLoading(),console.error(e,l,c),"getCurrentUser"!==n&&o.error(e.name,e.message),t.reject(e)))},i[a][n].$method=l,i[a][n].$namespace=a,i[a][n].$isSetter="setters"===s})})}),i.prepareParams=function(e,t){return e||(e={}),s.indexOf(t)>-1&&(e.appId||(e.appId=n.appId)),e}}]),angular.module("studio").service("connectAppService",["$rootScope","blockService","eventService","apiService","wsService","connectApiService","connectorService","allFilesService",function(e,t,n,r,o,i,s,a){this.openApp=function(t){return r.applications.open({appId:t}).then(function(t){return document.title=t.app.name+" - SmartUXâ„¢ Connect",a.resetCache(),e.$broadcast(e.EVENT_APP_OPENED),t.app})},this.openConnectConfig=function(){return s.refreshActiveConnectors().then(s.getConnectorConfig).then(t=>{i.framework.getVersions().then(function(n){i.framework.getSelectedVersion().then(function(r){e.$broadcast(e.EVENT_DIALOG_REQUESTED,"connect-config",{allConnectors:t,versions:n,selectedConnectVersion:r,activeConnectors:s.getActiveConnectors()},{isCommon:!1,allowMultiple:!1})})})})},this.updateConnectSettings=function(t,n,r){const o={appId:t,activeConnectors:n,connectVersion:r};return i.framework.updateConnectSettings(o).then(t=>(t.error&&e.$broadcast(e.EVENT_DIALOG_REQUESTED,"error",{title:"Connector Save Error",text:t.error},{isCommon:!0,allowMultiple:!0}),t))}}]),angular.module("studio").service("connectParserService",["$rootScope","apiService","screenModelService","commonSyncService",function(e,t,n,r){this.parse=function(e,t){let n=esprima.parseScript(t,{attachComment:!0}),r=new ConnectParser.EndPoint(e);return r.parse(n),r},this.createNewBlockFromDef=function(e,t,o){var i=e.split("."),s=i[0],a=i[1],l=i[2],c={};if("api"==s){if(c=new ConnectParser.ApiBlock(a,l),t.input){let e=function(e,t){let o=null;if(1==t.length){let i=t[0].split(".");if("client"==i[0]&&i.length>2){let t=n.getById(i[1]);r.isAssignable(t,e)&&(o=new ConnectParser.ModelField(i[1]))}}return o}(t.input,o);e&&c.addMapping({to:new ConnectParser.InputField(""),from:e})}if(t.output){let e=function(e,t){let o=null;if(1==t.length){let i=t[0].split(".");if("client"==i[0]&&i.length>2){let t=n.getById(i[1]);r.isAssignable(e,t)&&(o=new ConnectParser.ModelField(i[1]))}}return o}(t.output,o);e&&c.addMapping({to:e,from:new ConnectParser.OutputField("")})}if(t.errorOutput){let e=new ConnectParser.TryCatchBlock;e.setMainBlock(c),c=e}}else if("builtin"==s)"data"===l?c=new ConnectParser.SetDataBlock:"code"===l?c=new ConnectParser.CodeBlock(""):"screen"===l?c=new ConnectParser.ScreenBlock(""):"copyModel"===l?c=new ConnectParser.CopyModelBlock:"ifThen"===l?c=new ConnectParser.IfBlock:"call"===l?c=new ConnectParser.CallBlock(""):"updateUserInfo"===l&&(c=new ConnectParser.UpdateUserInfoBlock);else if("web"===s)if(i.length>=4){var d=i[1],u=i[2];l=i[3];if((c=new ConnectParser.TransformBlock(d,l)).setPageModel(u),"action"==l){var p=i.slice(4).join(".");c.setAction(p)}}else{d=i[1],l=i[2];if(c=new ConnectParser.TransformBlock(d,l),"action"==l){p=i.slice(4).join(".");c.setAction(p)}}return c}}]),angular.module("studio").service("blockService",["$rootScope","connectApiService",function(e,t){var n={},r=[];this.getBlocks=function(){return t.blocks.getAll().then(function(t){return t.error?e.$broadcast(e.EVENT_DIALOG_REQUESTED,"error",{title:"Block Error",text:t.error},{isCommon:!0,allowMultiple:!0}):(function(e){for(let t of e)if("web"===t.type){let e=[];e.push({app:t.app,blockType:"start",icon:"fa-play",name:"start"}),e.push({app:t.app,blockType:"stop",icon:"fa-stop",name:"stop"}),e.push({app:t.app,blockType:"url",icon:"fa-chrome",name:"url"}),e.push({app:t.app,blockType:"close",icon:"fa-window-close",name:"close"}),e.push({app:t.app,blockType:"authenticate",icon:"fa-id-card",name:"authenticate"}),e.push({app:t.app,blockType:"screenshot",icon:"fa-camera",name:"screenshot"}),e.push({app:t.app,blockType:"evalSync",icon:"fa-file-code-o",name:"evalSync"}),e.push({app:t.app,blockType:"acceptDialog",icon:"fa-check-circle-o",name:"acceptDialog"}),e.push({app:t.app,blockType:"dismissDialog",icon:"fa-times-circle-o",name:"dismissDialog"}),e.push({app:t.app,blockType:"checkState",icon:"fa-question-circle-o",name:"checkState"}),t.blocks.unshift(e)}}(t.blocks),r=t.blocks,function(e){let t;n={};for(var r of e)for(var o of r.blocks)if("api"===r.type?t=`${r.type}.${r.name}.${o.method}`:"builtin"===r.type&&(t=`session.${o.method}`),n[t]=o,"web"===r.type)for(var i of o)t=`${r.type}.${r.app}.${i.actionPath}`,n[t]=i}(t.blocks)),t})},this.getBlockDefById=function(e){return angular.copy(n[e])},this.getBlockGroups=function(){return r}}]),angular.module("studio").service("eventService",["$rootScope","connectApiService","screenModelService",function(e,t,n){function r(e,t,n){for(let o in e)if("object"===e[o].type){let i=o;t.length>0&&(i=t+"."+i),r(e[o].properties,i,n)}else if("action"===e[o].type){let e=o;t.length>0&&(e=t+"."+e),n.push(e)}else if("method"===e[o].type){let e=o;t.length>0&&(e=t+"."+e),n.push(e)}else if("array"===e[o].type){let i=o+"[]";t.length>0&&(i=t+"."+i),r(e[o].items.properties,i,n)}}this.getEvents=function(){return t.events.getTransformEvents().then(function(t){if(!t.error)return n.refresh().then(function(e){let t={name:"Client",id:"client",type:"client",eventGroups:[]};t.eventGroups.push({name:"client",isAppWide:"true",events:["start","stop"]});for(let n of e){let e={name:n.id,events:["onload","onunload"]};"menu"==n.id&&(e.events=[]),r(n.properties,"",e.events),e.events.length>0&&t.eventGroups.push(e)}return t}).then(function(e){return[e,...t.eventSources]});e.$broadcast(e.EVENT_DIALOG_REQUESTED,"error",{title:"Event Error",text:t.error},{isCommon:!0,allowMultiple:!0})})}}]),angular.module("common").service("endpointTreeService",["$q","$rootScope","connectApiService",function(e,t,n){var r=null;this.fetch=function(e){return n.endpoints.getTree(e).then(function(e){return r=e})},this.getCachedTree=function(){return r}}]),angular.module("studio").service("endpointService",["$injector","$q","$rootScope","$timeout","connectApiService","endpointTreeService","connectParserService","sessionService",function(e,t,n,r,o,i,s,a){function l(e){if(e){const t={id:e};return o.endpoints.getEndpoint(t).then(function(t){return t.error&&n.$broadcast(n.EVENT_DIALOG_REQUESTED,"error",{title:"Connect View Error",text:t.error},{isCommon:!0,allowMultiple:!0}),s.parse(e,t.endpoint)})}return null}function c(){console.log("Save the list of opened endpoint tab");let e=[];_.each(u,function(t){e.push({id:t.id,name:t.name,isSticky:t.isSticky,selected:p===t.id})}),a.set("endpoints",e)}var d=this,u={},p=null;d.getTree=function(){return i.fetch().then(function(e){return e})},d.getSelectedView=function(){return u[p]},d.getOpenedViews=function(){return u},d.updateSelectedViewJS=function(e,t){const n=s.parse(e,t);d.getSelectedView().endpoint=n,d.endpointChanged("editor")},d.saveSelectedView=function(){return d.saveView(p)},d.saveAllViews=function(){const e=[];for(let t of Object.values(u))t.isDirty&&e.push(d.saveView(t.id));return t.all(e)},d.saveView=function(e){const t={id:e,endpoint:u[e].endpoint.getScript()};return o.endpoints.saveEndpoint(t).then(function(t){return t.error?n.$broadcast(n.EVENT_DIALOG_REQUESTED,"error",{title:"Connect View Error",text:t.error},{isCommon:!0,allowMultiple:!0}):u[e].isDirty=!1,t.endpoint})},d.isOpenedView=function(e){return!!u[e]},d.endpointChanged=function(e){const t=d.getSelectedView();r(function(){t.isDirty=!0,t.isSticky=!0,n.$broadcast(n.EVENT_ENDPOINT_CHANGED,e)},!0),console.log("Connect View has been changed and is now dirty: ",t.id)},d.openView=(e=>{let t=d.getOpenedViews();if(_.isEmpty(t)||t[e.id])return d.selectView(e);{let n;return _.each(t,e=>{e.isSticky||(n=e)}),d.selectView(e).then(function(){n&&d.closeView(n)})}}),d.refresh=function(){var e=d.getSelectedView();e&&d.selectView(e)},d.selectView=(e=>{let t=e.id;0==t.indexOf("App.")&&(t="client."+t.substring(4).toLowerCase());let r=e.name;if(u[t]){p=t,c(),n.$broadcast(n.EVENT_ENDPOINT_SELECTED,p);let e=document.querySelector("#central .canvas-holder .canvas-grid");return e&&(e.scrollTop=0),u[t]}return l(t).then(o=>{let i=e.id.split("."),s="client"===i[0]?i[1]:null;u[t]={id:t,endpoint:o,name:r,sourceScreenId:s},p=t,c(),n.$broadcast(n.EVENT_ENDPOINT_SELECTED,p);let a=document.querySelector("#central .canvas-holder .canvas-grid");return a&&(a.scrollTop=0),u[t]})}),d.getTabIcon=(e=>0==e.id.indexOf("transform.")?"fa-desktop":"fa-file-text-o"),d.stickView=(e=>{let t=e.id;u[t]||d.selectView(e),u[t].isSticky=!0,c()}),d.closeView=(e=>{let t=e.id;if(p===t){var r=Object.keys(u);if(r.length>1){var o=r.indexOf(t),i=o>0?o-1:o+1;d.selectView(u[r[i]])}else p=null}delete u[t],c(),n.$broadcast(n.EVENT_ENDPOINT_CLOSED,t)}),d.closeAllViews=function(){for(let e of Object.values(u))d.closeView(e)},d.hasOpenedViews=function(){return Object.keys(u).length>0},d.hasDirtyViews=function(){return _.where(u,{isDirty:!0}).length>0},d.restoreEndpoints=function(){let e,n=[],r=a.get("endpoints");if(r.length>0)return r.forEach(t=>{n.push(d.openView(t).then(function(n){n.isSticky=t.isSticky,n.name=t.name,t.id==n.id&&t.selected&&(e=n)}))}),t.all(n).then(()=>{!e&&r.length>0&&(e=r[0]),d.selectView(e)})},d.getAllEndpoints=function(){let e=t.defer(),n=[];return d.getTree().then(function(t){let r=0;_.each(t,function(t){_.each(t.screens,function(o){let i;"client"===t.id?i="client."+o.id.toLowerCase():t.id.startsWith("transform")&&(i=o.id),r++,l(i).then(function(t){n.push(t),n.length===r&&e.resolve(n)})})})}),e.promise}}]),angular.module("studio").service("connectorService",["connectApiService","$rootScope","config",function(e,t,n){const r=this;let o=[];r.getConnectorConfig=function(){return e.connectors.getConnectorConfig().then(e=>(e.error&&t.$broadcast(t.EVENT_DIALOG_REQUESTED,"error",{title:"Connector Config Error",text:e.error},{isCommon:!0,allowMultiple:!0}),e.config))},r.getActiveWebConnectors=function(){return e.connectors.getActiveWebConnectors()},r.getActiveAPIConnectors=function(){return e.connectors.getActiveAPIConnectors()},r.getActiveConnectors=function(){return o},r.refreshActiveConnectors=function(){return r.getActiveAPIConnectors().then(function(e){return o=e,r.getActiveWebConnectors()}).then(function(e){return o=o.concat(e)})}}]),angular.module("studio").service("variableService",["$q","$rootScope","connectApiService",function(e,t,n){function r(e){let t=e.split(".");return{scope:t[1],name:t[2]}}function o(e){return{scope:"local",name:e}}let i={},s=[],a=[];this.getVariables=(e=>n.endpoints.getProjectVariables().then(function(t){let n=Object.keys(t);for(let e of n){i.hasOwnProperty(e)&&delete i[e];let t=r(e);if(!i.hasOwnProperty(`${t.scope}.${t.name}`)){_.find(a,function(e){return e.scope===t.scope&&e.name===t.name})||a.push(t)}}for(let t of e){i.hasOwnProperty(t)&&delete i[t];let e=o(t);i.hasOwnProperty(`${e.scope}.${e.name}`)||a.push(e)}for(let e in i){let t=i[e];_.find(a,function(e){return e.scope===t.scope&&e.name===t.name})||a.push(t)}return a})),this.getVarsForOptions=(t=>{let n=e.defer(),r=[],o={};return this.getVariables(t).then(e=>{for(let t of e)o[t.scope]||(o[t.scope]={name:t.scope,type:"Variables",properties:[]}),o[t.scope].properties.push({name:t.name,value:t});for(let e in o)r.push(o[e]);n.resolve(r)}),n.promise}),this.pushNewVar=((e,t)=>{let n=_.find(a,function(n){return n.scope===e&&n.name===t});if(n)return n;{let n={name:t,scope:e,toType:"variable"};return e&&t&&(i[`${e}.${t}`]=n),s.push(n),a.push(n),n}}),this.deleteVar=(e=>{let t=a[e];delete i[t.key];let n=s.indexOf(t);s.splice(n,1),a.splice(e,1)}),this.deleteCreatedVariable=function(e){delete i[e];for(var t=0;t<s.length&&s[t].key!==e;t++);t<s.length&&s.splice(t,1)},this.createVariablesCache=function(){_.each(s,function(e){i[`${e.scope}.${e.name}`]=e})},this.clearCache=function(){a.length=0}}]),angular.module("studio").directive("endpointsTree",["$rootScope","$q","$timeout",function(e,t,n){return{restrict:"A",require:"treeRoot",link:function(e,t,n,r){r.decorate({getIcon:function(e,t){return~e.id.indexOf("__placeholder__")?"":e.isState?"fa-desktop":e.folder&&e.expanded&&!t?"fa-folder-open-o":t||e.folder?"fa-folder-o":e.modal?"fa-list-alt":e?"fa-file-text-o":void 0},getLabel:function(e){return e.name||e.id},getChildren:function(e){return e.screens}})}}}]),angular.module("studio").directive("connectBlock",["$compile","$q","RecursionHelper","dialogService","$rootScope","endpointService","eventService","apiService",function(e,t,n,r,o,i,s,a){return{restrict:"E",templateUrl:"/views/connect/directives/connectBlock.html",scope:{block:"=",eventArea:"="},controller:["$scope","$element",function(e,n){function l(){return t(function(t,n){let r={pageModelId:e.block.getPageModel(),explorerId:e.block.transformId};a.pageModels.getModel(r).then(function(e){t(e)})})}let c={};e.labelIcon="fa-bolt",e.settings=function(){"if"===e.block.type?r.conditionBuilder(e.block,e.eventArea):"code"===e.block.type?r.codeBlockSettings(e.block):"tryCatch"===e.block.type?r.setData(e.block.getMainBlock(),e.eventArea):"transform"===e.block.type?"extract"==e.block.method?l().then(function(t){e.block.rightPageModel=t,r.setData(e.block,e.eventArea)}):"update"==e.block.method?l().then(function(t){e.block.leftPageModel=t,r.setData(e.block,e.eventArea)}):"url"==e.block.method||"authenticate"==e.block.method||"screenshot"==e.block.method||"acceptDialog"==e.block.method||"dismissDialog"==e.block.method||"checkState"==e.block.method?r.setData(e.block,e.eventArea):"evalSync"==e.block.method?r.evalSyncBlockSettings(e.block,e.eventArea):"uploadFiles"==e.block.method?l().then(function(t){e.block.leftPageModel=t,r.setData(e.block,e.eventArea)}):"imageDataUri"==e.block.method&&l().then(function(t){e.block.leftPageModel=t,r.imageDataUriBlockSettings(e.block,e.eventArea)}):"screen"!==e.block.type||e.block.screenId?"updateUserInfo"===e.block.type?r.setData(e.block,e.eventArea):"call"===e.block.type?function(){let e=t.defer(),n=[{label:"No Event Selected",value:null}];return s.getEvents().then(function(t){for(let e of t)for(let t of e.eventGroups)for(let r of t.events)t.isAppWide?(n.push({label:`${e.id}.${r}`,value:`${e.id}.${r}`}),c[`${e.id}.${r}`]=!0):(n.push({label:`${e.id}.${t.name}.${r}`,value:`${e.id}.${t.name}.${r}`}),c[`${e.id}.${t.name}.${r}`]=!0);e.resolve(n)}),e.promise}().then(n=>{(function(){let e=t.defer(),n=[];return i.getAllEndpoints().then(function(t){_.each(t,function(e){_.each(e.eventAreas,function(e){_.each(e.trigger.events,function(e){c.hasOwnProperty(e)||n.push({label:e,value:e})})})}),e.resolve(n)}),e.promise})().then(function(t){let o=n.concat(t);r.selectEvent(e.block,o)})}):r.setData(e.block,e.eventArea):r.selectScreen(e.block)},e.blockSpecificSettings=function(){"screen"===e.block.type&&r.selectScreen(e.block)},e.hasSpecificSettings=function(){return"screen"===e.block.type},e.selectBlock=function(e,t){t.stopPropagation(),o.$broadcast(o.EVENT_BLOCK_SELECTED,e.id)}}]}}]),angular.module("studio").directive("connectNode",["$compile","RecursionHelper","dialogService",function(e,t,n){return{restrict:"E",templateUrl:"/views/connect/directives/connectNode.html",scope:{currentBlock:"=",eventArea:"=",isLast:"="},controller:["$scope","$element",function(e,t){e.paths=e.currentBlock.hasSubContextBlocks()?e.currentBlock.getSubContexts().map((e,t)=>(function(e){const t=0===e?150:450;return 300>t?"M300 0 L300,6 A6,6 0 0,1 294,12 L"+(t+6)+",12 A6,6 0 0,0 "+t+",18 L"+t+",44":"M300 0 L300,6 A6,6 0 0,0 306,12 L"+(t-6)+",12 A6,6 0 0,1 "+t+",18 L"+t+",44"})(t)):["M150 0 v24"],e.currentBlock.isLast=e.isLast}],compile:function(e){return t.compile(e,function(e,t,n,r,o){})}}}]),angular.module("studio").directive("blockDataTree",["modelTreeService",function(e){return{restrict:"A",require:"treeRoot",link:function(t,n,r,o){o.decorate({getIcon:e.getIcon,getChildren:e.getChildren,getDescription:e.getDescription,getDescriptionIcon:e.getDescriptionIcon})}}}]),angular.module("common").component("conditions",{templateUrl:"/views/connect/components/conditions.template.html",transclude:!0,bindings:{conditionData:"<",variables:"<",eventArea:"<"},controller:["$q","$scope","screenModelService","variableService","connectorService","modelTreeService",function(e,t,n,r,o,i){function s(){for(let e of d.conditionData.children){try{"model"===e.lhsType?function(e){let t=e.lhsModel,n=(e.lhs,_.find(d.dataSource,function(e){return"Models"===e.conditionType&&e.id===t}));if(!n)throw new c("model");e.lhsSource=n,a(n);let r=_.find(n.properties,function(t){return t.path===e.lhs});if(!r)throw new c("model-entry");e.dd2Source=n,e.tempLhs=r}(e):"transform"===e.lhsType?function(e){let t=e.lhsTransformId,n=_.find(d.dataSource,function(e){return e.name===t});if(!n)throw new c("transform");e.lhsSource=n;let r=_.find(n.properties,function(t){return t.name===e.lhs});if(!r)throw new c("transform-event");e.dd2Source=n,e.tempLhs=r}(e):"vars"===e.lhsType?function(e){if("item"===e.lhsVarType){let t=_.find(d.dataSource,function(e){return"Item"===e.conditionType});if(!t)throw new c("item");e.lhsSource=t,a(t);let n=_.find(t.properties,function(n){return n.id.replace(t.id+".","")===e.lhs});if(!n)throw new c("item-entry");e.dd2Source=t,e.tempLhs=n}else{let t=_.find(d.dataSource,function(t){return"Variables"===t.type&&t.name===e.lhsVarType});if(!t)throw new c("scope");let n=_.find(t.properties,function(t){return t.name===e.lhs});if(!n)throw new c("variable");e.lhsSource=t,e.dd2Source=t,e.tempLhs=n}}(e):"value"===e.lhsType&&(e.lhsSource=d.dataSource[0],e.lhs=e.lhsValue.toString())}catch(t){!function(e,t){if("model"===t.type){let t={conditionType:"Models",name:e.lhsModel,dd1Filler:!0};if(d.dataSource.push(t),e.lhsSource=t,e.dd2Source={properties:{}},e.lhs){let t={name:e.lhs,dd2Filler:!0};e.dd2Source.properties=e.properties||[],e.dd2Source.properties.push(t),e.tempLhs=t}}if("model-entry"===t.type){let t={name:e.lhs,dd2Filler:!0};e.dd2Source={},e.dd2Source.properties=e.properties||[],e.dd2Source.properties.push(t),e.tempLhs=t}t.type;if("item-entry"===t.type){let t={name:e.lhs,dd2Filler:!0};e.dd2Source={},e.dd2Source.properties=e.properties||[],e.dd2Source.properties.push(t),e.tempLhs=t}if("scope"===t.type){let t={type:"Variables",name:e.lhsVarType,dd1Filler:!0};if(d.dataSource.push(t),e.lhsSource=t,e.dd2Source={},e.lhs){let t={name:e.lhs,dd2Filler:!0};e.dd2Source.properties=e.properties||[],e.dd2Source.properties.push(t),e.tempLhs=t}}if("variable"===t.type){let t={name:e.lhs,dd2Filler:!0};e.dd2Source.properties=e.properties||[],e.dd2Source.properties.push(t),e.tempLhs=t}if("transform"===t.type){let t={type:"Transform",name:e.lhsTransformId,dd1Filler:!0};if(d.dataSource.push(t),e.lhsSource=t,e.dd2Source={},e.lhs){let t={name:e.lhs,dd2Filler:!0};e.dd2Source.properties=e.properties||[],e.dd2Source.properties.push(t),e.tempLhs=t}}if("transform-event"===t.type&&e.lhs){let t={name:e.lhs,dd2Filler:!0};e.dd2Source={},e.dd2Source.properties=e.properties||[],e.dd2Source.properties.push(t),e.tempLhs=t}}(e,t),e.leftHandErrorMessage=t.message+" on left hand side."}try{"model"===e.rhsType?function(e){let t=e.rhsModel,n=(e.rhs,_.find(d.dataSource,function(e){return"Models"===e.conditionType&&e.id===t}));if(!n)throw new c("model");e.rhsSource=n,a(n);let r=_.find(n.properties,function(t){return t.path===e.rhs});if(!r)throw new c("model-entry");e.dd5Source=n,e.tempRhs=r}(e):"transform"===e.rhsType?function(e){let t=e.rhsTransformId,n=_.find(d.dataSource,function(e){return e.name===t});if(!n)throw new c("transform");e.rhsSource=n;let r=_.find(n.properties,function(t){return t.name===e.rhs});if(!r)throw new c("transform-event");e.dd5Source=n,e.tempRhs=r}(e):"vars"===e.rhsType?function(e){if("item"===e.rhsVarType){let t=_.find(d.dataSource,function(e){return"Item"===e.conditionType});if(!t)throw new c("item");e.rhsSource=t,a(t);let n=_.find(t.properties,function(n){return n.id.replace(t.id+".","")===e.rhs});if(!n)throw new c("item-entry");e.dd2Source=t,e.tempRhs=n}else{let t=_.find(d.dataSource,function(t){return"Variables"===t.type&&t.name===e.rhsVarType});if(!t)throw new c("scope");let n=_.find(t.properties,function(t){return t.name===e.rhs});if(!n)throw new c("variable");e.rhsSource=t,e.dd5Source=t,e.tempRhs=n}}(e):"value"===e.rhsType&&(e.rhsSource=d.dataSource[0],e.rhs=e.rhsValue.toString())}catch(t){!function(e,t){if("model"===t.type){let t={conditionType:"Models",name:e.rhsModel,dd4Filler:!0};if(d.dataSource.push(t),e.rhsSource=t,e.dd5Source={properties:{}},e.rhs){let t={name:e.rhs,dd5Filler:!0};e.dd5Source.properties=e.properties||[],e.dd5Source.properties.push(t),e.tempRhs=t}}if("model-entry"===t.type){let t={name:e.rhs,dd5Filler:!0};e.dd5Source={},e.dd5Source.properties=e.properties||[],e.dd5Source.properties.push(t),e.tempRhs=t}t.type;if("item-entry"===t.type){let t={name:e.rhs,dd5Filler:!0};e.dd5Source={},e.dd5Source.properties=e.properties||[],e.dd5Source.properties.push(t),e.tempRhs=t}if("scope"===t.type){let t={type:"Variables",name:e.rhsVarType,dd4Filler:!0};if(d.dataSource.push(t),e.rhsSource=t,e.dd5Source={},e.rhs){let t={name:e.rhs,dd5Filler:!0};e.dd5Source.properties=e.properties||[],e.dd5Source.properties.push(t),e.tempRhs=t}}if("variable"===t.type){let t={name:e.rhs,dd5Filler:!0};e.dd5Source.properties=e.properties||[],e.dd5Source.properties.push(t),e.tempRhs=t}if("transform"===t.type){let t={type:"Transform",name:e.rhsTransformId,dd4Filler:!0};if(d.dataSource.push(t),e.rhsSource=t,e.dd5Source={},e.rhs){let t={name:e.rhs,dd5Filler:!0};e.dd5Source.properties=e.properties||[],e.dd5Source.properties.push(t),e.tempRhs=t}}if("transform-event"===t.type&&e.rhs){let t={name:e.rhs,dd5Filler:!0};e.dd5Source={},e.dd5Source.properties=e.properties||[],e.dd5Source.properties.push(t),e.tempRhs=t}}(e,t),e.rightHandErrorMessage=t.message+" on right hand side."}}}function a(e){let t=[];if(e.hasOwnProperty("properties")&&!_.isArray(e.properties)){l(angular.copy(e.properties),t),e.properties=t}else if(e.hasOwnProperty("items")&&!e.hasOwnProperty("properties")){l(angular.copy(e.items.properties),t),e.properties=t}}function l(e,t){_.each(e,function(e){t.push(e);let n=e.getChildren();n&&l(n,t)})}function c(e){this.type=e,this.message="Missing "+this.type}let d=this;d.dataSource=[];const u=n.getModels();console.log("conditionData",d.conditionData),d.operators=[{name:"is true",value:"isTrue"},{name:"is false",value:"isFalse"},{name:"equal to",value:"=="},{name:"not equal to",value:"!="},{name:"is less than",value:"<"},{name:"is greater than",value:">"}];let p={Models:"model",Variables:"vars",Transform:"transform",Value:"value",Item:"item"};d.groupBy=function(e){if("Value"!==e.type&&"Item"!==e.conditionType)return e.hasOwnProperty("conditionType")?e.conditionType:e.type},d.addCondition=function(){d.conditionData.children.push({})},d.deleteCondition=function(e){d.conditionData.children.splice(e,1)},d.selectLHProp=function(e){for(let t in e)t.includes("lhs")&&"lhsSource"!==t&&delete e[t];for(let t of d.dataSource)t===e.lhsSource&&(e.lhsType=p[t.conditionType||t.type],"Models"===t.conditionType?(e.lhsModel=e.lhsSource.id,a(t)):"Item"===t.conditionType?(e.lhsType="vars",e.lhsVarType="item"):"Variables"===t.type?e.lhsVarType=e.lhsSource.name:"Transform"===t.type&&(e.lhsTransformId=e.lhsSource.name),e.dd2Source=t,e.dd2Source.hasOwnProperty("properties")&&e.dd2Source.properties.length&&(e.lhs=e.dd2Source.properties[0].name))},d.selectLHChild=function(e,t){t&&(t.hasOwnProperty("path")?e.lhs=t.path:e.lhs=t.name)},d.lhsValueChange=function(e){e.lhsValue=e.lhs},d.selectRHProp=function(e){for(let t in e)t.includes("rhs")&&"rhsSource"!==t&&delete e[t];for(let t of d.dataSource)t===e.rhsSource&&(e.rhsType=p[t.conditionType||t.type],"Models"===t.conditionType?(e.rhsModel=e.rhsSource.id,a(t)):"Item"===t.conditionType?(e.rhsType="vars",e.rhsVarType="item"):"Variables"===t.type?e.rhsVarType=e.rhsSource.name:"Transform"===t.type&&(e.rhsTransformId=e.rhsSource.name),e.dd5Source=t,e.dd5Source.hasOwnProperty("properties")&&e.dd5Source.properties.length&&(e.rhs=e.dd5Source.properties[0].name))},d.selectRHChild=function(e,t){t&&(t.hasOwnProperty("path")?e.rhs=t.path:e.rhs=t.name)},d.rhsValueChange=function(e){e.rhsValue=e.rhs},d.changeOperator=function(e,t){"isTrue"!==e.test&&"isFalse"!==e.test&&(e.rhsSource||(e.rhsSource=!0,e.rhs=""))},d.filterOperators=function(e){return function(t){return"transform"!==e.lhsType||"isStarted()"!==e.lhs||("isTrue"===t.value||"isFalse"===t.value)}},d.rhsFilter=function(e){if(e&&e.hasOwnProperty("name"))return"isStarted()"===e.name},function(){let t=e.defer();d.dataSource.push({type:"Value",name:"Value"}),i.eachNode(u,function(e){let t=e.path.split("."),n=t[0]?t.length:0;for(e.name=e.name.trim(),e.name.includes("[]")&&(e.name=e.name.replace(/\[]/,"")),"array"===e.type&&(e.name=e.name+"[]");n>1;)e.name="Â Â "+e.name,n--;e.parent||(e.conditionType="Models",d.dataSource.push(e))});try{!function(){let e,t=u,n=d.eventArea.trigger.events;_.each(n,function(n){if(n.startsWith("client")&&n.includes("[]")){let o=n.split(".");o.shift(),fullEventPath=_.map(o,function(e){return e.replace(/\[]$/,"")}).join(".");let s,a,l=o.shift();for(var r=0;r<o.length;r++)if(o[r].endsWith("[]")){a=o.splice(r+1),s=_.map(o,function(e){return e.replace(/\[]$/,"")}).join(".");break}rootItemPath=s;let u=_.find(t,function(e){return e.id===l});if(!(e=i.findByPath(u,s)))throw new c("item");i.eachNode([e],function(e){let t=e.path.split("."),n=t[0]?t.length:0;for(e.name=e.name.trim(),e.name.includes("[]")&&(e.name=e.name.replace(/\[]/,"")),"array"===e.type&&(e.name=e.name+"[]");n>1;)e.name="Â Â "+e.name,n--}),e.conditionType="Item",e.name="Item",d.dataSource.splice(1,0,e)}})}()}catch(e){"item"===e.type&&d.dataSource.splice(1,0,{conditionType:"Item",name:"Item",dd1Filler:!0})}return function(){let t=e.defer(),n=d.eventArea.getLocalVariables();return r.getVarsForOptions(n).then(function(e){d.dataSource=d.dataSource.concat(angular.copy(e)),t.resolve()}),t.promise}().then(()=>{(function(){let t=e.defer();return o.getActiveWebConnectors().then(function(e){for(let t of e)d.dataSource.push({name:t.transformId,type:"Transform",properties:[{name:"isStarted()"},{name:"currentEvent()"}]});t.resolve()}),t.promise})().then(()=>{t.resolve()})}),t.promise}().then(()=>{s()})}]}),angular.module("studio").component("block",{templateUrl:"/views/connect/components/block.template.html",transclude:!0,bindings:{dragid:"<",logicBlock:"<",item:"<"},controller:["endpointService",function(e){this.dragStart=function(){return function(t){e.hasOpenedViews()||(event.dataTransfer.dropEffect="none")}},this.dragEnd=(()=>(function(e){}))}]}),angular.module("studio").component("event",{templateUrl:"/views/connect/components/event.template.html",transclude:!0,bindings:{dragid:"<",eventname:"<",isWebEvent:"<"},controller:["endpointService",function(e){let t=this;t.dragStart=function(){return function(t){console.log(t),e.hasOpenedViews()||(event.dataTransfer.dropEffect="none")}},t.dragEnd=(()=>(function(e){})),t.toTitleCase=function(e){return e.split(" ").map(e=>e[0].toUpperCase().concat(e.slice(1))).join(" ")},t.setIcon=function(){switch(t.eventname){case"onload":return"fa-sign-in";case"onunload":return"fa-sign-out";default:return"fa-bolt"}}}]}),angular.module("studio").component("eventArea",{templateUrl:"/views/connect/components/eventArea.template.html",transclude:!0,bindings:{eventarea:"<",currentEndpoint:"<"},controller:["$element","$timeout","$q","endpointService","blockService","canvasService","connectParserService","dialogService","screenModelService","modelTreeService",function(e,t,n,r,o,i,s,a,l,c){function d(e,t){for(let n of t)if(n.id==e?n.selected=!0:delete n.selected,n.hasSubContexts()){let t=n.getSubContexts();for(let n of t)d(e,n.body)}}function u(){m.eventarea.rect=e[0].getBoundingClientRect(),h(e[0],m.eventarea.getRootContextBody())}function p(e){t(u)}function f(){let e=!1;if(S&&v){let t=v.indexOf(S);t>=0&&(e=!0,v.splice(t,1),S=null,v=null)}return e}function h(e,t){for(let n of t){let t=e.querySelector(`#${n.id}`);if(t){let r=t.getBoundingClientRect();if(n.midY=(r.top+r.bottom)/2,n.hasSubContexts()){n.midX=(r.left+r.right)/2;let t=n.getSubContexts();for(let n of t)h(e,n.body);let o=e.querySelector(`#end-${n.id}`);if(o){let e=o.getBoundingClientRect();n.endY=e.bottom}}}}}let m=this;m.triggerBuilder=function(e){e.stopPropagation(),a.triggerBuilder(m.eventarea)},m.showToolbar=function(){m.eventarea.toolbarActive=!0},m.hideToolbar=function(){m.eventarea.toolbarActive=!1},m.openSettings=function(e){console.log("clicked!")},m.isLastEventArea=function(){if(m.currentEndpoint){let e=m.currentEndpoint.getEventAreas();return m.eventarea===e[e.length-1]}return!1},m.isFirstEventArea=function(){if(m.currentEndpoint){let e=m.currentEndpoint.getEventAreas();return m.eventarea===e[0]}return!1},m.moveDown=function(e){e.stopPropagation();let t=m.currentEndpoint.getEventAreas();const n=t.findIndex(e=>e===m.eventarea),o=t[n];t[n]=t[n+1],t[n+1]=o,r.endpointChanged("canvas"),p()},m.moveUp=function(e){e.stopPropagation();let t=m.currentEndpoint.getEventAreas();const n=t.findIndex(e=>e===m.eventarea),o=t[n];t[n]=t[n-1],t[n-1]=o,r.endpointChanged("canvas"),p()},m.deleteEventArea=function(e){e&&e.stopPropagation(),m.currentEndpoint.removeEventArea(m.eventarea.getId()),r.endpointChanged("canvas"),p()},m.selectEventArea=function(e){if(e.stopPropagation(),m.currentEndpoint){let e=m.currentEndpoint.getEventAreas();for(let t of e){d(null,t.getRootContextBody()),m.eventarea===t?t.selected=!0:delete t.selected}}};let g=m.eventarea,v=null,S=null;m.getAcceptedTypes=(()=>["block"]),m.onDrop=function(){return function(e,t,n){if(r.hasOpenedViews()){if(event.preventDefault(),event.stopPropagation(),v){const e=event.dataTransfer.getData("connectdataid"),t=g,n=v;let i=n.indexOf(S);f();const a=o.getBlockDefById(e),l=s.createNewBlockFromDef(e,a,t.trigger.events);t.insertBlockAtIndex(i,l,n),r.endpointChanged("canvas"),p()}}else event.dataTransfer.dropEffect="none"}},m.onDragleave=function(){return function(e,t){t.stopPropagation(),f(),p()}},m.onDragenter=function(){return function(){}},m.onDragover=function(){return function(t,n){function o(e,t,n,r){let i;if(0!=t.length){for(i of t){if(event.pageY<i.midY)break;{let t=i.getSubContexts();if(t.length>1){if((t[0].body.length>0||t[1].body.length>0)&&(o(e,t[0].body,i,{left:r.left,right:i.midX}),o(e,t[1].body,i,{left:i.midX,right:r.right})),null==a&&i.endY&&event.pageY<=i.endY)return c=event.pageX<i.midX?0:1,s=i,a=null,void(l=t[c].body)}else 1==t.length&&o(e,t[0].body,i,r)}n=i}!l&&event.pageX>=r.left&&event.pageX<=r.right&&(null===n?(s=null,a=i,l=t):n===i?(s=n,a=null,l=t):(s=n,a=i,l=t))}}if(!r.hasOpenedViews())return void(event.dataTransfer.dropEffect="none");let s=null,a=null,l=null,c=-1,d=m.eventarea;d.rect=e[0].getBoundingClientRect(),o(d,d.getRootContextBody(),null,{left:d.rect.left,right:d.rect.right}),a&&"fake"==a.type||s&&"fake"==s.type||(s?(f(),a&&"fake"==a.type?(a.yellow=!0,a.nextBlock||i.updateBlockDrawing(!0)):null==a&&c>=0?(g=d,v=s.getSubContexts()[c].body,S=new ConnectParser.FakeBlock,s.getSubContexts()[c].addBlock(S),p()):(g=d,v=l,S=new ConnectParser.FakeBlock,d.addBlockAfter(s.id,S,l),p())):(f(),g=d,v=d.rootContext.body,S=new ConnectParser.FakeBlock,d.addFirstBlock(S,v),p()))}}}]}),angular.module("studio").component("connectCanvas",{templateUrl:"/views/connect/components/canvas.template.html",transclude:!0,bindings:{currentEndpoint:"<"},controller:["$scope","endpointService",function(e,t){function n(){e.$digest()}function r(){let e=!1;if(i){if(o.currentEndpoint){o.currentEndpoint.getEventAreas().splice(s,1)}e=!0,i=null,s=null,a=null}return e}let o=this,i=null,s=null,a=null,l=null;o.getAcceptedTypes=function(){return["event"]},o.onDragover=function(){return function(e,t){let l=t.dataTransfer.getData("connectdataid");if(o.currentEndpoint){let e=o.currentEndpoint.getEventAreas();for(let t=0;t<e.length;t++){const c=e[t];if(!c.fake){const d=(c.rect.top+c.rect.bottom)/2;if(!(event.pageY>d)){if(t>0&&e[t-1].fake)break;r(),i=new ConnectParser.FakeEventArea(l),o.currentEndpoint.addEventAreaBefore(i,c.getId()),s=e.findIndex(e=>e===i),a=c,n();break}c===e[e.length-1]&&(r(),i=new ConnectParser.FakeEventArea(l),o.currentEndpoint.addEventArea(i),s=e.findIndex(e=>e===i),n())}}}}},o.onDrop=function(){return function(e,i,c){const d=s,u=a;r();let p=i.getData("connectdataid");if(l){if(o.currentEndpoint){let e=o.currentEndpoint.getEventAreas();null===u?e.push(l):e.splice(d,0,l)}l=null}else{t.getSelectedView();let e=new ConnectParser.EventArea({id:p,events:[p]});null===u?o.currentEndpoint.addEventArea(e):o.currentEndpoint.addEventAreaBefore(e,u.getId())}t.endpointChanged("canvas"),n()}},o.onDragleave=function(){return function(e,t){(function(e,t){return!(t.pageX<=e.left||t.pageX>=e.left+e.width||t.pageY<=e.top||t.pageY>=e.top+e.height)})(e.getBoundingClientRect(),t)||(r(),n())}}}]}),angular.module("studio").controller("CodeBlockCtrl",["$scope","dialogService","batchRequest","endpointService",function(e,t,n,r){e.model={code:e.ngDialogData.block.code},e.ok=function(){e.ngDialogData.block.code=e.model.code,r.endpointChanged("canvas"),e.closeThisDialog()},e.cancel=function(){e.closeThisDialog()}}]),angular.module("studio").controller("SetDataCtrl",["$scope","$rootScope","$q","$timeout","screenService","screenModelService","dialogService","apiService","uiUploader","mockService","canvas","batchRequest","endpointService","blockService","variableService","modelTreeService","sharedModelService",function(e,t,n,r,o,i,s,a,l,c,d,u,p,f,h,m,g){function v(t,n){n.stopPropagation(),s.dataEntry(m.TYPE_SCREEN_MODEL,t).then(n=>{let r=_.find(e.rightScreenModelTree,function(e){return e.id===t.root.id}),o=m.findByPath(r,t.path);i.qAddProperty(o,n),i.qAddProperty(t,n)})}function S(t,n){n.stopPropagation(),s.dataEntry(m.TYPE_SCREEN_MODEL,t).then(n=>{let r=_.find(e.leftScreenModelTree,function(e){return e.id===t.root.id}),o=m.findByPath(r,t.path);i.qAddProperty(o,n),i.qAddProperty(t,n)})}function y(t){return"transform"===e.ngDialogData.block.type&&"input"===t.toType?t.path.length>0?"input."+t.path:"input":t.id}function E(t){let n=y(t);return e.currentMap.hasOwnProperty(n)&&e.currentMap[n].selectedType}function b(t){t.isFiller&&t.element[0].classList.add("filler");let n=y(t),r=e.currentMap[n].selectedType;if("variable"===e.currentMap[n].selectedType){let t=e.currentMap[n].variable;return t.name?`vars.${t.scope}.${t.name}`:"vars."+t.scope}{let t=e.currentMap[n][e.currentMap[n].selectedType];return r===t?r:t?`${r}.${t}`:r}}function w(t,n){e.selectedProp=t,"variable"===t.selectedType&&t.hasOwnProperty("variable")&&e.selectRhsVar(t.variable)}function C(t,n,r){if(r=void 0===r?t.id:r,0!==Object.keys(e.selectedProp).length||e.selectedProp.constructor!==Object){let t=y(e.selectedProp);t&&(e.currentMap[t]=e.selectedProp,e.currentMap[t][n]=r,e.currentMap[t].selectedType=n,O())}}function T(){let t=e.ngDialogData.block.getMappings();_.each(t,function(t){!function(t){let n;if("vars"===t.to.type){let r=t.to.path.split("."),o=r[0],i=r[1];if(n=i?o+"."+i:o,e.currentMap[n]=_.find(e.toVariables,function(e){return e.scope===o&&e.name===i}),!e.currentMap[n]){let t=h.pushNewVar(o,i);t.toType="variable",e.currentMap[n]=t}e.currentMap[n].key=n}else if(e.customInputTree){n=t.to.type;let r;""===t.to.path?(n=e.customInputKey,r=""):(n=e.customInputKey+"."+t.to.path,r=t.to.path),e.currentMap[n]=m.findByPath(e.customInputObject,r)}else if("input"===t.to.type)n=""===t.to.path?t.to.type:"input."+t.to.path,"transform"===e.ngDialogData.block.type&&"input"===t.to.type?e.currentMap[n]=m.findByPath(e.leftPageModel,t.to.path):e.currentMap[n]=m.findByPath(e.inputsTree.input,t.to.path);else if("models"===t.to.type){n=t.to.path;let r=t.to.path.split(/\.(.+)/),o=r[0],i=r[1]||"",s=_.find(e.leftScreenModelTree,function(e){return e.id===o});s||((s=function(t){let n={id:t,name:t,type:"object",properties:{}};e.leftScreenModelTree.push(n),e.rightScreenModelTree.push(n),m.process(e.leftScreenModelTree),m.process(e.rightScreenModelTree);let r;if("screen"===e.ngDialogData.block.type)r=e.ngDialogData.block.screenId;else if("setdata"===e.ngDialogData.block.type||"api"===e.ngDialogData.block.type){let e=p.getSelectedView();r=e.sourceScreenId}return R(r),U(r),n}(o)).isFiller=!0),s.expanded=!0;let a=function(e,t){if(!t)return e;let n=t.split("."),r=e;for(;n.length;){if(!r)return null;let e=n.shift(),t=j(r);if(!t||!t.hasOwnProperty(e))return null;r=t[e]}return r}(s,i);if(a)e.currentMap[n]=a;else{let t=function(e,t){if(!t)return e;let n,r=t.split("."),o=e,i=e;for(;r.length&&o;){if(!o)return[i,n,r.join(".")];n=r.shift(),i=o,o.hasOwnProperty("properties")||o.hasOwnProperty("items")||(o.properties={}),o=j(o)[n]}return[i,n,r.join(".")]}(s,i),r=t[0],o=t[1],a=t[2],l=function(e,t,n){let r=B(e,{type:"object",newName:t});if(r.isFiller=!0,n){let e=n.split(".");for(;e.length;){let t={type:"object",newName:e.shift()};(r=B(r,t)).isFiller=!0}}return e.expanded=!1,r}(r,o,a);l.parent.expanded=!0,e.currentMap[n]=l}}if(t.from)if("vars"===t.from.type){let r=t.from.path.split("."),o=r.shift(),i=r.join(".")||"";if("page"===o)e.currentMap[n].selectedType="page",e.currentMap[n].page=i,e.currentMap[n].selectedString=t.from.path;else if("item"===o)e.currentMap[n].selectedType="item",e.currentMap[n].item=i,e.currentMap[n].selectedString=t.from.path;else{let t=_.find(e.toVariables,function(e){return e.scope===o&&e.name===i});t||h.pushNewVar(o,i),e.currentMap[n].selectedType="variable",e.currentMap[n].variable={},e.currentMap[n].variable.name=i,e.currentMap[n].variable.scope=o,e.currentMap[n].variable.type="",e.currentMap[n].radioSelection="var."+i,e.currentMap[n].selectedString=A(o,i)}}else if("condition"===t.from.type);else if("expression"===t.from.type||"constant"===t.from.type)e.currentMap[n].selectedType=t.from.type,e.currentMap[n].selectedString=`${t.from.type}.${t.from.value}`,null===t.from.value?e.currentMap[n][t.from.type]="null":e.currentMap[n][t.from.type]=t.from.value.toString();else if("errorOutput"===t.from.type){let r=t.from.path?t.from.path:t.from.value;e.currentMap[n][t.from.type]=r||"",e.currentMap[n].selectedString=r?t.from.type+"."+r:t.from.type,e.currentMap[n].selectedType="errorOutput"}else{if("models"===t.from.type){let n=t.from.path.split(".").shift(),r=_.find(e.rightScreenModelTree,function(e){return e.id===n});r.expanded=!0}let r=t.from.path?t.from.path:t.from.value||"";e.currentMap[n][t.from.type]=r,e.currentMap[n].selectedString=r?t.from.type+"."+r:t.from.type,e.currentMap[n].selectedType=t.from.type}}(t)})}function D(){e.pageModelTrees=[],function(){let t={},r=!1,o={},i=0,s=e.ngDialogData.eventArea.trigger.events;return _.each(s,function(t){if(t.startsWith("transform")){e.hasTransformEvent=!0,r=!0;let n=t.split("."),s=n[1],a=n[2];o.hasOwnProperty(s)?o.push(a):(o[s]=[a],i++)}}),n(function(e,n){r?_.each(o,function(n,r){i--,a.pageModels.get({explorerId:r}).then(function(o){_.each(n,function(e){let n=_.find(o,function(t){return t.id===e});t.hasOwnProperty(r)?t[r].push(n):t[r]=[n]}),0===i&&e(t)})}):e()})}().then(function(t){t&&(_.each(t,function(e){m.process(e)}),e.pageModelTrees=t)})}function M(){e.itemTree=function(){let t,n=i.getModels(),r=e.ngDialogData.eventArea.trigger.events;if(_.each(r,function(r){if(r.startsWith("client")&&r.includes("[]")){e.hasItemEvent=!0;let i=r.split(".");i.shift(),Q=_.map(i,function(e){return e.replace(/\[]$/,"")}).join(".");let s,a,l=i.shift();for(var o=0;o<i.length;o++)if(i[o].endsWith("[]")){a=i.splice(o+1),s=_.map(i,function(e){return e.replace(/\[]$/,"")}).join(".");break}J=s;let c=_.find(n,function(e){return e.id===l});t=m.findByPath(c,s)}}),t)return t.getChildren();return[]}()}function x(){let t=n.defer();return function(){let e=n.defer();return i.refresh().then(function(){e.resolve(i.getModels())}),e.promise}().then(function(n){if("screen"===e.ngDialogData.block.type){let t=_.find(n,function(t){return t.id===e.ngDialogData.block.screenId});e.leftScreenModelTree={},e.leftScreenModelTree[t.id]=angular.copy(t)}else e.leftScreenModelTree=angular.copy(n);let r;if("screen"===e.ngDialogData.block.type)r=e.ngDialogData.block.screenId;else if("setdata"===e.ngDialogData.block.type||"api"===e.ngDialogData.block.type){r=p.getSelectedView().sourceScreenId}e.rightScreenModelTree=angular.copy(n),R(r),m.process(e.leftScreenModelTree),m.eachNode(e.leftScreenModelTree,function(e){e.toType="model"}),U(r),t.resolve()}),t.promise}function k(t,n,r,o){r.hasOwnProperty(n)&&(e[t]=o(r).properties,m.process(e[t]),m.eachNode(e[t],function(e){e.toType=n}))}function P(t){let r=n.defer();return function(e){e&&(k("inputsTree","input",e,V),k("outputsTree","output",e,L),k("errorOutputsTree","errorOutput",e,F))}(t),e.customInputTree=e.ngDialogData.block.getCustomInputTree(),e.customInputTree&&(m.process(e.customInputTree),m.eachNode(e.customInputTree,function(e){e.toType="customInput"}),e.customInputKey=Object.keys(e.customInputTree)[0],e.customInputObject=e.customInputTree[e.customInputKey]),D(),function(){e.leftPageModel=[];let t=e.ngDialogData.block.leftPageModel;t&&(m.process([t]),m.eachNode([t],function(e){e.toType="input"}),e.leftPageModel=t)}(),M(),e.toVariables=[],e.fromVariables=[],h.getVariables(e.ngDialogData.eventArea.getLocalVariables()).then(function(t){e.toVariables=t,e.fromVariables=t,_.each(e.toVariables,function(e){e.toType="variable",e.key=e.scope+"."+e.name})}),x().then(function(){r.resolve()}),r.promise}function A(e,t){return`variables.${e}.${t}`}function I(t,n,r){let o={};if("input"===t)if(r===r.root)o.to=new ConnectParser.InputField("");else{let e=n.split(".");"input"===e[0]&&e.shift(),o.to=new ConnectParser.InputField(e.join("."))}else if("variable"===t)o.to=new ConnectParser.VariableField(n);else if("customInput"===t)if(r===r.root)o.to=new ConnectParser.InputField("");else{let t=n.split(".");t[0]===e.customInputKey&&t.shift(),o.to=new ConnectParser.InputField(t.join("."))}else o.to=new ConnectParser.ModelField(n);return function(e,t){let n=t.selectedType;if("variable"===n){let n=t.variable.name?`${t.variable.scope}.${t.variable.name}`:t.variable.scope;e.from=new ConnectParser.VariableField(n)}else if("start"===n||"item"===n||"page"===n){let r=t[n]?`${n}.${t[n]}`:n;e.from=new ConnectParser.VariableField(r)}else"models"===n?e.from=new ConnectParser.ModelField(t[n]):"errorOutput"===n?e.from=new ConnectParser.ErrorOutputField(t[n]):"output"===n?e.from=new ConnectParser.OutputField(t[n]):"constant"===n?e.from=new ConnectParser.ConstantField(t[n]):"expression"===n&&(e.from=new ConnectParser.ExpressionField(t[n]))}(o,r),o}function O(){if(e.selectedProp.id){let t=y(e.selectedProp),n=e.currentMap[t];"variable"===n.selectedType?n.selectedString=A(n.variable.scope,n.variable.name):n.selectedType===n[n.selectedType]?(n[n.selectedType]="",n.selectedString=`${n.selectedType}`):n.selectedString=`${n.selectedType}.${n[n.selectedType]}`}}function N(e){return $(e,"array"===e.type?`${e.name}[]`:e.name)}function $(e,t){return e.parent?"array"===e.parent.type?$(e.parent,`${e.parent.id}[].${t}`):"object"===e.parent.type?$(e.parent,`${e.parent.id}.${t}`):void 0:t}function V(e){let t={type:"object",properties:{}};for(let n in e)"input"===n&&(t.properties.input=e.input);return t}function L(e){let t={type:"object",properties:{}};return t.properties.output=e.output,t}function F(e){let t={type:"object",properties:{}};return t.properties.errorOutput=e.errorOutput,t}function R(t){t?_.each(e.rightScreenModelTree,function(e){e.id!==t&&(e.expanded=!1)}):_.each(e.rightScreenModelTree,function(e){e.expanded=!1})}function U(t){_.each(e.leftScreenModelTree,function(n){"screen"===e.ngDialogData.block.type?n.id!==t&&(n.expanded=!1):"setdata"===e.ngDialogData.block.type&&t?n.id!==t&&(n.expanded=!1):"api"===e.ngDialogData.block.type&&(e.outputsTree||e.errorOutputsTree)?n.id!==t&&(n.expanded=!1):n.expanded=!1})}function j(e){return e.items&&e.items.properties?e.items.properties:(e.properties,e.properties)}function B(e,t){let n={type:t.type};"date"===t.type||"time"===t.type?n.format=t.format:"object"===t.type?n.properties={}:"method"===t.type&&(n.parameters={}),t.isArray&&(n={type:"array",items:n,expanded:!1}),_.extend(n,{id:e.id+"."+t.newName,name:t.newName,parent:e,root:e.root,getChildren:m.getChildren,expanded:!1}),n.path=function(e,t){let n=new RegExp("^"+t.id+".?");return e.id.replace(n,"")}(n,e.root),e.expanded=!0;return j(e)[n.name]=n,n}e.currentMap={},e.variableScopes=[{name:"Request",value:"request"},{name:"Screen",value:"screen"},{name:"Session",value:"session"},{name:"Local",value:"local"}],e.variableTypes=[{name:"String",value:"string"},{name:"Object",value:"object"},{name:"Object Array",value:"array"},{name:"Date",value:"date"},{name:"Boolean",value:"boolean"}],e.selectedTab={tab:null},e.selectedProp={},e.rhsValues={radioSelection:""},e.lhsValues={radioSelection:""},e.addScreenModel=function(){},e.removeAssociation=function(t,n){n.stopPropagation();let r=y(t);var o=["selectedType","variable","selectedString"];e.currentMap.hasOwnProperty(r)&&(_.each(o,function(t){delete e.currentMap[r][t]}),delete e.currentMap[r])},e.treeControls=[{icon:"fa-trash-o",title:"Remove association",action:e.removeAssociation}],e.inputTreeOptions={isSelected:function(t){return e.selectedProp.id===t.id},hasAssociatedItem:function(e){return E(e)},getAssociatedItem:function(e){return b(e)},getControls:function(t){return e.treeControls},onClick:function(e){w(e,e.id)}},e.editLeftProperty=function(t,n){n.stopPropagation(),s.dataEntry(m.TYPE_SCREEN_MODEL,t.parent,t).then(n=>{let r=_.find(e.rightScreenModelTree,function(e){return e.id===t.root.id}),o=m.findByPath(r,t.path);m.updateProp(o,n);let s;e.currentMap.hasOwnProperty(t.id)&&n.newName&&(s=t.id),i.qEditProperty(t,n),s&&(e.currentMap[t.id]=e.currentMap[s],delete e.currentMap[s])})},e.deleteLeftProperty=function(t,n){n.stopPropagation(),s.confirm(null,"Do you really want to delete this data entry?").then(()=>{let n=_.find(e.rightScreenModelTree,function(e){return e.id===t.root.id}),r=m.findByPath(n,t.path);i.qDeleteProperty(r);let o={};_.each(e.currentMap,function(e){if("models"===e.selectedType){let t=e.selectedString.split(".");t.shift();let n=t.join(".");o[n]=e}}),m.eachNode([t],function(t){e.currentMap.hasOwnProperty(t.id)&&delete e.currentMap[t.id],o.hasOwnProperty(t.id)&&_.each(e.currentMap,function(n,r){n===o[t.id]&&delete e.currentMap[r]})}),i.qDeleteProperty(t)})},e.addMissingProp=function(t,n){n.stopPropagation(),s.dataEntry(m.TYPE_SCREEN_MODEL,t.parent,t).then(n=>{let r=_.find(e.rightScreenModelTree,function(e){return e.id===t.root.id}),o=m.findByPath(r,t.parent.path);i.qAddProperty(o,n);let s;e.currentMap.hasOwnProperty(t.id)&&n.newName&&(s=t.id),i.qEditProperty(t,n),delete t.isFiller,t.element[0].classList.remove("filler")})};let q=[{icon:"fa-pencil",title:"Modify Data Entry",action:e.editLeftProperty},{icon:"fa-trash",title:"Delete Data Entry",action:e.deleteLeftProperty},{icon:"fa-times",title:"Remove association",action:e.removeAssociation}],H=[{icon:"fa-plus",title:"Add Child",action:v},...q],W=[{icon:"fa-plus",title:"Add Param",action:v},...q],G=[{icon:"fa-plus-circle",title:"Add Missing Model Entry",action:e.addMissingProp}];e.leftModelTreeOptions={getDescription:function(e){return e.isFiller?(e.element[0].classList.add("filler"),"missing"):m.getDescription(e)},getChildren:function(e){return e.items&&e.items.properties?e.items.properties:e.properties?e.properties:null},isHidden:function(e){return"action"===e.type},isSelected:function(t){return e.selectedProp.id===t.id},hasAssociatedItem:function(e){return E(e)},getAssociatedItem:function(e){return b(e)},getControls:function(e){return e.isFiller?G:"method"===e.type?W:"object"===e.type||"array"===e.type&&"object"===e.items.type||"model"===e.type?H:q},onClick:function(e){N(e);w(e)}},e.leftPageModelTreeOptions={getIcon:m.getIcon,getChildren:m.getChildren,getDescription:m.getDescription,getDescriptionIcon:m.getDescriptionIcon,isHidden:function(e){return"action"===e.type},isSelected:function(t){return e.selectedProp.id===t.id},hasAssociatedItem:function(e){return E(e)},getAssociatedItem:function(e){return b(e)},getControls:function(t){return e.treeControls},onClick:function(e){w(e,e.path)}},e.customInputTreeOptions={getIcon:m.getIcon,getChildren:m.getChildren,getDescription:m.getDescription,getDescriptionIcon:m.getDescriptionIcon,isSelected:function(t){return e.selectedProp.id===t.id},hasAssociatedItem:function(e){return E(e)},getAssociatedItem:function(e){return b(e)},getControls:function(t){return e.treeControls},onClick:function(e){w(e,e.path)}},e.LHSVariable=function(t,n){let r=t.scope+"."+n,o=t.scope+"."+t.name;if(e.currentMap.hasOwnProperty(r)){let t=e.currentMap[r];e.currentMap[o]=t,delete e.currentMap[r],h.deleteCreatedVariable(r)}e.selectedProp=t,e.selectedProp.id=o,e.selectedProp.key=o},e.outputTreeOptions={isSelected:function(e){},onClick:function(e){C(e,"output",e.path)}},e.errorOutputTreeOptions={isSelected:function(e){},onClick:function(e){C(e,"errorOutput",e.path)}},e.previousOutputTreeOptions={isSelected:function(e){},onClick:function(e){C(e,"output")}},e.editRightProperty=function(t,n){n.stopPropagation(),s.dataEntry(m.TYPE_SCREEN_MODEL,t.parent,t).then(n=>{let r=_.find(e.leftScreenModelTree,function(e){return e.id===t.root.id}),o=m.findByPath(r,t.path);m.updateProp(o,n),i.qEditProperty(t,n)})},e.deleteRightProperty=function(t,n){n.stopPropagation(),s.confirm(null,"Do you really want to delete this data entry?").then(()=>{let n=_.find(e.leftScreenModelTree,function(e){return e.id===t.root.id}),r=m.findByPath(n,t.path);i.qDeleteProperty(r);let o={};_.each(e.currentMap,function(e){if("models"===e.selectedType){let t=e.selectedString.split(".");t.shift();let n=t.join(".");o[n]=e}}),m.eachNode([t],function(t){o.hasOwnProperty(t.id)&&_.each(e.currentMap,function(n,r){n===o[t.id]&&delete e.currentMap[r]})}),i.qDeleteProperty(t)})};let z=[{icon:"fa-pencil",title:"Modify Data Entry",action:e.editRightProperty},{icon:"fa-trash",title:"Delete Data Entry",action:e.deleteRightProperty}],Y=[{icon:"fa-plus",title:"Add Child",action:S},...z],K=[{icon:"fa-plus",title:"Add Param",action:S},...z];e.rightModelTreeOptions={isHidden:function(e){return"action"===e.type},isSelected:function(e){},onClick:function(e){N(e);C(e,"models",e.id)},getControls:function(e){return"method"===e.type?K:"object"===e.type||"array"===e.type&&"object"===e.items.type||"model"===e.type?Y:z}},e.startTreeOptions={isSelected:function(e){},onClick:function(e){C(e,"start")}},e.pageModelTreeOptions={getIcon:m.getIcon,getChildren:m.getChildren,getDescription:m.getDescription,getDescriptionIcon:m.getDescriptionIcon,isHidden:function(e){return"action"===e.type},getLabel:function(e){return e.name},isSelected:function(e){},onClick:function(e){C(e,"page",e.path)}};var J,Q;e.itemTreeOptions={getIcon:m.getIcon,getChildren:m.getChildren,getDescription:function(e){if("descriptor"===e.type)return"empty";if("array"===e.type){let t=Q.split(".");t.pop();let n=t.join(".");return e.id.includes(n)&&e.id.length>n.length?e.items.type+"[]":e.items.type}return e.type},getDescriptionIcon:m.getDescriptionIcon,getLabel:function(e){return e.name},isHidden:function(e){return"action"===e.type},isSelected:function(e){},onClick:function(e){let t=J?`${e.root.id}.${J}.`:e.root.id+".";C(e,"item",e.id.replace(t,""))}},e.changeItemStyle=function(){e.itemStyle={cursor:"pointer",background:"#E5F1F8"}},e.changeItemStyleBack=function(){e.itemStyle={background:"none"}},e.itemClick=function(){C("","item","")},e.selectLhsVar=function(t){e.lhsValues.radioSelection=`variables.${t.scope}.${t.name}`},e.selectRhsVar=function(t){e.rhsValues.radioSelection=`variables.${t.scope}.${t.name}`},e.selectRadio=function(t){let n=y(e.selectedProp);n&&(e.currentMap.hasOwnProperty(n)||(e.currentMap[n]=e.selectedProp),e.currentMap[n].selectedType=t)},e.selectConstant=function(t){let n=y(e.selectedProp);n&&(e.currentMap[n]=e.selectedProp,t.selectedType="constant",t.constant?O():e.currentMap[n].selectedString="")},e.selectExpression=function(t){let n=y(e.selectedProp);n&&(e.currentMap[n]=e.selectedProp,t.selectedType="expression",t.expression?O():e.currentMap[n].selectedString="")},e.RHSVariable=function(t,n){let r=y(e.selectedProp);r&&(e.currentMap[r]=e.selectedProp,e.currentMap[r].variable=n,e.currentMap[r].selectedType="variable"),O()},e.init=function(){let t=f.getBlockDefById(e.ngDialogData.block.getDefId());h.clearCache(),P(t).then(function(){e.inputsTree?(e.mapInput=!0,e.mapOutput=!1,e.selectedTab.tab="input"):e.outputsTree?(e.mapInput=!1,e.mapOutput=!0,e.selectedTab.tab="output"):(e.mapInput=!1,e.mapOutput=!1),T()})},e.apply=function(){e.ngDialogData.block.clearMappings();for(let t in e.currentMap){let n=e.currentMap[t],r=I(n.toType,t,n);e.ngDialogData.block.addMapping(r)}u.send(),h.createVariablesCache(),p.endpointChanged("canvas"),e.closeThisDialog()},e.close=function(){u.clear(),e.closeThisDialog()},e.addNewVariable=function(){h.pushNewVar("local","")},e.deleteVariable=function(e){h.deleteVar(e)},e.inputTab=function(){e.mapOutput=!1,e.mapInput=!0,e.selectedTab.tab="input",e.selectedProp={}},e.outputTab=function(){e.mapOutput=!0,e.mapInput=!1,e.selectedTab.tab="output",e.selectedProp={}},e.init()}]),angular.module("studio").controller("ConditionBuilderCtrl",["$scope","$rootScope","$timeout","screenService","dataService","dialogService","apiService","uiUploader","mockService","canvas","endpointService","blockService",function(e,t,n,r,o,i,s,a,l,c,d,u){let p=e.ngDialogData.block.conditionsTree;e.conditionData=p&&p.children.length?angular.copy(p):{operator:"||",children:[{lhsSource:"Value",lhsType:"value",lhs:"true",lhsValue:"true",test:"isTrue"}]},e.eventArea=e.ngDialogData.eventArea,e.conditionsValid=function(){let t=!0;return _.each(e.conditionData.children,function(e){e.lhsSource&&e.lhs&&e.test||(t=!1),e.hasOwnProperty("rhsSource")&&e.rhsSource&&(e.rhsType&&e.rhs||(t=!1))}),t},e.save=function(){e.ngDialogData.block.conditionsTree=e.conditionData,d.endpointChanged("canvas"),e.close()},e.close=function(){e.closeThisDialog()}}]),angular.module("studio").controller("TriggerBuilderCtrl",["$q","$scope","$rootScope","$timeout","screenService","dataService","dialogService","apiService","uiUploader","mockService","canvas","endpointService","blockService","eventService",function(e,t,n,r,o,i,s,a,l,c,d,u,p,f){console.log("data",t.ngDialogData);let h=t.ngDialogData.eventArea.trigger.conditions;t.conditionData=h?angular.copy(h):{operator:"||",children:[{}]},t.eventArea=t.ngDialogData.eventArea,t.save=function(){t.ngDialogData.eventArea.trigger.conditions=t.conditionData,t.ngDialogData.eventArea.trigger.events=t.trigger.selectedEvents.map(function(e){return e.value}),u.endpointChanged("canvas"),t.close()},t.close=function(){t.closeThisDialog()},t.disableEvent=function(e,n){let r=!1;return _.each(t.trigger.selectedEvents,function(t,o){o!==n&&t===e&&(r=!0)}),r},t.whatIs=function(e){console.log(e),console.log(t.trigger.selectedEvents)},t.addEvent=function(){t.trigger.selectedEvents.push(t.possibleEvents[0])},t.deleteEvent=function(e){t.trigger.selectedEvents.splice(e,1)},function(){let n=e.defer();return t.possibleEvents=[],f.getEvents().then(function(e){for(let n of e)for(let e of n.eventGroups)for(let r of e.events)e.isAppWide?t.possibleEvents.push({label:`${n.id}.${r}`,value:`${n.id}.${r}`}):"web"===n.type?t.possibleEvents.push({label:`transform.${n.id}.${e.name}.${r}`,value:`transform.${n.id}.${e.name}.${r}`}):t.possibleEvents.push({label:`${n.id}.${e.name}.${r}`,value:`${n.id}.${e.name}.${r}`});n.resolve()}),n.promise}().then(()=>{t.trigger={},t.trigger.selectedEvents=[],t.ngDialogData.eventArea.trigger.events?_.each(t.ngDialogData.eventArea.trigger.events,function(e){let n=_.find(t.possibleEvents,function(t){return e===t.value});t.trigger.selectedEvents.push(n)}):t.trigger.selectedEvents.push(t.possibleEvents[0])})}]),angular.module("studio").controller("ConnectConfigCtrl",["$scope","$rootScope","connectorService","connectAppService",function(e,t,n,r){function o(e){if("api"==e.type){var t=Object.keys(e.settings.config);e.missingRequired=!1;for(var n of t){var r=e.settings.config[n];!r.required||e.currentSettings&&e.currentSettings.hasOwnProperty(n)&&("text"!=r.type||e.currentSettings[n])||(e.missingRequired=!0)}}}e.availableConnectors=[],e.model={connectVersion:e.ngDialogData.selectedConnectVersion},e.versions=e.ngDialogData.versions,e.activeConnectors=e.ngDialogData.allConnectors.filter((t,n)=>{t.$i=n;const r=e.ngDialogData.activeConnectors.findIndex(e=>e.module===t.packageId);return-1===r?e.availableConnectors.push(t):o(t),r>=0}),e.selectedConnector=null,e.addingConnector=!e.activeConnectors.length,e.addActiveConnector=function(t){o(t),e.activeConnectors.push(t),e.removeAvailableConnector(t),e.addingConnector=!1},e.addAvailableConnector=function(t){e.availableConnectors.push(t)},e.removeAvailableConnector=function(t){const n=e.availableConnectors.findIndex(e=>e===t);e.availableConnectors.splice(n,1)},e.editSettings=function(n){"api"==n.type&&t.$broadcast(t.EVENT_DIALOG_REQUESTED,"connect-edit-settings",{connector:n,activeConnectors:e.activeConnectors},{isCommon:!1,allowMultiple:!1})},e.showAddConnectorMenu=function(){e.selectedConnector=null,e.addingConnector=!0},e.removeActiveConnector=function(t){const n=e.activeConnectors.findIndex(e=>e===t);e.activeConnectors.splice(n,1),e.addAvailableConnector(t),e.addingConnector=!e.activeConnectors.length},e.submit=function(){e.submitted=!0,t.showLoading(),r.updateConnectSettings(t.app.id,e.activeConnectors,e.model.connectVersion).then(function(){t.$broadcast(t.EVENT_CONNECTORS_CHANGED,{}),e.closeThisDialog(),t.hideLoading()})},e.isValid=function(){var t=!0;for(var n of e.activeConnectors)o(n),n.missingRequired&&(t=!1);return t}}]),angular.module("studio").controller("ConnectEditSettingsCtrl",["$scope","$rootScope","connectorService",function(e,t,n){!function(){e.submitted=!1,e.connector=e.ngDialogData.connector,e.settings=[];let t=e.ngDialogData.connector.settings.config,n=Object.keys(t);for(let r of n){let n,o=t[r];e.connector.currentSettings&&e.connector.currentSettings.hasOwnProperty(r)&&(n=e.connector.currentSettings[r]),e.settings.push({key:r,value:n,name:o.name,description:o.description,type:o.type,required:!!o.required})}}(),e.submit=function(){e.submitted=!0;const t={};for(const n of e.settings)t[n.key]=n.value;e.ngDialogData.activeConnectors.find(t=>t===e.connector).currentSettings=t,e.closeThisDialog()}}]),angular.module("studio").controller("CustomEventCtrl",["$scope","endpointService",function(e,t){e.model={};let n=e.ngDialogData.currentEndpoint;e.close=function(){e.closeThisDialog()},e.add=function(){if(e.model.eventName){let r=n.id+"."+e.model.eventName,o=new ConnectParser.EventArea({id:r,events:[r]});n.addEventArea(o),t.endpointChanged("canvas")}e.closeThisDialog()},e.validate=function(t,n){""!==t.eventName&&(isVarName(t.eventName)||(e.model.eventName=n))}}]),angular.module("studio").controller("ConnectCtrl",["$rootScope","$location","$stateParams","config","endpointService","app","$document","dialogService","layoutService","wsService","saveService","allFilesService","endpointTreeService",function(e,t,n,r,o,i,s,a,l,c,d,u,p){e.app=i,e.serverUrl=r.serverUrl,e.$stateParams=n,e.globals={showContainers:!1,viewSource:!1,showErrorNotifications:!1,activePane:"screens",layout:l.getConfig()},"development"!==r.env&&(window.onbeforeunload=function(){return o.hasDirtyViews()?"You have unsaved changes.":void 0});var f=e.$on("$stateChangeStart",(n,r,i,s)=>{var l=function(){f(),o.closeAllViews(),e.hideLoading(),c.close(!0),r.name!==s.name&&t.path(r.url)};o.hasDirtyViews()?(n.preventDefault(),a.saveConfirm().then(()=>{e.showLoading(),o.saveAllViews().then(()=>{l()})}).catch(()=>{l()})):l()});s.off("keydown"),s.off("keyup"),s.off("cut"),s.off("copy"),s.off("paste"),s.on("keydown",function(e){46===e.keyCode&&"BODY"===e.target.tagName&&e.preventDefault(),83===e.keyCode&&(e.metaKey||e.ctrlKey)&&(h(),e.preventDefault())}),s.on("keyup",function(t){46===t.keyCode&&"BODY"===t.target.tagName&&t.preventDefault(),8===t.keyCode&&"TEXTAREA"!==t.target.tagName&&"INPUT"!==t.target.tagName&&(t.preventDefault(),e.$broadcast(e.EVENT_KEY_DELETE)),83===t.keyCode&&(t.metaKey||t.ctrlKey)&&t.preventDefault()}),s.on("cut",function(e){"INPUT"!==e.target.tagName&&e.target.tagName}),s.on("copy",function(e){"INPUT"!==e.target.tagName&&e.target.tagName}),s.on("paste",function(e){"INPUT"!==e.target.tagName&&e.target.tagName}),e.isAllFilesMode=function(){return"allFiles"===e.globals.activePane},e.hasDirtyEditorFiles=function(){return o.hasDirtyViews()},e.hasDirtyFiles=function(){return u.hasDirtyFiles()};var h=_.debounce(function(){e.showLoading(),d.saveAllEndpoints().then(e.hideLoading)},500,!0);e.hideLoading()}]),angular.module("studio").controller("ConnectSidebarCtrl",["$scope","$timeout","endpointService","connectAppService","dialogService",function(e,t,n,r,o){e.globals.activePane="sources",e.sources=function(){e.globals.activePane="sources",t(n.refresh)},e.events=function(){e.globals.activePane="events",t(n.refresh)},e.blocks=function(){e.globals.activePane="blocks",t(n.refresh)},e.allFiles=function(){e.globals.activePane="allFiles"},e.settings=function(){r.openConnectConfig()},e.revisionHistory=function(){o.revisionHistory()}}]),angular.module("studio").controller("ConnectLeftPaneCtrl",function(){}),angular.module("studio").controller("LeftPaneEventsCtrl",["$scope","$rootScope","$stateParams","config","eventService","endpointService","screenModelService",function(e,t,n,r,o,i,s){e.config=r,e.search={},e.showSearch=!1;let a=[];t.$on(e.EVENT_ENDPOINT_SELECTED,function(){e.endpoint=i.getSelectedView()}),e.$on(e.EVENT_CONNECTORS_CHANGED,function(){e.getEvents()}),e.toggleSearch=function(){e.showSearch=!e.showSearch,e.showSearch||(e.search.name="")},e.getEvents=function(){o.getEvents().then(function(t){a=t,e.eventSources=t})},e.toTitleCase=function(e){return e.split(" ").map(e=>e[0].toUpperCase().concat(e.slice(1))).join(" ")},e.makeDragId=function(e,t,n){return"client"==e.type?t.isAppWide?`client.${n}`:`client.${t.name}.${n}`:"web"==e.type?`transform.${e.name}.${t.name}.${n}`:""},e.getEvents(),s.refresh()}]),angular.module("studio").controller("LeftPaneBlocksCtrl",["$scope","$rootScope","$stateParams","config","blockService","endpointService","dialogService",function(e,t,n,r,o,i,s){e.config=r,e.search={},e.showSearch=!1,e.$on(e.EVENT_CONNECTORS_CHANGED,function(){e.setBlocks()}),e.toggleSearch=function(){e.showSearch=!e.showSearch,e.showSearch||(e.search.name="")},e.setBlocks=function(){o.getBlocks().then(function(t){e.blockGroups=t.blocks})},e.toTitleCase=function(e){return e.split(" ").map(e=>e[0].toUpperCase().concat(e.slice(1))).join(" ")},e.makeDragId=function(e,t){if("builtin"===e.id||"api"===e.type)return`${e.type}.${e.id}.${t.method}`;if("web"===e.type){let n;return n=t.hasOwnProperty("pageModel")?`${e.type}.${e.app}.${t.pageModel}.${t.blockType}`:`${e.type}.${e.app}.${t.blockType}`,"action"==t.blockType&&(n=`${n}.${t.actionPath}`),n}},e.setBlocks()}]),angular.module("studio").controller("LeftPaneEndpointsCtrl",["$scope","$rootScope","$timeout","$window","screenService","endpointService","dialogService","apiService","dataService","config","screenTreeService","workspaceService","canvas",function(e,t,n,r,o,i,s,a,l,c,d,u,p){function f(){return i.getTree().then(function(t){e.rootScreens=t})}e.search={},e.showSearch=!1,e.$on(e.EVENT_CONNECTORS_CHANGED,function(){f()}),f(),e.toggleSearch=function(){e.showSearch=!e.showSearch,e.showSearch||(e.search.name="")},e.toTitleCase=function(e){return e.split(" ").map(e=>e[0].toUpperCase().concat(e.slice(1))).join(" ")},e.cancel=function(){e.edit=null},e.confirmEditing=function(){o.createFolder(e.rootScreen,e.edit.name).then(e.cancel)},e.getIcon=function(){return"fa-folder-o"},e.isValid=function(t){return o.isValidName(t.name,e.rootScreen,t.node)};e.addScreen,e.addFolder,e.manageViews;e.treeOptions={isEditable:function(){return!0},hasAsterisk:function(e){return e.isDirty},onDblClick:function(e){e.folder?e.expanded=!e.expanded:i.stickView(e)},onClick:function(e){if(e.folder)return!1;i.openView(e)},getControls:function(e){return!1},hasDelete:function(e){return!1},hasRename:function(e){return e.folder},hasAddChild:function(){return!1},getChildren:function(e){return e.folder?e.screens:1===_.keys(e.views).length?null:e.views},isHidden:function(e){return!0===e.view&&"default"===e.id},confirmEditing:function(e){},confirmDeleting:function(e){},isSelected:function(e){var t=i.getSelectedView();return t&&(t===e||t===e.screen)},isClickable:function(){return!0},isDraggable:function(e){return!1},isSortable:function(e){return!e.view},isSortableChildren:function(e){return e.folder},getType:function(){return"screen"},getDragData:function(e){return{id:e.id,type:"screen"}},moveNode:o.moveScreen},e.getAppwideEndpoint=function(e,t){t.preventDefault(),"client"==e.id&&i.selectView(e)}}]),angular.module("studio").controller("CanvasHolderConnectCtrl",["$rootScope","$scope","$stateParams","$sce","endpointService","helperService","config","layoutService","canvas",function(e,t,n,r,o,i,s,a,l){t.$on("ui.layout.resize",function(e,t,n){}),o.restoreEndpoints()}]),angular.module("studio").controller("ConnectHeaderCtrl",["$scope","endpointService","dialogService","workspaceService","saveService",function(e,t,n,r,o){e.tabsStyle={marginLeft:0,marginRight:0},e.$on(e.EVENT_ENDPOINT_SELECTED,function(){console.log("header: On EVENT_ENDPOINT_SELECTED"),e.selectedView=t.getSelectedView(),e.openedViews=t.getOpenedViews()}),e.$on(e.EVENT_ENDPOINT_CLOSED,function(){console.log("header: On EVENT_ENDPOINT_CLOSED"),e.selectedView=t.getSelectedView(),e.openedViews=t.getOpenedViews()}),e.$on("ui.layout.resize",(t,n,r)=>{let o=n.id?n:r;e.globals.layout[o.id]=o.size}),e.about=function(){n.about()};var i=e.$root.globals.layout;!function(t,n){t&&(e.tabsStyle.marginLeft=parseInt(t)+5)}(i.west,i.east),e.closeView=function(e){e.isDirty?n.saveConfirm().then(()=>{t.saveView(e.id),t.closeView(e)}).catch(()=>{t.closeView(e)}):t.closeView(e)},e.selectView=function(e){t.getSelectedView()!==e&&t.selectView(e)},e.getTabIcon=function(e){return t.getTabIcon(e)},e.stickView=function(e){t.stickView(e)},e.saveAll=function(){o.saveAllEndpoints()},e.saveSelected=function(){o.saveSelectedEndpoint()},e.toggleExpandedView=function(){r.showContainers(!e.globals.showContainers)},e.toggleViewCode=function(){e.globals.viewSource=!e.globals.viewSource},e.openedViews=t.getOpenedViews()}]),angular.module("studio").controller("ConnectBottomPaneCtrl",["$scope","$rootScope","endpointService","helperService","$timeout",function(e,t,n,r,o){function i(){e.selectedEndpoint=n.getSelectedView(),e.selectedEndpoint.activeTab||(e.selectedEndpoint.activeTab="javascript-"+e.selectedEndpoint.id)}function s(){e.source.js=e.selectedEndpoint.endpoint.getScript()}function a(t){t.layout(),o(function(){var n=t.domElement.getAttribute("data-endpoint-id");e.selectedEndpoint.id===n&&t.domElement.getClientRects().length&&(console.log("editor ["+n+": "+t.domElement.id+"]: focus"),t.focus())},!0)}e.$on(e.EVENT_ENDPOINT_SELECTED,function(){console.log("bottomPane: On EVENT_ENDPOINT_SELECTED"),i(),s()}),e.$on(e.EVENT_ENDPOINT_CHANGED,function(e,t){console.log("bottomPane: On EVENT_ENDPOINT_CHANGED",t),"editor"!==t&&s()}),e.source={js:""},e.selectedEndpoint={id:""},i(),s(),e.editorLoaded=function(r){return r.unwatchers={},r.unwatchers.layoutResize=e.$on("ui.layout.resize",function(){a(r)}),!(["editor-view","editor-ctrl","editor-handler"].indexOf(r.domElement.id)<0)&&(r.unwatchers.activeTab=e.$watch("selectedEndpoint.activeTab",function(){a(r)}),r.unwatchers.endpointClosed=e.$on(e.EVENT_ENDPOINT_CLOSED,function(o,i){!function(r,o){n.hasOpenedViews()||(console.log("editor ["+e.selectedEndpoint.id+": "+r.domElement.id+"]: cleanup"),_.each(r.unwatchers,function(e){e()}),delete r.unwatchers,r.getModel()&&r.getModel().dispose(),r.dispose(),r.destroy(),e.source={js:""},t.globals.viewSource=!1)}(r)}),"editor-view"===r.domElement.id&&void 0)},e.updateEndpointJS=_.debounce(function(t){if(t!==n.getSelectedView().id)return!1;console.log("Setting new JS for endpoint: "+t),console.log("New code: ",e.source.js),n.updateSelectedViewJS(t,e.source.js)},500),e.jsChanged=function(t){if(t&&t.isFocused()&&t.domElement.getClientRects().length){var n=t.domElement.getAttribute("data-endpoint-id");e.updateEndpointJS(n)}}}]),angular.module("studio").controller("ConnectCanvasCtrl",["$scope","$rootScope","$stateParams","config","blockService","screenService","dialogService","connectParserService","endpointService",function(e,t,n,r,o,i,s,a,l){function c(e,t){for(let n of t)if(n.id==e?n.selected=!0:delete n.selected,n.hasSubContexts()){let t=n.getSubContexts();for(let n of t)c(e,n.body)}}function d(t,n){for(let r of t){if(r.selected)return void e.deleteBlock(r.id,t,n);if(r.hasSubContexts()){let e=r.getSubContexts();for(let t of e)d(t.body,n)}}}function u(){if(!e.currentEndpoint)return;let t=e.currentEndpoint.getEventAreas();for(let e of t){let t=e.getId(),n=document.querySelector(`#canvas [id='${t}'] .event-area`);n&&(e.rect=n.getBoundingClientRect()),p(t,e.getRootContextBody())}}function p(e,t){for(let n of t){let t=document.querySelector(`#canvas [id='${e}'] #${n.id}`);if(t){let r=t.getBoundingClientRect();if(n.midY=(r.top+r.bottom)/2,n.hasSubContexts()){n.midX=(r.left+r.right)/2;let t=n.getSubContexts();for(let n of t)p(e,n.body);let o=document.querySelector(`#canvas [id='${e}'] #end-${n.id}`);if(o){let e=o.getBoundingClientRect();n.endY=e.bottom}}}}}e.$on(e.EVENT_ENDPOINT_SELECTED,function(){console.log("connectCanvas: On EVENT_ENDPOINT_SELECTED");var t=document.querySelectorAll("#svg > text, #svg > path");for(var n of t)document.querySelector("#svg").removeChild(n);e.selectedView=l.getSelectedView(),e.openedViews=l.getOpenedViews(),e.selectedView?e.currentEndpoint=e.selectedView.endpoint:e.currentEndpoint=null,setTimeout(u,100)}),e.$on(e.EVENT_BLOCK_SELECTED,function(t,n){if(!e.currentEndpoint)return;let r=e.currentEndpoint.getEventAreas();for(let e of r){c(n,e.getRootContextBody()),delete e.selected}}),e.$on(e.EVENT_KEY_DELETE,function(t){if(!e.currentEndpoint)return;let n=e.currentEndpoint.getEventAreas();for(let t of n){if(t.selected)return void e.deleteEventArea(t);d(t.getRootContextBody(),t)}}),e.hasOpenedViews=function(){return l.hasOpenedViews()},e.selectEventArea=function(t,n){if(n.stopPropagation(),e.currentEndpoint){let n=e.currentEndpoint.getEventAreas();for(let e of n){c(null,e.getRootContextBody()),t===e?e.selected=!0:delete e.selected}}},e.$on(e.EVENT_ENDPOINT_CLOSED,function(){console.log("connectCanvas: On EVENT_ENDPOINT_CLOSED"),e.selectedView=l.getSelectedView(),e.currentEndpoint=e.selectedView?e.selectedView.endpoint:null}),e.$on(e.EVENT_ENDPOINT_CHANGED,function(t){console.log("connectCanvas: On EVENT_ENDPOINT_CHANGED"),"canvas"!==t&&(e.selectedView=l.getSelectedView(),e.currentEndpoint=e.selectedView?e.selectedView.endpoint:null,setTimeout(u,100))}),e.close=function(){e.selectedView=null,e.currentEndpoint=null},e.deleteBlock=function(t,n,r){r.removeBlock(t,n),l.endpointChanged("canvas"),function(t){t&&e.$apply(),setTimeout(u)}()}}]),angular.module("studio").controller("AllFilesConnectHeaderCtrl",["$scope","$rootScope","batchRequest","layoutService","allFilesService","endpointService",function(e,t,n,r,o,i){e.openedFiles=o.getOpenedFiles(),e.selectedFile=o.getSelectedFile(),e.layoutSizes=r.getConfig(),e.$on("ui.layout.resize",(t,n,r)=>{let o=n.id?n:r;e.layoutSizes[o.id]=o.size}),e.$on(e.EVENT_FILE_SELECTED,()=>{console.log("header: On EVENT_FILE_SELECTED"),e.selectedFile=o.getSelectedFile()}),e.$on(e.EVENT_FILE_CLOSED,()=>{console.log("header: On EVENT_FILE_CLOSED"),e.selectedFile=o.getSelectedFile()}),e.closeFile=o.processClosingFileTab,e.selectFile=o.processSelectingFileTab,e.stickFile=o.processStickingFileTab,e.saveAll=function(){e.showLoading(),o.saveAllFiles().then(()=>{i.refresh(),t.hideLoading()})}}]);var webexplorer=angular.module("webexplorer",["common","angular-jsonrpc-client","RecursionHelper","mp.autoFocus","ngDialog","uiSwitch","cfp.hotkeys","ui.layout","monospaced.elastic"]);angular.module("webexplorer").run(["explorerWsService","commonDialogs",function(e,t){e.setAPI({errorHandling:function(e,n){_.isObject(n)&&n.error&&(n="<pre>"+JSON.stringify(n,null,2)+"</pre>"),t.error(e,n)}})}]),angular.module("webexplorer").controller("webExplorerCtrl",["$scope","$document","$rootScope","global","xDialogService","pageModelService","$stateParams",function(e,t,n,r,o,i,s){n.appName="webexplorer",t[0].body.id="explorer",document.title=s.explorerId+" - SmartUXâ„¢ Explorer",e.globals={layout:{west:"300px"},activePane:"pageModels",extractionMode:!0,sourceEditorOpened:!1,devtoolsOpened:!1,activeSourceTab:"Find",bottomPaneHeight:null,selectedFunction:{}},n.explorerData={screens:r.screens,matchedConnections:null},n.isAllFilesMode=function(){return"xFiles"===e.globals.activePane};Object.keys(r.screenModels).length>0&&0===i.cache.length&&o.syncModels()}]),angular.module("webexplorer").factory("config",function(){return{serverUrl:null,layout:{north:"50%",northLeft:"60%",southLeft:"60%"},defaultControls:["action.button","action.link","attrib.onclick","checkbox","exists","property","property.className","property.id","property.innerHTML","property.innerText","radio","select","text"],codeRegex:/\(.*\)/,messages:{noScreenModel:"The screen doesn't have a screen model.",pageModelExists:'The page model "{{model}}" already exists.'},reconnectTimeout:1e3}}),angular.module("webexplorer").run(["$rootScope","$timeout","global","pageService",function(e,t,n,r){e.EVENT_EDIT_SOURCE="EDIT_SOURCE",e.EVENT_CLEAR_EDITOR="CLEAR_EDITOR",e.EVENT_POWWOW_INJECTED="POWWOW_INJECTED",e.EVENT_EDIT_PAGE_MODEL="EDIT_PAGE_MODEL",e.EVENT_PAGE_MODEL_UPDATED="PAGE_MODEL_UPDATED",e.EVENT_DEVTOOLS_NODE_DROPPED="DEVTOOLS_NODE_DROPPED",e.EVENT_DEVTOOLS_FRAMES_DROPPED="DEVTOOLS_FRAMES_DROPPED",e.$on(e.EVENT_POWWOW_INJECTED,function(){r.getMatchedConnections()}),e.$watch("selected.node",function(e){if(!e)return!1;r.countElements(e.root,e.id).then(function(e){n.matchedElements=e||0})})}]),angular.module("webexplorer").service("explorerWsService",["$rootScope","$q","$sce","config","uuid4",function(e,t,n,r,o){var i={},s={};this.setAPI=function(e){s=e},this.init=function(){var n=t.defer(),a=(r.serverUrl.indexOf("https")>-1?"wss":"ws")+r.serverUrl.replace(/^https?/,""),l=localStorage.getItem("wsConnectionId");return l||(l=o.generate(),localStorage.setItem("wsConnectionId",l)),e.wsConnectionId=l,a+="?wsConnectionId="+e.wsConnectionId+"&appId="+e.appId+"&explorerId="+e.explorerId+"&token="+localStorage.getItem("accessToken"),this.ws=new WebSocket(a),this.ws.onopen=function(){console.log("WS has been opened "+a)},this.ws.onmessage=function(e){var t;try{t=JSON.parse(e.data)}catch(e){console.log("Can not parse ws message response: ",e)}if(t&&"2.0"===t.jsonrpc)if("ready"!=t.method){if(!Object.hasOwnProperty.call(t,"id")&&t.method){if(!Object.hasOwnProperty.call(s,t.method))return console.log("Frontend API does not exist!");try{return s[t.method].apply(null,t.params)}catch(e){console.log("Front end API method error",e)}}t.id&&i[t.id]&&(t.error?(console.log("JSON-RPC error:",i[t.id].request,t),i[t.id].reject(t.error)):i[t.id].resolve(t.result),delete i[t.id])}else n.resolve()},n.promise},this.method=function(e,n){var r=o.generate(),s=JSON.stringify({jsonrpc:"2.0",method:e,params:n,id:r});return 1===this.ws.readyState&&this.ws.send(s),function(e){setTimeout(function(){i[e]&&(i[e].reject(i[e].request+" timed_out"),delete i[e])},2e4)}(r),t(function(e,t){i[r]={resolve:e,reject:t,request:s}})},this.notify=function(e,t){var n={jsonrpc:"2.0",method:e,params:t};1===this.ws.readyState&&this.ws.send(JSON.stringify(n))}}]),angular.module("webexplorer").service("explorerService",["$rootScope","explorerWsService","commonDialogs",function(e,t,n){const r=this;_.each({getters:{applications:["getList","getRemaining","getConfig"],events:["getEventTypes"],injectables:["getInjectScripts","getInjectFiles"],mocks:["getMockSets"],pageModels:["get"],screens:["getTree"],screenModels:["get"],sharedModels:["get"]},setters:{applications:["create","update","delete"],connections:["updateMatch","updateModel","reorder","connectScreens","delete","connectEvent","reorderScreens","connectAction","connectScreenModels"],events:["renameEvent","renamePageModel"],injectables:["update","rename","delete"],mocks:["createDataSet","updateData"],pageModels:["create","rename","delete","reorder","copyScreenModel","copySharedModel","save","screenModelToObject","sharedModelToObject"],sessions:["create","delete","getList","restart"],screens:["createScreen"],screenModels:["deleteProp","addSourcePath","unlink","copyPageModelObj","copyPmToExistingSm","deleteModel","addProp"],sharedModels:["copyPageModelObj","deleteProp","addSourcePath","unlink","copyPmToExistingSm","deleteModel","addProp","updateProp"],sync:["pushToPageModel","pushToScreenModel","pushToSharedModel"],tree:["createNode","updateNode","deleteNode"]}},(o,i)=>{_.each(o,(o,s)=>{r[s]=r[s]||{},_.each(o,o=>{let a="webexplorer/"+s+"."+o,l=function(o){return o=r.$prepareParams(o),t.method(a,o).then(t=>(function(t,n){return e.$broadcast(e.EVENT_API_SUCCESS,{name:n.$method,namespace:n.$namespace,isSetter:n.$isSetter}),t})(t,l)).catch(e=>(function(e){console.error(e),_.isString(e)?n.error("An error occurred",e):n.error(e.name,e.message)})(e))};l.$method=a,l.$namespace=s,l.$isSetter="setters"===i,r[s][o]=l})})}),_.each({sessions:["removeAllWsConnections"]},(e,n)=>{r[n]=r[n]||{},_.each(e,e=>{let o="webexplorer/"+n+"."+e;r[n][e]=function(e){e=r.$prepareParams(e,n),t.notify(o,e)}})}),r.$prepareParams=function(t,n){return t=t||{},"dom"!==n&&(t.appId=t.appId||e.appId,t.explorerId=t.explorerId||e.explorerId,t.wsConnectionId=e.wsConnectionId),t}}]),angular.module("webexplorer").service("pageService",["$rootScope","powwowService","xDataService",function(e,t,n){const r=this;r.preview={data:{}},r.extract=function(e){return t.extract(e).then(e=>(console.log("pageService.extract",e),r.preview.data=e.result.value,r.preview.data)).catch(()=>{r.preview.data={}})},r.update=function(e){let o=angular.copy(r.preview.data);return n.flattenSelects(o),t.update(e,o).then(e=>{console.log("pageService.update",e)})},r.action=function(e,n){return t.action(e,n).then(e=>{console.log("pageService.action",e)})},r.getMatchedConnections=function(){return t.checkState().then(t=>(console.log("pageService.getMatchedConnections:",t),e.explorerData.matchedConnections=t.result.value,e.explorerData.matchedConnections)).catch(()=>{e.explorerData.matchedConnections=[]})}}]),angular.module("webexplorer").service("canvasService",["$window","$rootScope","rectangleService",function(e,t,n){let r=this;r.canvas=null,r.canvasScope=null,r.overlay=null,r.screencast=null,r.prevWidth=null,r.prevHeight=null;let o={border:[],width:0,height:0};r.removeRect=function(){o={border:[],width:0,height:0},n.removeRect()},r.drawBoxModel=function(e){o.border[0]===e.border[0]&&o.width===e.width&&o.border[1]===e.border[1]&&o.height===e.height||0===e.height||0===e.width||(n.drawRect(e,r.canvas,r.canvasScope),o=e)},r.getScreencastWidth=function(){return r.screencast?r.screencast.getBoundingClientRect().width:null},r.getScreencastHeight=function(){return r.screencast?r.screencast.getBoundingClientRect().height:null},r.getCanvasOffsetX=function(){let e=document.querySelector("#north");if(e&&r.screencast){let t=r.screencast.getBoundingClientRect().left-e.getBoundingClientRect().left;return Math.round(t)}},r.getCanvasOffsetY=function(){let e=document.querySelector("#north");if(e&&r.screencast){let t=r.screencast.getBoundingClientRect().top-e.getBoundingClientRect().top;return Math.round(t)}},r.resizeViewport=function(){let e=document.querySelector("#domInspector").shadowRoot.querySelector(".root-view:nth-last-child(1)").querySelector(".screencast").getBoundingClientRect(),t=e.width,n=e.height,r=window.innerWidth/window.outerWidth;return{width:parseInt(t/r),height:parseInt(n/r)-40}}}]),angular.module("webexplorer").service("rectangleService",["$compile",function(e){const t=this;let n=null;t.drawRect=function(r,o,i){t.removeRect();let s=e("<rectangle></rectangle>")(i)[0];s.style.left=r.border[0]-1+"px",s.style.top=r.border[1]-1+"px",s.style.width=r.width+2+"px",s.style.height=r.height+2+"px",n=s,o.append(s)},t.removeRect=function(){n&&(n.parentElement.removeChild(n),n=null)}}]),angular.module("webexplorer").service("selectorService",["powwowService",function(e){function t(e,t){return`[${e[t]}`+(e[t+1]?`='${e[t+1]}']`:"]")}function n(e,i,s){var a=-1;return~i.indexOf("id")?a=i.indexOf("id"):~i.indexOf("name")?a=i.indexOf("name"):~i.indexOf("class")?a=i.indexOf("class"):~i.indexOf("title")&&(a=i.indexOf("title")),new Promise(function(l,c){return~a?(e+=t(i,a),i.splice(a,2),o.getSelectorCount(e,s).then(function(t){if(1===t)return r(i[0],e,s,l);n(e,i,s).then(l)})):r(i[0],e,s,l)})}function r(e,t,n,r){switch(e){case"iframe":return r(n.concat(t));case"table":return r(t+" tbody tr");default:return r(t)}}var o=this;this.typeOptions=[{label:"String",value:"string"},{label:"Boolean",value:"boolean"},{label:"Identifier",value:"identifier"},{label:"Select",value:"select"},{label:"Object",value:"object"},{label:"Object Array",value:"array"},{label:"Action",value:"action"},{label:"Method",value:"method"},{label:"Page Model",value:"descriptor"}],this.formatSelector=function(e,i){var s=e[0].toLowerCase(),a=-1;switch(s){case"iframe":case"img":a=e.indexOf("src");break;case"a":a=e.indexOf("href");break;case"form":a=e.indexOf("action");break;case"input":a=e.indexOf("id");break;case"table":a=_.findIndex(e,e=>~["summary","cellspacing","cellpadding"].indexOf(e))}return new Promise(function(l,c){return"td"===s?l(s):(~a&&(s+=t(e,a),e.splice(a,2)),o.getSelectorCount(s,i).then(function(t){if(1===t)return r(e[0],s,i,l);n(s,e,i).then(l)}))})},this.getControls=function(e,t){if("identifier"===t)return"exists";var n=e[0],r=e.indexOf("type"),o=~r?e[r+1]:null;return~["img","video","audio"].indexOf(n)?"attrib.src":"a"===n?"string"===t?"property.innerText":"action.click":"button"===n?"action.click":"input"===n?~["button","file","reset","submit"].indexOf(o)?"action.click":"checkbox"===o?"checkbox":"radio"===o?"radio":"image"===o?"attrib.src":"text":"textarea"===n?"text":"select"===n?"select":"div"===n?"property.innerHTML":"property.innerText"},this.isValidSelector=function(e){try{document.querySelector(e||"*")}catch(e){return!1}return!0},this.getSelectorCount=function(t,n){return e.getSelectorCount(t,n).then(function(e){return e.result.value||0})},this.getControlParam=function(e){switch(e){case"property":return[" ","innerText","innerHTML"];case"action":return[" ","click","dblclick","keydown","keyup"];default:return[" "]}}}]),angular.module("webexplorer").service("xSyncService",["explorerService","modelTreeService","xBatchRequest","pageModelService","xScreenModelService","xSharedModelService",function(e,t,n,r,o,i){function s(e,n,r){let o=[];return t.eachNode([e],e=>{o.push(function(e,n,r){let o=e.path.split(".");if(o.pop(),r&&r.path){let e=r.path.split(".");_.each(e,()=>{o.shift()})}let i=t.findByPath(n,o.join(".")),s=_.pick(e,"name","path","type","format"),a=s;"array"===e.type&&(s.items=_.pick(e.items,"type","format"),a=s.items);"object"===a.type?a.properties={}:"method"===a.type&&(a.parameters={});let l=angular.copy(s);if(r&&r.path){let e=r.path.split("."),t=l.path.split(".");_.each(e,()=>{t.shift()}),l.path=t.join(".")}return t.getChildren(i)[e.name]=s,t.processNode(s,e.name,n,i),l}(e,n,r))}),o}const a=this;let l={pageModels:[],screenModels:[],sharedModels:[]},c=[],d={};a.initialize=function(){return l.pageModels=angular.copy(r.cache),l.screenModels=angular.copy(o.cache),l.sharedModels=angular.copy(i.cache),l},a.save=function(){return r.cache=l.pageModels,o.cache=l.screenModels,i.cache=l.sharedModels,c.push(()=>{let t={screenModelIds:Object.keys(d)};return[e.connections.connectScreenModels,t]}),c.forEach(e=>{let t=e();n.add(t[0],t[1])}),a.clear(),n.send()},a.clear=function(){c.length=0,l.pageModels=[],l.screenModels=[],l.sharedModels=[]},a.pageModels={},a.pageModels.pushNode=function(t,n){let r=s(t,n);c.push(()=>{d[n.id]=!0;let t={path:n.id,props:r};return[e.sync.pushToPageModel,t]})},a.pageModels.copyScreenModel=function(t){let n=angular.copy(t);return n.connect=[],l.pageModels.push(n),r.process(l.pageModels),c.push(()=>{d[t.id]=!0;let r={screenModelId:t.id,pageModelName:n.name};return[e.pageModels.copyScreenModel,r]}),n},a.pageModels.screenModelToObject=function(t,n){let o=angular.copy(t),i=n.getChildren();return Object.assign(i,o.getChildren()),r.process(l.pageModels),c.push(()=>{d[o.id]=!0;let t={pageModelId:n.root.id,screenModelId:o.id,path:n.path,descriptor:n.descriptor};return[e.pageModels.screenModelToObject,t]}),o},a.pageModels.sharedModelToObject=function(t,n){let o=angular.copy(t),i=n.getChildren();return Object.assign(i,o.getChildren()),r.process(l.pageModels),c.push(()=>{d[o.id]=!0;let t={pageModelId:n.root.id,screenModelId:o.id,path:n.path,descriptor:n.descriptor};return[e.pageModels.sharedModelToObject,t]}),o},a.screenModels={},a.screenModels.link=function(t,n){t.sourcePath=n,c.push(()=>{d[t.id]=!0;let n={screenModelId:t.id,sourcePath:t.sourcePath};return[e.screenModels.addSourcePath,n]})},a.screenModels.unlink=function(t){delete t.sourcePath,c.push(()=>{d[t.id]=!0;let n={screenModelId:t.id};return[e.screenModels.unlink,n]})},a.screenModels.pushNode=function(t,n,r){let o=s(t,n,r);c.push(()=>{d[n.id]=!0;let t={modelId:n.id,props:o};return[e.sync.pushToScreenModel,t]})},a.screenModels.copyPageModelObj=function(n){let r=angular.copy(n),o=n.id;r.sourcePath=o;let i=o.split(".").pop();r.id=i,r.path="",l.screenModels[i]=r,t.eachNode(r.properties,function(e,t){if("identifier"===e.type)return delete t[e.name];if("descriptor"===e.type){let t=l.pageModels[e.id];a.copyPageModelObj(t)}_.each(["control","selector","selectorAll","frameSelector","frameSelectorAlt","descriptor","expanded","selectIndex","get_selectorAll","get_control","set_selector","set_control","fn","path","root","parent"],function(t){delete e[t]})});let s=angular.copy(r);return delete s.root,delete s.parent,c.push(()=>[e.screenModels.copyPageModelObj,s]),t.process(l.screenModels),r},a.screenModels.copyPmToExistingSm=function(n,r){n.sourcePath=r.id;let o=angular.copy(r);Object.assign(n.properties,o.properties),t.eachNode(n.properties,function(e,t){if("identifier"===e.type)return delete t[e.name];_.each(["control","selector","selectorAll","frameSelector","frameSelectorAlt","descriptor","expanded","selectIndex","get_selectorAll","get_control","set_selector","set_control","fn","path","root","parent","id","name"],function(t){delete e[t]})});let i=angular.copy(n);return delete i.root,delete i.parent,c.push(()=>[e.screenModels.copyPmToExistingSm,i]),t.process(l.screenModels),n},a.sharedModels={},a.sharedModels.link=function(t,n){t.sourcePath=n,c.push(()=>{let n={sharedModelId:t.id,sourcePath:t.sourcePath};return[e.sharedModels.addSourcePath,n]})},a.sharedModels.unlink=function(t){delete t.sourcePath,c.push(()=>{let n={sharedModelId:t.id};return[e.sharedModels.unlink,n]})},a.sharedModels.pushNode=function(t,n,r){let o=s(t,n,r);c.push(()=>{d[n.id]=!0;let t={modelId:n.id,props:o};return[e.sync.pushToSharedModel,t]})},a.sharedModels.copyPageModelObj=function(n,r,o){let i=angular.copy(n),s=[];return t.eachNode([i],(e,t,n)=>{if(_.each(["control","selector","selectorAll","frameSelector","frameSelectorAlt","expanded","connect","selectIndex","get_selectorAll","get_control","set_selector","set_control","fn","path","root","parent"],t=>{delete e[t]}),"descriptor"===e.type||e===i){if("identifier"===e.type)return delete t[e.name];if(n){let t=e.id.split(".");delete n.properties[t.pop()]}if("descriptor"===e.type){if(e.type="object",r.hasOwnProperty(e.descriptor))return;if(o.hasOwnProperty(e.descriptor))return;let t=e.id.split(".");e.descriptorId=e.id,e.id=t.pop()}e.sourcePath=e.descriptorId||e.id,l.sharedModels[e.id]=e,s.push(e)}}),c.push(()=>{let t={result:angular.copy(s)};return[e.sharedModels.copyPageModelObj,t]}),t.process(l.sharedModels),s},a.sharedModels.copyPmToExistingSm=function(n,r){n.sourcePath=r.id;let o=angular.copy(r);Object.assign(n.properties,o.properties),t.eachNode(n.properties,(e,t)=>{if("identifier"===e.type)return delete t[e.name];_.each(["control","selector","selectorAll","frameSelector","frameSelectorAlt","descriptor","expanded","selectIndex","get_selectorAll","get_control","set_selector","set_control","fn","path","root","parent","id","name"],t=>{delete e[t]})});let i=angular.copy(n);return delete i.root,delete i.parent,c.push(()=>[e.sharedModels.copyPmToExistingSm,i]),t.process(l.sharedModels),n}}]),angular.module("webexplorer").service("ratioService",["canvasService",function(e){this.ratioToChrome,this.ratioFromChrome,this.config={width:1024,height:768},this.getRatioXToChrome=function(){return this.config.width/e.getScreencastWidth()},this.getRatioYToChrome=function(){return this.config.height/e.getScreencastHeight()},this.getRatioXFromChrome=function(){return e.getScreencastWidth()/this.config.width},this.getRatioYFromChrome=function(){return e.getScreencastHeight()/this.config.height}}]),angular.module("webexplorer").service("tabService",["$q","explorerService","devtoolsMethods","powwowService",function(e,t,n,r){var o=this;this.tabs=[],this.emptyTabs=function(){o.tabs.length=0},this.getTabs=function(){return e(function(e,n){t.sessions.getList().then(e,n)})},this.createTabs=function(e){e.reverse().forEach(o.createTab)},this.createTab=function(e){o.tabs.push({name:e.title||"Untitled",targetId:e.targetId||e.id})},this.deleteTab=function(e){var t=_.findIndex(o.tabs,t=>t.targetId===e);this.tabs.splice(t,1)},this.selectTab=function(e,t){t||n.reinitDevTools(e.targetId)},this.closeTab=function(e){r.evaluate({expression:"window.close()",returnByValue:!1}).then(function(){o.deleteTab(e.targetId);var t=o.tabs.slice(-1)[0];n.reinitDevTools(t.targetId)})},this.updateTabs=function(e){o.tabs.forEach(t=>{var n=_.find(e,e=>t.targetId===e.id);t.name=n.title||"Untitled"})}}]),angular.module("webexplorer").service("xDialogService",["$rootScope","$q","commonDialogs",function(e,t,n){_.extend(this,n),this.syncModels=function(){e.$emit(e.EVENT_DIALOG_REQUESTED,"sync-models",{})},this.connectScreens=function(t){e.$emit(e.EVENT_DIALOG_REQUESTED,"connect-screens",{connection:t})},this.connectAction=function(t){e.$emit(e.EVENT_DIALOG_REQUESTED,"connect-action",{connection:t})},this.pushMockData=function(t){e.$emit(e.EVENT_DIALOG_REQUESTED,"push-mock-data",{data:t})},this.updateWebConnector=function(){let n=t.defer();return e.$emit(e.EVENT_DIALOG_REQUESTED,"update-web-connector",{onSubmit:n.resolve}),n.promise}}]),angular.module("webexplorer").service("helperService",["$timeout","commonHelperService",function(e,t){_.extend(this,t),this.saveToFile=function(e,t){"string"!=typeof e&&(e=JSON.stringify(e,void 0,2));var n=new Blob([e],{type:"text/json"}),r=document.createElement("a");r.download=t,r.href=window.URL.createObjectURL(n),r.dataset.downloadurl=["text/json",r.download,r.href].join(":");var o=new MouseEvent("click");r.dispatchEvent(o)}}]),angular.module("webexplorer").service("injectableService",["$q","explorerService","commonHelperService","xBatchRequest",function(e,t,n,r){var o=this;this.injectables={},this.baseControls=["action","attrib","checkbox","computedstyle","constant","exists","hasClass","hasComputedstyle","none","property","radio","select","style","text","url"],this.powwow={script:null},this.getInjectFiles=function(){var n=e.defer();return t.injectables.getInjectFiles().then(function(e){o.injectables=e||{},_.each(o.injectables,function(e,t){_.each(e,function(e){e.type=t})}),n.resolve(e)}).then(n.reject),n.promise},this.getInjectScripts=function(){var n=e.defer();return t.injectables.getInjectScripts().then(function(e){var t=function(e){var t=[],n="";if(e.length<3)return n;t.push({source:_.find(e,{name:"common"}).src}),o.powwow.preinject={source:_.find(e,{name:"preinject"}).src},o.powwow.postinject={source:_.find(e,{name:"postinject"}).src};for(var r=0;r<t.length;r++)n+=t[r].source+"\n";return n}(e);o.powwow.script=t,n.resolve(t)}).then(n.reject),n.promise},this.getPowwowScript=function(){return this.powwow.script+o.append("powwow")},this.getInjectString=function(){var e="";return e+=this.powwow.preinject.source+"\n",_.each(o.injectables,function(t,n){_.each(t,function(t){e+=`${t.src}\n`,e+=`window.powwow['${n.toLowerCase()}']['${t.name}']=exports;\n`,e+=o.append(n.toLowerCase(),t.name)+"\n"})}),e+=this.powwow.postinject.source+"\n"},this.validateName=function(e,t){let r=n.filterName(t),o=!!r&&t===r,i=_.pluck(e,"name").indexOf(r)<0;return o&&i},this.append=function(){return`//# sourceURL=${[].slice.call(arguments).join(".")}\n`}}]),angular.module("webexplorer").service("lexiconService",["config","global","modelTreeService",function(e,t,n){var r=this;r.controls=[],r.controlsFn=[],r.selectorsFn=[],r.update=function(e,t,n,r){if(!t)return!1;var o=_.findWhere(e,{value:t});o?o.priority+=1:!0===r&&e.push({priority:1,value:t,label:n})},r.sort=function(e){for(var t=_.sortBy(e,function(e){return-e.priority});e.length;)e.pop();for(;t.length;)e.push(t.shift())},_.each(e.defaultControls,function(e){r.controls.push({value:e,label:e,priority:0})}),_.each(t.extractFunctions,function(e){r.controlsFn.push({value:e,label:e.split(".").pop(),priority:0})}),_.each(t.findFunctions,function(e){r.selectorsFn.push({value:e,label:e.split(".").pop(),priority:0})}),_.each(t.pageModels,function(t){n.eachNode(t.properties,function(t){var n=t.control;if("object"==typeof n){if(n.fn&&!e.codeRegex.test(n.fn)){var o=n.fn.split(".").pop();r.update(r.controlsFn,n.fn,o)}n=n.control}if(r.update(r.controls,n,n,!0),"object"==typeof t.selector&&t.selector.fn&&!e.codeRegex.test(t.selector.fn)){var i=t.selector.fn.split(".").pop();r.update(r.selectorsFn,t.selector.fn,i)}})}),r.sort(r.controls),r.sort(r.controlsFn),r.sort(r.selectorsFn)}]),angular.module("webexplorer").service("versionsService",["$rootScope","apiService",function(e,t){this.resolveMerge=function(e){return t.versions.resolveMerge({acceptTheirs:e}).then(function(e){return e})}}]),angular.module("webexplorer").service("xBatchRequest",["$rootScope","$q","jsonrpc","$injector","commonDialogs",function(e,t,n,r,o){let i=()=>(a=!1,s=0,n.batch()),s=0,a=!1,l=i();this.add=((t,n,i)=>{a=i,s++;var c=r.get("explorerService");return l.add(t.$method,c.$prepareParams(n,t.$namespace)).then(n=>(e.$broadcast(e.EVENT_API_SUCCESS,{name:t.$method,namespace:t.$namespace,isSetter:t.$isSetter}),n)).catch(t=>{console.error(t),e.hideLoading(),o.error(t.name,t.message)})}),this.send=(()=>s?l.send().then(()=>{let e=a;return l=i(),e}).catch(e=>t.reject(e)):t.resolve()),this.count=(()=>s),this.clear=(()=>l=i())}]),angular.module("webexplorer").service("xDataService",function(){let e=this;e.flattenSelects=function(t){_.each(t,(n,r)=>{if(!(n.hasOwnProperty("options")&&n.hasOwnProperty("selected")&&n.options.length))return _.isArray(n)||_.isObject(n)?e.flattenSelects(n):null;let o=null===n.selected,i=_.isObject(n.selected),s=_.isArray(n.selected);if(o)t[r]=null;else if(i)t[r]=n.selected.value;else if(s){t[r]=[];for(let e of n.selected)t[r].push(e.value)}})}}),angular.module("webexplorer").service("xSettingsService",["$rootScope","explorerService","resizerService","devtoolsMethods","ratioService",function(e,t,n,r,o){const i=this;i.config={startURL:"about: blank",height:768,width:1024},i.getConfig=function(){t.applications.getConfig().then(t=>{e.app=t.app,i.config.startURL=t.startURL.value,n.autoResize=t.autoResize.value,r.authWhitelistUrls=t.authWhitelistUrls&&t.authWhitelistUrls.value,angular.extend(o.config,t.viewportSize.value)})}}]),angular.module("webexplorer").service("xMockService",["xBatchRequest","explorerService","helperService",function(e,t,n){var r=this;this.cache={},r.fetch=function(){return t.mocks.getMockSets().then(function(e){return r.cache=e||{}})},r.createDataSet=function(r,o){var i={id:n.filterName(r),data:"{}"};return this.cache[o].push(i),e.add(t.mocks.createDataSet,{name:r,screenModelId:o}),i},r.updateData=function(n,r,o){var i=_.findWhere(this.cache[r],{id:o});return e.add(t.mocks.updateData,{data:n,screenModelId:r,name:o}),i}}]),angular.module("webexplorer").service("xScreenModelService",["$q","explorerService","modelTreeService","xBatchRequest","xSharedModelService","pageModelService",function(e,t,n,r,o,i){var s=this;s.cache={},s.fetch=function(){var r=e.defer();return t.screenModels.get().then(function(e){e=e||[],s.cache=e,n.process(e),r.resolve(e)},r.reject),r.promise},s.findById=function(e){return s.cache[e]},s.copyPageModelObj=function(e){var a=angular.copy(e),l=e.id;a.sourcePath=l;var c=l.split(".").pop();a.id=c,a.path="",s.cache[c]=a,n.eachNode(a.properties,function(e,t){if("identifier"===e.type)return delete t[e.name];if("descriptor"===e.type){var n=i.cache[e.id];o.copyPageModelObj(n)}_.each(["control","selector","selectorAll","frameSelector","frameSelectorAlt","descriptor","expanded","selectIndex","get_selectorAll","get_control","set_selector","set_control","fn","path","root","parent"],function(t){delete e[t]})});var d=angular.copy(a);return delete d.root,delete d.parent,r.add(t.screenModels.copyPageModelObj,d),n.process(s.cache),a},s.copyPmToExistingSm=function(e,o){e.sourcePath=o.id;var i=angular.copy(o);Object.assign(e.properties,i.properties),n.eachNode(e.properties,function(e,t){if("identifier"===e.type)return delete t[e.name];_.each(["control","selector","selectorAll","frameSelector","frameSelectorAlt","descriptor","expanded","selectIndex","get_selectorAll","get_control","set_selector","set_control","fn","path","root","parent","id","name"],function(t){delete e[t]})});var a=angular.copy(e);return delete a.root,delete a.parent,r.add(t.screenModels.copyPmToExistingSm,a),n.process(s.cache),e},s.editProperty=((t,r)=>dialogService.dataEntry(n.TYPE_SCREEN_MODEL,t.parent,t).then(n=>(n.isArray=n.type.indexOf("[]")>-1,n.type=n.type.replace("[]",""),dataService.updateProp(t,n),dataService.processScreenModelProperties(r,r.properties,r.dataMap),batchRequest.add(apiService.screenModels.updateProp,{modelId:r.id,type:n.type,format:n.format,isArray:n.isArray,name:n.newName,oldName:n.name,path:t.parent===r?null:t.parent.id},!0),e.resolve()))),s.deleteModel=function(e){r.add(t.screenModels.deleteModel,{screenModelId:e.id}),delete s.cache[e.id]},s.addChildNode=function(e,o){var i=n.addProp(e,{type:"object",newName:o}),s={modelId:e.root.id,name:i.name,path:e.path,type:"object"};r.add(t.screenModels.addProp,s)}}]),angular.module("webexplorer").service("xSharedModelService",["$q","explorerService","modelTreeService","xBatchRequest",function(e,t,n,r){var o=this;o.cache={},o.fetch=function(){var r=e.defer();return t.sharedModels.get().then(function(e){e=e||[],o.cache=e,n.process(e),r.resolve(e)},r.reject),r.promise},o.copyPageModelObj=function(e,i,s){var a=angular.copy(e),l=[];return n.eachNode([a],function(e,t,n){if(_.each(["control","selector","selectorAll","frameSelector","frameSelectorAlt","expanded","connect","selectIndex","get_selectorAll","get_control","set_selector","set_control","fn","path","root","parent"],function(t){delete e[t]}),"descriptor"===e.type||e===a){if("identifier"===e.type)return delete t[e.name];if(n){var r=e.id.split(".");delete n.properties[r.pop()]}if("descriptor"===e.type){if(e.type="object",i.hasOwnProperty(e.descriptor))return;if(s.hasOwnProperty(e.descriptor))return;var c=e.id.split(".");e.descriptorId=e.id,e.id=c.pop()}e.sourcePath=e.descriptorId||e.id,o.cache[e.id]=e,l.push(e)}}),r.add(t.sharedModels.copyPageModelObj,{result:angular.copy(l)}),n.process(o.cache),l},o.qEditProperty=function(e,o,i){n.updateProp(o,i),r.add(t.sharedModels.updateProp,{modelId:e.id,type:i.type,format:i.format,isArray:i.isArray,name:i.newName,oldName:i.name,path:o.parent.path},!0)},o.copyPmToExistingSm=function(e,i){e.sourcePath=i.id;var s=angular.copy(i);Object.assign(e.properties,s.properties),n.eachNode(e.properties,function(e,t){if("identifier"===e.type)return delete t[e.name];_.each(["control","selector","selectorAll","frameSelector","frameSelectorAlt","descriptor","expanded","selectIndex","get_selectorAll","get_control","set_selector","set_control","fn","path","root","parent","id","name"],function(t){delete e[t]})});var a=angular.copy(e);return delete a.root,delete a.parent,r.add(t.sharedModels.copyPmToExistingSm,a),n.process(o.cache),e},o.deleteModel=function(e){r.add(t.sharedModels.deleteModel,{sharedModelId:e.id}),delete o.cache[e.id]},o.addChildNode=function(e,o){var i=n.addProp(e,{type:"object",newName:o}),s={modelId:e.root.id,name:i.name,path:e.path,type:"object"};r.add(t.sharedModels.addProp,s)}}]),angular.module("webexplorer").service("xScreenService",["$q","xBatchRequest","explorerService","xScreenTreeService","pageModelService","xScreenModelService","helperService",function(e,t,n,r,o,i,s){var a=this;this.screensTree={},a.fetch=function(){var t=e.defer();return r.fetch().then(function(e){r.eachScreen(function(e,t){a.processScreen(e)}),a.screensTree=e,t.resolve(e)},t.reject),t.promise},a.connectPageModel=function(e,t){},a.processScreen=function(e){},a.createScreen=function(e,r){var o={id:s.filterName(e),name:e},i=screenTreeService.getCachedTree();i.screens.push(o),screenTreeService.processNode(o,i.screens,i),r?a.connectPageModel(o,r):a.processScreen(o),t.add(n.screens.createScreen,{name:e,pageModelId:r?r.id:null})}}]),angular.module("webexplorer").service("xScreenTreeService",["$q","$rootScope","explorerService",function(e,t,n){var r=this,o=null;r.fetch=function(e){return n.screens.getTree(e).then(function(e){return o=e,r.eachNode(r.processNode),o})},r.getCachedTree=function(){return o},r.eachScreen=function(e){r.eachNode(function(t,n,r){t.folder||e(t,n,r)})},r.eachChildScreen=function(e,t){r.eachScreen(function(n,r,o){0===n.id.indexOf(e.id)&&t(n,r,o)})},r.eachNode=function(e,t,n){t=t||o.screens,n=n||o,_.each(t,o=>{e(o,t,n),o.screens&&r.eachNode(e,o.screens,o)})},r.findById=function(e){for(var t=e.split("_"),n=t.shift(),r=_.findWhere(o.screens,{id:n});t.length;){if(!r)return!1;n+="_"+t.shift(),r=_.findWhere(r.screens,{id:n})}return r},r.exists=function(e){return!!r.findById(e)},r.processNode=function(e,t,n){e.parent=n,e.siblings=t}}]),angular.module("webexplorer").service("connectionService",["commonHelperService","explorerService","modelTreeService","pageModelService","pageService","xBatchRequest","powwowService",function(e,t,n,r,o,i,s){function a(e,t){return t||(t={match:[]},e.connect.push(t)),t}function l(e){e.connect.length>1||n.eachNode(e.properties,function(t){if("identifier"===t.type){var n=c.getMatchId(t,e);e.connect[0].match.push(n)}})}var c=this;this.cache={events:[]},c.fetchEvents=function(e){return Object.hasOwnProperty.call(r.events,e.pageModelId)?(c.cache.events=r.events[e.pageModelId],Promise.resolve()):t.events.getEventTypes(e).then(function(t){t&&(c.cache.events=t,r.events[e.pageModelId]=t)})},c.getEvent=function(e){return _.find(c.cache.events,function(t){return t.event===e})},c.addEvent=function(e){this.cache.events.push(e)},c.deleteEvent=function(e){var t=_.findIndex(c.cache.events,function(t){return t.event===e});this.cache.events.splice(t,1)},c.toggleMatch=function(e,n){var r=e.match.indexOf(n);~r?e.match.splice(r,1):e.match.push(n);var o={pageModelId:e.pageModel.id,connectionIndex:e.id,match:e.match};c.injectAndBatch(t.connections.updateMatch,o)},c.updateModel=function(e,n){n?e.model=n:delete e.model;var r={pageModelId:e.pageModel.id,connectionIndex:e.id,model:n};i.add(t.connections.updateModel,r)},c.getMatchId=function(e,t){var r=e.path;return e.root.id!==t.id&&n.eachNode(t.properties,function(t,n,o){t===e&&(r=o.path+"."+r)}),r},c.reorder=function(e,n,r,o){var i=e.connect,s=r.id>n?r.id-1:r.id;if(s!==n){"after"===o&&s++,i.splice(s,0,i.splice(n,1)[0]),_.each(i,function(e,t){e.id=t,e.expanded=!0});var a={pageModelId:e.id,oldIndex:n,newIndex:s};c.injectAndBatch(t.connections.reorder,a)}},c.connectScreens=function(e,n,o,i){(o=a(e,o)).event=i,r.processConnection(e),l(e);var s={screens:n,event:i,match:o.match,connectionIndex:o.id,pageModelId:e.id};c.injectAndBatch(t.connections.connectScreens,s)},c.connectAction=function(e,n,o,i){(o=a(e,o)).event=i,r.processConnection(e),l(e);var s={action:n,event:i,match:o.match,connectionIndex:o.id,pageModelId:e.id};c.injectAndBatch(t.connections.connectAction,s)},c.connectEvent=function(e,n,o){(o=a(e,o)).event=n,r.processConnection(e),l(e);var i={event:o.event,match:o.match,connectionIndex:o.id,pageModelId:e.id};c.injectAndBatch(t.connections.connectEvent,i)},c.delete=function(e){c.deleteEvent(e.event);var n=e.pageModel.connect;n.splice(e.id,1),_.each(n,function(e,t){e.id=t});var r={pageModelId:e.pageModel.id,connectionIndex:e.id};c.injectAndBatch(t.connections.delete,r)},c.injectAndBatch=function(e,t){let n=r.getDescriptorToInject(r.selected.pageModel,!0);s.injectAndBatch(n,e,t).then(()=>{o.getMatchedConnections()})},c.reorderScreens=function(e,n,r,o){var s=e.screens,a=_.pluck(s,"id"),l=a.indexOf(n),c=a.indexOf(r.id),d=c>l?c-1:c;"after"===o&&d++,i.add(t.connections.reorderScreens,{pageModelId:e.pageModel.id,connectionIndex:e.id,oldIndex:l,newIndex:d}),s.splice(d,0,s.splice(l,1)[0])},c.validateName=function(t,n){let r=e.filterName(n),o=!!r&&n===r,i=_.pluck(t,"event").indexOf(r)<0;return o&&i}}]),angular.module("webexplorer").service("pageModelService",["$rootScope","$q","explorerService","xBatchRequest","helperService","modelTreeService","config","commonDialogs","commonHelperService","pageService","powwowService",function(e,t,n,r,o,i,s,a,l,c,d){function u(e,t){if(angular.isArray(e))e.forEach(function(e){delete e.expanded,delete e.getChildren,delete e.id,delete e.parent,delete e.root,e.connect&&e.connect.forEach(function(e){delete e.pageModel,e.screens&&e.screens.forEach(function(e){delete e.connection})}),e.properties&&u(e.properties)});else if(t)delete e.expanded,delete e.getChildren,delete e.id,delete e.parent,delete e.root,e.connect&&e.connect.forEach(function(e){delete e.pageModel,e.screens&&e.screens.forEach(function(e){delete e.connection})}),e.properties&&u(e.properties);else if("object"==typeof e)for(var n in e)delete e[n].expanded,delete e[n].getChildren,delete e[n].id,delete e[n].parent,delete e[n].root,e[n].items&&u(e[n].items.properties),e.hasOwnProperty(n)&&e[n].properties&&u(e[n].properties)}const p=this;p.cache=[],p.events={},p.selected={pageModel:{},field:{},connection:null},p.fetch=function(){return n.pageModels.get().then(e=>{let t=e||[];return p.cache=t,p.selected.pageModel=p.cache[0]||{},p.process(t),t})},p.process=function(e){i.process(e),i.eachNode(e,p.processModel)},p.processModel=function(e){if("descriptor"===e.type){let t=p.findById(e.descriptor);e.circular=!1,i.eachNode(t.getChildren(),t=>{t.parentModel===e.root.id&&(e.circular=!0)}),e.circular||(_.extend(e,_.pick(t,"properties","items")),i.eachNode([t],function(t){t.parentModel=e.descriptor}))}else"action"===e.type?e.invoke=function(t){let n=p.getPathWithIndices(e,t);c.action(e.root.id,n)}:e.connect&&p.processConnection(e)},p.processConnection=function(e){_.each(e.connect,function(t,n){if(t.id=n,t.pageModel=e,t.screens&&_.isString(t.screens[0])){t.expanded=!0;var r=[];_.each(t.screens,function(e){r.push({id:e,name:e,connection:t})}),t.screens=r}})},p.findById=function(e){return _.findWhere(p.cache,{id:e})},p.add=function(e){var t=o.toLowerCase(e),r=n.pageModels.create,i={id:t};d.injectAndBatch("",r,i);var s={id:t,type:"object",properties:{},connect:[]};return p.cache.push(s),p.process(p.cache),s},p.rename=function(e,t){var r=o.toLowerCase(t),i=n.pageModels.rename,s={id:r,oldId:e.id},a=p.getRemoveScript(e);return e.id=r,a+=p.getDescriptorToInject(e,!0),d.injectAndBatch(a,i,s),p.process(p.cache),p.events[r]=p.events[s.oldId],delete p.events[s.oldId],r},p.delete=function(e){var t=p.getRemoveScript(e),r=n.pageModels.delete,o={id:e.id};d.injectAndBatch(t,r,o);var i=p.cache.indexOf(e);p.cache.splice(i,1),delete p.events[e.id]},p.reorder=function(e,t,r){var o=_.pluck(p.cache,"id"),i=o.indexOf(e),s=o.indexOf(t.id),a=s>i?s-1:s;if(a===i)return;"after"===r&&a++,p.cache.splice(a,0,p.cache.splice(i,1)[0]);let l=p.getAllDescriptorsToInject();d.injectAndBatch(l,n.pageModels.reorder,{oldIndex:i,newIndex:a})},p.validateName=function(e){let t=l.filterName(e),n=!!t&&e===t,r=_.pluck(p.cache,"name").indexOf(t)<0;return n&&r},p.addProperty=function(t,r,o,s,a){var l=function(e,t){var n=t||"string";return~["action","action.button","action.link"].indexOf(e)?n="action":~["select","radio","checkbox"].indexOf(e)?n="select":"exists"===e&&(n="boolean"),n}(s,a),c=p.getDescriptorIdAndPath(t);if(c){let e=c[0],n=c[1],r=p.findById(e);t=i.findByPath(r,n)}var u=t.getChildren(),f={type:l};o&&(f.selector=o),s&&(f.control=s),i.processNode(f,r,t.root,t),p.processModel(f),p.updatePropertyType(f,l),u[f.name]=f;var h=p.getDescriptorToInject(p.selected.pageModel,!0),m=n.tree.createNode,g={pageModelId:f.descriptor||f.root.id,path:f.path,name:f.name,selector:f.selector,control:f.control,type:f.type,descriptor:f.descriptor};return d.injectAndBatch(h,m,g),e.$broadcast(e.EVENT_PAGE_MODEL_UPDATED,f.root.id),f},p.deleteProperty=function(t){delete t.parent.getChildren()[t.name];var r=p.getDescriptorToInject(p.selected.pageModel,!0),o=n.tree.deleteNode,i={pageModelId:t.root.id,path:t.path,name:t.name};d.injectAndBatch(r,o,i),e.$broadcast(e.EVENT_PAGE_MODEL_UPDATED,t.root.id)},p.updatePropertyType=function(e,t,n){var r=e;"array"===e.type&&(r=e.items),r.type=t,"object"===r.type?(delete r.control,r.properties=r.properties||{}):delete r.properties,"method"===r.type?r.parameters=r.parameters||{}:delete r.parameters,~["date","time"].indexOf(e.type)?e.format=n:delete e.format},p.updatePropertyArrayType=function(e,t){t&&"array"!==e.type?(_.isObject(e.selector)?e.selectorAll={selectorAll:e.selector.selector||e.selector.selectorAll,fn:e.selector.fn}:e.selectorAll=e.selector,delete e.selector,e.items={type:e.type},"object"===e.type?(e.items.properties=e.properties,delete e.properties):(e.items.control=e.control,e.items.format=e.format),delete e.control,delete e.selectIndex,delete e.selectContains,e.type="array"):t||"array"!==e.type||(_.isObject(e.selectorAll)?e.selector={selector:e.selectorAll.selectorAll||e.selectorAll.selector,fn:e.selectorAll.fn}:e.selector=e.selectorAll,delete e.selectorAll,e.type=e.items.type,"object"===e.type?e.properties=e.items.properties:(e.control=e.items.control,e.format=e.items.format),delete e.items)},p.updatePropertyPath=function(e){let t=e.id.split(".");t.shift(),t=t.join("."),e.path=t},p.updateProperty=function(t,r){var o=t.parent.getChildren();if("descriptor"===r.type)p.updatePropertyArrayType(t,!1),t.type="descriptor",t.descriptor=r.descriptor,p.process(p.cache);else{delete t.descriptor;var i=r.type.replace("[]",""),s=r.isArray||~r.type.indexOf("[]");p.updatePropertyType(t,i,r.format),p.updatePropertyArrayType(t,s)}if(r.name!==r.newName){t.name=r.newName;let e=r.name.split(" ").join(),n=r.newName.split(" ").join();t.id=t.parent.id+"."+n,o[n]=o[e],p.updatePropertyPath(t),delete o[e]}p.processModel(t);var a=p.getAllDescriptorsToInject(),l=n.tree.updateNode,c={pageModelId:t.root.id,path:t.path,name:r.name,newName:r.newName,type:"descriptor"===r.type?r.type:t.type,"items.type":"array"===t.type?t.items.type:null,format:r.format,descriptor:t.descriptor};d.injectAndBatch(a,l,c),e.$broadcast(e.EVENT_PAGE_MODEL_UPDATED,t.root.id)},p.getAllUnprocessedModels=function(){var e=angular.copy(p.cache);return u(e),e},p.getUnprocessedModel=function(e,t){var n=angular.copy(e);return u(n,t),n},p.getAllDescriptorsToInject=function(){let e=p.getAllUnprocessedModels();e=JSON.stringify(e);let t=`var pageModels = JSON.parse('${e=jsesc(e)}');\n`;return t+=f+"\n",t+="injectDescriptorFunc(pageModels);"},p.getDescriptorToInject=function(e,t){let n=p.getUnprocessedModel(e,t);n=JSON.stringify(n);let r=`var pageModel = JSON.parse('${n=jsesc(n)}');\n`;return r+=f+"\n",r+="injectDescriptorFunc(pageModel)"},p.getRemoveScript=function(e){return"delete window.powwow.models['"+e.name+"'];\n"},p.getDescriptorIdAndPath=function(e){for(var t=[],n=e;n.parent;){if(n.descriptor)return[n.descriptor,t.join(".")];t.unshift(n.id.split(".").pop()),n=n.parent}return!1},p.updateComplexAttribute=function(e,t,n){if("array"===e.type&&("selector"===t?t+="All":e=e.items),n&&!_.isObject(e[t])){var r=e[t];e[t]={fn:""},e[t][t]=r}else!n&&_.isObject(e[t])&&(e[t]=e[t][t])},p.getPathWithIndices=function(e,t){let n=[];for(;e.parent;){let r="array"===e.type?`[${t.pop()}]`:"";n.unshift(e.name+r),e=e.parent}return n.join(".")};var f="var injectDescriptorFunc = function (param) {if (Array.isArray(param)) {param.forEach(function(pageModel) {window.powwow.models[pageModel.name] = pageModel;});} else {window.powwow.models[param.name] = param;}}"}]),angular.module("webexplorer").service("explorationService",["explorerService",function(e){const t=this;t.cache=[],t.fetch=function(){return e.applications.getList().then(e=>(t.cache=e,e))}}]),angular.module("webexplorer").service("global",["$rootScope","explorerWsService","explorerService","devtoolsMethods","pageModelService","injectableService","xMockService","xScreenModelService","xSharedModelService","xScreenService","allFilesService","xSettingsService","explorationService",function(e,t,n,r,o,i,s,a,l,c,d,u,p){var f=this;e.global=f,f.$fetch=function(h,m){t.init().then(function(){return n.sessions.create()}).then(function(e){return r.initDevTools(e)}).then(function(){return Promise.all([o.fetch(),i.getInjectFiles(),i.getInjectScripts()])}).then(function(){return u.getConfig()}).then(function(){return p.fetch()}).then(function(){return s.fetch()}).then(function(){return a.fetch()}).then(function(){return l.fetch()}).then(function(){return c.fetch()}).then(function(){f.screenModels=a.cache,f.sharedModels=l.cache,f.screens=c.screensTree.screens,d.resetCache(),e.$broadcast(e.EVENT_APP_OPENED),h()}).catch(function(e){m(e)})}}]),angular.module("webexplorer").service("devtoolsMethods",["$q","elementsService","screencastService",function(e,t,n){function r(e,t){t=t||window.location.href,e=e.replace(/[\[\]]/g,"\\$&");let n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}const o=this;o.main=null,o.authWhitelistUrls="",o.setExplorerData=function(e){window.explorerData={websocketDebuggerUrlId:e.id,commitHash:e.commitHash,version:e.version}},window.getWSUrl=function(){let e=window.location.hostname,t=window.location.protocol,n=r("serverPort");return n||(n=window.location.port||("http:"===t?80:443)),`${e}:${n}/devtools/page/?id=${window.explorerData.websocketDebuggerUrlId}&ver=${window.explorerData.version}&token=${localStorage.getItem("accessToken")}`},window.getRequestInterceptionUrls=function(){return o.authWhitelistUrls},o.instantiateMain=function(){let e=setInterval(()=>{document.querySelector("[ui-view='topPane']")&&(clearInterval(e),window.runtimeInit(),o.main=new Main.Main)},100)},o.initDevTools=function(t){let n=e.defer();if(this.setExplorerData(t),localStorage.removeItem("panel-selectedTab"),"development"===r("env",window.location.href)){let e=document.createElement("script");e.src="/bower_components/devtools/front_end/Runtime.js",e.onload=function(){window.Runtime.startApplication("inspector").then(n.resolve).catch(console.log)},document.getElementsByTagName("head")[0].appendChild(e)}else n.resolve();return o.instantiateMain(),n.promise},o.reinitDevTools=function(e,r){window.explorerData.websocketDebuggerUrlId=e,r&&(window.explorerData.version=r),o.main._reinitializeTarget(),t.rebindDOM(),n.cleanCanvas()}}]),angular.module("webexplorer").service("elementsService",["$window","$q",function(e,t){let n,r,o;this.rebindDOM=function(){n=e.Elements.ElementsPanel.instance(),r=n._treeOutlines[0],(o=r.domModel())._document=null,o.requestDocument(()=>{o=r.domModel()})},this.collectAttributes=function(e){return r._collectAttributes(e)},this.selectDOMNode=function(e,r){return t((t,i)=>{if(!n)return i("Elements Panel not instantiated");let s;return(s=r?n.selectedDOMNode().parentNode:o.nodeForId(e[0].nodeId))?(n.selectDOMNode(s),t({nodeId:s.id})):i("Not able to select node.")})},window.document.addEventListener("ELEMENTS_PANEL_CONSTRUCTED",this.rebindDOM)}]),angular.module("webexplorer").service("screencastService",["$q","$compile","canvasService","resizerService",function(e,t,n,r){var o,i;window.document.addEventListener("SCREENCAST_APP_CONSTRUCTED",function(e){o=window.Screencast.ScreencastApp._instance(),i=o._screencastView,o._rootSplitWidget.hideSidebar()}),this.cleanCanvas=function(){n.removeRect(),r.updateViewport()},this.getCanvas=function(){return i._canvasElement},this.closeDevtools=function(){return e(function(e,t){o._rootSplitWidget.hideSidebar(),e()})},this.openDevtools=function(){return e(function(e,t){o._rootSplitWidget.showBoth(),e()})}}]),angular.module("webexplorer").service("powwowService",["$q","protocolService","xBatchRequest",function(e,t,n){let r=this;r.evaluate=function(n){"string"==typeof n&&(n={expression:n});let r=e.defer();return t.Runtime.evaluate(n).then(e=>{1!==e.length&&console.error("Unexpected response object from protocolService.Runtime.evaluate",e),(e=e[0]).exceptionDetails||e.result&&"error"===e.result.subtype?(console.error("Exception in running expression:",n,e),r.reject(e)):r.resolve(e)}).catch(e=>{console.error("Runtime evaluate failed:",e),r.reject(e)}),r.promise},r.checkState=function(){return r.evaluate({expression:"powwow.checkStateUsingDescriptor(true)",awaitPromise:!0,returnByValue:!0})},r.update=function(e,t){let n=`powwow.getDescriptor(powwow.models, '${e}')`,o=`JSON.parse('${jsesc(JSON.stringify(t))}')`;return r.evaluate({expression:`powwow.update(${n}, ${o}, powwow.getCurrentWindow().document)`,awaitPromise:!0,returnByValue:!0})},r.extract=function(e){let t=`powwow.getDescriptor(powwow.models, '${e}')`;return r.evaluate({expression:`powwow.extract(${t}, powwow.getCurrentWindow().document)`,awaitPromise:!0,returnByValue:!0})},r.action=function(e,t){let n=`powwow.getDescriptor(powwow.models, '${e}')`,o=`'${t}'`;return r.evaluate({expression:`powwow.action(${n}, ${o}, powwow.getCurrentWindow().document)`,awaitPromise:!0,returnByValue:!0})},r.getSelectorCount=function(e,t){if(!e)return Promise.resolve({result:{value:0}});let n=`{frameSelector: [${(t=t.filter(e=>e&&e.length)||[]).map(e=>`"${jsesc(e)}"`).join(", ")}]}`,o=`'${jsesc(e)}'`;return r.evaluate({expression:`powwow.findNodeBySelector(${n}, powwow.getCurrentWindow().document).querySelectorAll(${o}).length;`,awaitPromise:!0,returnByValue:!0})},r.injectAndBatch=function(e,t,o){return n.add(t,o),r.evaluate({expression:e})}}]),angular.module("webexplorer").service("resizerService",["ratioService","protocolService",function(e,t){var n=this;this.autoResize,this.updateViewport=function(r,o){var i=document.querySelector("#domInspector").shadowRoot;if(n.autoResize&&i){var s=i.querySelector(".root-view:nth-last-child(1)").querySelector(".screencast");r&&((s=document.querySelector("#north")).style.height="100%"),o&&(s.style.height=o);var a=s.getBoundingClientRect(),l=a.width,c=a.height,d=window.innerWidth/window.outerWidth,u=parseInt(l/d)-1,p=parseInt(c/d)-39,f={width:u,height:p,deviceScaleFactor:0,mobile:!1};e.config.width=u,e.config.height=p,t.Emulation.setDeviceMetricsOverride(f)}}}]),angular.module("webexplorer").service("protocolService",["$window","ratioService",function(e,t){var n,r=this;this.lastGoodOrigin=null,this.scrollOffsetX=null,this.scrollOffsetY=null,e.document.addEventListener("MAIN_LOADED",function(){n=window.Main});_.each({DOM:["getNodeForLocation","getBoxModel","setAttributeValue","removeAttribute"],Emulation:["setDeviceMetricsOverride","setVisibleSize"],Input:["dispatchMouseEvent"],Page:["handleJavaScriptDialog"],Runtime:["evaluate"],Network:["continueInterceptedRequest","setRequestInterceptionEnabled"],Security:["handleCertificateError"]},function(e,t){r[t]={},_.each(e,function(e){var o=t+"."+e;r[t][e]=function(e){return n.sendOverProtocol(o,e).catch(function(e){return console.error(o,e),Promise.reject(e)})}})})}]),angular.module("webexplorer").run(["$window","domEventCallbacks","pageEventCallbacks","runtimeEventCallbacks","targetEventCallbacks","networkEventCallbacks","securityEventCallbacks",function(e,t,n,r,o,i,s){var a={DOM:t,Page:n,Runtime:r,Target:o,Network:i,Security:s};_.each({DOM:["attributeModified","childNodeCountUpdated","childNodeInserted","childNodeRemoved","documentUpdated"],Page:["frameNavigated","frameStoppedLoading","javascriptDialogOpening","screencastFrame"],Runtime:["executionContextCreated","executionContextDestroyed","executionContextsCleared"],Target:["targetCreated","targetInfoChanged"],Network:["requestIntercepted"],Security:["certificateError"]},function(t,n){_.each(t,function(t){var r="EXPLORER_"+n+"."+t,o=a[n][t];e.document.addEventListener(r,e=>o(e.detail.params))})})}]),angular.module("webexplorer").service("domEventCallbacks",["elementsService","pageService","tabService",function(e,t,n){this.attributeModified=function(){t.getMatchedConnections()},this.childNodeInserted=function(r){"iframe"===r.node.localname&&(e.rebindDOM(),n.getTabs().then(n.updateTabs)),t.getMatchedConnections()},this.childNodeCountUpdated=function(){t.getMatchedConnections()},this.childNodeRemoved=function(){t.getMatchedConnections()},this.documentUpdated=function(){e.rebindDOM(),n.getTabs().then(n.updateTabs)}}]),angular.module("webexplorer").service("pageEventCallbacks",["$rootScope","elementsService","pageService","protocolService","tabService",function(e,t,n,r,o){this.frameStoppedLoading=function(){t.rebindDOM(),o.getTabs().then(o.updateTabs),n.getMatchedConnections()},this.frameNavigated=function(e){var t=e.frame,n=t.id,o=t.securityOrigin,i=t.mimeType;"1"===n.split(".")[1]&&"text/html"===i&&(r.lastGoodOrigin=o)},this.javascriptDialogOpening=function(t){e.$emit(e.EVENT_DIALOG_REQUESTED,"javascript-dialog",{data:t},{closeByEscape:!1,closeByDocument:!1})},this.screencastFrame=function(e){var t=e.metadata;r.scrollOffsetX=t.scrollOffsetX,r.scrollOffsetY=t.scrollOffsetY}}]),angular.module("webexplorer").service("runtimeEventCallbacks",["injectableService","pageModelService","pageService","powwowService",function(e,t,n,r){function o(o){delete i[o],i[o]=setTimeout(function(){r.evaluate({contextId:o,expression:"window === window.top"}).then(function(i){i.result&&!0===i.result.value&&function(e){return r.evaluate({contextId:e,expression:"window.powwow = window.powwow || {};"})}(o).then(()=>(function(t){let n=e.getPowwowScript();return r.evaluate({contextId:t,expression:n})})(o)).then(()=>(function(e){let n=t.getAllDescriptorsToInject();return r.evaluate({contextId:e,expression:n})})(o)).then(()=>(function(t){return r.evaluate({contextId:t,expression:e.getInjectString()})})(o)).then(()=>{n.getMatchedConnections(),window.document.dispatchEvent(new CustomEvent("POWWOW_INJECTED"))}).catch(()=>{console.log("Failed to initialize ExecutionContext")})}).catch(function(e){console.log("Failed window === window.top",e)})},0)}var i={};this.executionContextCreated=function(e){o(e.context.id)},this.executionContextDestroyed=function(e){i&&i[e.executionContextId]&&(clearTimeout(i[e.executionContextId]),delete i[e.executionContextId])},this.executionContextsCleared=function(e){if(i){let e=Object.keys(i);for(let t of e)clearTimeout(i[t]),delete i[t]}i={}}}]),angular.module("webexplorer").service("targetEventCallbacks",["devtoolsMethods","screencastService","tabService",function(e,t,n){this.targetCreated=function(t){var r=t.targetInfo;"page"===r.type&&n.getTabs().then(function(t){0===n.tabs.length?n.createTabs(t):n.tabs.length<t.length?(n.createTab(r),e.reinitDevTools(r.targetId)):n.updateTabs(t)})},this.targetInfoChanged=function(e){t.cleanCanvas()}}]),angular.module("webexplorer").service("networkEventCallbacks",["$rootScope","protocolService",function(e,t){this.requestIntercepted=function(n){n.authChallenge?(console.log("Request Intercepted",n),e.$emit(e.EVENT_DIALOG_REQUESTED,"authenticate-dialog",{data:n},{closeByEscape:!1,closeByDocument:!1})):t.Network.continueInterceptedRequest({interceptionId:n.interceptionId})}}]),angular.module("webexplorer").service("securityEventCallbacks",["$rootScope","protocolService",function(e,t){this.certificateError=function(e){t.Security.handleCertificateError({eventId:e.eventId,action:"continue"})}}]),angular.module("webexplorer").directive("pageDropdown",["$rootScope","pageModelService",function(e,t){return{restrict:"E",scope:{},templateUrl:"/views/webexplorer/directives/pageDropdown.html",link:function(e,n){e.$on("PAGE_MODEL_UPDATED",function(){e.pageModels=t.cache;_.find(e.pageModels,function(t){return t.id===e.selected.pageModel.id})||(t.selected.pageModel={},t.selected.field={})})},controller:["$scope","$timeout","pageModelService",function(e,t,n){t(()=>{e.pageModels=n.cache,e.selected=n.selected},!0),e.show=!1,e.find=!1,e.search={text:""},e.toggle=function(){e.find=!1,e.show=!e.show},e.onBlur=function(){e.find=!1,e.show=!1},e.create=function(){e.find=!1,e.edit={},t(function(){document.querySelector("page-dropdown form[ng-submit] input").focus()},!0)},e.isValid=function(e){return e&&e.name&&n.validateName(e.name)},e.confirmEditing=function(){var r=n.add(e.edit.name);e.cancel(),n.selected.pageModel=r,n.selected.field=r,e.show=!1,t(function(){e.$digest()},0)},e.cancel=function(){e.edit=null},e.toggleSearch=function(){e.search.text="",e.find=!e.find},e.treeOptions={getIcon:e.getIcon,onClick:function(t){n.selected.pageModel=t,n.selected.field=t,e.show=!1},isSelected:function(t){return e.selected.pageModel===t},isEditable:function(e){return!0},clickAddChild:!1,getChildren:function(){return!1},clickRename:function(t,n){n.stopPropagation(),this.edit.node=t,this.edit.name=t.id,e.$root.$broadcast(e.EVENT_EDIT_PAGE_MODEL)},isValid:function(e){return n.validateName(e.name)},confirmEditing:function(e){e.id,n.rename(e,this.edit.name);this.cancel()},confirmDeleting:function(t){n.delete(t),this.cancel(),t===e.selected.pageModel&&(e.selected.pageModel={},e.selected.field={}),e.onBlur()},isDraggable:function(){return!0},isSortable:function(){return!0},getType:function(){return"page-model"},getDragData:function(e){return{id:e.id,type:"page-model"}},moveNode:function(e,t,r){n.reorder(e,t,r)},hasLeftButton:function(){return!0}},t(function(){var e=document.querySelector('[tree-node="selected.pageModel"] span');document.querySelector('[ui-view="pages"] .header').appendChild(e)},0)}]}}]),angular.module("webexplorer").directive("explorerCanvas",["canvasService","ratioService","protocolService","rectangleService","resizerService","elementsService","screencastService",function(e,t,n,r,o,i,s){return{restrict:"E",scope:{},templateUrl:"/views/webexplorer/directives/explorerCanvas.html",link:function(i,a){e.canvas=a[0].querySelector("#selector-canvas"),e.canvasScope=angular.element(e.canvas).scope(),e.overlay=a[0].querySelector("#overlay"),window.document.addEventListener("SCREENCAST_APP_CONSTRUCTED",function(){e.screencast=s.getCanvas()}),window.document.addEventListener("SCREENCAST_RESIZED",function(i){let s=e.getScreencastWidth(),a=e.getScreencastHeight();if((e.prevWidth!==s||e.prevHeight!==a)&&(e.prevWidth=s,e.prevHeight=a,r.removeRect(),e.canvas.style.width=s+"px",e.canvas.style.height=a+"px",e.canvas.style.left=e.getCanvasOffsetX()+"px",e.canvas.style.top=e.getCanvasOffsetY()+"px",e.overlay.style.width=s+"px",e.overlay.style.height=a+"px",e.overlay.style.left=e.getCanvasOffsetX()+"px",e.overlay.style.top=e.getCanvasOffsetY()+"px",o.autoResize)){let r=e.resizeViewport();t.config.width=r.width,t.config.height=r.height,n.Emulation.setDeviceMetricsOverride({width:r.width,height:r.height,deviceScaleFactor:0,mobile:!1})}}),window.document.addEventListener("DOM_NODE_SELECTED",function(e){e.detail.boxModel().then(function(e){e&&i.drawBoxModel(e)})})},controller:["$scope",function(o){function s(e){return{x:parseInt(e.offsetX*t.getRatioXToChrome()+n.scrollOffsetX),y:parseInt(e.offsetY*t.getRatioYToChrome()+n.scrollOffsetY)}}angular.element(document.querySelector("#overlay")).bind("mousewheel",function(e){let t=s(e);n.Input.dispatchMouseEvent(_.extend(t,{type:"mouseWheel",deltaX:e.originalEvent.deltaX,deltaY:e.originalEvent.deltaY})),r.removeRect()}),o.sendMouseDown=function(e){e.target.style.zIndex="0",e.metaKey||e.ctrlKey?i.selectDOMNode(null,!0).then(n.DOM.getBoxModel).then(o.drawBoxModel).catch(function(e){console.log(e)}):function(e){let t=s(e);n.DOM.getNodeForLocation(t).then(i.selectDOMNode).then(n.DOM.getBoxModel).then(o.drawBoxModel).catch(function(e){console.log(e)})}(e),setTimeout(function(){e.target.style.zIndex="2"},500)},o.drawBoxModel=function(n){let r=n[0]||n,o=function(e){return e.border[0]*=t.getRatioXFromChrome(),e.border[1]*=t.getRatioYFromChrome(),e.width*=t.getRatioXFromChrome(),e.height*=t.getRatioYFromChrome(),e}(r.model||r);e.drawBoxModel(o)}}]}}]),angular.module("webexplorer").directive("rectangle",function(){return{restrict:"E",templateUrl:"/views/webexplorer/directives/rectangle.html"}}),angular.module("studio").component("explorerSelect",{templateUrl:"/views/webexplorer/components/explorerSelect.template.html",transclude:!0,bindings:{options:"<",coordinates:"<"},controller:["$q","$element","protocolService","powwowService","ratioService",function(e,t,n,r,o){let i=this;i.select=function(s){let a={nodeId:s.id,name:"selected",value:"true"};n.DOM.setAttributeValue(a);let l=[];for(let e of i.options)if(e.id!=s.id){let t={nodeId:e.id,name:"selected"};l.push(n.DOM.removeAttribute(t))}e.all(l).then(()=>(function(e){let t=`\n            (function() {\n                let selectX = ${parseInt(e.x*o.getRatioXToChrome()+n.scrollOffsetX)};\n                let selectY = ${parseInt(e.y*o.getRatioYToChrome()+n.scrollOffsetY)};\n                let select = document.elementFromPoint(selectX, selectY);\n                while (select instanceof HTMLIFrameElement) {\n                    let rect = select.getBoundingClientRect();\n                    selectX = selectX - rect.x;\n                    selectY = selectY - rect.y;\n                    select = select.contentWindow.document.elementFromPoint(selectX, selectY);\n                }\n                select.dispatchEvent(new Event('input', {\n                    'bubbles': true,\n                    'cancelable': true\n                }));\n                select.dispatchEvent(new Event('change', {\n                    'bubbles': true,\n                    'cancelable': true\n                }));\n            })();\n        `;return r.evaluate(t)})(i.coordinates)).then(()=>{t.remove()}).catch(e=>{console.log(e),t.remove()})}}]}),angular.module("webexplorer").controller("xSidebarCtrl",["$scope","pageModelService","resizerService","screencastService","xDialogService","xScreenModelService","xSharedModelService","xSyncService","explorerWsService",function(e,t,n,r,o,i,s,a,l){e.pageModels=function(){e.globals.activePane="pageModels"},e.reloadStudio=function(){window.name="Home",setTimeout(()=>{l.ws.close(),window.location.reload()})},e.syncDataModels=function(){o.syncModels()},e.xFiles=function(){e.globals.extractionMode=!1,e.globals.sourceEditorOpened=!1,e.globals.devtoolsOpened=!1,r.closeDevtools(),setTimeout(n.updateViewport,100),e.globals.activePane="xFiles"},e.update=function(){o.updateWebConnector()}}]),angular.module("webexplorer").controller("xHeaderCtrl",["$rootScope","$scope","$stateParams","canvasService","devtoolsMethods","explorerService","xBatchRequest","explorationService","resizerService","tabService","screencastService",function(e,t,n,r,o,i,s,a,l,c,d){t.devtools={restarting:!1},e.app={id:n.appId,explorationId:n.explorerId,explorations:a.cache,isVersioned:e.app.isVersioned},t.openedTabs=c.tabs,t.isSelected=function(e){return window.explorerData.websocketDebuggerUrlId===e.targetId},t.selectTab=function(e){c.selectTab(e,t.isSelected(e)),t.globals.devtoolsOpened&&(t.globals.devtoolsOpened=!1,d.closeDevtools())},t.closeTab=function(e){c.closeTab(e)},t.$on("ui.layout.resize",(e,n,r)=>{let o=n.id?n:r;t.globals.layout[o.id]=o.size}),t.toggleDevtools=function(){t.globals.devtoolsOpened=!t.globals.devtoolsOpened,t.globals.devtoolsOpened?d.openDevtools():(d.closeDevtools(),setTimeout(l.updateViewport,100))},t.toggleExtractionMode=function(){t.globals.extractionMode=!t.globals.extractionMode,t.globals.extractionMode||r.removeRect()},t.restartBrowser=function(){t.devtools.restarting=!0,i.sessions.restart().then(function(e){c.emptyTabs(),o.reinitDevTools(e.id,e.version),t.devtools.restarting=!1})},t.save=function(){console.log("saving"),t.showLoading(),s.send().then(function(){t.hideLoading()})},t.batch=s}]),angular.module("webexplorer").controller("xFilesHeaderCtrl",["$scope","$rootScope","batchRequest","layoutService","allFilesService","canvas","workspaceService",function(e,t,n,r,o,i,s){e.openedFiles=o.getOpenedFiles(),e.selectedFile=o.getSelectedFile(),e.layoutSizes=r.getConfig(),e.$on("ui.layout.resize",(t,n,r)=>{let o=n.id?n:r;e.layoutSizes[o.id]=o.size}),e.$on(e.EVENT_FILE_SELECTED,()=>{console.log("header: On EVENT_FILE_SELECTED"),e.selectedFile=o.getSelectedFile()}),e.$on(e.EVENT_FILE_CLOSED,()=>{console.log("header: On EVENT_FILE_CLOSED"),e.selectedFile=o.getSelectedFile()}),e.closeFile=o.processClosingFileTab,e.selectFile=o.processSelectingFileTab,e.stickFile=o.processStickingFileTab,e.saveAll=function(){e.showLoading(),o.saveAllFiles().then(()=>{e.hideLoading()})}}]),angular.module("webexplorer").controller("xFilesEditorCtrl",["$scope","allFilesService",function(e,t){e.selectedFile=t.getSelectedFile(),e.$on(e.EVENT_FILE_SELECTED,()=>{console.log("editor: On EVENT_FILE_SELECTED"),e.selectedFile=t.getSelectedFile()}),e.$on(e.EVENT_FILE_CLOSED,()=>{console.log("editor: On EVENT_FILE_CLOSED"),e.selectedFile=t.getSelectedFile()})}]),angular.module("webexplorer").controller("CenterPaneCtrl",["$scope","canvasService",function(e,t){e.$on("ui.layout.resize",function(e,t,n){"south"===n.id&&window.document.dispatchEvent(new CustomEvent("BOTTOM_PANE_RESIZE"))})}]),angular.module("webexplorer").controller("TopPaneCtrl",["$scope","$compile","resizerService",function(e,t,n){e.$on("ui.layout.resize",(e,t,r)=>{"north"===t.id&&"south"===r.id&&setTimeout(()=>{n.updateViewport()},!0),"west"===t.id&&setTimeout(()=>{n.updateViewport()},!0)}),window.document.addEventListener("DEVTOOLS_SPLITBAR_DRAG_END",function(e){n.updateViewport()}),window.getSelectData=function(e,t,n){let r=[];if("SELECT"===e._nodeName){for(let t of e._children)"OPTION"===t._nodeName&&r.push({label:t._children[0]._nodeValue,value:t._attributesMap.value.value,id:t.id});let o={options:r,x:t,y:n};window.document.dispatchEvent(new CustomEvent("SELECT_NODE_FOUND",{detail:o}))}else window.document.dispatchEvent(new CustomEvent("NOT_SELECT_NODE"))},window.document.addEventListener("SELECT_NODE_FOUND",function(e){let t=e.detail.options,n=e.detail.x,o=e.detail.y;r(t,n,o)});let r=function(n,r,o){$("explorer-select").remove(),e.options=n,e.coordinates={x:r,y:o};let i=t(`<explorer-select options="options" coordinates="coordinates" style="top: ${o}px; left: ${r}px;"></explorer-select>`)(e)[0];$("#domParent").append(i)};window.document.addEventListener("NOT_SELECT_NODE",function(e){$("explorer-select").remove()})}]),angular.module("webexplorer").controller("xBottomPaneCtrl",["$scope","injectableService","explorerService","resizerService","powwowService",function(e,t,n,r,o){e.hideLoading(),setTimeout(()=>{var e=document.querySelector("#center-layout"),t=(document.querySelector("#north"),e.getBoundingClientRect().height);r.updateViewport(null,t)},100),e.injectables=t.injectables,e.closeSourceEditor=function(){var t=document.querySelector("#south");e.globals.bottomPaneHeight=t.getBoundingClientRect().height,e.globals.sourceEditorOpened=!1;setTimeout(function(){r.updateViewport(!0)},150)},e.selectTab=function(t){e.globals.activeSourceTab=t},e.getClass=function(e){switch(e){default:return"";case"find":return"fa-search";case"extract":return"fa-download";case"controls":return"fa-random"}},e.addFunction=function(t){e.edit={type:t}},e.cancel=function(){e.edit=null},e.isValid=function(n){let r=e.globals.activeSourceTab;return e.edit.name&&t.validateName(e.injectables[r],e.edit.name)},e.confirmEditing=function(){var t=e.edit.type,r="";r="controls"===t?"exports = {\n\thasMultipleNodes: false,\n\tgetterReturnsPromise: false,\n\tget: function(node) {},\n\tset: function(scopedoc, node, value, params) {}\n}":"exports = function(node) {\n}";var s={};s.name=e.edit.name,s.type=e.edit.type,s.src=r,e.injectables[t].push(s),e.selectFunction(s);var a=i(s);o.injectAndBatch(a,n.injectables.update,s),e.cancel()},e.selectFunction=function(t){e.globals.selectedFunction=t||{}},e.amendFile=_.debounce(t=>{try{let r;if(r=t.getModel().getAllDecorations().find(e=>"redsquiggly"===e.options.className))throw r;let s=i(e.globals.selectedFunction);o.injectAndBatch(s,n.injectables.update,e.globals.selectedFunction)}catch(e){console.log("The source function contain errors",e)}},500),e.fileChanged=function(t){t&&t.isFocused()&&t.domElement.getClientRects().length&&setTimeout(e.amendFile.bind(null,t),0)},e.isNotBaseCtrl=function(e){return"controls"!==e.type||t.baseControls.indexOf(e.name)<0},e.isNotEditable=function(){let t=e.globals.selectedFunction;return!e.isNotBaseCtrl(t)};var i=function(e){var n=`${e.src}\n`;return n+=`window.powwow['${e.type}']['${e.name}'] = exports;\n`,n+=t.append(e.type,e.name)},s=function(e){o.evaluate(`delete window.powwow['${e.type}']['${e.name}'];\n`),o.evaluate(`deleted\n${t.append(e.type,e.name)}`)};e.functionOptions={confirmDeleting:function(t){s(t);let r={name:t.name,type:t.type};o.injectAndBatch("",n.injectables.delete,r),function(t){var n=e.injectables[t.type].indexOf(t);e.injectables[t.type].splice(n,1)}(t),t=null,e.globals.selectedFunction={},this.cancel()},confirmEditing:function(e,t){let r={oldName:e.name,name:this.edit.name,type:e.type};s(e),e.name=this.edit.name;let a=i(e);o.injectAndBatch(a,n.injectables.rename,r),this.cancel()},getChildren:function(){return!1},getIcon:function(){return"fa-code"},getLabel:function(e){return e.name},hasAddChild:function(){return!1},hasAsterisk:function(e){},hasDelete:e.isNotBaseCtrl,hasRename:e.isNotBaseCtrl,isEditable:function(){return!0},isSelected:function(t){return e.globals.selectedFunction===t},isValid:function(n){let r=n.node.type;return t.validateName(e.injectables[r],n.name,n.node.name)},isWarned:function(e){},onClick:function(t){e.selectFunction(t)}}}]),angular.module("webexplorer").controller("xLeftPaneCtrl",function(){}),angular.module("webexplorer").controller("PagesCtrl",["$scope","$timeout","$rootScope","pageService","pageModelService","modelTreeService","connectionService","dialogService","xDialogService","elementsService",function(e,t,n,r,o,i,s,a,l,c){function d(e){return!e.selector||_.isObject(e.selector)&&!e.selector.fn&&(!e.selector.selector||!e.selector.selectorAll)}function u(e){return!e.selectorAll||_.isObject(e.selectorAll)&&!e.selectorAll.fn&&(!e.selectorAll.selector||!e.selectorAll.selectorAll)}function p(e){return function(e){return"object"!==e.type&&(!e.items||"object"!==e.items.type)}(e)&&!e.control||_.isObject(e.control)&&!e.control.fn&&!e.control.control}function f(t){return!i.isNodeInArray(t)&&e.previewMode&&["string","number","date","time","boolean","identifier"].includes(t.type)}function h(t){let n=e.previewMode&&t.parent&&"array"===t.type&&"object"===t.items.type&&t.parent.id===e.selected.pageModel.id,r=e.previewMode&&t.parent&&t.parent.id===e.selected.pageModel.id&&"select"===t.type;return n||r}function m(e){return e._attributes.reduce(function(e,t){return e.concat([t.name,t.value])},[e._localName,e.index])}e.togglePreview=function(){e.previewMode=!e.previewMode,e.previewMode&&e.extract()},e.saveData=function(){l.pushMockData(e.preview.data)},e.update=function(){r.update(e.selected.pageModel.id)},e.extract=function(){r.extract(e.selected.pageModel.id)};let g={action:[{title:"Invoke Action",icon:"fa-play",action:function(e){e.invoke()}}],node:[{icon:"fa-pencil",title:"Edit",action:function(t,n){n.stopPropagation(),a.dataEntry(i.TYPE_PAGE_MODEL,t.parent,t,e.pageModels).then(e=>o.updateProperty(t,e))}}]};e.treeOptions={getControls:function(t){return!t.parent||e.selected.connection?(t.expanded=!0,null):e.previewMode?"action"===t.type?g.action:null:g.node},hasDelete:function(t){return!e.previewMode&&t.parent},hasAddChild:function(t){if(!e.previewMode)return"descriptor"===t.type||t===t.root||"object"===t.type||"array"===t.type&&t.items&&"object"===t.items.type||"method"===t.type},isValid:function(e){return i.validateNodeName(e.parentNode.getChildren(),e.name)},isClickable:function(t){return!e.selected.connection||"identifier"===t.type},isSelected:function(t){return e.selected.field===t},isEditable:function(){return!e.selected.connection},isHidden:function(t){return e.selected.connection&&!function(e){let t=!1;return i.eachNode([e],function(e){"identifier"===e.type&&(t=!0)}),t}(t)},onClick:function(t){if(!_.isEmpty(e.selected.field))if(e.selected.connection){let n=s.getMatchId(t,e.selected.pageModel);s.toggleMatch(e.selected.connection,n)}else e.selected.field=t},confirmEditing:function(t){let n=this.edit.name;e.selected.field=o.addProperty(t,n),this.cancel()},confirmDeleting:function(e){o.deleteProperty(e),this.cancel()},isChecked:function(t){let n=s.getMatchId(t,e.selected.pageModel);return e.selected.connection&&~e.selected.connection.match.indexOf(n)},onClickCheckbox:function(e,t){return!1},isWarned:function(e){switch(e.type){case"array":return u(e)&&d(e);case"identifier":return p(e)||!e.control.match(/^url/)&&u(e)&&d(e);case"select":return"radio"===e.control&&u(e)||"select"===e.control&&d(e)}return!["object","descriptor"].includes(e.type)&&(d(e)&&u(e)||p(e))},getAcceptedTypes:function(e){return["rectangle","devtools/attrs"]},getDragEnter:function(e){return function(t){e.id&&(t.style.backgroundColor="#FFFFAA")}},getDragLeave:function(e){return function(e){e.style.backgroundColor=""}},getDragDrop:function(r){return function(o,i){if(!r.id)return;if(o.style.backgroundColor="",e.selected.connection){let t=s.getMatchId(r,e.selected.pageModel);s.toggleMatch(e.selected.connection,t)}else e.selected.field=r;let a=c.collectAttributes(function(e,t){let n={frames:[]},r="array"===e.type,o=e.parent&&"array"===e.parent.type;for("iframe"!==t._localName&&(n.selector=m(t));r&&"table"!==t._localName&&(t=t.parentNode););for(;o&&"td"!==t._localName&&(t=t.parentNode););for(t&&(n.selector=m(t));t&&!o;)"iframe"===t._localName&&n.frames.push(m(t)),t=t.parentNode;return n}.bind(this,r));t(function(){n.$broadcast(n.EVENT_DEVTOOLS_FRAMES_DROPPED,a.frames),a.selector&&n.$broadcast(n.EVENT_DEVTOOLS_NODE_DROPPED,a.selector)},0)}},hasTemplate:e=>f(e)||h(e),getTemplateSrc:e=>f(e)?"/views/common/includes/inputPreview.html":h(e)?"/views/common/includes/arrayPreview.html":void 0,getTemplateModel:function(t){return function(n){let r=t.id.split(".");if(r[0]===e.selected.pageModel.id&&r.shift(),i.processModelsWithStubs(e.selected.pageModel.properties,e.preview),e.preview.data){let t=e.preview.data;for(let e=0;e<r.length-1;e++){let n=r[e];t[n]=t[n]||{},t=t[n]}let o=r.pop();if(n&&(t[o]=n),""===n&&(t[o]=""),t[o])return t[o]}}},getItemClass:t=>e.previewMode?h(t)?"array-preview-item":void 0:"",hasCheckbox:function(t){return e.selected.connection&&t.parent&&"identifier"===t.type}},e.pageModels=o.cache||[],e.selected=o.selected,e.previewMode=!1,e.preview=r.preview,e.$watch("selected.pageModel",function(){e.previewMode=!1}),e.$on("PAGE_MODEL_UPDATED",function(){e.pageModels=o.cache;let t=_.find(e.pageModels,function(t){return t.id===e.selected.pageModel.id});t?e.selected.pageModel=t:(o.selected.pageModel=e.pageModels[0]||{},o.selected.field=e.selected.pageModel)})}]),angular.module("webexplorer").controller("EventsCtrl",["$scope","$timeout","pageModelService","xDialogService","screenTreeService","screenService","connectionService",function(e,t,n,r,o,i,s){function a(t){return _.find(e.events,function(e){return e.event===t})}function l(e){let t=a(e);return t&&t.type}e.connectScreens=function(){r.connectScreens()},e.connectEvent=function(){e.tree.cancelEditing(),e.edit={},t(function(){document.querySelector(".events-container form[ng-submit] input").scrollIntoView()},!0)},e.connectAction=function(){r.connectAction()},e.selectTab=function(t){e.activeTab=t},e.treeOptions={getIcon:function(e){switch(l(e.event)){case"event":return"fa-file-code-o";case"screens":return"fa-files-o";case"action":return"fa-bolt";default:return"fa-file-text-o"}},getLabel:function(e){return e.event?e.event:e.screens?1===e.screens.length?e.screens[0].name:"":e.action?e.action:e.name},getDescription:function(e){return l(e.event)},getDescriptionIcon:function(e){var t=e.model,n=e.screens&&e.screens.length;if(e.event){if(t&&n)return u;if(t)return c;if(n)return d}else if(t)return c;return null},getChildren:function(e){return!e.event&&e.screens&&e.screens.length>1?e.screens:null},isCollapsible:function(){return!1},isClickable:function(e){return e.match},hasRename:function(e){return"event"===l(e.event)},onClick:function(t){t.match&&(e.selected.connection=this.isSelected(t)?null:t)},isSelected:function(t){return e.selected.connection===t||e.selected.connection===t.connection},isDraggable:function(){return!0},getDragData:function(e){return e.match?{id:e.id,type:"connection"}:{id:e.id,type:e.connection.id+"-screen"}},isSortable:function(){return!0},getType:function(e){return e.match?"connection":e.connection.id+"-screen"},moveNode:function(t,n,r){n.match?s.reorder(e.selected.pageModel,t,n,r):s.reorderScreens(n.connection,t,n,r)},isEditable:function(e){return!!e.match},clickAddChild:!1,getControls:function(e){switch(l(e.event)){case"screens":return p;case"action":return f;default:return}},confirmDeleting:function(t){e.selected.connection===t&&(e.selected.connection=null),s.delete(t)},confirmEditing:function(t){a(t.event).event=this.edit.name,s.connectEvent(e.selected.pageModel,this.edit.name,t),this.cancel()},clickRename:function(e,t){t.stopPropagation(),this.edit.node=e,this.edit.name=e.event},getAcceptedTypes:function(e){return e.screens?["screen"]:[]},getDragEnter:function(){return function(e){e.classList.add("drag-over")}},getDragLeave:function(){return function(e){e.classList.remove("drag-over")}},getDragDrop:function(t){return function(n,r){var a=r.getData("id"),l=o.findById(a),c=e.selected.pageModel,d=_.pluck(t.screens,"id");d.push(l.id),s.connectScreens(c,d,t),i.connectPageModel(l,c)}},hasLeftButton:function(){return!0}},e.isValid=function(t){return s.validateName(e.selected.pageModel.connect,e.edit.name)},e.cancel=function(){e.edit=null},e.confirmEditing=function(){s.addEvent({type:"event",event:e.edit.name}),s.connectEvent(e.selected.pageModel,e.edit.name),e.cancel()};var c=[],d=["fa-files-o"],u=["fa-files-o"],p=[{icon:"fa-pencil",title:"Edit",action:function(t,n){n.stopPropagation(),e.selected.connection===t&&(e.selected.connection=null),r.connectScreens(t)}}],f=[{icon:"fa-pencil",title:"Edit",action:function(t,n){n.stopPropagation(),e.selected.connection===t&&(e.selected.connection=null),r.connectAction(t)}}];e.activeTab="selector",e.selected=n.selected,e.events=s.cache.events,e.$watch("selected.pageModel",function(t){if(e.selected.pageModel.connect){let t={pageModelId:e.selected.pageModel.name,events:e.selected.pageModel.connect.map(function(e){return e.event})};s.fetchEvents(t).then(function(){e.events=s.cache.events})}})}]),angular.module("webexplorer").controller("SelectorCtrl",["$scope","pageService","pageModelService","screenTreeService","screenService","connectionService","explorerService","injectableService","selectorService","powwowService",function(e,t,n,r,o,i,s,a,l,c){function d(t,n){l.getSelectorCount(t,n).then(function(t){e.model.count=e.model.hasError?0:t})}function u(e,t,n,r,o){for(var i in e.properties)if(e.properties[i]===t)for(var s=n.split("."),a=0;a<s.length;a++)r.name===s[a]&&(o.value=!1);else{var l="descriptor"===e.properties[i].type,c=e.properties[i].descriptor;if(l&&c){var d=n+"."+c;u(e.properties[i],t,d,r,o)}}}function p(e,t,n,r){for(var o in e.properties){var i=e.properties[o];if("descriptor"===i.type&&i.descriptor===t.name)for(var s=n.split("."),a=0;a<s.length;a++)r.value=!1;else{var l="descriptor"===i.type,c=i.descriptor;if(l&&c){p(i,t,n+"."+c,r)}}}}e.$watch("selected.field",function(t){if(e.resetModel(),!t||_.isEmpty(t))return!1;if(!t.selector&&!t.selectorAll){var n="array"===t.type?"selectorAll":"selector";t[n]=""}var r=e.model;r.isArray="array"===t.type,r.editing=!1,r.frameSelectors=t.frameSelector?[t.frameSelector]:[""],r.selectorKey=_.has(t,"selector")?"selector":"selectorAll",r.altKey=_.has(t,"selector")?"selectorAll":"selector",_.isArray(t.frameSelector)&&(r.frameSelectors=angular.copy(t.frameSelector)),e.isComplex.control=r.isArray?_.isObject(t.items.control):_.isObject(t.control);var o=t[r.selectorKey];e.isComplex.selector=_.isObject(o),r.singleNode=!1,r.multipleNodes=!1,e.isComplex.selector&&(_.has(t,"selectorAll")&&_.has(t.selectorAll,"selector")?r.singleNode=!0:_.has(t,"selector")&&_.has(t.selector,"selectorAll")&&(r.multipleNodes=!0));var i=e.isComplex.selector?o[r.singleNode||r.multipleNodes?r.altKey:r.selectorKey]:o;r.hasError=!l.isValidSelector(i),o&&o.fn&&(e.selectedFunctions.find=_.find(e.injectables.find,e=>e.name===o.fn),r.findArgs=o.args?[o.args]:[""]);var s=e.isComplex.control?t.control.control:t.control;s&&([s,r.ctrlArg]=s.split(/\.(.+)/)),e.selectedFunctions.controls=_.find(e.injectables.controls,e=>e.name===s),r.isArray="radio"===s,t.control&&t.control.fn&&(e.selectedFunctions.extract=_.find(e.injectables.extract,e=>e.name===t.control.fn),r.extractArgs=t.control.args?[t.control.args]:[""]),e.$parent.$broadcast(e.EVENT_CLEAR_EDITOR),d(i,r.frameSelectors)}),e.$watch("model.singleNode",function(r){var o=e.selected.node;if(!o||!_.has(o,"selectorAll"))return!1;if(r&&_.has(o.selectorAll,"selectorAll"))o.selectorAll.selector=o.selectorAll.selectorAll,delete o.selectorAll.selectorAll;else{if(r||!_.has(o.selectorAll,"selector"))return!1;o.selectorAll.selectorAll=o.selectorAll.selector,delete o.selectorAll.selector}var i=n.getDescriptorToInject(e.selected.pageModel,!0);c.injectAndBatch(i,s.tree.updateNode,{pageModelId:o.root.id,path:o.path,name:o.name,selectorAll:o.selectorAll||""}).then(function(){t.getMatchedConnections()})}),e.$watch("model.multipleNodes",function(r){var o=e.selected.field;if(!o||!_.has(o,"selector"))return!1;if(r&&_.has(o.selector,"selector"))o.selector.selectorAll=o.selector.selector,delete o.selector.selector;else{if(r||!_.has(o.selector,"selectorAll"))return!1;o.selector.selector=o.selector.selectorAll,delete o.selector.selectorAll}var i=n.getDescriptorToInject(e.selected.pageModel,!0);c.injectAndBatch(i,s.tree.updateNode,{pageModelId:o.root.id,path:o.path,name:o.name,selector:o.selector||""}).then(function(){t.getMatchedConnections()})}),e.$on("PAGE_MODEL_UPDATED",function(){"array"===e.selected.field.type&&(e.model.isArray=!0,e.model.selectorKey="selectorAll",e.model.altKey="selector")}),e.viewFind=function(){e.sections.find=!e.sections.find},e.hasFind=function(){var t=e.selected.field;return e.sections.find||t.frameSelector||t.selectHidden||t.selectIndex||t.selectContains||t.selector&&t.selector.fn||t.selectorAll&&t.selectorAll.fn},e.viewExtract=function(){e.sections.extract=!e.sections.extract},e.hasExtract=function(){var t=e.selected.field;return e.sections.extract||t.comment||t.control&&t.control.fn},e.notObject=function(){return!~["object","array"].indexOf(e.selected.field.type)},e.openSourceEditor=function(t){e.globals.activeSourceTab=t,e.globals.selectedFunction=e.selectedFunctions[t],e.globals.sourceEditorOpened=!0},e.updateProperty=function(t,r){var o=e.selected.field;r&&"array"===o.type&&(e.model.isArray=!0,e.model.selectorKey="selectorAll",e.model.altKey="selector");var i={name:t||o.name,newName:o.name,type:"array"===o.type?"object[]":o.type};r&&(o.type=r),n.updateProperty(o,i)},e.updateNode=function(r){if(e.model.hasError)return;var o=e.selected.field;let i;i=o.parentModel?n.findById(o.parentModel):e.selected.pageModel,o.pageModelName=i.name;var a={pageModelId:o.root.id,path:o.path,name:o.name};a[r]=o[r],a.type=o.type||null,a.descriptor=o.descriptor||null;var l=n.getDescriptorToInject(i,!0),d=s.tree.updateNode,u=a;c.injectAndBatch(l,d,u).then(function(){t.getMatchedConnections()}),t.extract(i.id)},e.checkSelector=function(t){var n=e.selected.field,r=e.isComplex.selector?n[t][t]:n[t];l.isValidSelector(r)?(e.model.hasError=!1,e.updateNode(t),d(r,e.model.frameSelectors)):e.model.hasError=!0},e.filterModels=function(t){var n={value:!0},r=e.selected.pageModel,o=e.selected.field;return"descriptor"===o.type&&u(r,o,r.name,t,n),p(t,r,t.name,n),n.value},e.hasControl=function(e){return e&&"object"!==e.type&&(!e.items||"object"!==e.items.type)},e.isComplexChanged=function(t){var r=e.selected.field,o=e.isComplex[t];n.updateComplexAttribute(r,t,o),"array"===r.type&&"selector"===t&&(t+="All"),t=o?t+"."+t:t,"array"===r.type&&~t.indexOf("control")&&(t="items."+t),e.updateNode(t)},e.addArgument=function(t){e.model[t+"Args"].push(""),e.updateArgument(t)},e.removeArgument=function(t,n){e.model[t+"Args"].splice(n,1),e.updateArgument(t)},e.updateArgument=function(t){var n=e.selected.field,r=e.model[t+"Args"];"find"===t?(n.selector.args=r,e.updateNode("selector")):(n.control.args=r,e.updateNode("control"))},e.addFrameSelector=function(){e.model.frameSelectors.push(""),e.updateFrameSelector()},e.removeFrameSelector=function(t){e.model.frameSelectors.splice(t,1),e.updateFrameSelector()},e.updateFrameSelector=function(){var t=e.selected.field,n=e.model.frameSelectors;n.length>1?t.frameSelector=n:t.frameSelector=n[0],e.updateNode("frameSelector")},e.updateParams=function(t){var n=e.selectedFunctions.controls;e.model.ctrlArg=t||!e.model.ctrlArg?"":e.model.ctrlArg.trim();var r=n?n.name+`${e.model.ctrlArg?`.${e.model.ctrlArg}`:""}`:"";let o=e.selected.field;n&&"radio"===n.name?(o.selectorAll=o.selectorAll?o.selectorAll:o.selector,o.selector="",e.updateNode("selector"),e.model.selectorKey="selectorAll",e.model.altKey="selector",e.updateNode("selectorAll"),delete o.selector):(o.selector=o.selectorAll?o.selectorAll:o.selector,o.selectorAll="",e.updateNode("selectorAll"),e.model.selectorKey="selector",e.model.altKey="selectorAll",e.updateNode("selector"),delete o.selectorAll),e.isComplex.control?o.control.control=r:o.control=r,e.updateNode("control")},e.onFnChange=function(t){e.selectedFunctions[t]?function(t){var n=e.selectedFunctions[t],r=e.selected.field;switch(e.globals.selectedFunction=n,t){case"find":return e.isComplex.selector=!0,r.selector={selector:"object"==typeof r.selector?r.selector.selector:r.selector,fn:n.name,args:e.model.findArgs},e.updateNode("selector");case"controls":return"object"==typeof r.control?r.control.control=n.name:r.control=n.name,e.updateParams(!0);case"extract":e.isComplex.control=!0,r.control={control:"object"==typeof r.control?r.control.control:r.control,fn:n.name,args:e.model.extractArgs},e.updateNode("control")}}(t):function(t){e.selectedFunctions[t]=null;var n=e.selected.field;switch(t){case"find":return e.model.findArgs=[""],e.isComplex.selector=!1,n.selector=n.selector.selector,e.updateNode("selector");case"controls":return e.updateParams(!0);case"extract":e.model.extractArgs=[""],e.isComplex.control=!1,n.control=n.control.control,e.updateNode("control")}}(t)},e.onDragDrop=function(t,n){var s=n.getData("id"),a=r.findById(s),l=e.selected.pageModel;i.connectScreens(l,[a.id]),o.connectPageModel(a,l)},e.$on(e.EVENT_DEVTOOLS_NODE_DROPPED,function(t,n){var r=l.getControls(n,e.selected.field.type);[r,e.model.ctrlArg]=r.split(/\.(.+)/),e.notObject()&&function(t,n){e.selectedFunctions.controls=_.find(e.injectables.controls,e=>e.name===t),e.updateParams(n)}(r,!1);var o=e.model,i=o.selectorKey;l.formatSelector(n,e.model.frameSelectors).then(function(t){"td"===t&&(e.selected.field.selectIndex=n[1],e.updateNode("selectIndex")),e.isComplex.selector?o.singleNode||o.multipleNodes?e.selected.field[i][o.altKey]=t:e.selected.field[i][i]=t:e.selected.field[i]=t,e.updateNode(i),d(t,e.model.frameSelectors)})}),e.$on(e.EVENT_DEVTOOLS_FRAMES_DROPPED,function(t,n){n.reduceRight(function(e,t){return e.then(function(e){return l.formatSelector(t,e)})},Promise.resolve([])).then(function(t){e.model.frameSelectors=t,e.updateFrameSelector(),_.isEmpty(e.model.frameSelectors)&&(e.model.frameSelectors=[""])})}),e.notEmpty=function(){return!_.isEmpty(e.selected.field)},e.pageModels=n.cache,e.selected=n.selected,window.document.addEventListener("POWWOW_INJECTED",function(){n.selected.field=n.cache[0]||{}}),e.injectables=a.injectables,e.model={},e.isComplex={},e.selectedFunctions={},e.sections={},e.resetModel=function(){e.model={count:0,hasError:!1,isArray:!1,editing:!1,ctrlArg:"",findArgs:[""],extractArgs:[""],frameSelectors:[""],selectorKey:"",altKey:"",singleNode:!1,multipleNodes:!1},e.isComplex={control:!1,selector:!1},e.selectedFunctions={find:null,extract:null,controls:null},e.sections={find:!1,extract:!1}},e.resetModel(),e.typeOptions=l.typeOptions,e.getParam=l.getControlParam}]),angular.module("webexplorer").controller("StatusbarCtrl",["$scope","$rootScope","pageService","pageModelService",function(e,t,n,r){e.reload=function(){n.getMatchedConnections()},e.openPageModel=function(e){r.selected.pageModel=r.findById(e),r.selected.field=r.selected.pageModel},e.isString=function(e){return angular.isString(e)}}]),angular.module("webexplorer").controller("xFilesCtrl",["$scope","allFilesService",function(e,t){const n=["sessions.delete","applications.delete"];e.$on(e.EVENT_API_SUCCESS,(e,r)=>{const o=n.reduce((e,t)=>!!r.name.match(new RegExp(t))||e,!1);"files"!==r.namespace&&r.isSetter&&!o&&t.refreshAllFilesTab()})}]),angular.module("webexplorer").controller("AuthenticateDialogCtrl",["$scope","protocolService",function(e,t){e.username="",e.password="",e.cancelAuth=function(){t.Network.continueInterceptedRequest({interceptionId:e.ngDialogData.data.interceptionId,authChallengeResponse:{response:"CancelAuth"}}).then(e.closeThisDialog)},e.attemptAuth=function(){t.Network.continueInterceptedRequest({interceptionId:e.ngDialogData.data.interceptionId,authChallengeResponse:{response:"ProvideCredentials",username:e.username,password:e.password}}).then(e.closeThisDialog)}}]),angular.module("webexplorer").controller("ConnectActionCtrl",["$scope","explorerService","connectionService","modelTreeService","pageModelService",function(e,t,n,r,o){var i=o.selected.pageModel,s=e.ngDialogData.connection,a=s?n.getEvent(s.event).action:null;e.actionsTree=r.filterTypes(i,["action"]),e.submit=function(){e.submitted=!0,s&&n.deleteEvent(s.event);let t=function(e){var t=e.replace(/\./g,"_"),r="";do{var o=_.find(n.cache.events,function(e){return e.event===t+r});r=o?r?++r:2:r}while(o);return t+r}(a);n.addEvent({type:"action",action:a,event:t}),n.connectAction(i,a,s,t),e.closeThisDialog()},e.isValid=function(){return!!a},e.treeOptions={getIcon:r.getIcon,getChildren:r.getChildren,getDescription:r.getDescription,getDescriptionIcon:r.getDescriptionIcon,isClickable:function(e){return"action"===e.type},onClick:function(t){var r=n.getMatchId(t,e.actionsTree);a=a===r?null:r},hasCheckbox:function(e){return"action"===e.type},isChecked:function(t){return a===n.getMatchId(t,e.actionsTree)},onClickCheckbox:function(){return!1}}}]),angular.module("webexplorer").controller("ConnectScreensCtrl",["$rootScope","$scope","apiService","batchRequest","connectionService","xScreenTreeService","xScreenService","pageModelService",function(e,t,n,r,o,i,s,a){var l=a.selected.pageModel,c=t.ngDialogData.connection,d=c?o.getEvent(c.event).screens:[];t.pageModel=l,t.submit=function(){t.submitted=!0,c&&o.deleteEvent(c.event);var e=function(e){var t=e.join("_"),n="";do{var r=_.find(o.cache.events,function(e){return e.event===t+n});n=r?n?++n:2:n}while(r);return t+n}(d);o.addEvent({type:"screens",screens:d,event:e}),o.connectScreens(l,d,c,e),_.each(d,function(e){var t=i.findById(e);s.connectPageModel(t,l)}),t.closeThisDialog()},t.isValid=function(){return d.length},t.refresh=function(){t.showLoading(),s.fetch().then(()=>{e.global.screens=s.screensTree.screens,t.hideLoading()})},t.treeOptions={getIcon:function(e){return e.folder&&e.expanded?"fa-folder-open-o":e.folder?"fa-folder-o":void 0},isCollapsible:function(){return!1},isClickable:function(e){return!e.screens},getChildren:function(e){return e.expanded=!0,e.screens},onClick:function(e){~d.indexOf(e.id)?d.splice(d.indexOf(e.id),1):d.push(e.id)},hasCheckbox:function(e){return!e.screens},isChecked:function(e){return~d.indexOf(e.id)},onClickCheckbox:function(){return!1},isHidden:function(e){return e.pageModel&&e.pageModel!==l}},t.pageModelTreeOptions={getLabel:function(e){return e.expanded=!0,e.name},isCollapsible:function(){},isClickable:function(e){},getChildren:function(e){if("array"===(e=e||this).type&&"object"===e.items.type)return e.items.properties;if("object"===e.type)return e.properties;if("method"===e.type)return e.parameters;if("descriptor"===e.type){var t=_.find(a.cache,{id:e.descriptor});return t?t.properties:null}return null},onClick:function(e){},hasCheckbox:function(e){return"object"===e.type||"descriptor"===e.type},isChecked:function(e){},onClickCheckbox:function(){},hasIcon:function(){return!0},getIcon:function(e){return e.descriptor?"fa-external-link":"Toggle menu"===e.id?"fa-bars":"action"===e.type?"fa-bolt":"method"===e.type?"fa-code":"identifier"===e.type?"fa-question":-1===["array","object"].indexOf(e.type)?"fa-cube":"fa-cubes"}}}]),angular.module("webexplorer").controller("JavascriptDialogCtrl",["$scope","protocolService",function(e,t){function n(n){t.Page.handleJavaScriptDialog({accept:n,promptText:e.ngDialogData.data.prompt}).then(e.closeThisDialog)}e.isAlert=function(){return"alert"===e.dialogType},e.isPrompt=function(){return"prompt"===e.dialogType},e.isUnload=function(){return"beforeunload"===e.dialogType},e.dialogType=e.ngDialogData.data.type,e.message=e.isUnload()?"Do you want to leave this site?":e.ngDialogData.data.message,e.confirm=e.isUnload()?"Leave":"OK",e.dismiss=e.isUnload()?"Stay":"Cancel",e.accept=n.bind(null,!0),e.cancel=n.bind(null,!1)}]),angular.module("webexplorer").controller("PushMockDataCtrl",["$scope","helperService","xMockService","pageModelService",function(e,t,n,r){e.selectedPageModel=r.selected.pageModel,e.mocks=n.cache[r.selected.pageModel.id],e.preview=JSON.stringify(e.ngDialogData.data,null,"\t"),e.model={dataSet:null},e.copyToClipboard=function(){document.querySelector("#previewTextarea").select(),document.execCommand("copy")},e.submit=function(){n.updateData(e.ngDialogData.data,r.selected.pageModel.id,e.model.dataSet.id),e.closeThisDialog()},e.isValid=function(n){var r=t.filterName(n.name);return r.length&&-1===_.pluck(e.mocks,"id").indexOf(r)},e.createDataSet=function(){e.edit={}},e.cancel=function(){e.edit=null},e.confirmEditing=function(){e.model.dataSet=n.createDataSet(e.edit.name,r.selected.pageModel.id),e.cancel()},e.treeOptions={getLabel:function(e){return e.id||"Default"},onClick:function(t){e.model.dataSet=e.model.dataSet===t?null:t},hasCheckbox:function(){return!0},isChecked:function(t){return t===e.model.dataSet},onClickCheckbox:function(){return!1}}}]),angular.module("webexplorer").controller("UpdateWebConnectorCtrl",["$scope","$stateParams","dialogService","explorerService","resizerService","protocolService","ratioService","tabService","devtoolsMethods","commonHelperService","xSettingsService",function(e,t,n,r,o,i,s,a,l,c,d){e.model=d.config,e.model.name=t.explorerId,e.model.autoResize=o.autoResize,e.model.authWhitelistUrls=l.authWhitelistUrls,e.delete=function(){n.confirm("Confirm Exploration Delete","Are you sure you want to delete the exploration?",{},!0).then(()=>(e.closeThisDialog(),r.sessions.delete(),r.applications.delete())).then(()=>{r.sessions.removeAllWsConnections(),window.name="Home",window.location=e.getLink("applications"),window.location.reload()})},e.toggleAutoResize=function(){o.autoResize=e.model.autoResize},e.update=function(){e.showLoading(),e.submitted=!0,l.authWhitelistUrls=e.model.authWhitelistUrls,r.applications.update({name:e.model.name,config:{startURL:{value:c.checkUrlScheme(e.model.startURL)},viewportSize:{value:"{width:"+e.model.width+", height: "+e.model.height+"}"},autoResize:{value:e.model.autoResize},authWhitelistUrls:{value:e.model.authWhitelistUrls}},directory:""}).then(function(n){r.sessions.restart().then(function(e){a.emptyTabs(),l.reinitDevTools(e.id,e.version)}).then(function(){n.success&&(e.closeThisDialog(),e.hideLoading(),o.autoResize?o.updateViewport():(i.Emulation.setDeviceMetricsOverride({width:e.model.width,height:e.model.height,deviceScaleFactor:0,mobile:!1}),s.config.width=e.model.width,s.config.height=e.model.height),e.model.name!==t.explorerId&&r.sessions.delete().then(function(){window.location=e.getLink("app/"+t.appId+"/explorer/"+e.model.name),window.location.reload()}))})})},e.isValid=function(){return!!(e.model.startURL&&e.model.height&&e.model.width&&e.model.name)}}]);